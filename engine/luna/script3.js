Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="meshFilter"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{MeshFilterComponentSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this._mesh=null};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh=t}}),{MeshFilterComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="renderer",this.defaultMaterial=t.scene.defaultMaterial};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{RendererComponentSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this.model=new pc.Model,this._castShadows=!0,this._receiveShadows=!0,this.system=pc.Application.getApplication().systems.renderer,this._material=this.system.defaultMaterial,this.code=null,this._lastAABBVersion=-1};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onAttached:function(){pc.UnityComponent.prototype.onAttached.call(this),this.model&&(this.model.entity=this.entity)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(pc.Application.getApplication().scene.addRenderer(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(pc.Application.getApplication().scene.removeRenderer(this),!0)},synchronizeWithEntity(){this.entity&&this.code&&(this._destroyed||this._lastAABBVersion===this.entity.aabbVersion||(this._lastAABBVersion=this.entity.aabbVersion,this.code._lightProbeUsage&&this.code.UpdateProbes(),this.model.flipFaces=this.entity._isOddlyScaled()))},getMeshInstancesForRender:function(){return this.synchronizeWithEntity(),this.code.OnBeforeRender&&this.code.OnBeforeRender(),this.model.update(),this.model.meshInstances},getPropertyBlock:function(t,e){this.model.update();const i=this.model.meshInstances[e];i?t.handle.copyFromMeshInstance(i):console.warn("MaterialPropertyBlock index "+e+" is out of range")},setPropertyBlock:function(t,e){this.model.update();const i=this.model.meshInstances[e];i?t.handle.applyToMeshInstance(i):console.warn("MaterialPropertyBlock index "+e+" is out of range")},setMesh:function(t){this.model.setMeshDirectlyToMeshInstance(t)}}),Object.defineProperty(t.prototype,"aabb",{get:function(){return this._aabb||(this._aabb=new pc.BoundingBox),this.model&&this.model.mesh?this._aabb.setFromTransformedAabb(this.model.mesh.aabb,this.entity.worldTransform):this._aabb.setMinMax(pc.Vec3.ZERO,pc.Vec3.ZERO),this._aabb}}),Object.defineProperty(t.prototype,"meshInstances",{get:function(){return this.model?this.model.meshInstances:null},set:function(t){this.model&&(this.model.meshInstances=t)}}),Object.defineProperty(t.prototype,"castShadows",{get:function(){return this._castShadows},set:function(t){this._castShadows!==t&&(this._castShadows=t)}}),Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(t){if(this._receiveShadows!==t&&(this._receiveShadows=t,this.model)){const e=this.model.meshInstances;for(let i=0,n=e.length;i<n;i++)e[i].receiveShadow=t}}}),{RendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.code=new UnityEngine.SpriteRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,{SpriteRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.meshFilter=null,this.code=new UnityEngine.MeshRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.updateMesh(),!0)},getMeshInstancesForRender:function(){return this.synchronizeWithEntity(),this.updateMesh(),this.model.update(),this.model.meshInstances},updateMesh:function(){this.meshFilter&&!this.meshFilter._destroyed||(this.meshFilter=this.entity.getUnityComponent("meshFilter"));const t=null!=this.meshFilter?this.meshFilter.mesh:null;this.model.mesh!==t&&(this.model.mesh=t)}}),{MeshRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.code=new UnityEngine.SkinnedMeshRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,{SkinnedMeshRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.code=new UnityEngine.LineRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)}}),{LineRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.code=new UnityEngine.TrailRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,Object.assign(t.prototype,{_queuesToSubscribe:function(){return["onUpdate"]},onEnable:function(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onUpdate:function(t){this.code.Update()}}),{TrailRendererComponent:t}}()),Object.assign(pc,function(){const t=new pc.Mat4,e=new pc.Vec3,i=function(t){this.options=t,this._rigidbodies=[],this._fauxBodies={},this._colliders=[],this._constraints=[],this._isSimulating=!1,this.setup()};return i.PreSyncStages={TransformToPhysics:1,PhysicsToTransform:2},i.prototype={enableRigidbody:function(t){t.body._component=t,this.addRigidbody(t.body),this._rigidbodies.push(t),this.reattachCollidersInChildren(t.entity)},disableRigidbody:function(t){const e=this._rigidbodies,i=e.indexOf(t);i<0||(this.removeRigidbody(t.body),t.body._component=null,e[i]=e[e.length-1],e.pop(),this.reattachCollidersInChildren(t.entity))},enableCollider:function(i){i.shape&&(i.shape._component=i);const n=this.fetchBody(i.entity);i._body=n,this.getRelTransformAndAccumScale(n,i,t,e),i.updateShape(t,e,n),this.addCollider(n,i),this._colliders.push(i)},disableCollider:function(t){const e=this._colliders,i=e.indexOf(t);i<0||(t._body&&this.removeCollider(t._body,t),e[i]=e[e.length-1],e.length-=1)},enableConstraint:function(t){t.constraint._component=t,this.addConstraint(t),this._constraints.push(t)},disableConstraint:function(t){const e=this._constraints,i=e.indexOf(t);i<0||(this.removeConstraint(t),e[i]=e[e.length-1],e.length-=1)},fetchBody:function(t){let e=t;for(;e;){if(e._enabledInHierarchy){const t=this.getAttachedRigidbody(e);if(t)return t}e=e._parent}let i=this._fauxBodies[t._guid];return i||(i=this._fauxBodies[t._guid]=this.attachFauxRigidbody(t),i._body=i,i._entity=t,i)},onFixedUpdate:function(t){this._isSimulating=!0,this.onBeforeSimulation(),this.onSimulationStep(t),this.onAfterSimulation(),this._isSimulating=!1},onBeforeSimulation:function(){let t,e=this._rigidbodies;e.sort(this.compareBodyDepths);let n=e.length;for(t=0;t<n;t++)this.preSimulationSynchronization(e[t],i.PreSyncStages.TransformToPhysics);for(t=0;t<n;t++)this.preSimulationSynchronization(e[t],i.PreSyncStages.PhysicsToTransform);e=this._fauxBodies;for(const t in e)this.preSimulationSynchronization(e[t],i.PreSyncStages.TransformToPhysics);for(e=this._constraints,n=e.length,t=0;t<n;++t)this.updateConstraint(e[t]);for(e=this._colliders,n=e.length,t=0;t<n;t++)this.preSimulationSynchronizationForCollider(e[t])},onAfterSimulation:function(){let t,e,i=this._rigidbodies,n=i.length;for(e=0;e<n;e++){t=i[e],this.postSimulationSynchronization(t);const n=t._entity;t._worldTransformVersion=n.aabbVersion}for(i=this._colliders,n=i.length,e=0;e<n;e++){t=i[e];const n=t._entity;t._worldTransformVersion=n.aabbVersion}this.handleContacts()},compareBodyDepths:function(t,e){return t._entity.graphDepth-e._entity.graphDepth},dispatchContact:function(t,e,i){return t.sendPhysicsEvent(e,i)},entityHasEventListeners:function(t,e){return t._magicMethods&&t._magicMethods[e]},setIgnoreCollisionBetweenLayers:function(t,e,i){const n=this._world.collision_matrix,o=n[t]=n[t]||0,s=n[e]=n[e]||0;i?(n[t]=o|1<<e,n[e]=s|1<<t):(n[t]=o&~(1<<e),n[e]=s&~(1<<t))},reattachCollidersInChildren:function(t){if(!t._enabledInHierarchy)return;const e=this.getAttachedColliders(t);for(let i=0;i<e.length;i++){const n=e[i];!n.enabled||!n._body||n._body._component&&n._body._component._entity===t||(this.disableCollider(n),this.enableCollider(n))}const i=t._children;for(let t=0,e=i.length;t<e;t++){const e=i[t];this.getAttachedRigidbody(e)||this.reattachCollidersInChildren(e)}},syncHierarchy:function(t){if(t._enabledInHierarchy){if(this.getAttachedRigidbody(t))return;this.reattachCollidersInChildren(t)}},syncTransformsInChildren:function(t){if(!t._enabledInHierarchy)return;const e=this.getAttachedRigidbody(t);let n=e&&e._component;n&&this.preSimulationSynchronization(n,i.PreSyncStages.TransformToPhysics),n=this._fauxBodies[t._guid],n&&this.preSimulationSynchronization(n,i.PreSyncStages.TransformToPhysics);const o=this.getAttachedColliders(t);for(let t=0;t<o.length;t++){const e=o[t];e.enabled&&e._body&&this.preSimulationSynchronizationForCollider(e)}const s=t._children;for(let t=0,e=s.length;t<e;t++)this.syncTransformsInChildren(s[t])},syncTransforms:function(t){this._isSimulating||this.syncTransformsInChildren(t)},setup:function(){throw new Error("Not Implemented")},onSimulationStep:function(t){throw new Error("Not Implemented")},getAttachedColliders:function(t){throw new Error("Not Implemented")},getAttachedRigidbody:function(t){throw new Error("Not Implemented")},attachFauxRigidbody:function(t){throw new Error("Not Implemented")},addRigidbody:function(t){throw new Error("Not Implemented")},removeRigidbody:function(t){throw new Error("Not Implemented")},addCollider:function(t,e){throw new Error("Not Implemented")},removeCollider:function(t,e){throw new Error("Not Implemented")},handleContacts:function(){throw new Error("Not Implemented")},addConstraint:function(t){throw new Error("Not Implemented")},removeConstraint:function(t){throw new Error("Not Implemented")},getRelTransformAndAccumScale:function(t,e,i,n){throw new Error("Not Implemented")},updateConstraint:function(t){throw new Error("Not Implemented")},preSimulationSynchronization:function(t,e){throw new Error("Not Implemented")},preSimulationSynchronizationForCollider:function(i){const n=i._entity.aabbVersion;i._worldTransformVersion!==n&&(this.getRelTransformAndAccumScale(i._body,i,t,e),i.updateShape(t,e),i._worldTransformVersion=n)},postSimulationSynchronization:function(t){throw new Error("Not Implemented")}},{BasePhysicsAdapter:i}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Quat,i=new pc.Vec3,n=new pc.Quat,o=new Goblin.Vector3,s=new Goblin.Quaternion,r=function(t){pc.BasePhysicsAdapter.call(this,t)};return(r.prototype=Object.create(pc.BasePhysicsAdapter.prototype)).constructor=r,Object.assign(r.prototype,{setup:function(){this.wheelColliders=[],this._world=this.options.world,this._world.eventEmitter._onCollisionContactEnter=this.onCollisionContactEnter.bind(this),this._world.eventEmitter._onCollisionContactStay=this.onCollisionContactStay.bind(this),this._world.eventEmitter._onCollisionContactExit=this.onCollisionContactExit.bind(this),this._world.eventEmitter._onTriggerContactEnter=this.onTriggerContactEnter.bind(this),this._world.eventEmitter._onTriggerContactStay=this.onTriggerContactStay.bind(this),this._world.eventEmitter._onTriggerContactExit=this.onTriggerContactExit.bind(this),this.integratedTime=0,this.integratedPhysicsTime=0},addRigidbody:function(t){t.world||(this.synchronizeBodyWithEntity(t._component||t._fauxComponent),this._world.addRigidBody(t))},removeRigidbody:function(t){this._world.removeRigidBody(t)},addCollider:function(t,e){e._shape&&(t.shape.addChildShape(e._shape,e.getColliderPositionGoblin(),e.getColliderRotationGoblin()),t.onShapeUpdated(),this.preSimulationSynchronizationForCollider(e))},removeCollider:function(t,e){e._shape&&(t.shape.removeChildShape(e.id),t.onShapeUpdated())},enableWheelCollider:function(t){this.wheelColliders.push(t)},disableWheelCollider:function(t){const e=this.wheelColliders.indexOf(t);-1!==e&&(this.wheelColliders[e]=this.wheelColliders[this.wheelColliders.length-1],this.wheelColliders.pop())},addConstraint:function(t){this._world.addConstraint(t.constraint)},removeConstraint:function(t){this._world.removeConstraint(t.constraint)},onSimulationStep:function(t){this._world.step(t)},getAttachedColliders:function(t){return t._unityComponents.collider},getAttachedRigidbody:function(t){const e=t._unityComponents.rigidbody[0];if(!e)return null;const i=e.enabled,n=!!e._body&&!!e._body._component;return i&&n?e._body:null},attachFauxRigidbody:function(t){const e=new Goblin.RigidBody(-1,1/0),i=pc.RigidbodyComponent.fromStaticBody(e);return i.useGravity=!1,i.isStatic=!0,i.entity=t,i._entity=t,this.addRigidbody(e),this.synchronizeBodyWithEntity(i),e},getRelTransformAndAccumScale:function(t,e,i,n){},synchronizeBodyWithEntity:function(t,e=!0,i=!0){const n=t._entity,r=t._body,c=n.getPosition(),a=n.getRotation();o.set(c.x,c.y,c.z),s.set(a.x,a.y,a.z,a.w),e&&i?(r.setTransform(o,s),t._previousSyncPosition.copy(c),t.interpolatedPosition.copy(c),t._previousSyncRotation.copy(a),t.interpolatedRotation.copy(a)):e?(r.setPosition(o),t._previousSyncPosition.copy(c),t.interpolatedPosition.copy(c)):(r.setRotation(s),t._previousSyncRotation.copy(a),t.interpolatedRotation.copy(a)),t.interpolatedFraction=0,t.interpolatedAABBVersion=n.aabbVersion},synchronizeEntityWithBody:function(i,n=!0,o=!0){const s=i.entity;i.body.getTransform(t,e);const r=s.getPosition(),c=s.getRotation();if(n&&!r.equals(t)){const e=i.constraints;let n=!1;e&UnityEngine.RigidbodyConstraints.FreezePositionX&&(t.x=r.x,n=!0),e&UnityEngine.RigidbodyConstraints.FreezePositionY&&(t.y=r.y,n=!0),e&UnityEngine.RigidbodyConstraints.FreezePositionZ&&(t.z=r.z,n=!0),s.setPosition(t),n&&(i.position=t),i._previousSyncPosition.copy(t),i.interpolatedPosition.copy(t),i.interpolatedFraction=0}o&&Math.abs(c.dot(e))<1-Goblin.EPSILON&&(s.setRotation(e),i._previousSyncRotation.copy(e),i.interpolatedRotation.copy(e),i.interpolatedFraction=0)},updateConstraint:function(t){},synchronizeBodyTransform:function(t){},preSimulationSynchronization:function(t,e){t._fauxComponent&&(t=t._fauxComponent);const i=t._body,n=t._entity;if(!t.isInterpolationOrExtrapolationEnabled()||!i.isDynamic||n.aabbVersion!==t.interpolatedAABBVersion){if(e===pc.BasePhysicsAdapter.PreSyncStages.TransformToPhysics){if(!(t._worldTransformVersion!==n.aabbVersion))return;const e=!t._previousSyncPosition.equals(n.getPosition()),i=!t._previousSyncRotation.equals(n.getRotation());return this.synchronizeBodyWithEntity(t,e,i),void(t._worldTransformVersion=n.aabbVersion)}if(e===pc.BasePhysicsAdapter.PreSyncStages.PhysicsToTransform){const e=!i.isKinematic||t._dirtyPosition,n=!i.isKinematic||t._dirtyRotation;if(!e&&!n)return;this.synchronizeEntityWithBody(t,e,n),t._dirtyPosition=!1,t._dirtyRotation=!1}}},preSimulationSynchronizationForCollider:function(t){pc.BasePhysicsAdapter.prototype.preSimulationSynchronizationForCollider.call(this,t),t.layer=t.entity.cullingLayer},postSimulationSynchronization:function(i){const n=i._entity,o=i._body,s=i._worldTransformVersion!==n.aabbVersion;if(o.isKinematic)s&&this.synchronizeBodyWithEntity(i);else if(!o.isStatic||s){if(o.isDynamic&&i.shouldInterpolatePosition())return n.setPosition(i._previousSyncPosition),n.setRotation(i._previousSyncRotation),i.interpolatedPosition.copy(n.getPosition()),i.interpolatedRotation.copy(n.getRotation()),i.interpolatedFraction=0,i.interpolatedAABBVersion=n.aabbVersion,o.getTransform(t,e),i._previousSyncPosition.copy(t),void i._previousSyncRotation.copy(e);this.synchronizeEntityWithBody(i),o.isDynamic&&i.shouldExtrapolatePosition()&&(i.interpolatedPosition.copy(n.getPosition()),i.interpolatedRotation.copy(n.getRotation()),i.interpolatedFraction=0,i.interpolatedAABBVersion=n.aabbVersion)}},onFixedUpdate:function(t){this.integratedPhysicsTime+=t;for(let t=0;t<this.wheelColliders.length;t++)this.wheelColliders[t].fixedUpdate();pc.BasePhysicsAdapter.prototype.onFixedUpdate.call(this,t),this._world.emitEvents()},handleContacts:function(){},onUpdate:function(t){this.integratedTime+=t*UnityEngine.Time.timeScale;const e=this._getPhysicsSystem(),i=e.autoSyncTransforms;e.autoSyncTransforms=!1;for(let t=0;t<this._rigidbodies.length;t++){const e=this._rigidbodies[t];e.body.isDynamic&&(e.shouldInterpolatePosition()?this._interpolatePosition(e):e.shouldExtrapolatePosition()&&this._extrapolatePosition(e))}i&&(e.autoSyncTransforms=!0)},onTriggerContactEnter:function(t){this.emitTriggerContactEvent("OnTriggerEnter",t)},onTriggerContactStay:function(t){this.emitTriggerContactEvent("OnTriggerStay",t)},onTriggerContactExit:function(t){this.emitTriggerContactEvent("OnTriggerExit",t)},emitTriggerContactEvent:function(t,e){const i=e.shape_a._component,n=e.bodyA._component,o=e.shape_b._component,s=e.bodyB._component;if(!!i&&0===i._enabled||!!o&&0===o._enabled)return;let r=!1,c=!1;this.componentHasEventListeners(i,t)&&(r=this.dispatchContact(i._entity,t,o.code)),this.componentHasEventListeners(o,t)&&(c=this.dispatchContact(o._entity,t,i.code)),r=r&&!!n&&n.entity===i.entity,c=c&&!!s&&s.entity===o.entity,!r&&this.componentHasEventListeners(n,t)&&this.dispatchContact(n._entity,t,o.code),!c&&this.componentHasEventListeners(s,t)&&this.dispatchContact(s._entity,t,i.code)},onCollisionContactEnter:function(t){this.emitCollisionContactEvent("OnCollisionEnter",t)},onCollisionContactStay:function(t){this.emitCollisionContactEvent("OnCollisionStay",t)},onCollisionContactExit:function(t){this.emitCollisionContactEvent("OnCollisionExit",t)},emitCollisionContactEvent:function(t,e){const i=e.shape_a._component,n=e.shape_b._component,o=e.bodyA._component,s=e.bodyB._component;let r=!1,c=!1;this.componentHasEventListeners(o,t)&&(r=this.dispatchContact(o._entity,t,UnityEngine.Object.FromHandle(UnityEngine.Collision,e).ConfigureFor(0))),this.componentHasEventListeners(s,t)&&(c=this.dispatchContact(s._entity,t,UnityEngine.Object.FromHandle(UnityEngine.Collision,e).ConfigureFor(1))),!r&&this.componentHasEventListeners(i,t)&&this.dispatchContact(i._entity,t,UnityEngine.Object.FromHandle(UnityEngine.Collision,e).ConfigureFor(0)),!c&&this.componentHasEventListeners(n,t)&&this.dispatchContact(n._entity,t,UnityEngine.Object.FromHandle(UnityEngine.Collision,e).ConfigureFor(1))},componentHasEventListeners:function(t,e){return!!t&&!!t._entity&&!!t._entity._enabledInHierarchy&&this.entityHasEventListeners(t._entity,e)},setIgnoreCollisionBetweenLayers:function(t,e,i){pc.BasePhysicsAdapter.prototype.setIgnoreCollisionBetweenLayers.call(this,t,e,i),this._world.onCollisionMatrixUpdated()},_interpolatePosition:function(o){const s=o.entity,r=o.body;if(s.aabbVersion!==o.interpolatedAABBVersion)return;const c=this.integratedPhysicsTime,a=c+UnityEngine.Time.fixedDeltaTime,h=this.integratedTime;if(c===h||a<h)return;const l=(h-c)/(a-c),d=(l-o.interpolatedFraction)/(1-o.interpolatedFraction);r.getTransform(t,e),i.sub2(t,o.interpolatedPosition),i.scale(d),i.add(o.interpolatedPosition),s.setPosition(i),n.slerp(o.interpolatedRotation,e,d),s.setRotation(n),o.interpolatedPosition.copy(s.getPosition()),o.interpolatedRotation.copy(s.getRotation()),o.interpolatedFraction=l,o.interpolatedAABBVersion=s.aabbVersion},_extrapolatePosition:function(t){const e=t.entity;if(e.aabbVersion!==t.interpolatedAABBVersion)return;const o=this.integratedPhysicsTime,s=o+UnityEngine.Time.fixedDeltaTime,r=this.integratedTime;if(o===r||s<r)return;const c=(r-o)/(s-o),a=(s-o)*(c-t.interpolatedFraction);i.copy(t.velocity),i.scale(a),i.add(t.interpolatedPosition),e.setPosition(i),i.copy(t.angularVelocity);let h=i.length();h*a>Math.PI/4&&(h=Math.PI/4/a),h<.001?i.scale(.5*a-a*a*a*.020833333333*h*h):i.scale(Math.sin(.5*h*a)/h),n.x=i.x,n.y=i.y,n.z=i.z,n.w=Math.cos(h*a*.5),n.mul(t.interpolatedRotation),e.setRotation(n),t.interpolatedPosition.copy(e.getPosition()),t.interpolatedRotation.copy(e.getRotation()),t.interpolatedFraction=c,t.interpolatedAABBVersion=e.aabbVersion},_getPhysicsSystem:()=>pc.Application.getApplication().systems.physics}),{PhysicsAdapter:r}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=function(t){pc.UnityComponentSystem.call(this,t),this.id="physics",this.performanceSamplerSection=pc.Counters.PHYSICS,this._autoSyncTransforms=!1,this._autoSimulation=!0,this.initializePhysicsEngine()};return(e.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=e,Object.assign(e.prototype,{initializePhysicsEngine:function(){this._world=Goblin.World.initialize(),this._adapter=new pc.PhysicsAdapter({world:this._world})},onFixedUpdate:function(t){this._autoSimulation&&this.simulate(t)},simulate(t){this._adapter.onFixedUpdate(t)},onUpdate:function(t){this._adapter.onUpdate(t)},setIgnoreCollisionBetweenLayers:function(t,e,i){this._adapter.setIgnoreCollisionBetweenLayers(t,e,i)},syncHierarchy:function(t){this._adapter.syncHierarchy(t)},syncTransforms:function(t){this._autoSyncTransforms&&this._adapter.syncTransforms(t)}}),Object.defineProperty(e.prototype,"gravity",{get:function(){const e=this._world.gravity;return t.set(e.x,e.y,e.z),t},set:function(t){this._world.gravity.set(t.x,t.y,t.z)}}),Object.defineProperty(e.prototype,"defaultSolverIterations",{get:function(){return this._world.solver.max_iterations},set:function(t){this._world.solver.max_iterations=t}}),Object.defineProperty(e.prototype,"adapter",{get:function(){return this._adapter}}),Object.defineProperty(e.prototype,"autoSyncTransforms",{get:function(){return this._autoSyncTransforms},set:function(t){this._autoSyncTransforms=t}}),Object.defineProperty(e.prototype,"autoSimulation",{get:function(){return this._autoSimulation},set:function(t){this._autoSimulation=t}}),{PhysicsSystem:e}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="rigidbody",this.performanceSamplerSection=pc.Counters.PHYSICS,this._world=t.systems.physics._world,this._bodies={},this._contacts={},this._previousContacts={}};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDisable(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),{RigidbodySystem:t}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new Goblin.Vector3,i=new Goblin.Vector3,n=new Goblin.Quaternion,o=new pc.Vec3,s=new pc.Quat;function r(t){switch(t){case 0:return Goblin.RigidBody.CollisionDetectionMode.Discrete;case 1:case 2:return Goblin.RigidBody.CollisionDetectionMode.ContinuousConservativeAdvancement;case 3:return Goblin.RigidBody.CollisionDetectionMode.ContinuousSpeculative;default:throw new Error("Unrecognized collision detection mode")}}const c=function t(e){pc.UnityComponent.prototype.constructor.call(this),e=e||{mass:1,drag:0,angularDrag:0,useGravity:!0,isKinematic:!1,collisionDetectionMode:0,enabled:!0,maxAngularVelocity:7,constraints:0},this.id=t.uid++,this._body=new Goblin.RigidBody(this.id,e.mass),this._body._component=this,this._body.linear_damping=e.drag||0,this._body.angular_damping=e.angularDrag||0,this._body.useGravity=!!e.useGravity,this._body.isKinematic=e.isKinematic,this._body.collisionDetectionMode=r(e.collisionDetectionMode),this._body.maxAngularVelocity=e.maxAngularVelocity,this._enabled=e.enabled,this._collisionDetectionMode=e.collisionDetectionMode,this.constraints=e.constraints||0,this.interpolation=e.interpolation||UnityEngine.RigidbodyInterpolation.None,this._previousSyncPosition=new pc.Vec3,this._previousSyncRotation=new pc.Quat,this.interpolatedPosition=new pc.Vec3,this.interpolatedRotation=new pc.Quat,this.interpolatedFraction=0,this.interpolatedAABBVersion=0,this._dirtyPosition=!1,this._dirtyRotation=!1,this._adapter=pc.Application.getApplication().systems.physics.adapter};return c.uid=0,(c.prototype=Object.create(pc.UnityComponent.prototype)).constructor=c,c.fromStaticBody=function(t){const e=Object.create(c.prototype);return pc.UnityComponent.prototype.constructor.call(e),e.id=c.uid++,t.id=e.id,e._body=t,e._enabled=!0,e._collisionDetectionMode=0,e.constraints=0,e.interpolation=UnityEngine.RigidbodyInterpolation.None,e._previousSyncPosition=new pc.Vec3,e._previousSyncRotation=new pc.Quat,e.interpolatedPosition=new pc.Vec3,e.interpolatedRotation=new pc.Quat,e.interpolatedFraction=0,e.interpolatedAABBVersion=0,e._dirtyPosition=!1,e._dirtyRotation=!1,e._adapter=pc.Application.getApplication().systems.physics.adapter,t._fauxComponent=e,e},Object.assign(c.prototype,{addLinearForce:function(e,i,n){switch(t.copy(e),n&&this._body.getRotation().transformVector3(t),i){case UnityEngine.ForceMode.Force:t.scale(UnityEngine.Time.fixedDeltaTime),this._body.addLinearImpulse(t);break;case UnityEngine.ForceMode.Acceleration:t.scale(this._body.mass),t.scale(UnityEngine.Time.fixedDeltaTime),this._body.addLinearImpulse(t);break;case UnityEngine.ForceMode.Impulse:t.scale(1/this._body.mass),this._body.addLinearVelocity(t);break;case UnityEngine.ForceMode.VelocityChange:this._body.addLinearVelocity(t);break;default:throw new Error("Not Implemented")}},addLinearForceAtPosition:function(e,i,n){switch(t.copy(e),n){case UnityEngine.ForceMode.Force:t.scale(UnityEngine.Time.fixedDeltaTime),this._body.applyImpulseAtWorldPoint(t,i);break;case UnityEngine.ForceMode.Acceleration:t.scale(this._body.mass),t.scale(UnityEngine.Time.fixedDeltaTime),this._body.applyImpulseAtWorldPoint(t,i);break;case UnityEngine.ForceMode.Impulse:this._body.applyImpulseAtWorldPoint(t,i);break;case UnityEngine.ForceMode.VelocityChange:t.scale(this._body.mass),this._body.applyImpulseAtWorldPoint(t,i);break;default:throw new Error("Not Implemented")}},getPointVelocity:function(){const t=new Goblin.Vector3,e=new Goblin.Vector3;return function(i){t.set(i.x,i.y,i.z),this._body.getVelocityInGlobalPoint(t,e);const n=new pc.Vec3;return n.set(e.x,e.y,e.z),n}}(),addAngularForce:function(e,i,n){switch(t.copy(e),n&&this._body.getRotation().transformVector3(t),i){case UnityEngine.ForceMode.Force:t.scale(UnityEngine.Time.fixedDeltaTime),this._body.addAngularImpulse(t);break;case UnityEngine.ForceMode.Acceleration:t.scale(UnityEngine.Time.fixedDeltaTime),this._body.addAngularVelocity(t);break;case UnityEngine.ForceMode.Impulse:this._body.addAngularImpulse(t);break;case UnityEngine.ForceMode.VelocityChange:this._body.addAngularVelocity(t);break;default:throw new Error("Not Implemented")}},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableRigidbody(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableRigidbody(this),!0)},movePosition:function(t){e.set(t.x,t.y,t.z),this._body.setPosition(e),this._dirtyPosition=!0},moveRotation:function(t){n.set(t.x,t.y,t.z,t.w),this._body.setRotation(n),this._dirtyRotation=!0},rayIntersect:function(t,n,o){e.set(t.x,t.y,t.z),i.set(n.x,n.y,n.z);const s=[];return this._body.rayIntersect(e,i,o,-1,!0,s),s},closestPointOnBounds:function(t){e.set(t.x,t.y,t.z),this._body.getClosestPointOnBounds(e,i);const n=new pc.Vec3;return n.set(i.x,i.y,i.z),n},wakeUp(){this._body.wakeUp(!0)},sleep(){this._body.isSleeping=!0},isSleeping(){return this._body.isSleeping},resetCenterOfMass(){this._body.resetCenterOfMass()},isInterpolationOrExtrapolationEnabled(){return this.interpolation!==UnityEngine.RigidbodyInterpolation.None},shouldInterpolatePosition(){return this.interpolation===UnityEngine.RigidbodyInterpolation.Interpolate},shouldExtrapolatePosition(){return this.interpolation===UnityEngine.RigidbodyInterpolation.Extrapolate}}),Object.defineProperty(c.prototype,"body",{get:function(){return this._body}}),Object.defineProperty(c.prototype,"position",{get:function(){const t=new pc.Vec3;return this._body.getTransform(t,s),t},set:function(t){e.set(t.x,t.y,t.z),this._body.setPosition(e),this._dirtyPosition=!0}}),Object.defineProperty(c.prototype,"constraints",{get:function(){let t=0;return this._body.positionLockX&&(t|=UnityEngine.RigidbodyConstraints.FreezePositionX),this._body.positionLockY&&(t|=UnityEngine.RigidbodyConstraints.FreezePositionY),this._body.positionLockZ&&(t|=UnityEngine.RigidbodyConstraints.FreezePositionZ),this._body.rotationLockX&&(t|=UnityEngine.RigidbodyConstraints.FreezeRotationX),this._body.rotationLockY&&(t|=UnityEngine.RigidbodyConstraints.FreezeRotationY),this._body.rotationLockZ&&(t|=UnityEngine.RigidbodyConstraints.FreezeRotationZ),t},set:function(t){this._body.positionLockX=!!(t&UnityEngine.RigidbodyConstraints.FreezePositionX),this._body.positionLockY=!!(t&UnityEngine.RigidbodyConstraints.FreezePositionY),this._body.positionLockZ=!!(t&UnityEngine.RigidbodyConstraints.FreezePositionZ),this._body.rotationLockX=!!(t&UnityEngine.RigidbodyConstraints.FreezeRotationX),this._body.rotationLockY=!!(t&UnityEngine.RigidbodyConstraints.FreezeRotationY),this._body.rotationLockZ=!!(t&UnityEngine.RigidbodyConstraints.FreezeRotationZ),this._body.wakeUp()}}),Object.defineProperty(c.prototype,"rotation",{get:function(){return(new pc.Quat).copy(this._body.getRotation())},set:function(t){n.set(t.x,t.y,t.z,t.w),this._body.setRotation(n),this._dirtyRotation=!0}}),Object.defineProperty(c.prototype,"angularDrag",{get:function(){return this._body.angular_damping},set:function(t){this._body.angular_damping=t}}),Object.defineProperty(c.prototype,"drag",{get:function(){return this._body.linear_damping},set:function(t){this._body.linear_damping=t}}),Object.defineProperty(c.prototype,"angularVelocity",{get:function(){return(new pc.Vec3).copy(this._body.angular_velocity)},set:function(t){e.x=t.x,e.y=t.y,e.z=t.z,this._body.setAngularVelocity(e)}}),Object.defineProperty(c.prototype,"velocity",{get:function(){return(new pc.Vec3).copy(this._body.linear_velocity)},set:function(t){e.x=t.x,e.y=t.y,e.z=t.z,this._body.setLinearVelocity(e)}}),Object.defineProperty(c.prototype,"centerOfMass",{get:function(){return(new pc.Vec3).copy(this._body.getCenterOfMass())},set:function(t){e.set(t.x,t.y,t.z),this._body.overrideCenterOfMass(e)}}),Object.defineProperty(c.prototype,"mass",{get:function(){return this._body.mass},set:function(t){this._body.mass=t}}),Object.defineProperty(c.prototype,"maxAngularVelocity",{get:function(){return this._body.maxAngularVelocity},set:function(t){this._body.maxAngularVelocity=t}}),Object.defineProperty(c.prototype,"inertiaTensor",{get:function(){const t=this.body.getDiagonalizedInertiaTensor();return o.set(t.x,t.y,t.z),o},set:function(t){throw new Error("Not implemented")}}),Object.defineProperty(c.prototype,"inertiaTensorRotation",{get:function(){const t=this.body.getDiagonalizedInertiaTensorRotation();return s.set(t.x,t.y,t.z,t.w),s},set:function(t){throw new Error("Not implemented")}}),Object.defineProperty(c.prototype,"isKinematic",{get:function(){return this._body.isKinematic},set:function(t){this._body.isKinematic=t}}),Object.defineProperty(c.prototype,"isStatic",{get:function(){return this._body.isStatic},set:function(t){this._body.isStatic=t}}),Object.defineProperty(c.prototype,"useGravity",{get:function(){return this._body.useGravity},set:function(t){this._body.useGravity=t}}),Object.defineProperty(c.prototype,"disableCollisions",{get:function(){return this._body.disableCollisions},set:function(t){this._body.disableCollisions=t}}),Object.defineProperty(c.prototype,"collisionDetectionMode",{get:function(){return this._collisionDetectionMode},set:function(t){this._body.collisionDetectionMode=r(t),this._collisionDetectionMode=t}}),{RigidbodyComponent:c}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="collider",this.performanceSamplerSection=pc.Counters.PHYSICS,this._world=t.systems.physics._world};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDisable(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),{ColliderSystem:t}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Quat,i=new Goblin.Vector3,n=new Goblin.Vector3;function o(t,e){return Math.round(t*(1/e))*e}const s=function t(e){pc.UnityComponent.prototype.constructor.call(this),this.id=t.uid++,this._position=e.position,this._enabled=e.enabled,this._isTrigger=e.isTrigger,this._convex=e.convex,this._guid=pc.guid.create(),this._material=e.material,this._relativeTransform=(new pc.Mat4).setIdentity(),this._accumulatedScale=new pc.Vec3(1,1,1),this._colliderPosition=new pc.Vec3,this._colliderRotation=new pc.Quat,this._colliderPositionGoblin=new Goblin.Vector3,this._colliderRotationGoblin=new Goblin.Quaternion,this._shape=null,this._layer=0,this._adapter=pc.Application.getApplication().systems.physics.adapter,this._lastBuildParams={}};s.uid=0,(s.prototype=Object.create(pc.UnityComponent.prototype)).constructor=s,Object.defineProperty(s.prototype,"code",{get:function(){return this._code||this.initializeCode(),this._code}}),Object.defineProperty(s.prototype,"bounds",{get:function(){const t=this._body,e=new UnityEngine.Bounds;e.setMinMax(pc.Vec3.ZERO,pc.Vec3.ZERO);let i=null;for(let e=0;e<t.shape.child_shapes.length;e++)if(t.shape.child_shapes[e].shape===this._shape){i=t.shape.child_shapes[e];break}if(!i)return e;const n=new Goblin.AABB,o=new Goblin.Matrix4;return o.makeTransform(t.getRotation(),t.getPosition()),n.transform(i.aabb,o),e.setMinMax((new pc.Vec3).copy(n.min),(new pc.Vec3).copy(n.max)),e}}),Object.defineProperty(s.prototype,"shape",{get:function(){return this._shape}}),Object.defineProperty(s.prototype,"material",{get:function(){return this._shape.material},set:function(t){this._material=t,this._shape.material=t}}),Object.defineProperty(s.prototype,"isTrigger",{get:function(){return this._shape.isTrigger},set:function(t){this._shape.isTrigger!==t&&(this._shape.isTrigger=t,this._body.shape.updateIsTriggerFlag(),this._body.onShapeUpdated())}}),Object.defineProperty(s.prototype,"layer",{get:function(){return this._shape.layer},set:function(t){this._layer=t,this.syncLayer()}}),Object.defineProperty(s.prototype,"center",{get:function(){return this._position},set:function(t){this._position.copy(t),this._updateShapeSizeAndPosition()}}),Object.assign(s.prototype,{initializeCode:function(){throw new Error("Not Implemented")},getEntity(){return this.entity},getAttachedBodyEntity(){return(this._body._component||this._body._fauxComponent)._entity},getColliderPositionGoblin:function(){return this._colliderPositionGoblin.x=this._colliderPosition.x,this._colliderPositionGoblin.y=this._colliderPosition.y,this._colliderPositionGoblin.z=this._colliderPosition.z,this._colliderPositionGoblin},getColliderRotationGoblin:function(){return this._colliderRotationGoblin.x=this._colliderRotation.x,this._colliderRotationGoblin.y=this._colliderRotation.y,this._colliderRotationGoblin.z=this._colliderRotation.z,this._colliderRotationGoblin.w=this._colliderRotation.w,this._colliderRotationGoblin},syncLayer(){this._shape&&this._shape.layer!==this._layer&&(this._shape.layer=this._layer,this._body&&this._body.shape.updateLayersMasks())},updateShape:function(){this._updateShapeSizeAndPosition(),this._layer=this.entity.cullingLayer,this.syncLayer()},_calculateRelativePositionAndRotation(t){const e=this.getEntity(),i=this.getAttachedBodyEntity();e.transformPoint(t,this._colliderPosition),i.transformPointInverse(this._colliderPosition,this._colliderPosition),this._colliderPosition.mul(i.getLossyScale()),i.transformQuaternionInverse(e.getRotation(),this._colliderRotation)},_updateShapeSizeAndPosition:function(){throw new Error("Not Implemented")},onAttached:function(){pc.UnityComponent.prototype.onAttached.call(this),this._layer=this.entity.cullingLayer},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableCollider(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableCollider(this),!0)},closestPoint:function(t){i.set(t.x,t.y,t.z),this._body.getClosestPointOnShape(this._shape,i,n);const e=new pc.Vec3;return e.set(n.x,n.y,n.z),e},closestPointOnBounds:function(t){i.set(t.x,t.y,t.z),this._body.getClosestPointOnShapeBounds(this._shape,i,n);const e=new pc.Vec3;return e.set(n.x,n.y,n.z),e},rayIntersect:function(t,e,o){i.set(t.x,t.y,t.z),n.set(e.x,e.y,e.z);const s=[];this._body.rayIntersect(i,n,o,-1,!0,s);for(let t=0;t<s.length;t++)s[t].shape!==this._shape&&(s[t]=s[s.length-1],s.pop(),t--);return s[0]||null}});const r=function(t={}){const e={center:pc.Vec3.ZERO,size:pc.Vec3.ONE,enabled:!0,material:null,isTrigger:!1},i={position:(t=Object.assign({},e,t)).center.clone(),material:t.material,enabled:t.enabled,isTrigger:t.isTrigger};this._size=t.size.clone(),s.call(this,i),this._lastBuildParams.colliderSize=new pc.Vec3,this._lastBuildParams.colliderPosition=new pc.Vec3,this._lastBuildParams.colliderRotation=new pc.Quat,this._lastBuildParams.body=null};r._cache={},(r.prototype=Object.create(s.prototype)).constructor=r,Object.defineProperty(r.prototype,"size",{get:function(){return this._size},set:function(t){this._size.copy(t),this._updateShapeSizeAndPosition()}}),Object.assign(r.prototype,{_generateConvexHullShape:function(t,e,i){const n=o(t.x,Goblin.EPSILON)+1e4*o(t.y,Goblin.EPSILON)+1e8*o(t.z,Goblin.EPSILON),s=r._cache[n];if(s){const t=s.getShallowCopy();return t.uid=this.id,t._component=this,t.layer=this._layer,t.isTrigger=this._isTrigger,t.material=this._material,t}const c=Goblin.ConvexHullShape.fromAABB(this.id,.5*t.x,.5*t.y,.5*t.z,e,i);return c._component=this,r._cache[n]=c,c},_updateShapeSizeAndPosition:function(){this._calculateRelativePositionAndRotation(this._position),this._accumulatedScale.copy(this.entity.getLossyScale()).abs(),t.copy(this._size),t.mul(this._accumulatedScale);const e=!this._lastBuildParams.colliderSize.equals(t,Goblin.EPSILON),i=!this._lastBuildParams.colliderPosition.equals(this._colliderPosition,Goblin.EPSILON)||!this._lastBuildParams.colliderRotation.equals(this._colliderRotation),n=this._lastBuildParams.body!==this._body;if(!this._shape||e)this._shape=this._generateConvexHullShape(t,this._material,this._isTrigger),this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else if(n)this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else{if(!i)return;this._body.shape.updateShapeTransform(this.id,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated()}this._lastBuildParams.colliderSize.copy(t),this._lastBuildParams.colliderPosition.copy(this._colliderPosition),this._lastBuildParams.colliderRotation.copy(this._colliderRotation),this._lastBuildParams.body=this._body},initializeCode:function(){this._code=new UnityEngine.BoxCollider(this),this["__UnityEngine.BoxCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this}});const c=function(t={}){const e={center:pc.Vec3.ZERO,radius:.5,material:null,enabled:!0,isTrigger:!1},i={position:(t=Object.assign({},e,t)).center.clone(),material:t.material,enabled:t.enabled,isTrigger:t.isTrigger};this._radius=t.radius,s.call(this,i),this._lastBuildParams.radius=0,this._lastBuildParams.colliderPosition=new pc.Vec3,this._lastBuildParams.colliderRotation=new pc.Quat,this._lastBuildParams.body=null};(c.prototype=Object.create(s.prototype)).constructor=c,Object.assign(c.prototype,{_updateShapeSizeAndPosition:function(){this._calculateRelativePositionAndRotation(this._position),this._accumulatedScale.copy(this.entity.getLossyScale()),this._accumulatedScale.abs();const t=this._radius*Math.max(Math.max(this._accumulatedScale.x,this._accumulatedScale.y),this._accumulatedScale.z),e=Math.abs(this._lastBuildParams.radius-t)>Goblin.EPSILON,i=!this._lastBuildParams.colliderPosition.equals(this._colliderPosition,Goblin.EPSILON)||!this._lastBuildParams.colliderRotation.equals(this._colliderRotation),n=this._lastBuildParams.body!==this._body;if(!this._shape||e)this._shape=new Goblin.SphereShape(this.id,t,this._material,this._isTrigger),this._shape._component=this,this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else if(n)this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else{if(!i)return;this._body.shape.updateShapeTransform(this.id,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated()}this._lastBuildParams.radius=t,this._lastBuildParams.colliderPosition.copy(this._colliderPosition),this._lastBuildParams.colliderRotation.copy(this._colliderRotation),this._lastBuildParams.body=this._body},initializeCode:function(){this._code=new UnityEngine.SphereCollider(this),this["__UnityEngine.SphereCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this}}),Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._updateShapeSizeAndPosition()}});const a=function(t={}){const e={center:pc.Vec3.ZERO,radius:.5,height:1,material:null,enabled:!0,isTrigger:!1,direction:1},i={position:(t=Object.assign({},e,t)).center.clone(),material:t.material,enabled:t.enabled,isTrigger:t.isTrigger};this._radius=t.radius,this._height=t.height,this._direction=t.direction,s.call(this,i),this._lastBuildParams.radius=0,this._lastBuildParams.halfHeight=0,this._lastBuildParams.colliderPosition=new pc.Vec3,this._lastBuildParams.colliderRotation=new pc.Quat,this._lastBuildParams.body=null};(a.prototype=Object.create(s.prototype)).constructor=c,Object.assign(a.prototype,{_updateShapeSizeAndPosition:function(){this._calculateRelativePositionAndRotation(this._position),this.updateCapsuleQuaternion(this._direction,e),this._colliderRotation.mul2(e,this._colliderRotation),this._accumulatedScale.copy(this.entity.getLossyScale()),this._accumulatedScale.abs();let t=1,i=1;switch(this._direction){case 0:t=Math.max(this._accumulatedScale.y,this._accumulatedScale.z),i=this._accumulatedScale.x;break;case 1:t=Math.max(this._accumulatedScale.x,this._accumulatedScale.z),i=this._accumulatedScale.y;break;case 2:t=Math.max(this._accumulatedScale.x,this._accumulatedScale.y),i=this._accumulatedScale.z}const n=this._radius*t,o=Math.max(.5*this._height*i-n,10*Goblin.EPSILON),s=Math.abs(this._lastBuildParams.radius-n)>Goblin.EPSILON||Math.abs(this._lastBuildParams.halfHeight-o)>Goblin.EPSILON,r=!this._lastBuildParams.colliderPosition.equals(this._colliderPosition,Goblin.EPSILON)||!this._lastBuildParams.colliderRotation.equals(this._colliderRotation),c=this._lastBuildParams.body!==this._body;if(!this._shape||s)this._shape=new Goblin.CapsuleShape(this.id,n,o,this._material,this._isTrigger),this._shape._component=this,this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else if(c)this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else{if(!r)return;this._body.shape.updateShapeTransform(this.id,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated()}this._lastBuildParams.radius=n,this._lastBuildParams.halfHeight=o,this._lastBuildParams.colliderPosition.copy(this._colliderPosition),this._lastBuildParams.colliderRotation.copy(this._colliderRotation),this._lastBuildParams.body=this._body},updateCapsuleQuaternion:function(t,e){switch(t){case 0:return e.setFromAxisAngle(pc.Vec3.FORWARD,90);case 1:return e.set(0,0,0,1);case 2:return e.setFromAxisAngle(pc.Vec3.RIGHT,90);default:return NaN}},initializeCode:function(){this._code=new UnityEngine.CapsuleCollider(this),this["__UnityEngine.CapsuleCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this}}),Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._updateShapeSizeAndPosition()}}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._updateShapeSizeAndPosition()}}),Object.defineProperty(a.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t,this._updateShapeSizeAndPosition()}});const h=function(t={}){t=Object.assign({},{material:null,mesh:null,convex:!1,enabled:!0,isTrigger:!1},t);const e={position:pc.Vec3.ZERO,material:t.material,enabled:t.enabled,isTrigger:t.isTrigger,convex:t.convex};this._mesh=t.mesh,s.call(this,e),this._lastBuildParams.mesh=null,this._lastBuildParams.meshVersion=-1,this._lastBuildParams.scale=new pc.Vec3,this._lastBuildParams.colliderPosition=new pc.Vec3,this._lastBuildParams.colliderRotation=new pc.Quat,this._lastBuildParams.body=null,this._lastBuildParams.convex=e.convex};h._cache={},(h.prototype=Object.create(s.prototype)).constructor=h,Object.assign(h.prototype,{getCacheKeyForCurrentMesh:function(){return`${this._mesh.id}-${this._mesh.version}-${o(this._accumulatedScale.x,Goblin.EPSILON)+1e4*o(this._accumulatedScale.y,Goblin.EPSILON)+1e8*o(this._accumulatedScale.z,Goblin.EPSILON)}-${this._convex?1:0}`},_updateShapeSizeAndPosition:function(){if(!this._body)return void(this._shape=null);if(!this._mesh||0===this._mesh.vertexBuffer.numVertices||0===this.getMeshTriangleCount())return this._body.shape.removeChildShape(this.id),void(this._shape=null);this._calculateRelativePositionAndRotation(pc.Vec3.ZERO),this._accumulatedScale.copy(this.entity.getLossyScale());const t=!this._lastBuildParams.scale.equals(this._accumulatedScale,Goblin.EPSILON)||this._lastBuildParams.mesh!==this._mesh||this._lastBuildParams.meshVersion!==this._mesh.version||this._lastBuildParams.convex!==this._convex,e=!this._lastBuildParams.colliderPosition.equals(this._colliderPosition,Goblin.EPSILON)||!this._lastBuildParams.colliderRotation.equals(this._colliderRotation),i=this._lastBuildParams.body!==this._body;if(this._shape)if(t)this._shape=this.generateShape(),this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else if(i)this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else{if(!e)return;this._body.shape.updateShapeTransform(this.id,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated()}else this._shape=this.generateShape(),this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();this._lastBuildParams.colliderPosition.copy(this._colliderPosition),this._lastBuildParams.colliderRotation.copy(this._colliderRotation),this._lastBuildParams.body=this._body,this._lastBuildParams.scale.copy(this._accumulatedScale),this._lastBuildParams.mesh=this._mesh,this._lastBuildParams.meshVersion=this._mesh.version,this._lastBuildParams.convex=this._convex},generateShape:function(){const t=this.getCacheKeyForCurrentMesh(),e=h._cache[t];if(e){const t=e.getShallowCopy();return t.uid=this.id,t._component=this,t.layer=this._layer,t.isTrigger=this._isTrigger,t.material=this._material,t}const i=new Float32Array(this._mesh.vertexBuffer.storage),n=this._mesh.vertexBuffer.getFormat().getStructureFor(pc.SEMANTIC_POSITION);let o=this._mesh.subMeshes||[];0===o.length&&(o=[this._mesh]);const s=this.getMeshTriangleCount(),r=this._convex?null:new Array(s),c=this._convex?null:new Array(s),a=[],l=new Set;let d=0;for(let t=0;t<o.length;t++){const e=o[t];if(e&&e.indexBuffer&&e.indexBuffer[0]){const t=new Uint16Array(e.indexBuffer[0].storage);for(let e=0;e<t.length;e++){const o=t[e]*(n.stride/4)+n.offset,s=i[o+0],h=i[o+1],u=i[o+2],p=s+1e4*h+1e8*u;let _=null;if(l.has(p))for(let t=a.length-1;t>=0;t--){const e=a[t];if(e.x===s&&e.y===h&&e.z===u){_=e;break}}_||(_=new Goblin.Vector3(s,h,u),a.push(_),l.add(p)),this._convex||(c[d]=_,r[d]=d),d++}}}this._convex&&Goblin.ConvexHullShape.approximateByAABBIfNecessary(a);for(let t=0;t<a.length;t++){const e=a[t];e.x*=this._accumulatedScale.x,e.y*=this._accumulatedScale.y,e.z*=this._accumulatedScale.z}this._convex&&Goblin.ConvexHullShape.approximateByAABBIfNecessary(a);const u=this._convex?new Goblin.ConvexHullShape(this.id,a,this._material,!1,this._isTrigger):new Goblin.MeshShape(this.id,c,r,this._material,this._isTrigger);return u._component=this,h._cache[t]=u,u},getMeshTriangleCount(){let t=this._mesh.subMeshes||[];0===t.length&&(t=[this._mesh]);let e=0;for(let i=0;i<t.length;i++){const n=t[i];n&&n.indexBuffer&&n.indexBuffer[0]&&(e+=n.indexBuffer[0].numBytes/n.indexBuffer[0].bytesPerIndex)}return e},initializeCode:function(){this._code=new UnityEngine.MeshCollider(this),this["__UnityEngine.MeshCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this}}),Object.defineProperty(h.prototype,"sharedMesh",{get:function(){return this._mesh},set:function(t){this._mesh=t,this._updateShapeSizeAndPosition()}}),Object.defineProperty(h.prototype,"convex",{get:function(){return this._convex},set:function(t){this._convex=t,this._updateShapeSizeAndPosition()}});const l=function(t={}){pc.UnityComponent.prototype.constructor.call(this),this._adapter=pc.Application.getApplication().systems.physics.adapter};(l.prototype=Object.create(pc.UnityComponent.prototype)).constructor=l,Object.defineProperty(l.prototype,"code",{get:function(){return this._code||this.initializeCode(),this._code}}),Object.assign(l.prototype,{initializeCode:function(){this._code=new UnityEngine.WheelCollider(this),this["__UnityEngine.WheelCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableWheelCollider(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableWheelCollider(this),!0)},onAwake:function(){this.code.OnAwake()},fixedUpdate:function(){this.code.FixedUpdate()}});const d=function(t={}){pc.UnityComponent.prototype.constructor.call(this)};return(d.prototype=Object.create(pc.UnityComponent.prototype)).constructor=d,Object.defineProperty(d.prototype,"code",{get:function(){return this._code||this.initializeCode(),this._code}}),Object.assign(d.prototype,{initializeCode:function(){this._code=new UnityEngine.CharacterController(this),this["__UnityEngine.CharacterController"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this},onAwake:function(){this.code.OnAwake()}}),{ColliderComponent:s,BoxColliderComponent:r,SphereColliderComponent:c,MeshColliderComponent:h,CapsuleColliderComponent:a,WheelColliderComponent:l,CharacterControllerComponent:d}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="joint",this.performanceSamplerSection=pc.Counters.PHYSICS,this._world=t.systems.physics._world};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{}),{JointSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),(t=t||{}).type=t.type||"UnityEngine.FixedJoint",this.unityClass=Bridge._getTypeByName(t.type),this.type=t.type,this.constraint=new Goblin.Constraint,this.constraint.active=!1,this.constraint.update=Bridge.fn.bind(this,this._updateConstraint),this._adapter=pc.Application.getApplication().systems.physics.adapter};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code&&this.code.OnEnable(),this._adapter.enableConstraint(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this.code&&this.code.OnDisable(),this._adapter.disableConstraint(this),!0)},_updateConstraint:function(t){this.code&&this.code.OnUpdate(t)},onAwake:function(){this.code&&this.code.OnAwake()}}),Object.defineProperty(t.prototype,"sortingOrderInQueue",{get:function(){return this._sortingOrderInQueue},configurable:!0}),{JointComponent:t}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Vec3,i=function(t){pc.BasePhysicsAdapter.call(this,t),this._effectors2d=new Map};return(i.prototype=Object.create(pc.BasePhysicsAdapter.prototype)).constructor=i,Object.assign(i.prototype,{setup:function(){this._world=this.options.world,this._newContacts={},this._contacts={},this._oldContacts={},this._disabledContacts={},this._world.on("begin-contact",Bridge.fn.bind(this,this._onBeginContact)),this._world.on("end-contact",Bridge.fn.bind(this,this._onEndContact)),this._world.on("pre-solve",Bridge.fn.bind(this,this._onPresolve))},addRigidbody:function(t){t.setActive(!0),this.preSimulationSynchronization(t._component||t,pc.BasePhysicsAdapter.PreSyncStages.TransformToPhysics)},removeRigidbody:function(t){for(let e=t.getFixtureList();e;e=e.getNext())e._component&&this._exitContacts(e._component);t.setActive(!1)},_exitContacts:function(t){const e=t._getContacts();if(e)for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];i._childContactsCount=0,this._onEndContact(i)}},destroyRigidbody:function(t){this._world.destroyBody(t)},addCollider:function(t,e){e.addFixture(t),e.enable(),this.preSimulationSynchronizationForCollider(e)},removeCollider:function(t,e){this._exitContacts(e),e.disable(),this._clearDisabledContacts(e)},_clearDisabledContacts:function(t){const e=t._disabledContacts;if(e){for(let t=0,i=e.length;t<i;++t)delete this._disabledContacts[e[t]];e.length=0}},addConstraint:function(t){t.createJoint(),t.enable()},removeConstraint:function(t){t.disable()},onSimulationStep:function(t){this._world.step(t)},getAttachedColliders:function(t){return t._unityComponents.collider2D},getAttachedRigidbody:function(t){const e=t._unityComponents.rigidbody2D[0];return e&&e.enabled&&e.getSimulated()&&!e.destroyed?e._body:null},attachFauxRigidbody:function(t){const e=this.createWorldBody();return e._body=e,e._entity=t,this.addRigidbody(e),e},getRelTransformAndAccumScale:function(i,n,o,s){const r=i._component?i._component._entity:n._entity,c=n._entity.getWorldTransform(),a=r.getWorldTransform();r===n._entity?o.setTranslation(pc.Vec3.ZERO):(c.getTranslation(e),a.getTranslation(t),e.sub(t),o.setTranslation(e)),c.getScale(s).abs()},synchronizeBodyWithEntity:function(t){const e=t._entity,i=t._body;i.setLayer(e.cullingLayer),i.setLayerMask(e.layerMask);const n=e.getPosition(),o=e.getEulerAngles();pc.Rigidbody2DComponent.setBodyTransform(i,n,o.z)},synchronizeEntityWithBody:function(t){pc.Rigidbody2DComponent.setEntityTransform(t._body,t._entity)},updateConstraint:function(t){t.update()},preSimulationSynchronization:function(t,e){if(e!==pc.BasePhysicsAdapter.PreSyncStages.TransformToPhysics)return;const i=t._entity;t._worldTransformVersion!==i.aabbVersion&&(this.synchronizeBodyWithEntity(t),t._worldTransformVersion=i.aabbVersion,t._body._isEntityTransformed=!0)},postSimulationSynchronization:function(t){t._body._isEntityTransformed=!1;const e=t._entity,i=t._worldTransformVersion!==e.aabbVersion;if(t.getIsKinematic()){if(i)return void this.synchronizeBodyWithEntity(t)}else if(t.getIsStatic()&&!i)return;this.synchronizeEntityWithBody(t)},onAfterSimulation:function(t){pc.BasePhysicsAdapter.prototype.onAfterSimulation.call(this,t)},_drawDebug:function(){pc.debugDraw.clear();let t=this._rigidbodies;for(let e=0,i=t.length;e<i;++e)this._drawDebugShapes(t[e]._body);t=this._fauxBodies;for(const e in t)this._drawDebugShapes(t[e])},_drawDebugShapes:function(t){const e=t.getTransform();for(let i=t.getFixtureList();i;i=i.getNext()){if(!i.isActive())continue;const t=i.getShape(),n=t._vertices;if(n)this._drawVertices(n,e,"chain"!==t.m_type);else if("circle"===t.m_type)t._vertices=this._getCircleVertices(t),this._drawVertices(t._vertices,e,!0);else if("composite_polygon"===t.m_type){const i=t.m_polygons;for(let t=i.length,n=0;n<t;++n)this._drawVertices(i[n].m_vertices,e,!0)}else"capsule"===t.m_type?(t._vertices=this._getCapsuleVertices(t),this._drawVertices(t._vertices,e,!0)):t.m_vertices&&this._drawVertices(t._vertices=t.m_vertices,e,"chain"!==t.m_type)}},_getCircleVertices:function(t){const e=t.getCenter(),i=t.getRadius(),n=new Array(10),o=2*Math.PI/10;for(let t=0;t<10;++t){const s=o*t;n[t]=new planck.Vec2(e.x+i*Math.cos(s),e.y+i*Math.sin(s))}return n},_getCapsuleVertices:function(t){const e=t.m_vertex2.clone().sub(t.m_vertex1).normal(),i=new planck.Vec2(-e.y,e.x),n=Math.acos(i.x),o=t.getRadius(),s=new Array(12),r=Math.PI/5;let c=0,a=t.m_vertex1;for(;c<=5;++c){const t=n+r*c;s[c]=new planck.Vec2(a.x+o*Math.cos(t),a.y+o*Math.sin(t))}a=t.m_vertex2;for(let t=c-1;c<12;++c,++t){const e=n+r*t;s[c]=new planck.Vec2(a.x+o*Math.cos(e),a.y+o*Math.sin(e))}return s},_drawVertices:function(t,e,i){for(let n=0,o=t.length;n<o;++n){if(n===o-1&&!i)return;const s=planck.Transform.mulVec2(e,t[n]),r=planck.Transform.mulVec2(e,t[(n+1)%o]);pc.debugDraw.addLine(s,r)}},_onBeginContact:function(t){const e=this._getContactUid(t),i=this._contacts[e]||this._newContacts[e];i?i._childContactsCount++:(t._childContactsCount=1,this._newContacts[e]=t)},_onEndContact:function(t){const e=this._getContactUid(t),i=this._contacts[e];i&&--i._childContactsCount<=0&&(this._oldContacts[e]=i)},_onPresolve:function(t){const e=t.getFixtureA()._component,i=t.getFixtureB()._component;if(e._usedByEffector){const i=this._effectors2d.get(e._entity._guid);i&&i.onBeforeCollision2D(t)}else if(i._usedByEffector){const e=this._effectors2d.get(i._entity._guid);e&&e.onBeforeCollision2D(t)}},_getContactUid:function(t){return this._getCollidersUid(t.getFixtureA()._component,t.getFixtureB()._component)},_getCollidersUid:function(t,e){const i=t._id,n=e._id;return i>n?i+":"+n:n+":"+i},handleContacts:function(){this._triggerNewContacts(),this._triggerPersistentContacts(),this._removeNewContacts(),this._triggerOldContacts()},_triggerNewContacts:function(){for(const t in this._newContacts)this._contacts[t]||this._triggerContactCallback("Enter",this._newContacts[t],t,!0)},_triggerPersistentContacts:function(){for(const t in this._contacts)this._triggerContactCallback("Stay",this._contacts[t],t)},_removeNewContacts:function(){for(const t in this._newContacts)this._contacts[t]=this._newContacts[t],delete this._newContacts[t]},_triggerOldContacts:function(){for(const t in this._oldContacts){const e=this._oldContacts[t];e.getFixtureA()._component.removeContact(t),e.getFixtureB()._component.removeContact(t),this._triggerContactCallback("Exit",e,t),delete this._oldContacts[t],delete this._contacts[t]}},_triggerContactCallback:function(t,e,i,n){if(this._disabledContacts[i])return;const o=e.getFixtureA(),s=o.getBody();if(!s)return;const r=e.getFixtureB(),c=r.getBody();if(!c)return;const a=o._component,h=r._component;if(a._isTrigger||h._isTrigger){const e="OnTrigger"+t+"2D";this.dispatchContact(a._entity,e,h.code);let i=s._component;i&&a._entity!==i._entity&&this.dispatchContact(i._entity,e,h.code),this.dispatchContact(h._entity,e,a.code),i=c._component,i&&h._entity!==i._entity&&this.dispatchContact(i._entity,e,a.code)}else{n&&(a.addContact(e,i),h.addContact(e,i));const o="OnCollision"+t+"2D";this.dispatchContact(a._entity,o,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(0));let r=s._component;r&&a._entity!==r._entity&&this.dispatchContact(r._entity,o,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(0)),this.dispatchContact(h._entity,o,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(1)),r=c._component,r&&h._entity!==r._entity&&this.dispatchContact(r._entity,o,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(1))}},ignoreCollision:function(t,e,i){if(!t.entity._enabledInHierarchy||!e.entity._enabledInHierarchy)return;const n=this._getCollidersUid(t,e);this._disabledContacts[n]=i,i&&(t._disabledContacts=t._disabledContacts||[],e._disabledContacts=e._disabledContacts||[],t._disabledContacts.push(n),e._disabledContacts.push(n))},getWorldBody:function(){return this._worldBody?this._worldBody:(this._worldBody=this.createWorldBody(),this._worldBody)},createWorldBody:function(){const t=this._world.createBody({type:planck.Body.STATIC,userData:{isWorldBody:!0}});return t.equals=function(e){return e===t||e&&(e=e.getUserData())&&e.isWorldBody},t},enableEffector:function(t){this._effectors2d.set(t._entity._guid,t)},disableEffector:function(t){this._effectors2d.delete(t._entity._guid)}}),Object.defineProperty(i.prototype,"world",{get:function(){return this._world}}),{Physics2DAdapter:i}}()),Object.assign(pc,function(){let t,e,i,n;const o=new planck.Vec2,s=new planck.Vec2;let r,c,a,h,l,d;const u=function(t){pc.UnityComponentSystem.call(this,t),this.id="physics2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this.initializePhysicsEngine()};function p(t,o,s,r){return r>=e||_(t)?e:(e=r,h.collider=t._component.code,h.fraction=(h.distance=r*i)/n,h.m_Normal.set(s.x,s.y),h.m_Point.set(o.x,o.y),h.m_Centroid.set(o.x,o.y),r)}function _(e){if(e._isFaux)return!0;const i=e._component._entity;if(!(i.layerMask&t))return!0;const n=i.getPosition().z;return n<l||d<n}function y(t){return t===Number.POSITIVE_INFINITY?3402823e32:t===Number.NEGATIVE_INFINITY?-3402823e32:t}function f(t,e,o,s){if(_(t))return 1;let r=a.length;for(a.push(new UnityEngine.RaycastHit2D),m(r,t,e,o,e,(s*=i)/n,s);r>0&&!(a[r].fraction>=a[r-1].fraction);--r)b(r,r-1);return 1}function g(t,e,o,s){if(_(t))return 1;const c=s*i;let h;if(s=c/n,r<a.length)h=r++;else if(s>=a[h=a.length-1].fraction)return 1;for(m(h,t,e,o,e,s,c);h>0&&!(s>=a[h-1].fraction);--h)b(h,h-1);return 1}function m(t,e,i,n,o,s,r){const c=a[t];c.collider=e._component.code,c.fraction=s,c.distance=r,c.m_Normal.set(n.x,n.y),c.m_Point.set(i.x,i.y),c.m_Centroid.set(o.x,o.y)}function b(t,e){const i=a[t];a[t]=a[e],a[e]=i}function C(t){if(_(t))return 1;const e=t._component;return(null==h||e._entity.getPosition().z<h.handle._entity.getPosition().z)&&(h=e.code),1}function x(t){if(_(t))return 1;let e=a.length;const i=t._component,n=i._entity.getPosition().z;for(a.push(i.code);e>0&&!(n>=a[e-1].handle._entity.getPosition().z);--e)b(e,e-1);return 1}function S(t){if(_(t))return 1;let e;const i=t._component,n=i._entity.getPosition().z;if(r<a.length)e=r++;else if(n>=a[e=a.length-1].handle._entity.getPosition().z)return 1;for(a[e]=i.code;e>0&&!(n>=a[e-1].handle._entity.getPosition().z);--e)b(e,e-1);return 1}function A(t){const e=t.fixture;if(_(e))return 1;const i=e._component._id;let n=c[i];if(n>=0){if(t.fraction>=a[n].fraction)return 1}else n=a.length,a.push(new UnityEngine.RaycastHit2D);for(m(n,e,t.point,t.normal,t.centroid,t.fraction,t.distance);n>0&&!(a[n].fraction>=a[n-1].fraction);--n)b(n,n-1),c[a[n].collider.handle._id]=n;return c[i]=n,1}function w(t,e){const i=.5*t.x;let n=.5*t.y;const o=new planck.Vec2,s=new planck.Vec2;e===UnityEngine.CapsuleDirection2D.Vertical?(o.set(0,-n),s.set(0,n)):(o.set(-n,0),s.set(n,0)),n<=0&&(n=i);const r=Math.max(planck.Math.EPSILON,1-i/n);return o.mul(r),s.mul(r),{vertex1:o,vertex2:s,radius:i}}function P(t,i){if(i>e)return e;const n=t.fixture;if(_(n))return e;e=i,h.collider=n._component.code,h.fraction=t.fraction,h.distance=t.distance;const o=t.normal;h.m_Normal.set(o.x,o.y);const s=t.point;h.m_Point.set(s.x,s.y);const r=t.centroid;return h.m_Centroid.set(r.x,r.y),e}function D(t){const e=t.fixture;if(_(e))return 1;const i=e._component._id;let n=c[i];if(n>=0){if(t.fraction>=a[n].fraction)return 1}else if(r<a.length)n=r++;else{if(n=a.length-1,t.fraction>=a[n].fraction)return 1;c[a[n].collider.handle._id]=-1}for(m(n,e,t.point,t.normal,t.centroid,t.fraction,t.distance);n>0&&!(t.fraction>=a[n-1].fraction);--n)b(n,n-1),c[a[n].collider.handle._id]=n;return c[i]=n,1}return(u.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=u,Object.assign(u.prototype,{initializePhysicsEngine:function(){this._defaultMaterial=new UnityEngine.PhysicsMaterial2D,this._defaultMaterial.friction=.4,this._defaultMaterial.bounciness=0,this._gravity=new pc.Vec2(0,-9.81),u._world=this._world=planck.World({gravity:new planck.Vec2(this._gravity.x,this._gravity.y)}),u._adapter=this._adapter=new pc.Physics2DAdapter({world:this._world})},onFixedUpdate:function(t){this._adapter.onFixedUpdate(t)},setIgnoreCollisionBetweenLayers:function(t,e,i){this._adapter.setIgnoreCollisionBetweenLayers(t,e,i)},syncHierarchy:function(t){this._adapter.syncHierarchy(t)},syncTransforms:function(t){this._autoSyncTransforms&&this._adapter.syncTransforms(t)}}),Object.defineProperty(u.prototype,"adapter",{get:function(){return this._adapter}}),Object.defineProperty(u.prototype,"gravity",{get:function(){return this._gravity},set:function(t){this._gravity=t;const e=this._world.getGravity();e.x=t.x,e.y=t.y,this._world.setGravity(e)}}),Object.defineProperty(u.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial},set:function(t){t&&(this._defaultMaterial=t)}}),Object.defineProperty(u.prototype,"autoSyncTransforms",{get:function(){return this._autoSyncTransforms},set:function(t){this._autoSyncTransforms=t}}),Object.defineProperty(u.prototype,"velocityIterations",{get:function(){return this._world.getVelocityIterations()},set:function(t){this._world.setVelocityIterations(t>0?t:1)}}),Object.defineProperty(u.prototype,"positionIterations",{get:function(){return this._world.getPositionIterations()},set:function(t){this._world.setPositionIterations(t>0?t:1)}}),u.raycast=function(r,c,a,_,f,g){a=y(a),o.set(r.x,r.y),c=s.set(c.x,c.y),n=c.normalize(),0===n&&(n=1),s.mul(a),s.add(o),i=a,t=_,l=f,d=g,e=1/0;const m=h=new UnityEngine.RaycastHit2D;return u._world.rayCast(o,s,p),h=null,m},u.linecast=function(r,c,a,_,y){o.set(r.x,r.y),s.set(c.x,c.y),i=planck.Vec2.distance(o,s),n=i,0===n&&(n=1),t=a,l=_,d=y,e=1;const f=h=new UnityEngine.RaycastHit2D;return u._world.rayCast(o,s,p),h=null,f},u.raycastAll=function(e,r,c,h,p,_){c=y(c),o.set(e.x,e.y),r=s.set(r.x,r.y),n=r.normalize(),0===n&&(n=1),s.mul(c),s.add(o),i=c,t=h,l=p,d=_;const g=a=[];return u._world.rayCast(o,s,f),a=null,g},u.raycastNonAlloc=function(e,c,h,p,_,f,m){return null==h||0===h.length?0:(p=y(p),o.set(e.x,e.y),s.set(c.x,c.y),n=s.normalize(),0===n&&(n=1),s.mul(p),s.add(o),i=p,t=_,l=f,d=m,r=0,a=h,u._world.rayCast(o,s,g),a=null,r)},u.overlapCircle=function(e,i,n,s,r){o.set(e.x,e.y),t=n,l=s,d=r,h=null,u._world.queryCircle(o,i,C);const c=h;return h=null,c},u.overlapCircleAll=function(e,i,n,s,r){o.set(e.x,e.y),t=n,l=s,d=r;const c=a=[];return u._world.queryCircle(o,i,x),a=null,c},u.overlapCircleNonAlloc=function(e,i,n,s,c,h){return null==n||0===n.length?0:(o.set(e.x,e.y),t=s,l=c,d=h,r=0,a=n,u._world.queryCircle(o,i,S),a=null,r)},u.overlapPoint=function(e,i,n,r){s.set(o.set(e.x,e.y)),t=i,l=n,d=r,h=null,u._world.rayCast(o,s,C);const c=h;return h=null,c},u.overlapPointAll=function(e,i,n,r){s.set(o.set(e.x,e.y)),t=i,l=n,d=r;const c=a=[];return u._world.rayCast(o,s,x),a=null,c},u.overlapPointNonAlloc=function(e,i,n,c,h){return null==i||0===i.length?0:(s.set(o.set(e.x,e.y)),t=n,l=c,d=h,r=0,a=i,u._world.rayCast(o,s,S),a=null,r)},u.ignoreCollision=function(t,e,i){u._adapter.ignoreCollision(t,e,i)},u.circleCastAll=function(e,i,n,r,h,p,_){r=y(r),o.set(e.x,e.y),n=s.set(n.x,n.y),t=h,l=p,d=_;const f=a=[];return c={},u._world.circleCast(o,i,n,r,A),a=c=null,f},u.boxCastAll=function(e,i,n,r,h,p,_,f){h=y(h),o.set(e.x,e.y),r=s.set(r.x,r.y),n*=pc.math.DEG_TO_RAD,t=p,l=_,d=f;const g=a=[];return c={},u._world.boxCast(o,.5*i.x,.5*i.y,n,r,h,A),a=c=null,g},u.capsuleCastAll=function(e,i,n,r,h,p,_,f,g){p=y(p),o.set(e.x,e.y),h=s.set(h.x,h.y),r*=pc.math.DEG_TO_RAD,t=_,l=f,d=g;const m=w(i,n),b=a=[];return c={},u._world.capsuleCast(o,m.vertex1,m.vertex2,m.radius,r,h,p,A),a=c=null,b},u.circleCast=function(i,n,r,c,a,p,_){c=y(c),o.set(i.x,i.y),r=s.set(r.x,r.y),t=a,l=p,d=_,e=1;const f=h=new UnityEngine.RaycastHit2D;return u._world.circleCast(o,n,r,c,P),h=null,f},u.boxCast=function(i,n,r,c,a,p,_,f){a=y(a),o.set(i.x,i.y),c=s.set(c.x,c.y),r*=pc.math.DEG_TO_RAD,t=p,l=_,d=f,e=1;const g=h=new UnityEngine.RaycastHit2D;return u._world.boxCast(o,.5*n.x,.5*n.y,r,c,a,P),g},u.capsuleCast=function(i,n,r,c,a,p,_,f,g){p=y(p),o.set(i.x,i.y),a=s.set(a.x,a.y),c*=pc.math.DEG_TO_RAD,t=_,l=f,d=g;const m=w(n,r);e=1;const b=h=new UnityEngine.RaycastHit2D;return u._world.capsuleCast(o,m.vertex1,m.vertex2,m.radius,c,a,p,P),b},u.circleCastNonAlloc=function(e,i,n,h,p,_,f,g){return null==h||0===h.length?0:(p=y(p),o.set(e.x,e.y),n=s.set(n.x,n.y),t=_,l=f,d=g,r=0,a=h,c={},u._world.circleCast(o,i,n,p,D),a=c=null,r)},u.boxCastNonAlloc=function(e,i,n,h,p,_,f,g,m){return null==p||0===p.length?0:(_=y(_),o.set(e.x,e.y),h=s.set(h.x,h.y),n*=pc.math.DEG_TO_RAD,t=f,l=g,d=m,r=0,a=p,c={},u._world.boxCast(o,.5*i.x,.5*i.y,n,h,_,D),a=c=null,r)},u.capsuleCastNonAlloc=function(e,i,n,h,p,_,f,g,m,b){if(null==_||0===_.length)return 0;f=y(f),o.set(e.x,e.y),p=s.set(p.x,p.y),h*=pc.math.DEG_TO_RAD,t=g,l=m,d=b;const C=w(i,n);return r=0,a=_,c={},u._world.capsuleCast(o,C.vertex1,C.vertex2,C.radius,h,p,f,D),a=c=null,r},u.getRayIntersectionAll=function(t,e,i,n){if(0===e.z)return[];i=y(i);const o=u.raycastAll(t,e,i,n,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);for(let i=0;i<o.length;i++){const n=o[i],s=n.transform.position;if(Math.sign(s.z-t.z)!==Math.sign(e.z)){o.splice(i,1),i--;continue}const r=Math.abs((t.z-s.z)/e.z),c=new pc.Vec2(t.x+e.x*r,t.y+e.y*r);n.collider.OverlapPoint(c)?(n.point=c,n.distance=pc.Vec3.distance(t,c),n.fraction=n.distance,o[i]=n):(o.splice(i,1),i--)}return e.z>0?o.sort((t,e)=>t.transform.position.z-e.transform.position.z):o.sort((t,e)=>e.transform.position.z-t.transform.position.z)},u.getRayIntersectionNonAlloc=function(t,e,i,n,o){if(null==i||0===i.length||0===e.z)return 0;n=y(n);const s=u.raycastAll(t,e,n,o,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);let r=0;for(let n=0;n<s.length&&r<i.length;n++){const o=s[n],c=o.transform.position;if(Math.sign(c.z-t.z)!==Math.sign(e.z))continue;const a=Math.abs((t.z-c.z)/e.z),h=new pc.Vec2(t.x+e.x*a,t.y+e.y*a);o.collider.OverlapPoint(h)&&(o.point=h,o.distance=pc.Vec3.distance(t,h),o.fraction=o.distance,i[r]=o,r++)}return e.z>0?i.sort((t,e)=>t.transform===e.transform?0:null===t.transform?1:null===e.transform?-1:t.transform.position.z-e.transform.position.z):i.sort((t,e)=>t.transform===e.transform?0:null===t.transform?1:null===e.transform?-1:e.transform.position.z-t.transform.position.z),r},u.isTouching=function(t,e){const i=t.handle,n=e.handle.$id;if(!i._contacts||i.$id===n)return!1;for(const t in i._contacts){if(!i._contacts.hasOwnProperty(t))continue;const e=i._contacts[t],o=e.getFixtureA(),s=e.getFixtureB(),r=o._component,c=s._component;if(r.$id===n||c.$id===n)return!0}return!1},{Physics2DSystem:u}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="rigidbody2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this._physics2DSystem=pc.Application.getApplication().systems.physics2D};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),Object.defineProperty(t.prototype,"adapter",{get:function(){return this._physics2DSystem.adapter}}),{Rigidbody2DSystem:t}}()),Object.assign(pc,function(){const t=planck.Math.EPSILON,e=.001*Math.PI*.001,i=planck.Body,n=new planck.Vec2,o=new planck.Vec2,s=new pc.Quat,r=new pc.Vec3,c=function(t){pc.UnityComponent.prototype.constructor.call(this),t=t||{enabled:!0,simulated:!0,type:UnityEngine.RigidbodyType2D.Dynamic,collisionDetectionMode:UnityEngine.CollisionDetectionMode2D.Discrete,mass:1},this._system=pc.Application.getApplication().systems.rigidbody2D,this._enabled=t.enabled,this._simulated=t.simulated,this._collisionDetectionMode=t.collisionDetectionMode,this._constraints=t.constraints||0,this._freezeRotation=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezeRotation),this._freezeX=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezePositionX),this._freezeY=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezePositionY),this._useCollidersDensity=!!t.useAutoMass,this._adapter=this._system.adapter,this._world=this._adapter.world,this._body=this._world.createBody({type:t.type===UnityEngine.RigidbodyType2D.Dynamic?i.DYNAMIC:t.type===UnityEngine.RigidbodyType2D.Kinematic?i.KINEMATIC:i.STATIC,bullet:this._collisionDetectionMode===UnityEngine.CollisionDetectionMode2D.Continuous,gravityScale:Number.isFinite(t.gravityScale)?t.gravityScale:1,angularDamping:t.angularDrag>=0?t.angularDrag:.05,linearDamping:t.drag>0?t.drag:0,fixedRotation:this._freezeRotation,defaultMass:t.mass,fixedX:this._freezeX,fixedY:this._freezeY,active:!1}),this._body._component=this,this._body._entity=t.entity,this._body._material=t.material,this.createFauxFixture()};return(c.prototype=Object.create(pc.UnityComponent.prototype)).constructor=c,Object.assign(c.prototype,{createFauxFixture:function(){const t=this._body._density=this._body.getDefaultMass()/e;this._body.createFixture(new planck.Circle(.001),{density:t,filterMaskBits:0})._isFaux=!0},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._simulated&&this._adapter.enableRigidbody(this),!0)},onDisable:function(){if(!pc.UnityComponent.prototype.onDisable.call(this))return!1;if(this._simulated&&this._enabled&&this._adapter.disableRigidbody(this),this._entity._enabled)return!0;let t=this._body.getJointList();for(;t;){const e=t.joint;t=t.next,e.getBodyB()===this._body&&this._world.destroyJoint(e)}return!0},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this._destroyed=!0,this.onDisable(),this._world.destroyBody(this._body),!0)},addForce:function(t){this._body.applyForceToCenter(n.set(t.x,t.y),!0)},addImpulse:function(t){this._body.applyLinearImpulseToCenter(n.set(t.x,t.y),!0)},addForceAtPosition:function(t,e){this._body.applyForce(n.set(t.x,t.y),o.set(e.x,e.y),!0)},addImpulseAtPosition:function(t,e){this._body.applyLinearImpulse(n.set(t.x,t.y),o.set(e.x,e.y),!0)},addRelativeForce:function(t){this._body.applyForceToCenter(n.set(t.x,t.y).rot(this._body.getTransform().q),!0)},addRelativeImpulse:function(t){this._body.applyLinearImpulseToCenter(n.set(t.x,t.y).rot(this._body.getTransform().q),!0)},addTorque:function(t){this._body.applyTorque(t,!0)},addTorqueImpulse:function(t){this._body.applyAngularImpulse(t,!0)},getVelocity:function(){const t=this._body.getLinearVelocity();return this._velocity=(this._velocity||new pc.Vec2).set(t.x,t.y),this._velocity},setVelocity:function(t){this._freezeX&&this._freezeY||(this._freezeX||this._freezeY?(n.set(this._body.getLinearVelocity()),this._freezeX?n.y=t.y:n.x=t.x,this._body.setLinearVelocity(n)):this._body.setLinearVelocity(n.set(t.x,t.y)))},getAngularVelocity:function(){return this._body.getAngularVelocity()*pc.math.RAD_TO_DEG},setAngularVelocity:function(t){this._freezeRotation||this._body.setAngularVelocity(t*pc.math.DEG_TO_RAD)},getMass:function(){return this._body.getMass()},setMass:function(t){if(this._useCollidersDensity)return void UnityEngine.Debug.LogWarningFormat("Mass cannot be set on the rigid-body when it is using auto-mass.");const e=this._body;e.getMass()!==t&&(e.setDefaultMass(t),c.setDensity(e,e.getDefaultMass()/e.getMass()*e._density),e.setAwake(!0))},getUseAutoMass:function(){return this._useCollidersDensity},setUseAutoMass:function(t){this._useCollidersDensity!==t&&(this._useCollidersDensity=!!t,this._resetMassData())},_resetMassData:function(){const t=this._body;if(!this._useCollidersDensity){const e=t.getDefaultMass();return c.setDensity(t,1),void this.setMass(e)}let e=t.getFixtureList();if(!e._isFaux){for(;e;e=e.getNext()){const t=e._component.getDensity();e.setDensity(t)}t.resetMassData(),t.setAwake(!0)}},getInertia:function(){return this._body.getInertia()},setInertia:function(t){this._body.setInertia(Math.max(t,1e-4))},getDrag:function(){return this._body.getLinearDamping()},setDrag:function(t){this._body.setLinearDamping(t)},getAngularDrag:function(){return this._body.getAngularDamping()},setAngularDrag:function(t){this._body.setAngularDamping(t)},getPosition:function(){const t=this._body.getPosition();return new pc.Vec2(t.x,t.y)},setPosition:function(t){this._body.setPosition(o.set(t.x,t.y))},getRotation:function(){return this._body.getAngle()*pc.math.RAD_TO_DEG},setRotation:function(t){this._body.setAngle(t*pc.math.DEG_TO_RAD)},getGravityScale:function(){return this._body.getGravityScale()},setGravityScale:function(t){this._body.setGravityScale(t)},getCollisionDetectionMode:function(){return this._collisionDetectionMode},setCollisionDetectionMode:function(t){this._collisionDetectionMode!==t&&(this._collisionDetectionMode=t,this._body.setBullet(t===UnityEngine.CollisionDetectionMode2D.Continuous))},getSimulated:function(){return this._simulated},setSimulated:function(t){t!==this._simulated&&(this._simulated=t,this._enabled&&(t?this._adapter.enableRigidbody(this):this._adapter.disableRigidbody(this)))},getBodyType:function(){switch(this._body.getType()){case i.DYNAMIC:return UnityEngine.RigidbodyType2D.Dynamic;case i.KINEMATIC:return UnityEngine.RigidbodyType2D.Kinematic;case i.STATIC:return UnityEngine.RigidbodyType2D.Static;default:return NaN}},setBodyType:function(t){if(this.getBodyType()!==t)switch(t){case UnityEngine.RigidbodyType2D.Dynamic:this._body.setType(i.DYNAMIC),this._resetMassData();break;case UnityEngine.RigidbodyType2D.Kinematic:this._body.setType(i.KINEMATIC);break;case UnityEngine.RigidbodyType2D.Static:this._body.setType(i.STATIC)}},getIsKinematic:function(){return this._body.getType()===i.KINEMATIC},setIsKinematic:function(t){this._body.setType(t?i.KINEMATIC:i.DYNAMIC)},getIsStatic:function(){return this._body.getType()===i.STATIC},getFreezeRotation:function(){return this._freezeRotation},setFreezeRotation:function(t){t!==this._freezeRotation&&(this._body.setFixedRotation(this._freezeRotation=!!t),this._freezeRotation?this._constraints|=UnityEngine.RigidbodyConstraints2D.FreezeRotation:this._constraints&=~UnityEngine.RigidbodyConstraints2D.FreezeRotation)},getConstraints:function(){return this._constraints},setConstraints:function(t){t!==this._constraints&&(this._constraints=t,this._freezeRotation!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezeRotation)&&this._body.setFixedRotation(this._freezeRotation=!this._freezeRotation),this._freezeX!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezePositionX)&&this._body.setFixedX(this._freezeX=!this._freezeX),this._freezeY!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezePositionY)&&this._body.setFixedY(this._freezeY=!this._freezeY))},getCenterOfMass:function(){const t=this._body.getLocalCenter();return new pc.Vec2(t.x,t.y)},setCenterOfMass:function(t){o.set(t.x,t.y),this._body.setLocalCenter(o)},moveRotation:function(t){this._freezeRotation||(t*=pc.math.DEG_TO_RAD,this._body.setAngularVelocity((t-this._body.getAngle())/this._world.getLastTimeStep()))},movePosition:function(t){this._body.setPosition(t)},wakeUp:function(){this._body.setAwake(!0)}}),Object.assign(c,{setBodyTransform:function(e,i,n){if(o.set(i.x,i.y),n*=pc.math.DEG_TO_RAD,e.getPosition().closeTo(o)){const i=(n-e.getAngle())/(2*Math.PI);if(Math.abs(Math.round(i)-i)<=t)return}e.setTransform(o,n),e.dirtifyTransform(!1)},setEntityTransform:function(e,i){if(!e.isDirtyTransform())return;const n=e.getTransform(),c=i.getPosition();o.set(c.x,c.y),i.getRotation().getEulerAngles(r);const a=n.q.getAngle()*pc.math.RAD_TO_DEG;Math.abs(a-r.z)>t&&(s.setFromEulerAngles(r.x,r.y,a),i.setRotation(s)),o.closeTo(n.p)||i.setPosition(n.p.x,n.p.y,c.z),e.dirtifyTransform(!1)},setDensity:function(t,e){t._density=e;for(let i=t.getFixtureList();i;i=i.getNext())i.setDensity(e);t.resetMassData()}}),Object.defineProperty(c.prototype,"body",{get:function(){return this._body}}),Object.defineProperty(c.prototype,"destroyed",{get:function(){return this._destroyed}}),Object.defineProperty(c.prototype,"useCollidersDensity",{get:function(){return this._useCollidersDensity}}),{Rigidbody2DComponent:c}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="collider2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this._physics2DSystem=pc.Application.getApplication().systems.physics2D};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._physics2DSystem.defaultMaterial},set:function(t){this._physics2DSystem.defaultMaterial=t}}),{Collider2DSystem:t}}()),Object.assign(pc,function(){const t=planck.Math.EPSILON,e=new planck.Vec2,i=new pc.Vec3;let n,o;const s=new pc.Vec3,r=new pc.Vec3;let c;const a=function(t){pc.UnityComponent.prototype.constructor.call(this),t=t||{enabled:!0},this._enabled=void 0===t.enabled||t.enabled,this._fixtureDef=t.fixture||{active:!1},this._shape=t.shape,this._isTrigger=t.isTrigger,this._usedByEffector=t.usedByEffector,this._density=t.density>=0?t.density:1,this._offset=this._offset||t.offset,this._type=t.type||"collider2D",this._relativePosition=new pc.Vec3(0,0,0),this._accumulatedScale=new pc.Vec3(1,1,1),this._adapter=pc.Application.getApplication().systems.physics2D.adapter,this._material=t.material,this._material&&(this._fixtureDef.friction=this._material.friction,this._fixtureDef.restitution=this._material.bounciness),this._fixtureDef.isSensor=this._isTrigger};(a.prototype=Object.create(pc.UnityComponent.prototype)).constructor=a,Object.defineProperty(a.prototype,"code",{get:function(){return this._code||this._initializeCode(),this._code}}),Object.defineProperty(a.prototype,"shape",{get:function(){return this._shape}}),Object.defineProperty(a.prototype,"type",{get:function(){return this._type}}),Object.assign(a.prototype,{_initializeCode:function(){this._code&&(this["__UnityEngine.Collider2D"]=this._code,this._code.handle=this)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableCollider(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableCollider(this),!0)},onDestroy:function(){if(!pc.UnityComponent.prototype.onDestroy.call(this))return!1;if(this.onDisable(),this._fixture){const t=this._fixture.getBody();t.destroyFixture(this._fixture),t._component&&!t.getFixtureList()&&t._component.createFauxFixture(),this._fixture=null}return!0},addFixture:function(t){if(this._fixture){const e=this._fixture.getBody();if(e===t)return;e.destroyFixture(this._fixture),this._fixture=null}else{const e=t.getFixtureList();e&&e._isFaux&&t.destroyFixture(e)}const e=t._component&&t._component.useCollidersDensity;if(this._fixtureDef.density=e?this._density:t._density,!this._material){const e=t._material||this._system.defaultMaterial;this._fixtureDef.friction=e.friction,this._fixtureDef.restitution=e.bounciness}this._fixture=t.createFixture(this._shape,this._fixtureDef),this._fixture._component=this,this._body=t},updateShape:function(t,e,i){t.getTranslation(this._relativePosition),this._accumulatedScale.copy(e),i&&i!==this._body||this._updateShapeSizeAndPosition()},_updateShapeSizeAndPosition:function(t){const e=this._fixture;e&&(e.createProxies(),this._resetMassData())},_resetMassData:function(){this._resetBodyMassData(this._fixture.getBody())},_resetBodyMassData:function(t){if(t.resetMassData(),t.fixturesAreBlank()||t.isStatic()||t.isKinematic()||t._component&&t._component.useCollidersDensity)return t.setDefaultMass(t.getMass()),void t.setAwake(!0);const e=this._fixtureDef.density=t.getDefaultMass()/t.getMass()*t._density;pc.Rigidbody2DComponent.setDensity(t,e),t.setAwake(!0)},_transformVertices:function(){const t=this._entity.getWorldTransform(),n=this._vertices,o=this._vertices2D;let s=!1;const r=this._getAngle2D(),c=Math.cos(r),a=Math.sin(r),h=this._relativePosition;let l;for(let r=n.length,d=0;d<r;++d)i.copy(n[d]),t.transformVector(i,i).add(h),l=o[d],e.set(i).rotate(c,a).closeTo(l)||(l.set(e),s=!0);return s},_getAngle2D:function(){return-(this._body._entity||this._body._component._entity).getEulerAngles().z*pc.math.DEG_TO_RAD},enable:function(){this._fixtureDef.active=!0,this._fixture&&(this._fixture.setActive(!0),this._resetMassData())},disable:function(){this._fixtureDef.active=!1,this._fixture&&(this._fixture.setActive(!1),this._resetMassData())},addContact:function(t,e){this._contacts=this._contacts||{},this._contacts[e]=t},removeContact:function(t){this._contacts&&delete this._contacts[t]},_getContacts:function(){return this._contacts},overlapPoint:function(t){return!!this._fixture&&this._fixture.testPoint(e.set(t.x,t.y))},getContactedColliders:function(t){if(!(t&&t.length>0&&this._contacts))return 0;let e=0;for(const i in this._contacts){if(!this._contacts.hasOwnProperty(i))continue;const n=this._contacts[i],o=n.getFixtureA(),s=n.getFixtureB();if(!o.getBody()||!s.getBody())continue;const r=o._component,c=s._component;if(!r._isTrigger&&!c._isTrigger&&(o===this._fixture?t[e++]=c.code:s===this._fixture&&(t[e++]=r.code),e>=t.length))break}return e},getIsTrigger:function(){return this._isTrigger},setIsTrigger:function(t){t=!!t,this._isTrigger!==t&&(this._fixtureDef.isSensor=this._isTrigger=t,this._fixture&&this._fixture.setSensor(t))},getIsUsedByEffector:function(){return this._usedByEffector},setIsUsedByEffector:function(t){this._usedByEffector=!!t},getOffset:function(){return this._offset.clone()},setOffset:function(t){throw new Error("Not Implemented")},getShapeCount:function(){return 1},overlapCollider:function(t,e){return null!=e&&0!==e.length&&this._fixture?(n=0,o=e,this._fixture.queryOverlaps(this._reportOverlap),o=null,n):0},_reportOverlap:function(t){return!!t._isFaux||(o[n++]=t._component.code,n<o.length)},getDistance:function(t){const e=new UnityEngine.ColliderDistance2D;if(null==t||null==t._fixture||null==this._fixture)return e;const i=this._adapter.world.getDistance(this._fixture,t._fixture);if(null==i)return e;let n=i.pointA,o=i.pointB;return n=e.pointA.set(n.x,n.y),o=e.pointB.set(o.x,o.y),e.distance=i.distance,e.normal.copy(n).sub(o).normalize(),e.isValid=!0,e},getBounds:function(){const t=new UnityEngine.Bounds;if(!this._fixture||!this._fixtureDef.active)return t;const e=this._fixture.getProxyCount();if(e<1)return t;c=c||new planck.AABB,c.set(this._fixture.getAABB(0));for(let t=1;t<e;++t)c.combine(c,this._fixture.getAABB(t));const i=this._entity.getPosition().z;return s.set(c.lowerBound.x,c.lowerBound.y,i),r.set(c.upperBound.x,c.upperBound.y,i),t.SetMinMax(s,r),t},getDensity:function(){return this._density},setDensity:function(t){if(this._density===t)return;const e=this._body;if(e&&e._component&&!e._component.useCollidersDensity)return void UnityEngine.Debug.LogWarningFormat("Density cannot be set on the collider unless it is attached to a dynamic rigid-body that is using auto-mass.");this._fixtureDef.density=this._density=t=t>=0?t:0;const i=this._fixture;i&&(i.setDensity(t),this._resetBodyMassData(i.getBody()))},getSharedMaterial:function(){return this._material},setSharedMaterial:function(t){this._material=t,t||(this._body&&(t=this._body._material),t=t||this._system.defaultMaterial);const e=this._fixtureDef;e.friction=t.friction,e.restitution=t.bounciness;const i=this._fixture;i&&(i.setFriction(t.friction),i.setRestitution(t.bounciness))}});const h=function(t){(t=t||{}).type="boxCollider2D",this._offset=(new pc.Vec2).copy(t.center||pc.Vec2.ZERO),this._size=(new pc.Vec2).copy(t.size||pc.Vec2.ZERO).setFromMax(.005,.005);const i=new planck.Box(.5*this._size.x,.5*this._size.y,e.set(this._offset.x,this._offset.y));i.setRadius(t.radius),t.shape=i;const n=this._vertices2D=i.m_vertices,o=this._vertices=new Array(n.length);for(let t=o.length,e=0;e<t;++e)o[e]=new pc.Vec3(n[e].x,n[e].y,0);a.call(this,t)};(h.prototype=Object.create(a.prototype)).constructor=h,Object.assign(h.prototype,{_initializeCode:function(){this._code=new UnityEngine.BoxCollider2D(this),this["__UnityEngine.BoxCollider2D"]=this._code,a.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){(this._fixture||t)&&(this._transformVertices()||t)&&(this._shape._set(this._vertices2D),a.prototype._updateShapeSizeAndPosition.call(this))},getSize:function(){return this._size.clone()},setSize:function(t){let e=(t=t||pc.Vec2.ZERO).x,i=t.y;e<.005&&(e=.005),i<.005&&(i=.005),(t=this._size).x===e&&t.y===i||(this._size.set(e,i),this._rebuild())},_rebuild:function(){this._shape._setAsBox(.5*this._size.x,.5*this._size.y,e.set(this._offset.x,this._offset.y));const t=this._vertices;let i;const n=this._vertices2D;for(let e=t.length,o=0;o<e;++o)i=n[o],t[o].set(i.x,i.y,0);this._updateShapeSizeAndPosition()},setOffset:function(t){this._offset.equals(t=t||pc.Vec2.ZERO)||(this._offset.copy(t),this._rebuild())},getShapeCount:function(){return this._size.x<=.005||this._size.y<=.005?0:1}});const l=function(t){(t=t||{}).type="circleCollider2D",this._offset=(new pc.Vec2).copy(t.center||pc.Vec2.ZERO),e.set(this._offset.x,this._offset.y);const i=this._radius=t.radius=t.radius>0?t.radius:.005,n=t.shape=new planck.Circle(e,i);this._center=new pc.Vec3(e.x,e.y,0),this._vertices=[this._center],this._vertices2D=[n.m_p],this._radius=i,a.call(this,t)};(l.prototype=Object.create(a.prototype)).constructor=l,Object.assign(l.prototype,{_initializeCode:function(){this._code=new UnityEngine.CircleCollider2D(this),this["__UnityEngine.CircleCollider2D"]=this._code,a.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){if(this._fixture||t){const e=this._transformVertices(),i=this._scaleRadius();(e||i||t)&&this._rebuild()}},_rebuild:function(){a.prototype._updateShapeSizeAndPosition.call(this),this._shape.m_vertices=null},_scaleRadius:function(){const e=this._radius*Math.max(this._accumulatedScale.x,this._accumulatedScale.y),i=e-this._shape.getRadius();return!(-t<=i&&i<=t)&&(this._shape.setRadius(e),!0)},getRadius:function(){return this._radius},setRadius:function(t){this._radius!==t&&(this._radius=t,this._fixture&&this._scaleRadius()&&this._rebuild())},setOffset:function(t){this._offset.equals(t=t||pc.Vec2.ZERO)||(this._offset.copy(t),this._center.set(t.x,t.y,0),this._fixture&&this._transformVertices()&&this._rebuild())}});const d=function(t){(t=t||{}).type="capsuleCollider2D",this._offset=(new pc.Vec2).copy(t.center||pc.Vec2.ZERO),this._size=(new pc.Vec2).copy(t.size||pc.Vec2.ZERO).setFromMax(.005,.005),this._direction=t.direction||UnityEngine.CapsuleDirection2D.Vertical,this._vertices2D=[new planck.Vec2,new planck.Vec2,new planck.Vec2],this._vertices=[new pc.Vec3,new pc.Vec3,new pc.Vec3],this._vertex1=new planck.Vec2,this._vertex2=new planck.Vec2,this._radius=0,this._calculateVertices(),this._calculateShape(),t.shape=new planck.Capsule(this._vertex1,this._vertex2,this._radius),a.call(this,t)};(d.prototype=Object.create(a.prototype)).constructor=d,Object.assign(d.prototype,{_calculateVertices:function(){const t=this._offset.x,e=this._offset.y,i=.5*this._size.x,n=.5*this._size.y,o=this._vertices2D,s=this._vertices;this._direction===UnityEngine.CapsuleDirection2D.Vertical?(o[0].set(t,e-n),o[1].set(t,e+n),o[2].set(t+i,e)):(o[0].set(t-n,e),o[1].set(t+n,e),o[2].set(t,e+i));for(let t=0,e=o.length;t<e;++t){const e=o[t];s[t].set(e.x,e.y,0)}},_calculateShape:function(){const e=this._vertices2D[0],i=this._vertices2D[1],n=this._vertices2D[2],o=e.x,s=e.y,r=i.x,c=i.y,a=.5*(o+r),h=.5*(s+c),l=n.x-a,d=n.y-h,u=Math.sqrt(l*l+d*d);this._radius=u;let p=o-a,_=s-h,y=Math.sqrt(p*p+_*_);y<=0&&(y=u);const f=Math.max(t,1-u/y);this._vertex1.x=a+f*p,this._vertex1.y=h+f*_,p=r-a,_=c-h,this._vertex2.x=a+f*p,this._vertex2.y=h+f*_},_initializeCode:function(){this._code=new UnityEngine.CapsuleCollider2D(this),this["__UnityEngine.CapsuleCollider2D"]=this._code,a.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){(this._fixture||t)&&(this._transformVertices()||t)&&(this._calculateShape(),this._shape.setRadius(this._radius),this._shape.setVertex1(this._vertex1),this._shape.setVertex2(this._vertex2),a.prototype._updateShapeSizeAndPosition.call(this))},getSize:function(){return this._size.clone()},setSize:function(t){this._size.equals(t)||(this._size=t,this._calculateVertices(),this._updateShapeSizeAndPosition())},getDirection:function(){return this._direction}});const u=function(t){t=t||{},this._init(t),t.type="edgeCollider2D",t.shape=new planck.Chain(this._vertices2D,!1,t.radius),a.call(this,t)};(u.prototype=Object.create(a.prototype)).constructor=u,Object.assign(u.prototype,{_initializeCode:function(){this._code=new UnityEngine.EdgeCollider2D(this),this["__UnityEngine.EdgeCollider2D"]=this._code,a.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){(this._fixture||t)&&(!this._body||this._transformVertices()||t)&&(this._shape._createChain(this._vertices2D),a.prototype._updateShapeSizeAndPosition.call(this))},_init:function(t){this._offset=(new pc.Vec2).copy(t.offset||pc.Vec2.ZERO);const e=t.points||[],i=e.length,n=i/2,o=this._points=new Array(n),s=this._vertices=new Array(n),r=this._vertices2D=new Array(n),c=this._offset.x,a=this._offset.y;for(let t,n,h,l,d=0,u=0;d<i;d+=2,++u)t=e[d],n=e[d+1],h=c+t,l=a+n,o[u]=new pc.Vec2(t,n),r[u]=new planck.Vec2(h,l),s[u]=new pc.Vec3(h,l,0)},setOffset:function(t){if(this._offset.equals(t=t||pc.Vec2.ZERO))return;this._offset.copy(t);const e=this._points,i=this._vertices,n=t.x,o=t.y;for(let t,s=0,r=e.length;s<r;++s)t=e[s],i[s].set(n+t.x,o+t.y,0);this._updateShapeSizeAndPosition()},getPoints:function(){let t;const e=this._points,i=e.length,n=new Array(i);for(let o=0;o<i;++o)t=e[o],n[o]=new pc.Vec2(t.x,t.y);return n},setPoints:function(t){let e,i,n,o,s,r=0;const c=(t=t||[]).length,a=this._offset.x,h=this._offset.y,l=this._vertices,d=this._vertices2D,u=this._points;for(let e=Math.min(c,l.length);r<e;++r)n=t[r],o=n.x,s=n.y,l[r].set(a+o,h+s,0),u[r].set(o,s);for(l.length=d.length=u.length=c;r<c;++r)n=t[r],o=n.x,s=n.y,e=a+o,i=h+s,d[r]=new planck.Vec2(e,i),l[r]=new pc.Vec3(e,i,0),u[r]=new pc.Vec2(o,s);this._updateShapeSizeAndPosition(!0)},getPointCount:function(){return this._vertices.length}}),Object.defineProperty(u.prototype,"edgeRadius",{set:function(t){this._shape.setRadius(t)},get:function(){return this._shape.getRadius()}});const p=function(t){t=t||{},this._init(t),t.type="polygonCollider2D",t.shape=new planck.CompositePolygon(this._contours),a.call(this,t)};return(p.prototype=Object.create(a.prototype)).constructor=p,Object.assign(p.prototype,{_initializeCode:function(){this._code=new UnityEngine.PolygonCollider2D(this),this["__UnityEngine.PolygonCollider2D"]=this._code,a.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){(this._fixture||t)&&(!this._body||this._transformVertices()||t)&&(this._shape._set(this._contours),a.prototype._updateShapeSizeAndPosition.call(this))},_init:function(t){this._offset=(new pc.Vec2).copy(t.offset||pc.Vec2.ZERO);const e=this._offset.x,i=this._offset.y,n=this._points=t.points||[],o=n.length,s=this._vertices=new Array(o),r=this._contours=new Array(o);for(let t=0;t<o;++t){const o=n[t]||[],c=o.length,a=c>>1,h=s[t]=new Array(a),l=r[t]=new Array(c);for(let t,n,s=0,r=0;s<c;s+=2,++r)t=l[s]=o[s]+e,n=l[s+1]=o[s+1]+i,h[r]=new pc.Vec3(t,n,0)}},_transformVertices:function(){let t=!1;const e=this._entity.getWorldTransform(),i=this._getAngle2D(),n=Math.cos(i),o=Math.sin(i),s=this._relativePosition,r=this._vertices,c=this._contours;for(let i=r.length,a=0;a<i;++a){const i=c[a],h=r[a];t=this._setContour(i,h,e,n,o,s)||t}return t},_transformContour:function(t){const e=this._entity.getWorldTransform(),i=this._getAngle2D(),n=Math.cos(i),o=Math.sin(i),s=this._relativePosition,r=this._contours[t],c=this._vertices[t];return this._setContour(r,c,e,n,o,s)},_setContour:function(t,n,o,s,r,c){let a=!1;for(let h=t.length,l=0,d=0;l<h;l+=2,++d)i.copy(n[d]),o.transformVector(i,i).add(c),e.set(i).rotate(s,r).closeToValues(t[l],t[l+1])||(t[l]=e.x,t[l+1]=e.y,a=!0);return a},setOffset:function(t){if(this._offset.equals(t=t||pc.Vec2.ZERO))return;this._offset.copy(t);const e=t.x,i=t.y,n=this._points,o=this._vertices;for(let t=0,s=n.length;t<s;++t){const s=n[t],r=o[t];for(let t=0,o=0,c=n.length;t<c;t+=2,++o)r[o].set(e+s[t],i+s[t+1],0)}this._updateShapeSizeAndPosition()},getPoints:function(){return 0===this._points.length?[]:this.getPath(0)},getPath:function(t){if(t>=this._points.length||t<0)throw new System.ArgumentOutOfRangeException.ctor;const e=this._points[t],i=e.length,n=new Array(i>>1);for(let t=0,o=0;t<i;t+=2,++o)n[o]=new pc.Vec2(e[t],e[t+1]);return n},setPoints:function(t){null!=t&&0!==t.length&&this.setPath(0,t)},setPath:function(t,e){if(null==e)throw new System.ArgumentNullException;const i=this._points,n=i.length;if(t>0&&t>=n||t<0)throw new System.ArgumentOutOfRangeException.ctor;const o=this._contours,s=this._vertices;let r,c;0===n&&(i[0]=[],o[0]=[],s[0]=[]);let h=0,l=0;const d=e.length;let u,p,_;const y=this._offset.x,f=this._offset.y,g=i[t],m=o[t],b=s[t],C=b.length!==d;for(let t=Math.min(d,b.length);h<t;++h,l+=2)u=e[h],p=u.x,_=u.y,b[h].set(y+p,f+_,0),g[l]=p,g[l+1]=_;for(b.length=d,m.length=g.length=2*d;h<d;++h,l+=2)u=e[h],p=u.x,_=u.y,r=y+p,c=f+_,b[h]=new pc.Vec3(r,c,0),m[l]=r,m[l+1]=c,g[l]=p,g[l+1]=_;(!this._body||this._transformContour(t)||C)&&(this._shape._set(this._contours),a.prototype._updateShapeSizeAndPosition.call(this))},getPathCount:function(){return this._points.length},setPathCount:function(t){const e=this._points,i=e.length;if(i===t)return;t<0&&(t=0);const n=this._contours,o=this._vertices;if(e.length=t,n.length=t,o.length=t,t<i)return this._shape._set(this._contours),void a.prototype._updateShapeSizeAndPosition.call(this);for(let s=i;s<t;++s)e[s]=[],n[s]=[],o[s]=[]},getTotalPointCount:function(){let t=0;const e=this._vertices;for(let i=0,n=e.length;i<n;++i)t+=e[i].length;return t}}),{Collider2DComponent:a,BoxCollider2DComponent:h,CircleCollider2DComponent:l,CapsuleCollider2DComponent:d,EdgeCollider2DComponent:u,PolygonCollider2DComponent:p}}()),pc.extend(planck.Contact.prototype,{getContactPoint:function(t,e){const i=new UnityEngine.ContactPoint2D;i.collider=e.collider,i.otherCollider=e.otherCollider,i.rigidbody=e.rigidbody,i.otherRigidbody=e.otherRigidbody;const n=this.v_points[t];return i.point.set(n.worldPoint.x,n.worldPoint.y),i.normal.set(this.v_normal.x,this.v_normal.y),i.normalImpulse=n.normalImpulse,i.tangentImpulse=n.tangentImpulse,i.separation=n.separation,i}}),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),t&&(this._enabled=!!t.enabled,this._useColliderMask=!!t.useColliderMask,this._colliderMask=t.colliderMask),this._adapter=pc.Application.getApplication().systems.physics2D.adapter};(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{_initializeCode:function(){this._code&&(this["__UnityEngine.Effector2D"]=this._code,this._code.handle=this)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableEffector(this),!0)},onBeforeCollision2D:function(t){const e=t.getFixtureA(),i=t.getFixtureB(),n=e._component._body.getLinearVelocity(),o=i._component._body.getLinearVelocity();n.y+o.y>0&&t.setEnabled(!1)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableEffector(this),!0)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.onDisable(),!0)}}),Object.defineProperty(t.prototype,"useColliderMask",{get:function(){return this._useColliderMask},set:function(t){this._useColliderMask=t}});const e=function(e){t.call(this,e)};return(e.prototype=Object.create(t.prototype)).constructor=e,Object.assign(e.prototype,{_initializeCode:function(){this._code=new UnityEngine.PlatformEffector2D(this),this["__UnityEngine.PlatformEffector2D"]=this._code,t.prototype._initializeCode.call(this)}}),{Effector2DComponent:t,PlatformEffector2DComponent:e}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="effector2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),{Effector2DSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="joint2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),{Joint2DSystem:t}}()),Object.assign(pc,function(){const t=["onFixedUpdate"],e=pc.math.DEG_TO_RAD,i=pc.math.RAD_TO_DEG,n=new planck.Vec2,o=function(t){if(pc.UnityComponent.prototype.constructor.call(this),this.constraint=this._jointDef={active:!1},t){this._enabled=!!t.enabled,this._enableCollision=!!t.enableCollision;const e=t.breakForce,i=t.breakTorque;this._breakForce=Number.isFinite(e)&&e>=0?e:1/0,this._breakTorque=Number.isFinite(i)&&i>=0?i:1/0}else this._enabled=!0,this._enableCollision=!1,this._breakForce=1/0,this._breakTorque=1/0;this._breakForceSq=this._breakForce*this._breakForce,this._adapter=pc.Application.getApplication().systems.physics2D.adapter,this._world=this._adapter.world,this._dt=0};(o.prototype=Object.create(pc.UnityComponent.prototype)).constructor=o,Object.assign(o.prototype,{_initializeCode:function(){this._code&&(this["__UnityEngine.Joint2D"]=this._code,this._code.handle=this)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableConstraint(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableConstraint(this),!0)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.onDisable(),this._joint&&(this._world.destroyJoint(this._joint),this._joint=null),!0)},_queuesToSubscribe:function(){return t},onFixedUpdate:function(t){if(null!=this._joint){if(this._dt=t,this._breakTorque<1/0){if(this._joint.getReactionTorque(1/t)>this._breakTorque)return void this.onDestroy()}if(this._breakForce<1/0){this._joint.getReactionForce(1/t,n).lengthSquared()>this._breakForceSq&&this.onDestroy()}}},createJoint:function(){if(this._joint)return;this._connectedBody=this.code.connectedBody;let t=this._connectedBody&&this._connectedBody.handle.body;const e=this.getAttachedRigidbody().handle.body;t||(t=this._adapter.getWorldBody()),this._joint=this._createJoint(e,t),this._joint._component=this},_createJoint:function(t,e){const i=this._jointDef;return i.bodyA=t,i.bodyB=e,i.active=this.enabled,i.collideConnected=this._enableCollision,i},update:function(){},enable:function(){this._jointDef.active=!0,this._joint&&this._joint.setActive(!0)},disable:function(){this._jointDef.active=!1,this._joint&&this._joint.setActive(!1)},getEnableCollision:function(){return this._enableCollision},setEnableCollision:function(t){this._enableCollision=!!t,this._joint&&this._joint.setCollideConnected(t)},getAttachedRigidbody:function(){if(this._attachedRigidbody)return this._attachedRigidbody;const t=this._entity._unityComponents.rigidbody2D[0];return this._attachedRigidbody=UnityEngine.Object.FromHandle(UnityEngine.Rigidbody2D,t),this._attachedRigidbody},getConnectedBody:function(){return this._connectedBody},setConnectedBody:function(t){this._connectedBody!==t&&(this._connectedBody=t,this._joint&&this._joint.setBodyB(t?this._connectedBody.handle.body:this._adapter.getWorldBody()))},getBreakForce:function(){return this._breakForce},setBreakForce:function(t){t<0&&(t=0),this._breakForce=t,this._breakForceSq=t*t},getBreakTorque:function(){return this._breakTorque},setBreakTorque:function(t){this._breakTorque=t<0?0:t},getReactionForce:function(t){return t>0&&this._joint?(new pc.Vec2).copy(this._joint.getReactionForce(1/t,n)):new pc.Vec2},getFrameReactionForce:function(){return this._dt>0&&this._joint?(new pc.Vec2).copy(this._joint.getReactionForce(1/this._dt,n)):new pc.Vec2},getReactionTorque:function(t){return t>0&&this._joint?this._joint.getReactionTorque(1/t):0},getFrameReactionTorque:function(){return this._dt>0&&this._joint?this._joint.getReactionTorque(1/this._dt):0}}),Object.defineProperty(o.prototype,"sortingOrderInQueue",{get:function(){return this._sortingOrderInQueue},configurable:!0}),Object.defineProperty(o.prototype,"code",{get:function(){return this._code||this._initializeCode(),this._code}}),Object.defineProperty(o.prototype,"joint",{get:function(){return this._joint}}),Object.defineProperty(o.prototype,"type",{get:function(){return this._type}});const s=function(t){o.call(this,t),t?(this._autoConfigureConnectedAnchor=!!t.autoConfigureConnectedAnchor,this._connectedAnchor=t.connectedAnchor,this._anchor=t.anchor):(this._autoConfigureConnectedAnchor=!0,this._connectedAnchor=new pc.Vec2,this._anchor=pc.Vec2.ZERO)};(s.prototype=Object.create(o.prototype)).constructor=s,Object.assign(s.prototype,{_initializeCode:function(){this._code&&(this["__UnityEngine.AnchoredJoint2D"]=this._code),o.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=o.prototype._createJoint.call(this,t,e);i.localAnchorA=new planck.Vec2(this._anchor);const n=new planck.Vec2(this._connectedAnchor);return this._autoConfigureConnectedAnchor?(i.localAnchorB=this._getConnectedAnchor(t,e,i.localAnchorA,n),this._connectedAnchor.set(n.x,n.y)):i.localAnchorB=n,i},_getConnectedAnchor:function(t,e,i,n){return e.getLocalPoint(t.getWorldPoint(i,n),n)},getAutoConfigureConnectedAnchor:function(){return this._autoConfigureConnectedAnchor},setAutoConfigureConnectedAnchor:function(t){this._autoConfigureConnectedAnchor=!!t},getAnchor:function(){return this._anchor.clone()},setAnchor:function(t){this._anchor.equals(t)||(this._anchor=t,this._joint&&this._joint.setLocalAnchorA(this._joint.getLocalAnchorA().set(t.x,t.y)))},getConnectedAnchor:function(){return this._connectedAnchor.clone()},setConnectedAnchor:function(t){this._autoConfigureConnectedAnchor||this._connectedAnchor.equals(t)||(this._connectedAnchor=t,this._joint&&this._joint.setLocalAnchorB(this._joint.getLocalAnchorB().set(t.x,t.y)))},update:function(){if(!this._autoConfigureConnectedAnchor)return;const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&this._resetConnectedAnchor(t,e,i)},_updateConnectedAnchor:function(){if(!this._autoConfigureConnectedAnchor)return;const t=this._joint;t&&this._resetConnectedAnchor(t,t.getBodyA(),t.getBodyB())},_resetConnectedAnchor:function(t,e,i){const n=t.getLocalAnchorB();t.setLocalAnchorB(this._getConnectedAnchor(e,i,t.getLocalAnchorA(),n)),this._connectedAnchor.set(n.x,n.y)},setConnectedBody:function(t){this._connectedBody!==t&&(o.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateConnectedAnchor())},enable:function(){o.prototype.enable.call(this),this._updateConnectedAnchor()}});const r=function(t){this._type="springJoint2D",s.call(this,t),t?(this._frequency=t.frequency,this._dampingRatio=t.dampingRatio,this._distance=t.distance):(this._autoConfigureConnectedAnchor=!1,this._frequency=1,this._dampingRatio=0,this._distance=0)};(r.prototype=Object.create(s.prototype)).constructor=r,Object.assign(r.prototype,{_initializeCode:function(){this._code=new UnityEngine.SpringJoint2D(this),this["__UnityEngine.SpringJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=s.prototype._createJoint.call(this,t,e);return i.frequencyHz=this._frequency,i.dampingRatio=this._dampingRatio,i.length=this._distance,this._world.createJoint(new planck.DistanceJoint(i))},getDistance:function(){return this._distance},setDistance:function(t){this._distance=t,this._joint&&this._joint.setLength(t)},getFrequency:function(){return this._frequency},setFrequency:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)},getDampingRatio:function(){return this._dampingRatio},setDampingRatio:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}});const c=function(t){this._type="distanceJoint2D",s.call(this,t),t?(this._maxDistanceOnly=!!t.maxDistanceOnly,this._distance=t.distance,this._autoConfigureDistance=!!t.autoConfigureDistance):(this._autoConfigureConnectedAnchor=!1,this._maxDistanceOnly=!1,this._distance=.005,this._autoConfigureDistance=!0)};(c.prototype=Object.create(s.prototype)).constructor=c,Object.assign(c.prototype,{_initializeCode:function(){this._code=new UnityEngine.DistanceJoint2D(this),this["__UnityEngine.DistanceJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=s.prototype._createJoint.call(this,t,e);return this.autoConfigureDistance&&(this._distance=this._getDistance(t,e)),this._maxDistanceOnly?(i.maxLength=this._distance,this._world.createJoint(new planck.RopeJoint(i,t,e))):(i.frequencyHz=0,i.dampingRatio=1,i.length=this._distance,this._world.createJoint(new planck.DistanceJoint(i)))},update:function(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(s.prototype.update.call(this),this._autoConfigureDistance&&this._resetDistance(e,i))},_updateDistance:function(){if(!this._autoConfigureDistance)return;const t=this._joint;t&&this._resetDistance(t.getBodyA(),t.getBodyB())},_resetDistance:function(t,e){const i=this._distance=this._getDistance(t,e);this._joint.setLength(i),this._joint2&&this._joint2.setLength(i)},_getDistance:function(t,e){return Math.max(planck.Vec2.distance(t.getWorldPoint(this._anchor),e.getWorldPoint(this._connectedAnchor)),.005)},getDistance:function(){return this._distance},setDistance:function(t){this._autoConfigureDistance||(this._distance=t,this._joint&&(this._joint.setLength(t),this._joint2&&this._joint2.setLength(t)))},onDestroy:function(){return!!pc.AnchoredJoint2DComponent.prototype.onDestroy.call(this)&&(this._joint2&&(this._world.destroyJoint(this._joint2),this._joint2=null),!0)},getMaxDistanceOnly:function(){return this._maxDistanceOnly},setMaxDistanceOnly:function(t){if(t=!!t,this._maxDistanceOnly===t)return;if(this._maxDistanceOnly=t,!this._joint)return;if(this._joint.setActive(!1),!this._joint2)return this._joint2=this._joint,void(this._joint=this._createJoint(this._joint.getBodyA(),this._joint.getBodyB()));const e=this._joint2;this._joint2=this._joint,this._joint=e,this._joint.setActive(this.enabled)},getAutoConfigureDistance:function(){return this._autoConfigureDistance},setAutoConfigureDistance:function(t){if(t=!!t,this._autoConfigureDistance===t)return;if(this._autoConfigureDistance=t,!t)return;const e=this._joint;e&&this._resetDistance(e,e.getBodyA(),e.getBodyB())},setConnectedBody:function(t){this._connectedBody!==t&&(s.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateDistance())},enable:function(){this._updateDistance(),s.prototype.enable.call(this)}});const a=function(t){this._type="fixedJoint2D",s.call(this,t),t?(this._frequency=t.frequency,this._dampingRatio=t.dampingRatio):(this._frequency=0,this._dampingRatio=0)};(a.prototype=Object.create(s.prototype)).constructor=a,Object.assign(a.prototype,{_initializeCode:function(){this._code=new UnityEngine.FixedJoint2D(this),this["__UnityEngine.FixedJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=s.prototype._createJoint.call(this,t,e);return i.frequencyHz=this._frequency,i.dampingRatio=this._dampingRatio,this._world.createJoint(new planck.WeldJoint(i))},update:function(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(s.prototype.update.call(this),this._resetReferenceAngle(t,e,i))},_updateReferenceAngle:function(){const t=this._joint;t&&this._resetReferenceAngle(t,t.getBodyA(),t.getBodyB())},_resetReferenceAngle:function(t,e,i){t.setReferenceAngle(i.getAngle()-e.getAngle())},setConnectedBody:function(t){this._connectedBody!==t&&(s.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateReferenceAngle())},enable:function(){this._updateReferenceAngle(),s.prototype.enable.call(this)},getFrequency:function(){return this._frequency},setFrequency:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)},getDampingRatio:function(){return this._dampingRatio},setDampingRatio:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)},getReferenceAngle:function(){return this._joint?this._joint.getReferenceAngle()*i:0}});const h=function(t){this._type="hingeJoint2D",s.call(this,t),t?(this._limits=t.limits,this._useLimits=!!t.useLimits,this._motor=t.motor,this._useMotor=!!t.useMotor):(this._useLimits=!1,this._useMotor=!1)};(h.prototype=Object.create(s.prototype)).constructor=h,Object.assign(h.prototype,{_initializeCode:function(){this._code=new UnityEngine.HingeJoint2D(this),this["__UnityEngine.HingeJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,i){const n=s.prototype._createJoint.call(this,t,i);return n.enableLimit=this._useLimits,this._limits&&(n.lowerAngle=this._limits.min*e,n.upperAngle=this._limits.max*e),n.enableMotor=this._useMotor,this._motor&&(n.motorSpeed=this._motor.motorSpeed*e,n.maxMotorTorque=this._motor.maxMotorTorque),this._world.createJoint(new planck.RevoluteJoint(n))},getUseLimits:function(){return this._useLimits},setUseLimits:function(t){t=!!t,this._useLimits!==t&&(this._useLimits=t,this._joint&&this._joint.enableLimit(t))},getLimits:function(){if(this._limits)return this._limits.$clone();const t=new UnityEngine.JointAngleLimits2D;return t.max=359,t},setLimits:function(t){this._limits&&this._limits.min===t.min&&this._limits.max===t.max||(this._limits=t,this._joint&&this._joint.setLimits(t.min*e,t.max*e))},getUseMotor:function(){return this._useMotor},setUseMotor:function(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))},getMotor:function(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t},setMotor:function(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const i=this._joint;i&&(i.setMotorSpeed(t.motorSpeed*e),i.setMaxMotorTorque(t.maxMotorTorque))},getJointAngle:function(){return this._joint?this._joint.getJointAngle()*i:0}});const l=function(t){this._type="wheelJoint2D",s.call(this,t),this._autoConfigureConnectedAnchorMock=this._autoConfigureConnectedAnchor,this._autoConfigureConnectedAnchor=!1,t?(this._suspension=t.suspension,this._motor=t.motor,this._useMotor=!!t.useMotor):this._useMotor=!1};(l.prototype=Object.create(s.prototype)).constructor=l,Object.assign(l.prototype,{_initializeCode:function(){this._code=new UnityEngine.WheelJoint2D(this),this["__UnityEngine.WheelJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,i){const n=s.prototype._createJoint.call(this,t,i);return this._suspension&&(n.dampingRatio=this._suspension.dampingRatio,n.frequencyHz=this._suspension.frequency,n.localAxisA=this._getAxis(this._suspension.angle)),n.enableMotor=this._useMotor,this._motor&&(n.motorSpeed=this._motor.motorSpeed*e,n.maxMotorTorque=this._motor.maxMotorTorque),n.active=!!this._connectedBody,this._world.createJoint(new planck.WheelJoint(n))},_getAxis:function(t,i){return t*=e,(i=i||new planck.Vec2).set(Math.cos(t),Math.sin(t))},getAutoConfigureConnectedAnchor:function(){return this._autoConfigureConnectedAnchorMock},setConnectedBody:function(t){s.prototype.setConnectedBody.call(this,t),this._joint&&this._connectedBody&&this.enabled&&this._joint.setActive(!0)},enable:function(){s.prototype.enable.call(this),this._joint&&this._joint.setActive(!!this._connectedBody)},setAutoConfigureConnectedAnchor:function(t){this._autoConfigureConnectedAnchorMock=!!t},getSuspension:function(){if(this._suspension)return this._suspension.$clone();const t=new UnityEngine.JointSuspension2D;return t.dampingRatio=.7,t.frequency=2,t.angle=90,t},setSuspension:function(t){if(this._suspension&&this._suspension.dampingRatio===t.dampingRatio&&this._suspension.frequency===t.frequency&&this._suspension.angle===t.angle)return;this._suspension=t;const e=this._joint;e&&(e.setSpringDampingRatio(t.dampingRatio),e.setSpringFrequencyHz(t.frequency),e.setLocalAxisA(this._getAxis(t.angle,n)))},getUseMotor:function(){return this._useMotor},setUseMotor:function(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))},getMotor:function(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t},setMotor:function(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const i=this._joint;i&&(i.setMotorSpeed(t.motorSpeed*e),i.setMaxMotorTorque(t.maxMotorTorque))},getMotorTorque:function(t){return this._joint&&t>0?this._joint.getMotorTorque(1/t):0},getJointAngle:function(){return this._joint?this._joint.getJointAngle()*i:0},getJointSpeed:function(){return this._joint?this._joint.getJointAngularSpeed()*i:0},getJointTranslation:function(){return this._joint?this._joint.getJointTranslation():0},getJointLinearSpeed:function(){return this._joint?this._joint.getJointLinearSpeed():0}});const d=function(t){this._type="frictionJoint2D",s.call(this,t),t?(this._maxForce=t.maxForce,this._maxTorque=t.maxTorque):(this._maxForce=1,this._maxTorque=1)};(d.prototype=Object.create(s.prototype)).constructor=d,Object.assign(d.prototype,{_initializeCode:function(){this._code=new UnityEngine.FrictionJoint2D(this),this["__UnityEngine.FrictionJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=s.prototype._createJoint.call(this,t,e);return i.maxForce=this._maxForce,i.maxTorque=this._maxTorque,this._world.createJoint(new planck.FrictionJoint(i))},getMaxForce:function(){return this._maxForce},setMaxForce:function(t){this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce)},getMaxTorque:function(){return this._maxTorque},setMaxTorque:function(t){this._maxTorque=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxTorque(this._maxTorque)}});const u=function(t){this._type="relativeJoint2D",o.call(this,t),t?(this._autoConfigureOffset=!!t.autoConfigureOffset,this._linearOffset=t.linearOffset,this._angularOffset=t.angularOffset*e,this._maxForce=t.maxForce,this._maxTorque=t.maxTorque,this._correctionScale=t.correctionScale):(this._autoConfigureOffset=!0,this._linearOffset=new pc.Vec2,this._angularOffset=0,this._maxForce=1e4,this._maxTorque=1e4,this._correctionScale=.3)};(u.prototype=Object.create(o.prototype)).constructor=u,Object.assign(u.prototype,{_initializeCode:function(){this._code=new UnityEngine.RelativeJoint2D(this),this["__UnityEngine.RelativeJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=o.prototype._createJoint.call(this,t,e);i.maxForce=this._maxForce,i.maxTorque=this._maxTorque,i.correctionFactor=this._correctionScale;const n=new planck.Vec2(this._linearOffset);return this._autoConfigureOffset?(i.linearOffset=this._getLinearOffset(t,e,n),this._linearOffset.set(n.x,n.y),i.angularOffset=this._angularOffset=this._getAngularOffset(t,e)):(i.linearOffset=n,i.angularOffset=this._angularOffset),this._world.createJoint(new planck.MotorJoint(i))},_getLinearOffset:function(t,e,i){return t.getLocalPoint(e.getPosition(),i)},_getAngularOffset:function(t,e){return e.getAngle()-t.getAngle()},update:function(){if(!this._autoConfigureOffset)return;const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&this._resetOffsets(t,e,i)},_updateOffsets:function(){if(!this._autoConfigureOffset)return;const t=this._joint;t&&this._resetOffsets(t,t.getBodyA(),t.getBodyB())},_resetOffsets:function(t,e,i){const n=t.getLinearOffset();t.setLinearOffset(this._getLinearOffset(e,i,n)),this._linearOffset.set(n.x,n.y),t.setAngularOffset(this._angularOffset=this._getAngularOffset(e,i))},setConnectedBody:function(t){this._connectedBody!==t&&(o.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateOffsets())},enable:function(){o.prototype.enable.call(this),this._updateOffsets()},getAngularOffset:function(){return this._angularOffset*i},setAngularOffset:function(t){t*=e,this._angularOffset!==t&&(this._angularOffset=t,this._joint&&this._joint.setAngularOffset(t))},getLinearOffset:function(){return this._linearOffset.clone()},setLinearOffset:function(t){this._linearOffset.equals(t)||(this._linearOffset=t,this._joint&&this._joint.setLinearOffset(this._joint.getLinearOffset().set(t.x,t.y)))},getAutoConfigureOffset:function(){return this._autoConfigureOffset},setAutoConfigureOffset:function(t){this._autoConfigureOffset=!!t},getCorrectionScale:function(){return this._correctionScale},setCorrectionScale:function(t){this._correctionScale!==t&&(this._correctionScale=t<0?0:t>1?1:t,this._joint&&this._joint.setCorrectionFactor(this._correctionScale))},getMaxForce:function(){return this._maxForce},setMaxForce:function(t){this._maxForce!==t&&(this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce))},getMaxTorque:function(){return this._maxTorque},setMaxTorque:function(t){this._maxTorque!==t&&(this._maxTorque=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxTorque(this._maxTorque))},getTarget:function(){if(!this._joint)return pc.Vec2.ZERO.clone();const t=-this._angularOffset,e=this._joint.getBodyB();return n.set(e.getLocalCenter()).sub(this._linearOffset).rotate(Math.cos(t),Math.sin(t)),e.getWorldPoint(n,n),new pc.Vec2(n.x,n.y)}});const p=function(t){this._type="sliderJoint2D",s.call(this,t),t?(this._autoConfigureAngle=!!t.autoConfigureAngle,this._angle=t.angle*e,this._useMotor=!!t.useMotor,this._motor=t.motor,this._useLimits=!!t.useLimits,this._limits=t.limits):(this._autoConfigureConnectedAnchor=!1,this._autoConfigureAngle=!0,this._angle=0,this._useMotor=!1,this._useLimits=!1),this._newConnectedBody=!0};(p.prototype=Object.create(s.prototype)).constructor=p,Object.assign(p.prototype,{_initializeCode:function(){this._code=new UnityEngine.SliderJoint2D(this),this["__UnityEngine.SliderJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=s.prototype._createJoint.call(this,t,e);return i.enableMotor=this._useMotor,this._motor&&(i.motorSpeed=this._motor.motorSpeed,i.maxMotorForce=this._motor.maxMotorTorque),i.enableLimit=this._useLimits,this._limits&&(i.lowerTranslation=this._limits.min,i.upperTranslation=this._limits.max),i.localAxisA=this._getAxis(this._angle),this._world.createJoint(new planck.PrismaticJoint(i))},_getAxis:function(t,e){return(e=e||new planck.Vec2).set(Math.cos(t),Math.sin(t))},update:function(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(s.prototype.update.call(this),this._resetAngle(t,e,i))},_updateAngle:function(){const t=this._joint;t&&this._resetAngle(t,t.getBodyA(),t.getBodyB())},_resetAngle:function(t,e,i){if(this._newConnectedBody&&(t.setReferenceAngle(i.getAngle()-e.getAngle()),this._newConnectedBody=!1),!this._autoConfigureAngle)return;const o=t.getLocalAxisA(),s=i.getWorldPoint(t.getLocalAnchorB(),o),r=e.getWorldPoint(t.getLocalAnchorA(),n),c=s.sub(r).normal();this._angle=Math.atan2(c.y,c.x),t.setLocalAxisA(c)},setConnectedBody:function(t){this._newConnectedBody=!0,this._connectedBody!==t&&(s.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateAngle())},enable:function(){this._updateAngle(),s.prototype.enable.call(this)},getAngle:function(){return this._angle*i},setAngle:function(t){if(this._autoConfigureAngle)return void this._updateAngle();if(t*=e,this._angle===t)return;this._angle=t;const i=this._joint;i&&i.setLocalAxisA(this._getAxis(t,i.getLocalAxisA()))},getReferenceAngle:function(){return this._joint?this._joint.getReferenceAngle()*i:0},getAutoConfigureAngle:function(){return this._autoConfigureAngle},setAutoConfigureAngle:function(t){this._autoConfigureAngle=!!t},getUseMotor:function(){return this._useMotor},setUseMotor:function(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))},getMotor:function(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t},setMotor:function(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const e=this._joint;e&&(e.setMotorSpeed(t.motorSpeed),e.setMaxMotorForce(t.maxMotorTorque))},getUseLimits:function(){return this._useLimits},setUseLimits:function(t){t=!!t,this._useLimits!==t&&(this._useLimits=t,this._joint&&this._joint.enableLimit(t))},getLimits:function(){return this._limits?this._limits.$clone():new UnityEngine.JointTranslationLimits2D},setLimits:function(t){this.setUseLimits(!0),this._limits&&this._limits.min===t.min&&this._limits.max===t.max||(this._limits=t,this._joint&&this._joint.setLimits(t.min,t.max))},getLimitState:function(){if(!this._joint)return UnityEngine.JointLimitState2D.Inactive;switch(this._joint.getLimitState()){case 0:return UnityEngine.JointLimitState2D.Inactive;case 1:return UnityEngine.JointLimitState2D.LowerLimit;case 2:return UnityEngine.JointLimitState2D.UpperLimit;case 3:return UnityEngine.JointLimitState2D.EqualLimits;default:return UnityEngine.JointLimitState2D.Inactive}},getJointTranslation:function(){return this._joint?this._joint.getJointTranslation():0},getJointSpeed:function(){return this._joint?this._joint.getJointSpeed()*i:0},getMotorForce:function(t){return this._joint&&t>0?this._joint.getMotorForce(1/t):0}});const _=function(t){this._type="targetJoint2D",o.call(this,t),t?(this._autoConfigureTarget=!!t.autoConfigureTarget,this._target=t.target,this._anchor=t.anchor,this._maxForce=t.maxForce,this._dampingRatio=t.dampingRatio,this._frequency=t.frequency):(this._autoConfigureTarget=!0,this._target=new pc.Vec2,this._anchor=new pc.Vec2,this._maxForce=1e4,this._dampingRatio=1,this._frequency=5)};return(_.prototype=Object.create(o.prototype)).constructor=_,Object.assign(_.prototype,{_initializeCode:function(){this._code=new UnityEngine.TargetJoint2D(this),this["__UnityEngine.TargetJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=o.prototype._createJoint.call(this,e,t);i.maxForce=this._maxForce,i.dampingRatio=this._dampingRatio,i.frequencyHz=this._frequency,i.anchorB=new planck.Vec2(this._anchor);const n=new planck.Vec2(this._target);return this._autoConfigureTarget?(i.target=n.set(t.getPosition()),this._target.set(n.x,n.y)):i.target=n,this._world.createJoint(new planck.MouseJoint(i))},update:function(){if(!this._autoConfigureTarget)return;const t=this._joint;if(!t)return;const e=t.getBodyB();e._isEntityTransformed&&this._resetTarget(t,e)},_updateTarget:function(){if(!this._autoConfigureOffset)return;const t=this._joint;t&&this._resetTarget(t,t.getBodyB())},_resetTarget:function(t,e){const i=t.getTarget();t.setTarget(i.set(e.getPosition())),this._target.set(i.x,i.y)},setConnectedBody:function(t){UnityEngine.Debug.LogWarningFormat("The connected rigidbody for the 'TargetJoint2D' type cannot be set.")},enable:function(){o.prototype.enable.call(this),this._updateTarget()},getAutoConfigureTarget:function(){return this._autoConfigureTarget},setAutoConfigureTarget:function(t){this._autoConfigureTarget=!!t},getTarget:function(){return this._target.clone()},setTarget:function(t){this._target.set(t);const e=this._joint;e&&e.setTarget(e.getTarget().set(t.x,t.y))},getAnchor:function(){return this._anchor.clone()},setAnchor:function(t){if(this._anchor.equals(t))return;this._anchor=t;const e=this._joint;e&&e.setLocalAnchorB(e.getLocalAnchorB().set(t.x,t.y))},getMaxForce:function(){return this._maxForce},setMaxForce:function(t){this._maxForce!==t&&(this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce))},getFrequency:function(){return this._frequency},setFrequency:function(t){this._frequency!==t&&(this._frequency=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setFrequency(this._frequency))},getDampingRatio:function(){return this._dampingRatio},setDampingRatio:function(t){this._dampingRatio!==t&&(this._dampingRatio=t<0?0:t>1?1:t,this._joint&&this._joint.setDampingRatio(this._dampingRatio))}}),{Joint2DComponent:o,AnchoredJoint2DComponent:s,SpringJoint2DComponent:r,DistanceJoint2DComponent:c,FixedJoint2DComponent:a,HingeJoint2DComponent:h,WheelJoint2DComponent:l,FrictionJoint2DComponent:d,RelativeJoint2DComponent:u,SliderJoint2DComponent:p,TargetJoint2DComponent:_}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="animator",this.performanceSamplerSection=pc.Counters.ANIMATORS};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{AnimatorSystem:t}}()),Object.assign(pc,function(){const t=function(){pc.UnityComponent.prototype.constructor.call(this),this._canReceiveUpdates=!0,this.code=UnityEngine.Object.FromHandle(UnityEngine.Animator,this)};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onUpdate:function(t){this.code.AddTime(t)},_queuesToSubscribe:function(){return["onUpdate"]}}),{AnimatorComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="animation",this.performanceSamplerSection=pc.Counters.ANIMATIONS};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{AnimationSystem:t}}()),Object.assign(pc,function(){const t=function(){pc.UnityComponent.prototype.constructor.call(this),this._canReceiveUpdates=!0,this.code=UnityEngine.Object.FromHandle(UnityEngine.Animation,this)};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onUpdate:function(t){this.code.AddTime(t)},_queuesToSubscribe:function(){return["onUpdate"]}}),{AnimationComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="audiosourceunity"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{AudioSourceUnitySystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this._soundInstance=new pc.SoundInstance($application.app._audioManager),this._playOnAwake=t&&t.playOnAwake,this.loop=t&&t.loop,this.sound=t&&t.sound};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._playOnAwake&&this.play(),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._soundInstance.isPlaying&&this._soundInstance.stop(),!0)},play:function(){this._soundInstance.sound&&this._soundInstance.play()},pause:function(){this._soundInstance.sound&&this._soundInstance.pause()},resume:function(){this._soundInstance.sound&&this._soundInstance.resume()},stop:function(){this._soundInstance.sound&&this._soundInstance.stop()}}),Object.defineProperty(t.prototype,"playOnAwake",{get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._soundInstance.loop},set:function(t){this._soundInstance.loop=t}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._soundInstance.volume},set:function(t){this._soundInstance.volume=t}}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._soundInstance.pitch},set:function(t){this._soundInstance.pitch=t}}),Object.defineProperty(t.prototype,"sound",{get:function(){return this._soundInstance.sound},set:function(t){this._soundInstance.sound=t}}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._soundInstance.isPlaying}}),{AudioSourceUnityComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="videoPlayer"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{VideoPlayerSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this._clip=t?t.clip:null,this.code=UnityEngine.Object.FromHandle(UnityEngine.Video.VideoPlayer,this)};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{configureForEntity:function(t){this._entity=t},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this.code.OnDisable&&this.code.OnDisable(),!0)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.code.OnDestroy&&this.code.OnDestroy(),!0)},_queuesToSubscribe:function(){return[]}}),{VideoPlayerComponent:t}}());