window.pc={extend:function(t,e){let i,s;for(i in e)s=e[i],Array.isArray(s)?t[i]=pc.extend([],s):s instanceof RegExp||s instanceof Date||s instanceof Function||s instanceof Float32Array?t[i]=s:t[i]="object"==typeof s&&null!==s?pc.extend({},s):s;return t}},(()=>{"use strict";var t={},e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}i.m=t,i.x=t=>{},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={0:0},e=[],s=t=>{},n=(n,r)=>{for(var a,o,[h,c,l,u]=r,d=0,_=[];d<h.length;d++)o=h[d],i.o(t,o)&&t[o]&&_.push(t[o][0]),t[o]=0;for(a in c)i.o(c,a)&&(i.m[a]=c[a]);for(l&&l(i),n&&n(r);_.length;)_.shift()();return u&&e.push.apply(e,u),s()},r=self.webpackChunk=self.webpackChunk||[];function a(){for(var s,n=0;n<e.length;n++){for(var r=e[n],a=!0,o=1;o<r.length;o++){var h=r[o];0!==t[h]&&(a=!1)}a&&(e.splice(n--,1),s=i(i.s=r[0]))}return 0===e.length&&(i.x(),i.x=t=>{}),s}r.forEach(n.bind(null,0)),r.push=n.bind(null,r.push.bind(r));var o=i.x;i.x=()=>(i.x=o||(t=>{}),(s=a)())})();i.x()})(),(self.webpackChunk=self.webpackChunk||[]).push([[1],[(t,e,i)=>{"use strict";i.d(e,{a:()=>j,b:()=>O.a,c:()=>o.a,d:()=>H,e:()=>c,f:()=>u,g:()=>o.b,h:()=>x,i:()=>p,j:()=>n,k:()=>o.c,l:()=>o.f,m:()=>z,n:()=>o.g});const s={tmpVec41:null,diff:null};class n{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.z=i,this.w=s,this._data=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Vec4")}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}clone(){return(new n).copy(this)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}equals(t){const e=s.diff;return e.copy(this),e.sub(t),e.lengthSq()<999999943962493e-25}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}lerp(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this.w=t.w+i*(e.w-t.w),this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this}normalize(){const t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;if(t>0){const e=1/Math.sqrt(t);this.x*=e,this.y*=e,this.z*=e,this.w*=e}return this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setFromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}toString(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}project(t){const e=(this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w)/(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this.w=t.w*e,this}getitem(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:return NaN}}iget(t){return this.getitem(t)}setitem(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e}}iset(t,e){this.setitem(t,e)}strictEquals(t){return t instanceof n&&this.equals(t)}lerpUnclamped(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this.w=t.w+i*(e.w-t.w),this}hash(){return this.x^this.y^this.z^this.w}getHashCode(){return this.hash()}fromVector2(t){return this.x=t.x,this.y=t.y,this.z=0,this.w=0,this}fromVector3(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=0,this}$getType(){return n}$clone(t=new n){return t.copy(this),t}get data(){return this._data||(this._data=new Float32Array(4)),this._data[0]=this.x,this._data[1]=this.y,this._data[2]=this.z,this._data[3]=this.w,this._data}}s.tmpVec41=new n,s.diff=new n,n.ctor=n,n.$kind="struct",n.distance=(t,e)=>s.tmpVec41.copy(t).sub(e).length(),n.moveTowards=(t,e,i)=>{const n=s.tmpVec41.copy(e).sub(t),r=n.length();return r<=i||r<1401298e-51?e.clone():t.clone().add(n.scale(1/r*i))},n.equals=(t,e)=>null===t&&null===e||null!==t&&null!==e&&t.equals(e),n.getDefaultValue=()=>new n,n.FromVector2=t=>new n(t.x,t.y,0,0),n.FromVector3=t=>new n(t.x,t.y,t.z,0);const r=new n(1,1,1,1);r._data=new Float32Array(4),Object.freeze(r),n.ONE=r;const a=new n(0,0,0,0);a._data=new Float32Array(4),Object.freeze(a),n.ZERO=a;var o=i(3);const h={_tmpVec31:null,_tmpVec32:null,_tmpVec33:null,_tmpQuat1:null,_tmpQuat2:null,get tmpVec31(){return this._tmpVec31=this._tmpVec31||new p,this._tmpVec31},get tmpVec32(){return this._tmpVec32=this._tmpVec32||new p,this._tmpVec32},get tmpVec33(){return this._tmpVec33=this._tmpVec33||new p,this._tmpVec33},get tmpQuat1(){return this._tmpQuat1=this._tmpQuat1||new u,this._tmpQuat1},get tmpQuat2(){return this._tmpQuat2=this._tmpQuat2||new u,this._tmpQuat2}};class c{constructor(){this.data=new Float32Array(16),this.data[0]=this.data[5]=this.data[10]=this.data[15]=1,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Mat4")}add2(t,e){const i=t.data,s=e.data,n=this.data;return n[0]=i[0]+s[0],n[1]=i[1]+s[1],n[2]=i[2]+s[2],n[3]=i[3]+s[3],n[4]=i[4]+s[4],n[5]=i[5]+s[5],n[6]=i[6]+s[6],n[7]=i[7]+s[7],n[8]=i[8]+s[8],n[9]=i[9]+s[9],n[10]=i[10]+s[10],n[11]=i[11]+s[11],n[12]=i[12]+s[12],n[13]=i[13]+s[13],n[14]=i[14]+s[14],n[15]=i[15]+s[15],this}add(t){return this.add2(this,t)}clone(){return(new c).copy(this)}copy(t){const e=t.data,i=this.data;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this}equals(t){const e=this.data,i=t.data;return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}isIdentity(){const t=this.data;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}mul2(t,e){let i,s,n,r;const a=t.data,o=e.data,h=this.data,c=a[0],l=a[1],u=a[2],d=a[3],_=a[4],p=a[5],m=a[6],f=a[7],g=a[8],y=a[9],E=a[10],A=a[11],T=a[12],C=a[13],b=a[14],S=a[15];return i=o[0],s=o[1],n=o[2],r=o[3],h[0]=c*i+_*s+g*n+T*r,h[1]=l*i+p*s+y*n+C*r,h[2]=u*i+m*s+E*n+b*r,h[3]=d*i+f*s+A*n+S*r,i=o[4],s=o[5],n=o[6],r=o[7],h[4]=c*i+_*s+g*n+T*r,h[5]=l*i+p*s+y*n+C*r,h[6]=u*i+m*s+E*n+b*r,h[7]=d*i+f*s+A*n+S*r,i=o[8],s=o[9],n=o[10],r=o[11],h[8]=c*i+_*s+g*n+T*r,h[9]=l*i+p*s+y*n+C*r,h[10]=u*i+m*s+E*n+b*r,h[11]=d*i+f*s+A*n+S*r,i=o[12],s=o[13],n=o[14],r=o[15],h[12]=c*i+_*s+g*n+T*r,h[13]=l*i+p*s+y*n+C*r,h[14]=u*i+m*s+E*n+b*r,h[15]=d*i+f*s+A*n+S*r,this}mul(t){return this.mul2(this,t)}transformPoint(t,e=new p){const i=this.data,s=t.x,n=t.y,r=t.z;return e.x=s*i[0]+n*i[4]+r*i[8]+i[12],e.y=s*i[1]+n*i[5]+r*i[9]+i[13],e.z=s*i[2]+n*i[6]+r*i[10]+i[14],e}transformVector(t,e=new p){const i=this.data,s=t.x,n=t.y,r=t.z;return e.x=s*i[0]+n*i[4]+r*i[8],e.y=s*i[1]+n*i[5]+r*i[9],e.z=s*i[2]+n*i[6]+r*i[10],e}transformVec4(t,e=new n){const i=this.data,s=t.x,r=t.y,a=t.z,o=t.w;return e.x=s*i[0]+r*i[4]+a*i[8]+o*i[12],e.y=s*i[1]+r*i[5]+a*i[9]+o*i[13],e.z=s*i[2]+r*i[6]+a*i[10]+o*i[14],e.w=s*i[3]+r*i[7]+a*i[11]+o*i[15],e}setLookAt(t,e,i){const s=h.tmpVec31,n=h.tmpVec32,r=h.tmpVec33;if(r.sub2(e,t),r.length()<1e-6)return this.setIdentity();r.normalize(),n.copy(i).normalize(),s.cross(n,r).normalize(),n.cross(r,s);const a=this.data;return a[0]=s.x,a[1]=s.y,a[2]=s.z,a[3]=0,a[4]=n.x,a[5]=n.y,a[6]=n.z,a[7]=0,a[8]=r.x,a[9]=r.y,a[10]=r.z,a[11]=0,a[12]=t.x,a[13]=t.y,a[14]=t.z,a[15]=1,this}setFrustum(t,e,i,s,n,r){const a=2*n,o=e-t,h=s-i,c=r-n,l=this.data;return l[0]=a/o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=a/h,l[6]=0,l[7]=0,l[8]=-(e+t)/o,l[9]=-(s+i)/h,l[10]=(-r-n)/c,l[11]=-1,l[12]=0,l[13]=0,l[14]=-a*r/c,l[15]=0,this}setPerspective(t,e,i,s,n=!1){let r,a;return n?(r=i*Math.tan(t*Math.PI/360),a=r/e):(a=i*Math.tan(t*Math.PI/360),r=a*e),this.setFrustum(-r,r,-a,a,i,s)}setOrtho(t,e,i,s,n,r){const a=this.data;return a[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(s-i),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/(r-n),a[11]=0,a[12]=-(e+t)/(e-t),a[13]=-(s+i)/(s-i),a[14]=-(r+n)/(r-n),a[15]=1,this}setFromAxisAngle(t,e){e*=o.a;const i=t.x,s=t.y,n=t.z,r=Math.cos(e),a=Math.sin(e),h=1-r,c=h*i,l=h*s,u=this.data;return u[0]=c*i+r,u[1]=c*s+a*n,u[2]=c*n-a*s,u[3]=0,u[4]=c*s-a*n,u[5]=l*s+r,u[6]=l*n+a*i,u[7]=0,u[8]=c*n+a*s,u[9]=l*n-i*a,u[10]=h*n*n+r,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}setTranslate(t,e,i){const s=this.data;return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=t,s[13]=e,s[14]=i,s[15]=1,this}setScale(t,e,i){const s=this.data;return s[0]=t,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}invert(){const t=this.data,e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],a=t[5],o=t[6],h=t[7],c=t[8],l=t[9],u=t[10],d=t[11],_=t[12],p=t[13],m=t[14],f=t[15],g=e*a-i*r,y=e*o-s*r,E=e*h-n*r,A=i*o-s*a,T=i*h-n*a,C=s*h-n*o,b=c*p-l*_,S=c*m-u*_,x=c*f-d*_,D=l*m-u*p,M=l*f-d*p,R=u*f-d*m,I=g*R-y*M+E*D+A*x-T*S+C*b;if(0===I)this.setIdentity();else{const O=1/I;t[0]=(a*R-o*M+h*D)*O,t[1]=(-i*R+s*M-n*D)*O,t[2]=(p*C-m*T+f*A)*O,t[3]=(-l*C+u*T-d*A)*O,t[4]=(-r*R+o*x-h*S)*O,t[5]=(e*R-s*x+n*S)*O,t[6]=(-_*C+m*E-f*y)*O,t[7]=(c*C-u*E+d*y)*O,t[8]=(r*M-a*x+h*b)*O,t[9]=(-e*M+i*x-n*b)*O,t[10]=(_*T-p*E+f*g)*O,t[11]=(-c*T+l*E-d*g)*O,t[12]=(-r*D+a*S-o*b)*O,t[13]=(e*D-i*S+s*b)*O,t[14]=(-_*A+p*y-m*g)*O,t[15]=(c*A-l*y+u*g)*O}return this}set(t){const e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this}setFromArray(t,e=0){const i=this.data;for(let s=0;s<16;s++)i[s]=t[e+s];return this}setIdentity(){const t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}setTRS(t,e,i){const s=t.x,n=t.y,r=t.z,a=e.x,o=e.y,h=e.z,c=e.w,l=i.x,u=i.y,d=i.z,_=a+a,p=o+o,m=h+h,f=a*_,g=a*p,y=a*m,E=o*p,A=o*m,T=h*m,C=c*_,b=c*p,S=c*m,x=this.data;return x[0]=(1-(E+T))*l,x[1]=(g+S)*l,x[2]=(y-b)*l,x[3]=0,x[4]=(g-S)*u,x[5]=(1-(f+T))*u,x[6]=(A+C)*u,x[7]=0,x[8]=(y+b)*d,x[9]=(A-C)*d,x[10]=(1-(f+E))*d,x[11]=0,x[12]=s,x[13]=n,x[14]=r,x[15]=1,this}transpose(){let t;const e=this.data;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}invertTo3x3(t){const e=this.data,i=t.data,s=e[0],n=e[1],r=e[2],a=e[4],o=e[5],h=e[6],c=e[8],l=e[9],u=e[10],d=u*o-h*l,_=-u*n+r*l,p=h*n-r*o,m=-u*a+h*c,f=u*s-r*c,g=-h*s+r*a,y=l*a-o*c,E=-l*s+n*c,A=o*s-n*a,T=s*d+n*m+r*y;if(0===T)return this;const C=1/T;return i[0]=C*d,i[1]=C*_,i[2]=C*p,i[3]=C*m,i[4]=C*f,i[5]=C*g,i[6]=C*y,i[7]=C*E,i[8]=C*A,this}getTranslation(t=new p){return t.set(this.data[12],this.data[13],this.data[14])}getX(t=new p){return t.set(this.data[0],this.data[1],this.data[2])}getY(t=new p){return t.set(this.data[4],this.data[5],this.data[6])}getZ(t=new p){return t.set(this.data[8],this.data[9],this.data[10])}getScale(t=new p){const e=h.tmpVec31,i=h.tmpVec32,s=h.tmpVec33;return this.getX(e),this.getY(i),this.getZ(s),t.set(e.length(),i.length(),s.length()),t}setFromEulerAngles(t,e,i){t*=o.a,e*=o.a,i*=o.a;const s=Math.sin(-t),n=Math.cos(-t),r=Math.sin(-e),a=Math.cos(-e),h=Math.sin(-i),c=Math.cos(-i),l=this.data;return l[0]=a*c,l[1]=-a*h,l[2]=r,l[3]=0,l[4]=n*h+c*s*r,l[5]=n*c-s*r*h,l[6]=-a*s,l[7]=0,l[8]=s*h-n*c*r,l[9]=c*s+n*r*h,l[10]=n*a,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}getEulerAngles(t=new p){const e=h.tmpVec31;this.getScale(e);const i=e.x,s=e.y,n=e.z,r=this.data,a=Math.asin(-r[2]/i),c=.5*Math.PI;let l=0,u=0;return a<c?a>-c?(l=Math.atan2(r[6]/s,r[10]/n),u=Math.atan2(r[1]/i,r[0]/i)):(u=0,l=-Math.atan2(r[4]/s,r[5]/s)):(u=0,l=Math.atan2(r[4]/s,r[5]/s)),t.set(l,a,u).scale(o.b)}toString(){let t,e;for(e="[",t=0;t<16;t+=1)e+=this.data[t],e+=15!==t?", ":"";return e+="]",e}setColumn(t,e){return this.data[4*t]=e.x,this.data[4*t+1]=e.y,this.data[4*t+2]=e.z,this.data[4*t+3]=e.w,this}getColumn(t){switch(t){case 0:return new n(this.data[0],this.data[1],this.data[2],this.data[3]);case 1:return new n(this.data[4],this.data[5],this.data[6],this.data[7]);case 2:return new n(this.data[8],this.data[9],this.data[10],this.data[11]);case 3:return new n(this.data[12],this.data[13],this.data[14],this.data[15]);default:return null}}getRow(t){switch(t){case 0:return new n(this.data[0],this.data[4],this.data[8],this.data[12]);case 1:return new n(this.data[1],this.data[5],this.data[9],this.data[13]);case 2:return new n(this.data[2],this.data[6],this.data[10],this.data[14]);case 3:return new n(this.data[3],this.data[7],this.data[11],this.data[15]);default:return null}}scale(t){for(let e=0;e<16;e++)this.data[e]*=t}determinant(){const t=this.data,e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],a=t[5],o=t[6],h=t[7],c=t[8],l=t[9],u=t[10],d=t[11],_=t[12],p=t[13],m=t[14],f=t[15];return(e*a-i*r)*(u*f-d*m)-(e*o-s*r)*(l*f-d*p)+(e*h-n*r)*(l*m-u*p)+(i*o-s*a)*(c*f-d*_)-(i*h-n*a)*(c*m-u*_)+(s*h-n*o)*(c*p-l*_)}getRotation(t=new u){return t.setFromMat4(this),t}multiplyInverse(t){const e=h.tmpVec31,i=h.tmpVec32,s=h.tmpQuat1,n=h.tmpQuat2;n.setFromMat4(this).conjugate(),s.setFromMat4(t),t.getTranslation(i),this.getTranslation(e),i.sub(e),n.transformVector(i,i),n.mul(s),this.setTRS(i,n,p.ONE)}transformVectorInverse(t,e=new p){const i=h.tmpQuat1,s=h.tmpVec31;return i.setFromMat4(this),this.getTranslation(s),e.sub2(t,s),i.transformVectorInverse(e,e),e}setRotation(t){return this.setTRS(p.ZERO,t,p.ONE)}setTranslation(t){const e=this.data;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}setPerspective_Unity(t,e,i,s,n=!1){return this.setPerspective(t,e,i,s,n),this.data[8]*=-1,this.data[9]*=-1,this.data[10]*=-1,this.data[11]*=-1,this}multiplyPoint(t,e=new p){const i=this.data,s=t.x,n=t.y,r=t.z;e.x=s*i[0]+n*i[4]+r*i[8]+i[12],e.y=s*i[1]+n*i[5]+r*i[9]+i[13],e.z=s*i[2]+n*i[6]+r*i[10]+i[14];const a=1/(s*i[3]+n*i[7]+r*i[11]+i[15]);return e.scale(a),e}setData(t,e,i,s,n,r,a,o,h,c,l,u,d,_,p,m){return this.data[0]=t,this.data[1]=e,this.data[2]=i,this.data[3]=s,this.data[4]=n,this.data[5]=r,this.data[6]=a,this.data[7]=o,this.data[8]=h,this.data[9]=c,this.data[10]=l,this.data[11]=u,this.data[12]=d,this.data[13]=_,this.data[14]=p,this.data[15]=m,this}validTRS(){return!(Math.abs(this.data[3])>1e-5||Math.abs(this.data[7])>1e-5||Math.abs(this.data[11])>1e-5||Math.abs(this.data[15]-1)>1e-5)&&Math.abs(this.determinant())>=1e-5}decomposeProjection(){const t=new UnityEngine.FrustumPlanes.ctor;return t.zFar=(this.data[15]-this.data[14])/(this.data[11]-this.data[10]),t.zNear=(this.data[15]+this.data[14])/(this.data[11]+this.data[10]),t.left=(this.data[11]+this.data[8])/(this.data[3]+this.data[0])*t.zNear,t.right=(this.data[11]-this.data[8])/(this.data[3]-this.data[0])*t.zNear,t.top=(this.data[11]-this.data[9])/(this.data[7]-this.data[5])*t.zNear,t.bottom=(this.data[11]+this.data[9])/(this.data[7]+this.data[5])*t.zNear,t}transformPlane(t){const e=this.clone().invert(),i=t.normal.x,s=t.normal.y,n=t.normal.z,r=t.distance;return new UnityEngine.Plane.$ctor1(new p(e.e00*i+e.e10*s+e.e20*n+e.e30*r,e.e01*i+e.e11*s+e.e21*n+e.e31*r,e.e02*i+e.e12*s+e.e22*n+e.e32*r),e.e03*i+e.e13*s+e.e23*n+e.e33*r)}strictEquals(t){return t instanceof c&&this.equals(t)}$clone(t=new c){return t.copy(this),t}equalsWithEpsilon(t,e=1e-6){const i=this.data,s=t.data;for(let t=0;t<16;t++)if(Math.abs(i[t]-s[t])>=e)return!1;return!0}get e00(){return this.data[0]}set e00(t){this.data[0]=t}get e10(){return this.data[1]}set e10(t){this.data[1]=t}get e20(){return this.data[2]}set e20(t){this.data[2]=t}get e30(){return this.data[3]}set e30(t){this.data[3]=t}get e01(){return this.data[4]}set e01(t){this.data[4]=t}get e11(){return this.data[5]}set e11(t){this.data[5]=t}get e21(){return this.data[6]}set e21(t){this.data[6]=t}get e31(){return this.data[7]}set e31(t){this.data[7]=t}get e02(){return this.data[8]}set e02(t){this.data[8]=t}get e12(){return this.data[9]}set e12(t){this.data[9]=t}get e22(){return this.data[10]}set e22(t){this.data[10]=t}get e32(){return this.data[11]}set e32(t){this.data[11]=t}get e03(){return this.data[12]}set e03(t){this.data[12]=t}get e13(){return this.data[13]}set e13(t){this.data[13]=t}get e23(){return this.data[14]}set e23(t){this.data[14]=t}get e33(){return this.data[15]}set e33(t){this.data[15]=t}get singular(){return 0===this.determinant()}getitem(t){return this.data[t]}iget(t){return this.getitem(t)}setitem(t,e){this.data[t]=e}iset(t,e){this.setitem(t,e)}getitem$1(t,e){return this.data[t+4*e]}ijget(t,e){return this.getitem$1(t,e)}setitem$1(t,e,i){this.data[t+4*e]=i}ijset(t,e,i){this.setitem$1(t,e,i)}getHashCode(){let t=this.data[0];for(let e=0;e<this.data.length;e++)t^=this.data[e];return t}hash(){return this.getHashCode()}}c.ctor=c,c.$kind="struct",c.fromArray=t=>{const e=new c;return e.data=t,e},c.getDefaultValue=()=>new c,c.mat3FromMat4=(t,e)=>{t.data[0]=e.data[0],t.data[1]=e.data[1],t.data[2]=e.data[2],t.data[3]=e.data[4],t.data[4]=e.data[5],t.data[5]=e.data[6],t.data[6]=e.data[8],t.data[7]=e.data[9],t.data[8]=e.data[10]},c.inverse3DAffine=(t,e)=>{e.v=t.clone().invert()},c.setFrustumUnity=(t,e,i,s,n,r)=>{const a=2*n,o=e-t,h=s-i,l=n-r,u=new c;return u.data[0]=a/o,u.data[1]=0,u.data[2]=0,u.data[3]=0,u.data[4]=0,u.data[5]=a/h,u.data[6]=0,u.data[7]=0,u.data[8]=(e+t)/o,u.data[9]=(s+i)/h,u.data[10]=(r+n)/l,u.data[11]=-1,u.data[12]=0,u.data[13]=0,u.data[14]=a*r/l,u.data[15]=0,u},c.setLookAtUnity=(t,e,i)=>{const s=new c,n=new p,r=new p,a=new p;if(a.sub2(e,t),a.length()<1e-6)return s.setIdentity();a.normalize(),r.copy(i).normalize(),n.cross(r,a).normalize(),r.cross(a,n),s.data[0]=-n.x,s.data[1]=n.y,s.data[2]=-n.z,s.data[3]=0,s.data[4]=r.x,s.data[5]=r.y,s.data[6]=r.z,s.data[7]=0,s.data[8]=-a.x,s.data[9]=-a.y,s.data[10]=-a.z,s.data[11]=0,s.data[12]=t.x,s.data[13]=t.y,s.data[14]=t.z,s.data[15]=1},c.equals=(t,e)=>null===t&&null===e||null!==t&&null!==e&&t.equals(e),c.IDENTITY=Object.freeze(new c),c.ZERO=Object.freeze((new c).set([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));const l={_tmpVec31:null,get tmpVec31(){return this._tmpVec31=this._tmpVec31||new p,this._tmpVec31}};class u{constructor(t=0,e=0,i=0,s=1){this.x=t,this.y=e,this.z=i,this.w=s,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Quat")}clone(){return new u(this.x,this.y,this.z,this.w)}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t){return this.dot(t)>.999998986721039}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}transformVectorInverse(t,e=new p){const i=2*t.x,s=2*t.y,n=2*t.z,r=this.w*this.w-.5,a=this.x*i+this.y*s+this.z*n;return e.x=i*r-(this.y*n-this.z*s)*this.w+this.x*a,e.y=s*r-(this.z*i-this.x*n)*this.w+this.y*a,e.z=n*r-(this.x*s-this.y*i)*this.w+this.z*a,e}extractAxes(t,e,i){const s=this.x,n=this.y,r=this.z,a=this.w,o=s+s,h=n+n,c=r+r,l=o*s,u=h*n,d=c*r,_=o*n,p=o*r,m=o*a,f=h*r,g=h*a,y=c*a;t.set(1-u-d,_+y,p-g),e.set(_-y,1-l-d,f+m),i.set(p+g,f-m,1-l-u)}getAxisAngle(t){let e=2*Math.acos(this.w);const i=Math.sin(e/2);return 0!==i?(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i,(t.x<0||t.y<0||t.z<0)&&(t.x*=-1,t.y*=-1,t.z*=-1,e*=-1)):(t.x=1,t.y=0,t.z=0),e*o.b}getEulerAngles(t=new p){let e,i,s;const n=this.x,r=this.y,a=this.z,h=this.w,c=2*(h*r-n*a);return c<=-.99999?(e=2*Math.atan2(n,h),i=-Math.PI/2,s=0):c>=.99999?(e=2*Math.atan2(n,h),i=Math.PI/2,s=0):(e=Math.atan2(2*(h*n+r*a),1-2*(n*n+r*r)),i=Math.asin(c),s=Math.atan2(2*(h*a+n*r),1-2*(r*r+a*a))),t.set(e,i,s).scale(o.b)}getUnityEulerAngles(){const t=new c,e=new p,i=new p(1,0,0),s=new p(0,1,0),n=new p(0,0,1);this.transformVector(i,i),this.transformVector(s,s),this.transformVector(n,n),t.data[0]=i.x,t.data[1]=i.y,t.data[2]=i.z,t.data[4]=s.x,t.data[5]=s.y,t.data[6]=s.z,t.data[8]=n.x,t.data[9]=n.y,t.data[10]=n.z,t.data[15]=1;const r=t.data,a=r[0],h=r[8],l=r[1],u=r[5],d=r[9],_=r[2],m=r[10];return e.x=Math.asin(-(0,o.c)(d,-1,1)),Math.abs(d)<.99999?(e.y=Math.atan2(h,m),e.z=Math.atan2(l,u)):(e.y=Math.atan2(-_,a),e.z=0),e.scale(o.b),e}invert(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}mul(t){const e=this.x,i=this.y,s=this.z,n=this.w,r=t.x,a=t.y,o=t.z,h=t.w;return this.x=n*r+e*h+i*o-s*a,this.y=n*a+i*h+s*r-e*o,this.z=n*o+s*h+e*a-i*r,this.w=n*h-e*r-i*a-s*o,this}mul2(t,e){const i=t.x,s=t.y,n=t.z,r=t.w,a=e.x,o=e.y,h=e.z,c=e.w;return this.x=r*a+i*c+s*h-n*o,this.y=r*o+s*c+n*a-i*h,this.z=r*h+n*c+i*o-s*a,this.w=r*c-i*a-s*o-n*h,this}nearest(t,e=new u){const i=(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)+(this.z-t.z)*(this.z-t.z)+(this.w-t.w)*(this.w-t.w),s=(this.x+t.x)*(this.x+t.x)+(this.y+t.y)*(this.y+t.y)+(this.z+t.z)*(this.z+t.z)+(this.w+t.w)*(this.w+t.w);return e.copy(t),i>s&&(e.x*=-1,e.y*=-1,e.z*=-1,e.w*=-1),e}normalize(){let t=this.length();return 0===t?(this.x=this.y=this.z=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}fromTo(t,e){const i=t.length(),s=t.x/i,n=t.y/i,r=t.z/i,a=e.length(),o=e.x/a,h=e.y/a,c=e.z/a;this.w=Math.cos(Math.acos(s*o+n*h+r*c)/2);const l=Math.sqrt(1-this.w*this.w);if(this.x=(n*c-h*r)*l,this.y=(r*o-c*s)*l,this.z=(s*h-o*n)*l,this.lengthSq()<Number.EPSILON){const t=Math.abs(e.x),i=Math.abs(e.y),s=Math.abs(e.z),n=t<i?t<s?p.RIGHT:p.FORWARD:i<s?p.UP:p.FORWARD;this.x=e.y*n.z-n.y*e.z,this.y=e.z*n.x-n.z*e.x,this.z=e.x*n.y-n.x*e.y;const r=1/this.length();this.x*=r,this.y*=r,this.z*=r}return this}setFromAxisAngle(t,e){const{tmpVec31:i}=l;if(t.equalsWithEpsilon(p.ZERO))return this.x=0,this.y=0,this.z=0,this.w=1,this;e*=.5*o.a,i.copy(t).normalize();const s=Math.sin(e),n=Math.cos(e);return this.x=s*i.x,this.y=s*i.y,this.z=s*i.z,this.w=n,this}setFromEulerAngles(t,e,i){const s=.5*o.a;t*=s,e*=s,i*=s;const n=Math.sin(t),r=Math.cos(t),a=Math.sin(e),h=Math.cos(e),c=Math.sin(i),l=Math.cos(i);return this.x=n*h*l-r*a*c,this.y=r*a*l+n*h*c,this.z=r*h*c-n*a*l,this.w=r*h*l+n*a*c,this}setFromMat4(t){let e,i,s=t.data[0],n=t.data[1],r=t.data[2],a=t.data[4],o=t.data[5],h=t.data[6],c=t.data[8],l=t.data[9],u=t.data[10],d=1/Math.sqrt(s*s+n*n+r*r),_=1/Math.sqrt(a*a+o*o+h*h),p=1/Math.sqrt(c*c+l*l+u*u);d=Number.isFinite(d)?d:1,_=Number.isFinite(_)?_:1,p=Number.isFinite(p)?p:1,s*=d,n*=d,r*=d,a*=_,o*=_,h*=_,c*=p,l*=p,u*=p;const m=s+o+u;return m>=0?(e=Math.sqrt(m+1),this.w=.5*e,e=.5/e,this.x=(h-l)*e,this.y=(c-r)*e,this.z=(n-a)*e):s>o?s>u?(i=s-(o+u)+1,i=Math.sqrt(i),this.x=.5*i,i=.5/i,this.w=(h-l)*i,this.y=(n+a)*i,this.z=(r+c)*i):(i=u-(s+o)+1,i=Math.sqrt(i),this.z=.5*i,i=.5/i,this.w=(n-a)*i,this.x=(c+r)*i,this.y=(l+h)*i):o>u?(i=o-(u+s)+1,i=Math.sqrt(i),this.y=.5*i,i=.5/i,this.w=(c-r)*i,this.z=(h+l)*i,this.x=(a+n)*i):(i=u-(s+o)+1,i=Math.sqrt(i),this.z=.5*i,i=.5/i,this.w=(n-a)*i,this.x=(c+r)*i,this.y=(l+h)*i),this}slerp(t,e,i){return i=(0,o.c)(i,0,1),this.slerpUnclamped(t,e,i)}slerpUnclamped(t,e,i){let s,n,r,a;const o=t.x,h=t.y,c=t.z,l=t.w;s=e.x,n=e.y,r=e.z,a=e.w;let u=l*a+o*s+h*n+c*r;if(u<0&&(a=-a,s=-s,n=-n,r=-r,u=-u),Math.abs(u)>=1)return this.w=l,this.x=o,this.y=h,this.z=c,this;const d=Math.acos(u),_=Math.sqrt(1-u*u);if(Math.abs(_)<.001)return this.w=.5*l+.5*a,this.x=.5*o+.5*s,this.y=.5*h+.5*n,this.z=.5*c+.5*r,this;const p=Math.sin((1-i)*d)/_,m=Math.sin(i*d)/_;return this.w=l*p+a*m,this.x=o*p+s*m,this.y=h*p+n*m,this.z=c*p+r*m,this}transformVector(t,e=new p){const i=t.x,s=t.y,n=t.z,r=this.x,a=this.y,o=this.z,h=this.w,c=h*i+a*n-o*s,l=h*s+o*i-r*n,u=h*n+r*s-a*i,d=-r*i-a*s-o*n;return e.x=c*h+d*-r+l*-o-u*-a,e.y=l*h+d*-a+u*-r-c*-o,e.z=u*h+d*-o+c*-a-l*-r,e}toString(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}setLookAt(t,e){if(t.equals(p.ZERO))return this.copy(u.IDENTITY);const i=(new c).setLookAt(p.ZERO,t,e);return this.setFromMat4(i),this}getitem(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:return NaN}}iget(t){return this.getitem(t)}setitem(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e}}iset(t,e){this.setitem(t,e)}setFromEulerAngles_Unity(t,e,i){const s=t*o.a*.5,n=e*o.a*.5,r=i*o.a*.5,a=Math.sin(s),h=Math.cos(s),c=Math.sin(n),l=Math.cos(n),u=Math.sin(r),d=Math.cos(r);return this.x=l*a*d+c*h*u,this.y=c*h*d-l*a*u,this.z=l*h*u-c*a*d,this.w=l*h*d+c*a*u,this}getEulerAngles_Unity(t=new p){const e=this,i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,s=e.x*e.w-e.y*e.z;return s>.4995*i?(t.x=Math.PI/2,t.y=2*Math.atan2(e.y,e.x),t.z=0):s<-.4995*i?(t.x=-Math.PI/2,t.y=-2*Math.atan2(e.y,e.x),t.z=0):(t.x=Math.asin(2*(e.w*e.x-e.y*e.z)),t.y=Math.atan2(2*e.w*e.y+2*e.z*e.x,1-2*(e.x*e.x+e.y*e.y)),t.z=Math.atan2(2*e.w*e.z+2*e.x*e.y,1-2*(e.z*e.z+e.x*e.x))),t.x*=o.b,t.y*=o.b,t.z*=o.b,t.x+=t.x<0?360:0,t.y+=t.y<0?360:0,t.z+=t.z<0?360:0,t}getPositiveEulerAngles(){return this.getEulerAngles_Unity()}fromToRotation(t,e){const i=new p;i.cross(t,e);const s=new u;return s.x=i.x,s.y=i.y,s.z=i.z,s.w=Math.sqrt(t.lengthSq()*e.lengthSq())+t.dot(e),s.normalize()}strictEquals(t){return t instanceof u&&this.equals(t)}approximatelyEquals(t,e=1e-5){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e&&Math.abs(this.w-t.w)<e}toAngleAxis(t,e){const i=this.$clone().normalize();t.v=2*Math.acos(i.w)*o.b;const s=Math.sqrt(1-i.w*i.w);s<1e-4?(e.v.x=1,e.v.z=e.v.y=0):(e.v.x=i.x/s,e.v.y=i.y/s,e.v.z=i.z/s)}$clone(t=new u){return t.copy(this),t}get xyz(){return new p(this.x,this.y,this.z)}}u.ctor=u,u.$kind="struct",u.getDefaultValue=()=>new u,u.rotateTowards=(t,e,i)=>{const s=u.angle(t,e);if(s<1401298e-51)return e;return(new u).slerpUnclamped(t,e,Math.min(1,i/s))},u.angle=(t,e)=>{const i=t.dot(e);let s=0;return i<.999998986721039&&(s=2*Math.acos(Math.min(Math.abs(i),1))*o.b),s},u.IDENTITY=Object.freeze(new u),u.ZERO=Object.freeze(new u(0,0,0,0));const d={tmpVec31:null,tmpVec32:null,diff:null,_tmpQuat1:null,_tmpQuat2:null,get tmpQuat1(){return this._tmpQuat1=this._tmpQuat1||new u,this._tmpQuat1},get tmpQuat2(){return this._tmpQuat2=this._tmpQuat2||new u,this._tmpQuat2}};function _(t){return Math.abs(t)>1e-5?1/t:0}class p{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i,this._data=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Vec3")}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}clone(){return(new p).copy(this)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}cross(t,e){const i=t.x,s=t.y,n=t.z,r=e.x,a=e.y,o=e.z;return this.x=s*o-a*n,this.y=n*r-o*i,this.z=i*a-r*s,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}equals(t,e=999999943962493e-25){const i=d.diff;return i.copy(this),i.sub(t),i.lengthSq()<e}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}lerp(t,e,i){return i=(0,o.c)(i,0,1),this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this}lerpUnclamped(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}normalize(){const t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>0){const e=1/Math.sqrt(t);this.x*=e,this.y*=e,this.z*=e}return this}project(t){const e=(this.x*t.x+this.y*t.y+this.z*t.z)/(t.x*t.x+t.y*t.y+t.z*t.z);return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}toString(){return"["+this.x+", "+this.y+", "+this.z+"]"}slerp(t,e,i){i=(0,o.c)(i,0,1);const s=t.length();if(s<Number.EPSILON)return this.copy(t);const n=e.length();if(n<Number.EPSILON)return this.copy(e);const r=1-i,a=t.dot(e)/(s*n);if(a<=-1||a>=1)return this.copy(t).normalize().scale(r*s+i*n);const h=Math.acos(a);if(h<Number.EPSILON)return this.copy(t);const c=Math.sin(h),l=Math.sin(r*h)/c,u=Math.sin(i*h)/c;return this.set(t.x*l+e.x*u,t.y*l+e.y*u,t.z*l+e.z*u).normalize().scale(r*s+i*n)}slerpUnclamped(t,e,i){const s=t.length();if(s<Number.EPSILON)return this.copy(t);const n=e.length();if(n<Number.EPSILON)return this.copy(e);const r=1-i,a=t.dot(e)/(s*n);if(a<=-1||a>=1)return this.copy(t).normalize().scale(r*s+i*n);const o=Math.acos(a);if(o<Number.EPSILON)return this.copy(t);const h=Math.sin(o),c=Math.sin(r*o)/h,l=Math.sin(i*o)/h;return this.set(t.x*c+e.x*l,t.y*c+e.y*l,t.z*c+e.z*l).normalize().scale(r*s+i*n)}abs(t=null){return t?(t.x=this.x<0?-this.x:this.x,t.y=this.y<0?-this.y:this.y,t.z=this.z<0?-this.z:this.z,t):(this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y),this.z<0&&(this.z=-this.z),this)}strictEquals(t){return t instanceof p&&this.equals(t)}approximatelyEquals(t,e=1e-5){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e}invertSafe(){return this.x=_(this.x),this.y=_(this.y),this.z=_(this.z),this}$getType(){return p}getitem(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:return NaN}}iget(t){return this.getitem(t)}setitem(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e}}iset(t,e){this.setitem(t,e)}getHashCode(){return this.x^this.y^this.z}hash(){return this.getHashCode()}$clone(t=new p){return t.copy(this),t}fromVector2(t){return this.x=t.x,this.y=t.y,this.z=0,this}fromVector4(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equalsWithEpsilon(t,e=1e-6){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e}get data(){return this._data||(this._data=new Float32Array(3)),this._data[0]=this.x,this._data[1]=this.y,this._data[2]=this.z,this._data}}d.tmpVec31=new p,d.tmpVec32=new p,d.diff=new p,p.ctor=p,p.$kind="struct",p.kEpsilon=1e-5,p.kEpsilonNormalSqrt=1e-15,p.REVERSED_Z=new p(1,1,-1),p.cachedNegativeInfinity=new p(-1/0,-1/0,-1/0),p.cachedPositiveInfinity=new p(1/0,1/0,1/0),p.cachedForward=new p(0,0,1),p.cachedBack=new p(0,0,-1),p.cachedOne=new p(1,1,1);const m=new p(0,0,1);m._data=new Float32Array(3),Object.freeze(m),p.BACK=m;const f=new p(0,-1,0);f._data=new Float32Array(3),Object.freeze(f),p.DOWN=f;const g=new p(0,0,-1);g._data=new Float32Array(3),Object.freeze(g),p.FORWARD=g;const y=new p(-1,0,0);y._data=new Float32Array(3),Object.freeze(y),p.LEFT=y;const E=new p(1,1,1);E._data=new Float32Array(3),Object.freeze(E),p.ONE=E;const A=new p(1,0,0);A._data=new Float32Array(3),Object.freeze(A),p.RIGHT=A;const T=new p(0,1,0);T._data=new Float32Array(3),Object.freeze(T),p.UP=T;const C=new p(0,0,0);C._data=new Float32Array(3),Object.freeze(C),p.ZERO=C,p.distance=(t,e)=>d.tmpVec31.copy(t).sub(e).length(),p.projectOnPlane=(t,e,i=new p)=>{const{tmpVec31:s,tmpVec32:n}=d;return s.copy(t),n.copy(t),s.sub(n.project(e)),i.copy(s),i},p.smoothDamp=(t,e,i,s,n,r)=>{const a=2/(s=Math.max(1e-4,s)),o=a*r,h=1/(1+o+.479999989271164*o*o+.234999999403954*o*o*o),c=t.clone().sub(e.clone()),l=e.clone(),u=n*s,d=p.clampMagnitude(c.clone(),u);e=t.clone().sub(d.clone());const _=i.v.clone().add(d.clone().scale(a)).scale(r);i.v=i.v.clone().sub(_.clone().scale(a)).scale(h);let m=e.clone().add(d.clone().add(_.clone()).scale(h));return l.clone().sub(t.clone()).dot(m.clone().sub(l.clone()))>0&&(m=l.clone(),i.v=m.clone().sub(l.clone()).scale(1/r)),m.clone()},p.clampMagnitude=(t,e)=>t.length()>Math.abs(e)?t.clone().normalize().scale(e):t.clone(),p.reflect=(t,e)=>{const{tmpVec31:i}=d;return i.copy(e),i.scale(-2*t.dot(e)).add(t),i.clone()},p.moveTowards=(t,e,i)=>{const s=d.tmpVec31.copy(e).sub(t),n=s.length();return n<=i||n<1401298e-51?e.clone():t.clone().add(s.scale(1/n*i))},p.orthoNormalize=(t,e,i)=>{t.normalize(),e.cross(t,e),e.cross(e,t),e.normalize(),i.cross(t,e)},p.signedAngle=(t,e,i)=>{const{tmpVec31:s,tmpVec32:n}=d;s.copy(t).normalize(),n.copy(e).normalize();const r=(0,o.c)(n.dot(s),-1,1);s.cross(t,e);const a=i.dot(s);return Math.acos(r)*(0,o.i)(a)*o.b},p.rotateTowards=(t,e,i,s)=>{const{tmpVec31:n,tmpVec32:r,tmpQuat1:a,tmpQuat2:h}=d,c=n.cross(t,e),l=a.setLookAt(t,c),_=h.setLookAt(e,c),m=u.rotateTowards(l,_,i*o.b);n.set(0,0,1);const f=m.transformVector(n,r),g=e.length()-t.length(),y=t.length()+(0,o.i)(g)*Math.min(Math.abs(g),s);return f.normalize(),f.mul(new p(y,y,y)),f.clone()},p.angle=(t,e)=>{const{tmpVec31:i,tmpVec32:s}=d;return Math.acos((0,o.c)(i.copy(t).normalize().dot(s.copy(e).normalize()),-1,1))*o.b},p.equals=(t,e)=>null===t&&null===e||!!t&&!!e&&t.equals(e),p.getDefaultValue=()=>new p,p.FromVector2=t=>new p(t.x,t.y,0),p.FromVector4=t=>new p(t.x,t.y,t.z);class b{constructor(){const t=new Float32Array(9);t[0]=t[4]=t[8]=1,this.data=t,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Mat3")}clone(){return(new b).copy(this)}copy(t){const e=t.data,i=this.data;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this}set(t){const e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this}equals(t){const e=this.data,i=t.data;return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]}isIdentity(){const t=this.data;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]}setIdentity(){const t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}toString(){let t="[";for(let e=0;e<9;e++)t+=this.data[e],t+=9!==e?", ":"";return t+="]",t}transpose(){const t=this.data;let e;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}}b.IDENTITY=Object.freeze(new b),b.ZERO=Object.freeze((new b).set([0,0,0,0,0,0,0,0,0]));const S={tmpVec21:null,tmpVec22:null,diff:null};class x{constructor(t=0,e=0){this.x=t,this.y=e,this._data=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Vec2")}add(t){return this.x+=t.x,this.y+=t.y,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}clone(){return(new x).copy(this)}copy(t){return this.x=t.x,this.y=t.y,this}dot(t){return this.x*t.x+this.y*t.y}equals(t){const e=S.diff;return e.copy(this),e.sub(t),e.lengthSq()<999999943962493e-25}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}lerp(t,e,i){return i=(0,o.c)(i,0,1),this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this}lerpUnclamped(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this}mul(t){return this.x*=t.x,this.y*=t.y,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this}normalize(){const t=this.x*this.x+this.y*this.y;if(t>0){const e=1/Math.sqrt(t);this.x*=e,this.y*=e}return this}scale(t){return this.x*=t,this.y*=t,this}set(t,e){return this.x=t,this.y=e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}toString(){return"["+this.x+", "+this.y+"]"}setFromMax(t,e){return t>this.x&&(this.x=t),e>this.y&&(this.y=e),this}strictEquals(t){return t instanceof x&&this.equals(t)}div(t){return this.x/=t.x,this.y/=t.y,this}$getType(){return x}getitem(t){switch(t){case 0:return this.x;case 1:return this.y;default:return NaN}}iget(t){return this.getitem(t)}setitem(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e}}iset(t,e){this.setitem(t,e)}getHashCode(){return this.x^this.y}hash(){return this.getHashCode()}$clone(t=new x){return t.copy(this),t}fromVector3(t){return this.x=t.x,this.y=t.y,this}fromVector4(t){return this.x=t.x,this.y=t.y,this}get data(){return this._data||(this._data=new Float32Array(2)),this._data[0]=this.x,this._data[1]=this.y,this._data}}S.tmpVec21=new x,S.tmpVec22=new x,S.diff=new x,x.ctor=x,x.$kind="struct",x.kEpsilon=1e-5,x.kEpsilonNormalSqrt=1e-15,x.angle=(t,e)=>{const{tmpVec21:i,tmpVec22:s}=S;return i.copy(t).normalize(),s.copy(e).normalize(),Math.acos((0,o.c)(i.dot(s),-1,1))*o.b},x.signedAngle=(t,e)=>x.angle(t,e)*(0,o.i)(t.x*e.y-t.y*e.x),x.lengthClamp=(t,e)=>t.lengthSq()>e*e?t.clone().normalize().scale(e):t.clone(),x.reflect=(t,e)=>{const{tmpVec21:i}=S;i.copy(e);const s=-2*i.dot(t);return i.scale(s),i.add(t).clone()},x.moveTowards=(t,e,i)=>{const s=S.tmpVec21.copy(e).sub(t),n=s.length();return n<=i||n<1401298e-51?e.clone():t.clone().add(s.scale(1/n*i))},x.smoothDamp=(t,e,i,s,n,r)=>{const a=2/(s=Math.max(1e-4,s)),o=a*r,h=1/(1+o+.479999989271164*o*o+.234999999403954*o*o*o),c=t.clone().sub(e.clone()),l=e.clone(),u=n*s,d=x.lengthClamp(c.clone(),u);e=t.clone().sub(d.clone());const _=i.v.clone().add(d.clone().scale(a)).scale(r);i.v=i.v.clone().sub(_.clone().scale(a)).scale(h);let p=e.clone().add(d.clone().add(_.clone()).scale(h));return l.clone().sub(t.clone()).dot(p.clone().sub(l.clone()))>0&&(p=l.clone(),i.v=p.clone().sub(l.clone()).scale(1/r)),p.clone()},x.equals=(t,e)=>null===t&&null===e||t&&e&&t.equals(e),x.getDefaultValue=()=>new x,x.FromVector3=t=>new x(t.x,t.y),x.FromVector4=t=>new x(t.x,t.y);const D=new x(1,1);D._data=new Float32Array(2),Object.freeze(D),x.ONE=D;const M=new x(1,0);M._data=new Float32Array(2),Object.freeze(M),x.RIGHT=M;const R=new x(0,1);R._data=new Float32Array(2),Object.freeze(R),x.UP=R;const I=new x(0,0);I._data=new Float32Array(2),Object.freeze(I),x.ZERO=I;var O=i(4),F=i(8),P=i(9);class v{constructor(t,e,i){this.x=t,this.y=e,this.z=i}dot2(t,e){return this.x*t+this.y*e}}const w=[new v(1,1,0),new v(-1,1,0),new v(1,-1,0),new v(-1,-1,0),new v(1,0,1),new v(-1,0,1),new v(1,0,-1),new v(-1,0,-1),new v(0,1,1),new v(0,-1,1),new v(0,1,-1),new v(0,-1,-1)],L=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],B=new Array(512),U=new Array(512);function N(t){return t*t*t*(t*(6*t-15)+10)}function k(t,e,i){return(1-i)*t+i*e}function z(t,e){let i=Math.floor(t),s=Math.floor(e);t-=i,e-=s,i&=255,s&=255;const n=U[i+B[s]].dot2(t,e),r=U[i+B[s+1]].dot2(t,e-1),a=U[i+1+B[s]].dot2(t-1,e),o=U[i+1+B[s+1]].dot2(t-1,e-1),h=N(t);return k(k(n,a,h),k(r,o,h),N(e))}!function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(let e=0;e<256;e++){let i;i=1&e?L[e]^255&t:L[e]^t>>8&255,B[e]=B[e+256]=i,U[e]=U[e+256]=w[i%12]}}(0);const V={_tmpVecA:null,_tmpVecB:null,_tmpVecC:null,_tmpVecD:null,_tmpVecE:null,get tmpVecA(){return this._tmpVecA=this._tmpVecA||new p,this._tmpVecA},get tmpVecB(){return this._tmpVecB=this._tmpVecB||new p,this._tmpVecB},get tmpVecC(){return this._tmpVecC=this._tmpVecC||new p,this._tmpVecC},get tmpVecD(){return this._tmpVecD=this._tmpVecD||new p,this._tmpVecD},get tmpVecE(){return this._tmpVecE=this._tmpVecE||new p,this._tmpVecE}};class j{constructor(t=new p,e=new p){this.center=t,this.halfExtents=e,this._min=new p,this._max=new p,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"BoundingBox")}add(t){const e=this.center,i=e.x,s=e.y,n=e.z,r=this.halfExtents,a=r.x,o=r.y,h=r.z;let c=i-a,l=i+a,u=s-o,d=s+o,_=n-h,p=n+h;const m=t.center,f=m.x,g=m.y,y=m.z,E=t.halfExtents,A=E.x,T=E.y,C=E.z,b=f-A,S=f+A,x=g-T,D=g+T,M=y-C,R=y+C;b<c&&(c=b),S>l&&(l=S),x<u&&(u=x),D>d&&(d=D),M<_&&(_=M),R>p&&(p=R),e.x=.5*(c+l),e.y=.5*(u+d),e.z=.5*(_+p),r.x=.5*(l-c),r.y=.5*(d-u),r.z=.5*(p-_)}copy(t){this.center.copy(t.center),this.halfExtents.copy(t.halfExtents)}clone(){return new j(this.center.clone(),this.halfExtents.clone())}intersects(t){const e=this.getMax(),i=this.getMin(),s=t.getMax(),n=t.getMin();return i.x<=s.x&&e.x>=n.x&&i.y<=s.y&&e.y>=n.y&&i.z<=s.z&&e.z>=n.z}_intersectsRay(t,e){const i=V.tmpVecA.copy(this.getMin()).sub(t.origin),s=V.tmpVecB.copy(this.getMax()).sub(t.origin),n=t.direction;0===n.x?(i.x=i.x<0?-Number.MAX_VALUE:Number.MAX_VALUE,s.x=s.x<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.x/=n.x,s.x/=n.x),0===n.y?(i.y=i.y<0?-Number.MAX_VALUE:Number.MAX_VALUE,s.y=s.y<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.y/=n.y,s.y/=n.y),0===n.z?(i.z=i.z<0?-Number.MAX_VALUE:Number.MAX_VALUE,s.z=s.z<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.z/=n.z,s.z/=n.z);const r=V.tmpVecC.set(Math.min(i.x,s.x),Math.min(i.y,s.y),Math.min(i.z,s.z)),a=V.tmpVecD.set(Math.max(i.x,s.x),Math.max(i.y,s.y),Math.max(i.z,s.z)),o=Math.min(Math.min(a.x,a.y),a.z),h=Math.max(Math.max(r.x,r.y),r.z),c=o>=h&&h>=0;return c&&e.copy(t.direction).scale(h).add(t.origin),c}_fastIntersectsRay(t){const e=V.tmpVecA,i=V.tmpVecB,s=V.tmpVecC,n=V.tmpVecD,r=V.tmpVecE,a=t.direction;return e.sub2(t.origin,this.center),n.set(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),s.mul2(e,a),!(n.x>this.halfExtents.x&&s.x>=0)&&(!(n.y>this.halfExtents.y&&s.y>=0)&&(!(n.z>this.halfExtents.z&&s.z>=0)&&(r.set(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z)),i.cross(a,e),i.set(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z)),!(i.x>this.halfExtents.y*r.z+this.halfExtents.z*r.y)&&(!(i.y>this.halfExtents.x*r.z+this.halfExtents.z*r.x)&&!(i.z>this.halfExtents.x*r.y+this.halfExtents.y*r.x)))))}intersectsRay(t,e=null){return e?this._intersectsRay(t,e):this._fastIntersectsRay(t)}setToInfinity(){this.center.set(0,0,0),this.halfExtents.set(Number.MAX_SAFE_INTEGER/2,Number.MAX_SAFE_INTEGER/2,Number.MAX_SAFE_INTEGER/2)}setMinMax(t,e){this.center.add2(e,t).scale(.5),this.halfExtents.sub2(e,t).scale(.5)}getMin(){return this._min.copy(this.center).sub(this.halfExtents)}getMax(){return this._max.copy(this.center).add(this.halfExtents)}containsPoint(t){const e=this.getMin(),i=this.getMax();return!(t.x<e.x||t.x>i.x||t.y<e.y||t.y>i.y||t.z<e.z||t.z>i.z)}setFromTransformedAabb(t,e,i=!1){const s=this.center,n=this.halfExtents,r=t.center,a=t.halfExtents,o=e.data,h=o[0],c=o[4],l=o[8],u=o[1],d=o[5],_=o[9],p=o[2],m=o[6],f=o[10],g=Math.abs(h),y=Math.abs(c),E=Math.abs(l),A=Math.abs(u),T=Math.abs(d),C=Math.abs(_),b=Math.abs(p),S=Math.abs(m),x=Math.abs(f);if(s.set(o[12]+h*r.x+c*r.y+l*r.z,o[13]+u*r.x+d*r.y+_*r.z,o[14]+p*r.x+m*r.y+f*r.z),n.set(g*a.x+y*a.y+E*a.z,A*a.x+T*a.y+C*a.z,b*a.x+S*a.y+x*a.z),i){const t=o[3],e=o[7],i=o[11],h=o[15],c=Math.abs(t),l=Math.abs(e),u=Math.abs(i),d=Math.abs(h),_=h+t*r.x+e*r.y+i*r.z,p=d+c*a.x+l*a.y+u*a.z;s.scale(1/_),n.scale(1/p)}}compute(t,e){if(0===t.length)return void this.setToInfinity();e=e||3;const i=V.tmpVecA.set(t[0],t[1],t[2]),s=V.tmpVecB.set(t[0],t[1],t[2]),n=t.length/e;for(let r=1;r<n;r++){const n=t[r*e+0],a=t[r*e+1],o=t[r*e+2];n<i.x&&(i.x=n),a<i.y&&(i.y=a),o<i.z&&(i.z=o),n>s.x&&(s.x=n),a>s.y&&(s.y=a),o>s.z&&(s.z=o)}this.setMinMax(i,s)}expandToPoint(t){const e=this.getMin(),i=this.getMax();e.x=Math.min(e.x,t.x),e.y=Math.min(e.y,t.y),e.z=Math.min(e.z,t.z),i.x=Math.max(i.x,t.x),i.y=Math.max(i.y,t.y),i.z=Math.max(i.z,t.z),this.setMinMax(e,i)}expand(t){this.halfExtents.add(V.tmpVecA.copy(t).scale(.5))}closestPoint(t){const e=t.clone();return e.sub(this.center),e.x=(0,o.c)(e.x,-this.halfExtents.x,this.halfExtents.x),e.y=(0,o.c)(e.y,-this.halfExtents.y,this.halfExtents.y),e.z=(0,o.c)(e.z,-this.halfExtents.z,this.halfExtents.z),e.add(this.center),e}strictEquals(t){return t instanceof j&&this.equals(t)}equals(t){return this.center.equals(t.center)&&this.halfExtents.equals(t.halfExtents)}intersectRayDistance(t,e){const i=new p;return!!this._intersectsRay(t,i)&&(e.v=p.distance(t.origin,i),!0)}getHashCode(){return this.center.getHashCode()^this.halfExtents.getHashCode()<<2}get min(){return this.getMin()}set min(t){this.setMinMax(t,this.getMax())}get max(){return this.getMax()}set max(t){this.setMinMax(this.getMin(),t)}}j.ctor=j,j.$kind="struct",j.equals=(t,e)=>null===t&&null===e||t&&e&&t.equals(e);const G={_viewProj:null,get viewProj(){return this._viewProj=this._viewProj||new c,this._viewProj}};class H{constructor(t=(new c).setPerspective(90,16/9,.1,1e3),e=new c){this.planes=[],this.unityPlanesOrthographic=[],this.unityPlanesPerspective=[];for(let t=0;t<6;t++)this.planes[t]=[];this.unityPlanesOrthographic[0]=this.planes[1],this.unityPlanesOrthographic[1]=this.planes[0],this.unityPlanesOrthographic[2]=this.planes[2],this.unityPlanesOrthographic[3]=this.planes[3],this.unityPlanesOrthographic[4]=this.planes[5],this.unityPlanesOrthographic[5]=this.planes[4],this.unityPlanesPerspective[0]=this.planes[1],this.unityPlanesPerspective[1]=this.planes[0],this.unityPlanesPerspective[2]=this.planes[3],this.unityPlanesPerspective[3]=this.planes[2],this.unityPlanesPerspective[4]=this.planes[5],this.unityPlanesPerspective[5]=this.planes[4],this.update(t,e)}update(t,e){G.viewProj.mul2(t,e);const i=G.viewProj.data;this.planes[0][0]=i[3]-i[0],this.planes[0][1]=i[7]-i[4],this.planes[0][2]=i[11]-i[8],this.planes[0][3]=i[15]-i[12];let s=Math.sqrt(this.planes[0][0]*this.planes[0][0]+this.planes[0][1]*this.planes[0][1]+this.planes[0][2]*this.planes[0][2]);this.planes[0][0]/=s,this.planes[0][1]/=s,this.planes[0][2]/=s,this.planes[0][3]/=s,this.planes[1][0]=i[3]+i[0],this.planes[1][1]=i[7]+i[4],this.planes[1][2]=i[11]+i[8],this.planes[1][3]=i[15]+i[12],s=Math.sqrt(this.planes[1][0]*this.planes[1][0]+this.planes[1][1]*this.planes[1][1]+this.planes[1][2]*this.planes[1][2]),this.planes[1][0]/=s,this.planes[1][1]/=s,this.planes[1][2]/=s,this.planes[1][3]/=s,this.planes[2][0]=i[3]+i[1],this.planes[2][1]=i[7]+i[5],this.planes[2][2]=i[11]+i[9],this.planes[2][3]=i[15]+i[13],s=Math.sqrt(this.planes[2][0]*this.planes[2][0]+this.planes[2][1]*this.planes[2][1]+this.planes[2][2]*this.planes[2][2]),this.planes[2][0]/=s,this.planes[2][1]/=s,this.planes[2][2]/=s,this.planes[2][3]/=s,this.planes[3][0]=i[3]-i[1],this.planes[3][1]=i[7]-i[5],this.planes[3][2]=i[11]-i[9],this.planes[3][3]=i[15]-i[13],s=Math.sqrt(this.planes[3][0]*this.planes[3][0]+this.planes[3][1]*this.planes[3][1]+this.planes[3][2]*this.planes[3][2]),this.planes[3][0]/=s,this.planes[3][1]/=s,this.planes[3][2]/=s,this.planes[3][3]/=s,this.planes[4][0]=i[3]-i[2],this.planes[4][1]=i[7]-i[6],this.planes[4][2]=i[11]-i[10],this.planes[4][3]=i[15]-i[14],s=Math.sqrt(this.planes[4][0]*this.planes[4][0]+this.planes[4][1]*this.planes[4][1]+this.planes[4][2]*this.planes[4][2]),this.planes[4][0]/=s,this.planes[4][1]/=s,this.planes[4][2]/=s,this.planes[4][3]/=s,this.planes[5][0]=i[3]+i[2],this.planes[5][1]=i[7]+i[6],this.planes[5][2]=i[11]+i[10],this.planes[5][3]=i[15]+i[14],s=Math.sqrt(this.planes[5][0]*this.planes[5][0]+this.planes[5][1]*this.planes[5][1]+this.planes[5][2]*this.planes[5][2]),this.planes[5][0]/=s,this.planes[5][1]/=s,this.planes[5][2]/=s,this.planes[5][3]/=s}containsPoint(t){for(let e=0;e<6;e++)if(this.planes[e][0]*t.x+this.planes[e][1]*t.y+this.planes[e][2]*t.z+this.planes[e][3]<=0)return!1;return!0}containsSphere(t,e=null){let i,s,n=0;const r=t.radius,a=t.center,o=a.x,h=a.y,c=a.z,l=this.planes;let u;for(s=0;s<6;s++){if(u=l[s],i=4===s&&e?u[0]*o+u[1]*h+u[2]*c+e:u[0]*o+u[1]*h+u[2]*c+u[3],i<=-r)return 0;i>r&&n++}return 6===n?2:1}}pc.Vec3=p,pc.Quat=u,pc.Mat4=c,pc.Vec4=n,pc.Mat3=b,pc.Vec2=x,pc.math={RAD_TO_DEG:o.b,DEG_TO_RAD:o.a,clamp:o.c,intToBytes24:o.d,intToBytes32:o.e,lerp:o.f,powerOfTwo:o.g,random:o.h,smoothstep:o.k,smootherstep:o.j,sign:o.i},pc.Color=O.a,pc.AnimationCurve=F.a,pc.Keyframe=F.b,pc.BoundingBox=j,pc.Frustum=H,pc.noise={perlin2:z},pc.ColorGradient=P.a},(t,e,i)=>{"use strict";i.d(e,{a:()=>c,b:()=>n,c:()=>b.a,d:()=>h});let s=0;function n(){return"id:"+s++}let r=0,a=0;const o=window.performance&&window.performance.now?()=>window.performance.now():Date.now;const h={pause:function(){a=o()},resume:function(){r+=o()-a,a=0},now:function(){return a||o()-r}};class c{constructor(t){this.defaultScope=t,this._callbacks={},this._callbackActive={}}on(t,e,i=null){return this._callbacks[t]||(this._callbacks[t]=[]),this._callbackActive[t]&&this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),this._callbacks[t].push({callback:e,scope:i||this.defaultScope}),this}off(t=null,e=null,i=null){if(!this._callbacks)return this;if(this._callbackActive)if(t)this._callbackActive[t]&&this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice());else for(const t in this._callbackActive)this._callbacks[t]&&this._callbacks[t]===this._callbackActive[t]&&(this._callbackActive[t]=this._callbackActive[t].slice());if(t)if(e){const s=this._callbacks[t];if(!s)return this;let n=s.length;for(;n--;)s[n].callback===e&&s[n].scope===i&&s.splice(n,1)}else this._callbacks[t]&&delete this._callbacks[t];else this._callbacks=null;return this}fire(t,...e){if(!t||!this._callbacks||!this._callbacks[t])return this;let i;this._callbackActive||(this._callbackActive={}),this._callbackActive[t]?(this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),i=this._callbacks[t].slice()):this._callbackActive[t]=this._callbacks[t];for(let s=0;(i||this._callbackActive[t])&&s<(i||this._callbackActive[t]).length;s++){const n=(i||this._callbackActive[t])[s];if(n.callback.call(n.scope,...e),n.callback.once){const e=this._callbacks[t].indexOf(n);-1!==e&&(this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),this._callbacks[t].splice(e,1))}}return i||(this._callbackActive[t]=null),this}once(t,e,i){return e.once=!0,this.on(t,e,i),this}}const l=navigator.userAgent;let u=!1,d=!1,_=!1,p=!1;/(windows|mac os|linux|cros)/i.test(l)&&(u=!0),/android/i.test(l)?(u=!1,d=!0,_=!0):/ip([ao]d|hone)/i.test(l)&&(u=!1,d=!0,p=!0);const m={desktop:u,mobile:d,ios:p,android:_},f=new Uint32Array(2048),g=new Uint32Array(64),y=new Uint32Array(64),E={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",alegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};f[0]=0;for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;0==(8388608&e);)i-=8388608,e<<=1;e&=-8388609,i+=947912704,f[t]=e|i}for(let t=1024;t<2048;++t)f[t]=939524096+(t-1024<<13);y[0]=0;for(let t=1;t<31;++t)y[t]=t<<23;y[31]=1199570944,y[32]=2147483648;for(let t=33;t<63;++t)y[t]=2147483648+(t-32<<23);y[63]=3347054592,g[0]=0;for(let t=1;t<64;++t)g[t]=32===t?0:1024;const A=Object.create(null);function T(t,e,i,s,n){const r=Object.keys(t),a=Object.keys(e);let o=!0;for(let t=0;t<Math.max(r.length,a.length);t++){const e=r[t],h=a[t];e?h?e!==h&&(n.push(`Inconsistency in set "${s}": object #0 has property "${e}" at position ${t} and object #${i} has property "${h}" at position ${t}.`),o=!1):(n.push(`Inconsistency in set "${s}": object #0 has an additional property "${e}" at position ${t}.`),o=!1):(n.push(`Inconsistency in set "${s}": object #${i} has an additional property "${h}" at position ${t}.`),o=!1)}return o}const C={addObjectToValidationSet:function(t,e){TESTS&&(A[e]||(A[e]=[]),A[e].push(t))},validate:function(){if(!TESTS)return;const t=[];for(const e in A){const i=A[e];if(i.length<=1)continue;const s=i[0];for(let n=1;n<i.length&&T(s,i[n],n,e,t);n++);}if(t.forEach((t=>console.error(t))),0!==t.length)throw new Error(`Hidden shape validation failed, found ${t.length} error(s)`)}};var b=i(6);Object.assign(pc,b.a),pc.guid={create:n},pc.time=h,pc.Events=c,pc.platform=m,pc.Conversion={fromFloat16ToFloat32:function(t){const e=new Float32Array(t.length),i=new Uint32Array(e.buffer);for(let e=0;e<t.length;e++){const s=t[e],n=s>>10;i[e]=f[g[n]+(1023&s)]+y[n]}return e},tryParseHtmlString:function(t,e){if("#"===t[0])return e.fromString(t),!0;let i=t.toLowerCase();return!(!/^[a-z]+$/.test(i)||(i=E[i],!i))&&(e.fromString(i),!0)}},TESTS&&(pc.hiddenShapeValidator=C)},(t,e,i)=>{"use strict";i.d(e,{a:()=>r.a,b:()=>_.a,c:()=>n.a,e:()=>l.a,d:()=>d.b});var s=i(12),n=i(13),r=i(5),a=i(10),o=i(1);let h=0;class c{constructor(t,e){this.id=h++,this.$id="0",this.system=t,this.entity=e,this.data=null,this.events=new o.a(this),this.events.on("set_enabled",this.onSetEnabled,this)}get enabled(){throw new Error("Should be overwritten")}set enabled(t){throw new Error("Should be overwritten")}onSetEnabled(t,e,i){e!==i&&this.entity.enabled&&(i?this.onEnable():this.onDisable())}onEnable(){}onDisable(){}destroy(){this.system&&this.entity&&this.system.removeComponent(this.entity)}toUnityObject(){return this.unityClass?UnityEngine.Object.FromHandle(this.unityClass,this):null}}c.prototype.unityClass=null;var l=i(16),u=i(22),d=i(17),_=i(14);class p{}p._logs=[],p._lastId=0,p.log=(t,e={},i=0,s=0)=>{if(!DEVELOP)return;Object.keys(e).forEach((i=>{t=t.replace(i,e[i])}));const n=(new Date).getTime(),r=p._lastId++;let a;if(i>0){const t=(new Error).stack.split("\n");a=t.slice(2+s,t.length).join("\n")}p._logs.push({id:r,stackTrace:a,type:i,unix:n,message:t})},p.info=(t,e,i=1)=>{p.log(t,e,0,i)},p.warn=(t,e,i=1)=>{p.log(t,e,1,i)},p.error=(t,e,i=1)=>{p.log(t,e,2,i)},p.exception=(t,e,i=1)=>{p.log("**Exception:** "+t.message,e,2,i)},p.assert=(t,e,i,s=1)=>{t||p.log("**Assertion failed:** "+e,i,2,s)};const m={Console:p};var f=i(15);pc.Debugger=m,pc.GraphNode=s.a,pc.Entity=n.a,pc.Application=r.a,pc.ComponentSystem=a.a,pc.Component=c,pc.UnityComponent=l.a,pc.ComponentQueue=u.a,pc.UnityComponentSystem=d.b,pc.Counters=_.a,pc.Scene=f.a},(t,e,i)=>{"use strict";i.d(e,{a:()=>s,b:()=>n,c:()=>r,d:()=>a,e:()=>o,f:()=>h,g:()=>c,h:()=>l,k:()=>u,j:()=>d,i:()=>_});const s=Math.PI/180,n=180/Math.PI;function r(t,e,i){return t>=i?i:t<=e?e:t}function a(t){return[t>>16&255,t>>8&255,255&t]}function o(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]}function h(t,e,i){return t+(e-t)*r(i,0,1)}function c(t){return 0!==t&&!(t&t-1)}function l(t,e){const i=e-t;return Math.random()*i+t}function u(t,e,i){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*(3-2*i)}function d(t,e,i){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*i*(i*(6*i-15)+10)}function _(t){return t<0?-1:1}},(t,e,i)=>{"use strict";i.d(e,{a:()=>r});var s=i(3);const n=1e-5;class r{constructor(t=0,e=0,i=0,s=1){this.r=t,this.g=e,this.b=i,this.a=s,this._data=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Color")}get data(){return this._data||(this._data=new Float32Array(4)),this._data[0]=this.r,this._data[1]=this.g,this._data[2]=this.b,this._data[3]=this.a,this._data}clone(){return new r(this.r,this.g,this.b,this.a)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}set(t,e,i,s=1){return this.r=t,this.g=e,this.b=i,this.a=s,this}setFromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this.a=t[e+3],this}fromString(t){const e=parseInt(t.replace("#","0x"),16);let i;return t.length>7?i=(0,s.e)(e):(i=(0,s.d)(e),i[3]=255),this.set(i[0]/255,i[1]/255,i[2]/255,i[3]/255),this}toString(t=!1){let e="#"+((1<<24)+(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)).toString(16).slice(1);if(t){const t=Math.round(255*this.a).toString(16);this.a<16/255?e+="0"+t:e+=t}return e}getitem(t){switch(t){case 0:return this.r;case 1:return this.g;case 2:return this.b;case 3:return this.a;default:return NaN}}setitem(t,e){switch(t){case 0:this.r=e;break;case 1:this.g=e;break;case 2:this.b=e;break;case 3:this.a=e}}premultiply(){return this.r*=this.a,this.g*=this.a,this.b*=this.a,this}mul(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a,this}mul2(t,e){return this.r=t.r*e.r,this.g=t.g*e.g,this.b=t.b*e.b,this.a=t.a*e.a,this}scale(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}toLinear(){return this.r=r.gammaToLinear(this.r),this.g=r.gammaToLinear(this.g),this.b=r.gammaToLinear(this.b),this}equals(t){return Math.abs(this.r-t.r)<n&&Math.abs(this.g-t.g)<n&&Math.abs(this.b-t.b)<n&&Math.abs(this.a-t.a)<n}getHashCode(){return this.r^this.g^this.b^this.a}hash(){return this.getHashCode()}strictEquals(t){return t instanceof r&&this.equals(t)}lerpTo(t,e){this.r=t.r*e+this.r*(1-e),this.g=t.g*e+this.g*(1-e),this.b=t.b*e+this.b*(1-e),this.a=t.a*e+this.a*(1-e)}grayscale(){return.29899999499321*this.r+.587000012397766*this.g+.114*this.b}linear(){return new r(UnityEngine.Mathf.GammaToLinearSpace(this.r),UnityEngine.Mathf.GammaToLinearSpace(this.g),UnityEngine.Mathf.GammaToLinearSpace(this.b),this.a)}gamma(){return new r(UnityEngine.Mathf.LinearToGammaSpace(this.r),UnityEngine.Mathf.LinearToGammaSpace(this.g),UnityEngine.Mathf.LinearToGammaSpace(this.b),this.a)}maxColorComponent(){return Math.max(Math.max(this.r,this.g),this.b)}$getType(){return r}$clone(t=new r){return t.copy(this),t}}r.ctor=r,r.$kind="struct",r.gammaToLinear=t=>t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.2),r.hsvToRGB=(t,e,i,n)=>{let a=0,o=0,h=0;const c=Math.floor(6*t),l=6*t-c;switch(c%6){case 0:a=i,o=i*(1-(1-l)*e),h=i*(1-e);break;case 1:a=i*(1-l*e),o=i,h=i*(1-e);break;case 2:a=i*(1-e),o=i,h=i*(1-(1-l)*e);break;case 3:a=i*(1-e),o=i*(1-l*e),h=i;break;case 4:a=i*(1-(1-l)*e),o=i*(1-e),h=i;break;case 5:a=i,o=i*(1-e),h=i*(1-l*e)}return n||(a=(0,s.c)(a,0,1),o=(0,s.c)(o,0,1),h=(0,s.c)(h,0,1)),new r(a,o,h,1)},r.rgbToHSV=(t,e,i,s)=>{t.b>t.g&&t.b>t.r?r.rgbToHSVHelper(4,t.b,t.r,t.g,e,i,s):t.g>t.r?r.rgbToHSVHelper(2,t.g,t.b,t.r,e,i,s):r.rgbToHSVHelper(0,t.r,t.g,t.b,e,i,s)},r.rgbToHSVHelper=(t,e,i,s,n,r,a)=>{if(a.v=e,0!==a.v){const e=i<=s?i:s,o=a.v-e;if(0!==o?(r.v=o/a.v,n.v=t+(i-s)/o):(r.v=0,n.v=t+(i-s)),n.v/=6,n.v>=0)return;++n.v}else r.v=0,n.v=0},r.lerp=(t,e,i)=>r.lerpUnclamped(t,e,(0,s.c)(i,0,1)),r.lerpUnclamped=(t,e,i)=>new r(UnityEngine.Mathf.LerpUnclamped(t.r,e.r,i),UnityEngine.Mathf.LerpUnclamped(t.g,e.g,i),UnityEngine.Mathf.LerpUnclamped(t.b,e.b,i),UnityEngine.Mathf.LerpUnclamped(t.a,e.a,i)),r.equals=(t,e)=>null===t&&null===e||null!==t&&null!==e&&t.equals(e),r.getDefaultValue=()=>new r},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a:()=>Application});var _math_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_input_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11),_core_index_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_rendering_index_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7),_entity_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(13),_system_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(10),_registry_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(21),_counters_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(14),_scene_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(15);const unityAttenuationTextureBase64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAABCAYAAABADtw1AAAA+ElEQVRYCc1RSRLDIAxr///jbqlVqhkNJW4IZtEh8oYsyHUz3L64GxCCgYeBjJh4GhArIyZehjxGDUA9Rb9feNGq5ozBAOaUP0WpM1fmGa1dDJqX4nzGy7VXir0aey3sndWexrgzcqAl9s7X9PJZ5IB6O5KXZmpqEbN7GqgD+Z1SNX3P9v7pRvSPaKRb+HfkTI1e7eyI+TM7cIbw/jVn9rjlLDUjNKAVpRPti3o9PKr2CH3ui35r6no8Y6f6mb1fvTBe0RO9gWf6i9i9igbfNMIPtXr8n2h/9NpLt8cb0DO5p/eRO7gLPOJOM/etsps+Rr8395Y4yssbZyWMID2grNAAAAAASUVORK5CYII=",unitySpotTextureBase64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACABAMAAAAxEHz4AAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAO9SURBVGiB3VnredpAEEQdGHdg0wGiA4tUgKggiFSASAMB3EAQFQTRgeUO7HRg3IHtDkxm9+70AFk6sfoSf9k/2D9mNDO7iHt0Op+6nC7XhQh9LkcBfgYFY67T4n+bPp6APRfVNxTWIhwFJ7DrefyhKCwZgL8k+MBL64YoriwZGN8juO/74yCY4IMo+pYMjIf0IYGDEBUQyQhWrBgUfuABPg3D+RK1CMMZKCDChkHhhz7gQEdcxDEL/JFisMKPA8CjaBNzbcGxCIOJBYOj8dMQ8DjeJVx3cQyKcKYZqkyg/z3C4/FxnCT3j1wPSQKK5YIY+tdVEmBA4VcR4ID+3qOe8AcoorViqDDBBjwf+E2MpzNa1RNUxFsw+F6VCTbgB8DvEoa/6mKK5A4MgV9hwlEGQuD58a+5YhFgCJWJcgkQ4Hrj6ZLwBv52OLwbCmJYziYwUS6BBSAA5Kfxh7Q0A5JEDB9JIAHD8Xxl8G+HXL0bhvViMiqXoAXAAPwXHp+KQA5k4gMJLCCYR7t7wr8d41nE/unhLloE5RJIwHi62sBAKV4xPCbb9WxCEk4dsAAY2D+f6jcuXvYwoSQce1AJrGI2UI4nBpiI1yqF0wjRAhLwMZ4ZSMJkdBIjHAyGLOC5PAATwwtLGN0ce+AI0YJqAVpCtDiJkSPEDNQI0BIwC8cxkgNEWCtAS6AYiwRw4CHCpE6AkpAgRq/ooXvpcoS1AlgCx+jmCXIOagSQhBIPqgccYR0eEijGoz7QFCkHtQJYAnsoElAEu0cbASSBPORDoAh0D+wIuA+5EJyuisDKgfLAIaQEKgKrHmgC9pCFoCOwdMAeiiGoCNBEKwGQoBt53S1kaBtBFoJJMcvQDg8PxRQdnaFtBOkk9K8u8k2wzjBN0bSBm4Axso2AQsAoZW1ommE+xVYIsi7a4tM2qD5yF783aYJqw0/TRxB4zZpg2uBpAtNF6wh4mLNBaI3Avgk8CBkBD+LtfVOCh19mFJlg05xgmxG4w2+N5khP0g89y0TQbBDNKB4T2OP1KKYEgy/nEXy9+X8IxCG20EbhIIlHWfhlEn+dP8EbSfxSlb/WhT8s//63sYWfd+kCQ7zEkS+ypMs88UKzhaWudLEtXu6LNxziLU8bmy7htk+88RRvfeWbb/H2X3wAIT4CkR/CiI+BxAdR8qMw8WGc/DhQfCApPhKVH8qKj4XlB9Pio3H54bz4ekB+QSG/IhFf0sivieQXVeKrMvllnfy6UH5hKb8y7YgvbY2IFm+eZZffZ6L/Vv0BqFspPs/Tph4AAAAASUVORK5CYII=",unityNHxRoughnessBase64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAMAAADCg1mMAAAAA3NCSVQICAjb4U/gAAABEVBMVEX+/v7v7+/S0tKysrKfn5+ampqHh4d5eXltbW1mZmZkZGRjY2NiYmJeXl5bW1taWlpZWVlTU1NPT09OTk5MTExJSUlISEhHR0dGRkZFRUVERERCQkJBQUE+Pj49PT07Ozs6Ojo5OTk4ODg3Nzc2NjY1NTU0NDQzMzMyMjIxMTEwMDAvLy8uLi4tLS0sLCwrKysqKiopKSkoKCgnJycmJiYlJSUkJCQjIyMiIiIhISEgICAfHx8eHh4dHR0cHBwbGxsaGhoZGRkYGBgXFxcWFhYVFRUUFBQTExMSEhIREREQEBAPDw8ODg4NDQ0MDAwLCwsKCgoJCQkICAgHBwcGBgYFBQUEBAQDAwMCAgIBAQEAAAAUqg0sAAAACXBIWXMAAAsSAAALEgHS3X78AAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAABDdJREFUeJzl1wlf2jAcxnF334fbnHNz3hvoB9SqxYJSDkUF5RKGW9//C1n+SZsmpWlTWq72eQe/L2laFgzD+Cfe3/HuYfpbMAxvgsgZpl3sGAHwN4hCYYJZA+lRABmDUApTzZQDGCfC7BT7AEgiBFaYcvUf4dwAxoIwyXJxrjyALIK8wnjbgzST9cm8AKI+CtHXB+8dmi9ApAiR5YdqDg4QoUL4/rDZPX7yALIKIQlGjg8QHQIgGoTRAIK3C5rv2Y0AIKkwIkHAfPnye5d1u91RAcIrBBOQrZcJ77ILBSDHENRAEsA/3jO82yGLAEBGIZiBDIB3vEd5h19UACEUpAgC5Iva2ew2XaQAEgqyBkEABPWu7XZ5u4UXPYA/w0gGYgDXfK/2lrUm2rgARlKQJ3DtF9cPtTfpxgrgp+BvIBLw6hfUO9rvzI0fwIfBz8BPwNnvyOfq+fZbvEkBBFQQGYgF+H5hPdvegE0UwFNB0mBIwA2A6WfqmXjc3qijTR7Ai8EDYZiAFxjqd82n9dBev0GbFoC0gpuBg4ARcOvn6ukvD/HXaFMFEDOIENwJHAIUgPv12d/erL9CmwEAPD8EkQEjwAGw/Uy+WX9N6mtoswKA56PgNHASsAIMgNnP5ZP6S7SZAsDzRHAYMAT0ENhHwD4AtB/O/o1dP5MAZBIIjAF3COgRoAfAuvys/Ksr3F6FzSoAnhCBM+AIOIF223oBkPd+45rM/PErsJkGwBMpOI8Bcwjwy9D+/Cfffbfk7qP9OF/XZx8Azx3BxYC8ES0BmPnlj7986vj8X+CVYcXinADgiREcBOZnMSfg6Cf1xfkCwHNB4AysU2D+K7KfAXwDwpu/BndfCe0cLT93AHhDCNSAvBjNP0j4kxB/CtIr0Hr6dV0/Q9O0+QSAuSLYxwBGzwA9AvbvD79+Pp/LzS8AnsBgMHARsAGs/lwudzznADAewTQw/yxZd6F5DZIrEF9/hcLp6cnJyWEMAPCcCObfBesmINcAuQPgAkCPP/Qryn5cAGDOg4BmPQjkKUDPAAXQNOjPZuMEAGMQGANMgAXgDoAbQNNUVVEymXTcAGD8l5J5FeCLAG4BuAMAAH7/vVQqjgAwDsEiIALVqq4XCqp6iPp3NuMKAGMMCAE8BugerFTQO0A9Osikf22uxRkAZr0dyBsBDgG6BsrlM01V9vd+b639iDuAQQ0wQacDAtXSeV5Vsrs766vLCQAwGANE0GwiAb2QO8qmt36ufEkGgDX0Vuz1Wq2bWqWoHWdTG6tLi8kCIASdZr1WPlMPUuvfP39IGgAQ9PutRq2UV3bXvy2+TR4A2qDXua3pambj68eXiQRAp+D+rnaubC+9e5FMAETQb15q6eU3z5MKgJ6D9sXR6qtnyQUwHjql7ddPEgxgGJ3c+8eJBjBaKwvJBjD0RwkHMJ4mHeBT0gGM/4ecz/SdIIT+AAAAAElFTkSuQmCC",_mouseMovementDelta=new _math_index_js__WEBPACK_IMPORTED_MODULE_0__.h;class Application{constructor(t,e){this.events=new _core_index_js__WEBPACK_IMPORTED_MODULE_2__.a(this),Application._currentApplication=this,this._time=0,this.timeScale=1,this.maxDeltaTime=.1,this.frame=0,this.autoRender=!0,this.renderNextFrame=!1,this._fillMode=_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.FILLMODE_KEEP_ASPECT,this._resolutionMode=_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.RESOLUTION_FIXED,this.minimumResolution=null,this.paused=!1,this.graphicsDevice=e.graphicsDevice,this.counters=new _counters_js__WEBPACK_IMPORTED_MODULE_6__.a(this.graphicsDevice),this._audioManager=e.audioManager,this._entityIndex={},this.scene=new _scene_js__WEBPACK_IMPORTED_MODULE_7__.a,this.root=new _entity_js__WEBPACK_IMPORTED_MODULE_4__.a(this),this.root._enabledInHierarchy=!0,this.renderer=e.renderer,this.renderer.scene=this.scene,this.keyboard=e.keyboard,this.mouse=new _input_index_js__WEBPACK_IMPORTED_MODULE_1__.a(t),this.touch="ontouchstart"in window?new _input_index_js__WEBPACK_IMPORTED_MODULE_1__.b(t):null,this._targetAspect=null,this.systems=new _registry_js__WEBPACK_IMPORTED_MODULE_8__.a,this._visibilityChangeHandler=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._visibilityChangeHandler,!1),this.tick=this._tick.bind(this)}get audioManager(){return this._audioManager}get targetAspect(){return this._targetAspect}set targetAspect(t){this._targetAspect=t,this.setCanvasFillMode(this._fillMode,window.innerWidth,window.innerHeight)}start(){this.frame=0,this.tick(0)}_tick(t){if(!this.graphicsDevice)return;const e=_core_index_js__WEBPACK_IMPORTED_MODULE_2__.d.now();let i=(e-(this._time||e))/1e3;i=(0,_math_index_js__WEBPACK_IMPORTED_MODULE_0__.k)(i,0,this.maxDeltaTime),i*=this.timeScale,this._time=e,UnityEngine.Time.Update(i),window.requestAnimationFrame(this.tick),this.graphicsDevice.contextLost||this.paused||(this.counters.startSection(_counters_js__WEBPACK_IMPORTED_MODULE_6__.a.FRAME),this.update(i),this.counters.startSection(_counters_js__WEBPACK_IMPORTED_MODULE_6__.a.RENDER),(this.autoRender||this.renderNextFrame)&&(this.render(),this.renderNextFrame=!1),this.counters.endSection(_counters_js__WEBPACK_IMPORTED_MODULE_6__.a.RENDER),this.events.fire("frameend"),this.counters.endSection(_counters_js__WEBPACK_IMPORTED_MODULE_6__.a.FRAME),this.counters.tick())}update(t){this.frame++,this.graphicsDevice.updateClientRect(),_system_js__WEBPACK_IMPORTED_MODULE_5__.a.update(t),this.events.fire("update",t),this.mouse&&this.mouse.update(),this.keyboard&&this.keyboard.update(),UnityEngine.Input.Update(),UnityEngine.SceneManagement.SceneManager.ProcessAsync()}render(){this.graphicsDevice._drawCallsPerFrame=0,this.events.fire("prerender"),this.scene.syncHierarchy(),this.renderer.renderComposition(),this.events.fire("postrender")}syncHierarchy(){this.scene.syncHierarchy()}setCanvasFillMode(t,e,i){this._fillMode=t;const s=this.resizeCanvas(e,i);this.graphicsDevice.resizeCanvas(s.width,s.height)}setCanvasResolution(t,e,i){this._resolutionMode=t,t===_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.RESOLUTION_AUTO&&void 0===e&&(e=this.graphicsDevice.canvas.clientWidth,i=this.graphicsDevice.canvas.clientHeight),this.graphicsDevice.resizeCanvas(e,i)}onVisibilityChange(){document.hidden?this._audioManager.suspend():this._audioManager.resume()}resizeCanvas(t,e){const i=window.innerWidth,s=window.innerHeight;if(this._fillMode===_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.FILLMODE_KEEP_ASPECT){const n=this._targetAspect||this.graphicsDevice.canvas.width/this.graphicsDevice.canvas.height;n>i/s?e=(t=i)/n:t=(e=s)*n,this.minimumResolution&&(t<this.minimumResolution.x||e<this.minimumResolution.y)&&(t=this.minimumResolution.x,e=this.minimumResolution.y)}else this._fillMode===_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.FILLMODE_FILL_WINDOW&&(t=i,e=s);return this.graphicsDevice.canvas.style.width=t+"px",this.graphicsDevice.canvas.style.height=e+"px",this._resolutionMode===_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.RESOLUTION_AUTO&&this.setCanvasResolution(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.RESOLUTION_AUTO),{width:t,height:e}}mimicUnityMouse(){window.UnityEngine.Input.mousePosition=new _math_index_js__WEBPACK_IMPORTED_MODULE_0__.h(0,0),this.touch?(this.touch.events.on(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.EVENT_TOUCHSTART,this._onTouchStart,this),this.touch.events.on(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.EVENT_TOUCHEND,this._onTouchEnd,this),this.touch.events.on(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.EVENT_TOUCHMOVE,this._onTouchMove,this),this.touch.events.on(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.EVENT_TOUCHCANCEL,this._onTouchEnd,this),UnityEngine.Input.mousePresent=!1,UnityEngine.Input.touchSupported=!0):(this.mouse.events.on(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.EVENT_MOUSEUP,this._onMouseUp,this),this.mouse.events.on(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.EVENT_MOUSEDOWN,this._onMouseDown,this),this.mouse.events.on(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.EVENT_MOUSEMOVE,this._onMouseMove,this),this.mouse.events.on(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.EVENT_MOUSEWHEEL,this._onMouseScroll,this)),this.events.on("prerender",this._updateInputFlags,this),this.events.on("prerender",this._updateScreenCache,this),this.events.on("frameend",this._resetScroll,this)}_updateInputFlags(){window.UnityEngine.Input.mouseButtonsUp[0]=!1,window.UnityEngine.Input.mouseButtonsUp[1]=!1,window.UnityEngine.Input.mouseButtonsUp[2]=!1,window.UnityEngine.Input.mouseButtonsDown[0]=!1,window.UnityEngine.Input.mouseButtonsDown[1]=!1,window.UnityEngine.Input.mouseButtonsDown[2]=!1,window.UnityEngine.Input.axes.Insert("Mouse ScrollWheel",0)}_updateScreenCache(){this.renderer._screensRendered={}}_resetScroll(){window.UnityEngine.Input.axes.Insert("Mouse ScrollWheel",0),window.UnityEngine.Input.mouseScrollDelta=new _math_index_js__WEBPACK_IMPORTED_MODULE_0__.h(0,0)}_onMouseUp(t){const e={x:t.x,y:this.graphicsDevice._height-t.y};window.UnityEngine.Input.mouseButtonsUp[t.button]=!0,window.UnityEngine.Input.mouseButtons[t.button]=!1,window.UnityEngine.Input.mouseButtonsDown[t.button]=!1,window.UnityEngine.Input.mousePosition=new _math_index_js__WEBPACK_IMPORTED_MODULE_0__.h(e.x,e.y)}_onMouseMove(t){const e={x:t.x,y:this.graphicsDevice._height-t.y};_mouseMovementDelta.set(e.x-window.UnityEngine.Input.mousePosition.x,-e.y+window.UnityEngine.Input.mousePosition.y),window.UnityEngine.Input.axes.Insert("Mouse X",.1*_mouseMovementDelta.x),window.UnityEngine.Input.axes.Insert("Mouse Y",.1*_mouseMovementDelta.y),window.UnityEngine.Input.mousePosition=new _math_index_js__WEBPACK_IMPORTED_MODULE_0__.h(e.x,e.y)}_onMouseScroll(t){window.UnityEngine.Input.axes.Insert("Mouse ScrollWheel",.1*t.wheel),window.UnityEngine.Input.mouseScrollDelta=new _math_index_js__WEBPACK_IMPORTED_MODULE_0__.h(0,t.wheel)}_onMouseDown(t){window.UnityEngine.Input.mouseButtonsDown[t.button]=!0,window.UnityEngine.Input.mouseButtons[t.button]=!0,window.UnityEngine.Input.mouseButtonsUp[t.button]=!1;const e={x:t.x,y:this.graphicsDevice._height-t.y};window.UnityEngine.Input.mousePosition=new _math_index_js__WEBPACK_IMPORTED_MODULE_0__.h(e.x,e.y)}_onTouchStart(t){const e={x:t.changedTouches[0].x,y:t.changedTouches[0].y,button:0};for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];UnityEngine.Input.OnTouchStart(i.id,i.x,this.graphicsDevice._height-i.y)}return this._onMouseDown(e),!0}_onTouchEnd(t){const e={x:t.changedTouches[0].x,y:t.changedTouches[0].y,button:0};for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];UnityEngine.Input.OnTouchEnd(i.id,i.x,this.graphicsDevice._height-i.y)}return this._onMouseUp(e),!0}_onTouchMove(t){const e={x:t.changedTouches[0].x,y:t.changedTouches[0].y,button:0};for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];UnityEngine.Input.OnTouchMoved(i.id,i.x,this.graphicsDevice._height-i.y)}return this._onMouseMove(e),!0}getRootObjects(){return this.root.children}getMainCamera(){let t=null;for(let e=0;e<this.systems.camera.cameras.length;e++){const i=this.systems.camera.cameras[e];if("MainCamera"===i.entity.tag)return i;null!=i.renderTarget||t||(t=i)}return t}initializeBuiltInTextures(){const t=[["white",[255,255,255,255]],["red",[255,0,0,0]],["gray",[127,127,127,127]],["bump",[127,127,255,127]],["black",[0,0,0,0]]];let e=null;for(let i=0;i<t.length;i++){const s=t[i][1],n=new _rendering_index_js__WEBPACK_IMPORTED_MODULE_3__.f(this.graphicsDevice,{width:4,height:4,format:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.PIXELFORMAT_R8_G8_B8_A8,premultiplyAlpha:!1}),r=n.lock();for(let t=0;t<16;t++)r[4*t+0]=s[0],r[4*t+1]=s[1],r[4*t+2]=s[2],r[4*t+3]=s[3];n.unlock(),UnityEngine.Texture2D[t[i][0]+"Texture"]=UnityEngine.Object.FromHandle(UnityEngine.Texture2D,n),e=r}UnityEngine.Texture2D.greyTexture=UnityEngine.Texture2D.grayTexture;const i=new _rendering_index_js__WEBPACK_IMPORTED_MODULE_3__.f(this.graphicsDevice,{width:4,height:4,format:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.PIXELFORMAT_R8_G8_B8_A8,cubemap:!0,premultiplyAlpha:!1});i._levels=[[e,e,e,e,e]],i.upload(),UnityEngine.Cubemap.blackCube=UnityEngine.Object.FromHandle(UnityEngine.Cubemap,i);const s=new _rendering_index_js__WEBPACK_IMPORTED_MODULE_3__.f(this.graphicsDevice,{width:1024,height:1,addressU:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.ADDRESS_CLAMP_TO_EDGE,addressV:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.ADDRESS_CLAMP_TO_EDGE,format:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.PIXELFORMAT_R8_G8_B8_A8,premultiplyAlpha:!1});let n=document.createElement("IMG");n.src=unityAttenuationTextureBase64,s.setSource(n),UnityEngine.Texture2D.attenuationTexture=UnityEngine.Object.FromHandle(UnityEngine.Texture2D,s);const r=new _rendering_index_js__WEBPACK_IMPORTED_MODULE_3__.f(this.graphicsDevice,{width:128,height:128,addressU:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.ADDRESS_CLAMP_TO_EDGE,addressV:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.ADDRESS_CLAMP_TO_EDGE,format:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.PIXELFORMAT_R8_G8_B8_A8,premultiplyAlpha:!1});n=document.createElement("IMG"),n.src=unitySpotTextureBase64,r.setSource(n),UnityEngine.Texture2D.spotTexture=UnityEngine.Object.FromHandle(UnityEngine.Texture2D,r);const a=new _rendering_index_js__WEBPACK_IMPORTED_MODULE_3__.f(this.graphicsDevice,{width:256,height:64,addressU:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.ADDRESS_CLAMP_TO_EDGE,addressV:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.ADDRESS_CLAMP_TO_EDGE,format:_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.PIXELFORMAT_R8_G8_B8_A8,premultiplyAlpha:!1});n=document.createElement("IMG"),n.src=unityNHxRoughnessBase64,a.setSource(n),UnityEngine.Texture2D.nhxRoughnessTexture=UnityEngine.Object.FromHandle(UnityEngine.Texture2D,a),_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.UniformDefaultValues[_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.UNIFORMTYPE_TEXTURE2D]=UnityEngine.Texture2D.blackTexture.handle,_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.UniformDefaultValues[_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.UNIFORMTYPE_TEXTURECUBE]=UnityEngine.Cubemap.blackCube.handle,_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.UniformDefaultValues[_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.UNIFORMTYPE_TEXTURE2D_SHADOW]=UnityEngine.Texture2D.blackTexture.handle,_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.UniformDefaultValues[_core_index_js__WEBPACK_IMPORTED_MODULE_2__.c.UNIFORMTYPE_TEXTURECUBE_SHADOW]=UnityEngine.Cubemap.blackCube.handle}installPlayroundOverrides(){const overrides=window.playgroundOverrides||{};for(const className in overrides){if(!overrides.hasOwnProperty(className))continue;const classNameString=JSON.stringify(className),backupClassNameString=JSON.stringify("_"+className);let code="Deserializers[ "+backupClassNameString+" ] = Deserializers[ "+classNameString+"];\n";code+="Deserializers[ "+classNameString+" ] = function () {\n",code+="  var result = Deserializers[ "+backupClassNameString+" ].apply( this, arguments );\n";const fields=overrides[className];for(const t in fields){if(!fields.hasOwnProperty(t))continue;const e=fields[t];switch(e[0]){case"float":case"int":case"string":code+="  result."+t+" = "+JSON.stringify(e[1])+"; \n";break;case"boolean":code+="  result."+t+" = "+JSON.stringify(!!e[1])+"; \n";break;case"color":code+="  result."+t+" = new pc.Color("+e.slice(1,5).join(",")+"); \n";break;case"vector2":code+="  result."+t+" = new pc.Vec2("+e.slice(1,3).join(",")+"); \n";break;case"vector3":code+="  result."+t+" = new pc.Vec3("+e.slice(1,4).join(",")+"); \n";break;case"vector4":code+="  result."+t+" = new pc.Vec4("+e.slice(1,5).join(",")+"); \n";break;case"enum":code+="  result."+t+" = "+parseInt(e[1],10)+"; \n"}}code+="  return result;\n",code+="}",eval("(function() { "+code+"})()")}}muteAudio(){this.audioManager.volume=0}unmuteAudio(){this.audioManager.volume=1}pause(){_core_index_js__WEBPACK_IMPORTED_MODULE_2__.d.pause(),this.paused=!0,this.audioManager.suspend()}resume(){this.paused&&(_core_index_js__WEBPACK_IMPORTED_MODULE_2__.d.resume(),this.paused=!1,this.audioManager.resume())}}Application._currentApplication=null,Application.getApplication=()=>Application._currentApplication},(t,e,i)=>{"use strict";i.d(e,{a:()=>c});const s={SHADER_PASS_ALWAYS:0,SHADER_PASS_FORWARD_BASE:1,SHADER_PASS_FORWARD_ADD:2,SHADER_PASS_SHADOW_CASTER:3,SHADER_PASS_GRAB_PASS:4,SHADER_PASS_VERTEX:5,SHADER_PASS_VERTEX_LM:6,RENDER_TYPE_BACKGROUND:0,RENDER_TYPE_OPAQUE:1,RENDER_TYPE_TRANSPARENT:2,LIGHT_MODE_TAG_NAME:"LIGHTMODE",LIGHT_MODE_ALWAYS_NAME:"ALWAYS",LIGHT_MODE_FORWARD_BASE_NAME:"FORWARDBASE",LIGHT_MODE_FORWARD_ADD_NAME:"FORWARDADD",LIGHT_MODE_SHADOW_CASTER_NAME:"SHADOWCASTER",LIGHT_MODE_VERTEX_NAME:"Vertex",LIGHT_MODE_VERTEX_LM_NAME:"VertexLM",RENDER_TYPE_TAG_NAME:"RENDERTYPE",RENDER_TYPE_BACKGROUND_NAME:"Background",RENDER_TYPE_OPAQUE_NAME:"Opaque",RENDER_TYPE_TRANSPARENT_NAME:"Transparent",GRAB_PASS_TAG_NAME:"GRABPASS",GRAB_PASS_TEXTURE_NAME_TAG_NAME:"GRABPASS_TEXTURE_NAME",SHADERDEF_NOSHADOW:1,SHADERDEF_SKIN:2,SHADERDEF_UV0:4,SHADERDEF_UV1:8,SHADERDEF_VCOLOR:16,SHADERDEF_INSTANCING:32,SHADERDEF_LM:64,SHADERDEF_DIRLM:128,SHADERDEF_SCREENSPACE:256,SHADERDEF_TANGENTS:512,SHADERDEF_LMUV0:1024,SHADERDEF_LM_DLDR:2048,SHADERDEF_LM_BAKED_AMBIENT:4096,SHADERDEF_LIGHTPROBES:8192,SHADERDEF_BLEND_REFLECTION_PROBES:16384,SHADERDEF_RENDERTYPE_BACKGROUND:32768,SHADERDEF_PARTICLES_INSTANCING:65536,SHADERDEF_UI_MASK:1<<17,SHADERDEF_REVERT_STENCIL:1<<18,SHADERDEF_STENCIL_OVERRIDE:1<<19,SORTKEY_FORWARD:0,SORTKEY_DEPTH:1,SEMANTIC_POSITION:"POSITION",SEMANTIC_NORMAL:"NORMAL",SEMANTIC_TANGENT:"TANGENT",SEMANTIC_BLENDWEIGHT:"BLENDWEIGHT",SEMANTIC_BLENDINDICES:"BLENDINDICES",SEMANTIC_COLOR:"COLOR",SEMANTIC_TEXCOORD0:"TEXCOORD0",SEMANTIC_TEXCOORD1:"TEXCOORD1",SEMANTIC_TEXCOORD2:"TEXCOORD2",SEMANTIC_TEXCOORD3:"TEXCOORD3",SEMANTIC_TEXCOORD4:"TEXCOORD4",SEMANTIC_TEXCOORD5:"TEXCOORD5",SEMANTIC_TEXCOORD6:"TEXCOORD6",SEMANTIC_TEXCOORD7:"TEXCOORD7",SEMANTIC_ATTR0:"ATTR0",SEMANTIC_ATTR1:"ATTR1",SEMANTIC_ATTR2:"ATTR2",SEMANTIC_ATTR3:"ATTR3",SEMANTIC_ATTR4:"ATTR4",SEMANTIC_ATTR5:"ATTR5",SEMANTIC_ATTR6:"ATTR6",SEMANTIC_ATTR7:"ATTR7",SEMANTIC_ATTR8:"ATTR8",SEMANTIC_ATTR9:"ATTR9",SEMANTIC_ATTR10:"ATTR10",SEMANTIC_ATTR11:"ATTR11",SEMANTIC_ATTR12:"ATTR12",SEMANTIC_ATTR13:"ATTR13",SEMANTIC_ATTR14:"ATTR14",SEMANTIC_ATTR15:"ATTR15",ADDRESS_REPEAT:0,ADDRESS_CLAMP_TO_EDGE:1,ADDRESS_MIRRORED_REPEAT:2,PIXELFORMAT_A8:0,PIXELFORMAT_L8:1,PIXELFORMAT_L8_A8:2,PIXELFORMAT_R5_G6_B5:3,PIXELFORMAT_R5_G5_B5_A1:4,PIXELFORMAT_R4_G4_B4_A4:5,PIXELFORMAT_R8_G8_B8:6,PIXELFORMAT_R8_G8_B8_A8:7,PIXELFORMAT_DXT1:8,PIXELFORMAT_DXT3:9,PIXELFORMAT_DXT5:10,PIXELFORMAT_RGB16F:11,PIXELFORMAT_RGBA16F:12,PIXELFORMAT_RGB32F:13,PIXELFORMAT_RGBA32F:14,PIXELFORMAT_R32F:15,PIXELFORMAT_DEPTH:16,PIXELFORMAT_DEPTHSTENCIL:17,PIXELFORMAT_111110F:18,PIXELFORMAT_SRGB:19,PIXELFORMAT_SRGBA:20,PIXELFORMAT_ETC1:21,PIXELFORMAT_ETC2_RGB:22,PIXELFORMAT_ETC2_RGBA:23,PIXELFORMAT_PVRTC_2BPP_RGB_1:24,PIXELFORMAT_PVRTC_2BPP_RGBA_1:25,PIXELFORMAT_PVRTC_4BPP_RGB_1:26,PIXELFORMAT_PVRTC_4BPP_RGBA_1:27,TEXTURELOCK_READ:1,TEXTURELOCK_WRITE:2},n={LIGHT_MODE_NAMES:[s.LIGHT_MODE_ALWAYS_NAME,s.LIGHT_MODE_FORWARD_BASE_NAME,s.LIGHT_MODE_FORWARD_ADD_NAME,s.LIGHT_MODE_SHADOW_CASTER_NAME,s.GRAB_PASS_TAG_NAME,s.LIGHT_MODE_VERTEX_NAME,s.LIGHT_MODE_VERTEX_LM_NAME],RENDER_TYPE_NAMES:[s.RENDER_TYPE_BACKGROUND_NAME,s.RENDER_TYPE_OPAQUE_NAME,s.RENDER_TYPE_TRANSPARENT_NAME]},r={BLENDMODE_ZERO:0,BLENDMODE_ONE:1,BLENDMODE_SRC_COLOR:2,BLENDMODE_ONE_MINUS_SRC_COLOR:3,BLENDMODE_DST_COLOR:4,BLENDMODE_ONE_MINUS_DST_COLOR:5,BLENDMODE_SRC_ALPHA:6,BLENDMODE_SRC_ALPHA_SATURATE:7,BLENDMODE_ONE_MINUS_SRC_ALPHA:8,BLENDMODE_DST_ALPHA:9,BLENDMODE_ONE_MINUS_DST_ALPHA:10,BLENDEQUATION_ADD:0,BLENDEQUATION_SUBTRACT:1,BLENDEQUATION_REVERSE_SUBTRACT:2,BLENDEQUATION_MIN:3,BLENDEQUATION_MAX:4,BUFFER_STATIC:0,BUFFER_DYNAMIC:1,BUFFER_STREAM:2,BUFFER_GPUDYNAMIC:3,CLEARFLAG_COLOR:1,CLEARFLAG_DEPTH:2,CLEARFLAG_STENCIL:4,CLEARFLAG_USE_SKYBOX:8,CUBEFACE_POSX:0,CUBEFACE_NEGX:1,CUBEFACE_POSY:2,CUBEFACE_NEGY:3,CUBEFACE_POSZ:4,CUBEFACE_NEGZ:5,CULLFACE_NONE:0,CULLFACE_BACK:1,CULLFACE_FRONT:2,CULLFACE_FRONTANDBACK:3,TYPE_INT8:0,TYPE_UINT8:1,TYPE_INT16:2,TYPE_UINT16:3,TYPE_INT32:4,TYPE_UINT32:5,TYPE_FLOAT32:6,FILTER_NEAREST:0,FILTER_LINEAR:1,FILTER_NEAREST_MIPMAP_NEAREST:2,FILTER_NEAREST_MIPMAP_LINEAR:3,FILTER_LINEAR_MIPMAP_NEAREST:4,FILTER_LINEAR_MIPMAP_LINEAR:5,FUNC_NEVER:0,FUNC_LESS:1,FUNC_EQUAL:2,FUNC_LESSEQUAL:3,FUNC_GREATER:4,FUNC_NOTEQUAL:5,FUNC_GREATEREQUAL:6,FUNC_ALWAYS:7,INDEXFORMAT_UINT8:0,INDEXFORMAT_UINT16:1,INDEXFORMAT_UINT32:2,PRIMITIVE_POINTS:0,PRIMITIVE_LINES:1,PRIMITIVE_LINELOOP:2,PRIMITIVE_LINESTRIP:3,PRIMITIVE_TRIANGLES:4,PRIMITIVE_TRISTRIP:5,PRIMITIVE_TRIFAN:6,STENCILOP_KEEP:0,STENCILOP_ZERO:1,STENCILOP_REPLACE:2,STENCILOP_INCREMENT:3,STENCILOP_INCREMENTWRAP:4,STENCILOP_DECREMENT:5,STENCILOP_DECREMENTWRAP:6,STENCILOP_INVERT:7,UNIFORMTYPE_BOOL:0,UNIFORMTYPE_INT:1,UNIFORMTYPE_FLOAT:2,UNIFORMTYPE_VEC2:3,UNIFORMTYPE_VEC3:4,UNIFORMTYPE_VEC4:5,UNIFORMTYPE_IVEC2:6,UNIFORMTYPE_IVEC3:7,UNIFORMTYPE_IVEC4:8,UNIFORMTYPE_BVEC2:9,UNIFORMTYPE_BVEC3:10,UNIFORMTYPE_BVEC4:11,UNIFORMTYPE_MAT2:12,UNIFORMTYPE_MAT3:13,UNIFORMTYPE_MAT4:14,UNIFORMTYPE_TEXTURE2D:15,UNIFORMTYPE_TEXTURECUBE:16,UNIFORMTYPE_FLOATARRAY:17,UNIFORMTYPE_TEXTURE2D_SHADOW:18,UNIFORMTYPE_TEXTURECUBE_SHADOW:19,UNIFORMTYPE_TEXTURE3D:20},a={};a[r.UNIFORMTYPE_BOOL]=0,a[r.UNIFORMTYPE_INT]=0,a[r.UNIFORMTYPE_FLOAT]=0,a[r.UNIFORMTYPE_VEC2]=new Float32Array([0,0]),a[r.UNIFORMTYPE_VEC3]=new Float32Array([0,0,0]),a[r.UNIFORMTYPE_VEC4]=new Float32Array([0,0,0,0]),a[r.UNIFORMTYPE_IVEC2]=new Int32Array([0,0]),a[r.UNIFORMTYPE_IVEC3]=new Int32Array([0,0,0]),a[r.UNIFORMTYPE_IVEC4]=new Int32Array([0,0,0,0]),a[r.UNIFORMTYPE_BVEC2]=0,a[r.UNIFORMTYPE_BVEC3]=0,a[r.UNIFORMTYPE_BVEC4]=0,a[r.UNIFORMTYPE_MAT2]=new Float32Array([0,0,0,0]),a[r.UNIFORMTYPE_MAT3]=new Float32Array([0,0,0,0,0,0,0,0,0]),a[r.UNIFORMTYPE_MAT4]=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a[r.UNIFORMTYPE_TEXTURE2D]=null,a[r.UNIFORMTYPE_TEXTURECUBE]=null,a[r.UNIFORMTYPE_FLOATARRAY]=new Float32Array([0,0,0,0]),a[r.UNIFORMTYPE_TEXTURE2D_SHADOW]=null,a[r.UNIFORMTYPE_TEXTURECUBE_SHADOW]=null;const o={};o[s.SEMANTIC_POSITION]=0,o[s.SEMANTIC_NORMAL]=1,o[s.SEMANTIC_TANGENT]=2,o[s.SEMANTIC_BLENDWEIGHT]=3,o[s.SEMANTIC_BLENDINDICES]=4,o[s.SEMANTIC_COLOR]=5,o[s.SEMANTIC_TEXCOORD0]=6,o[s.SEMANTIC_TEXCOORD1]=7,o[s.SEMANTIC_TEXCOORD2]=8,o[s.SEMANTIC_TEXCOORD3]=9,o[s.SEMANTIC_TEXCOORD4]=10,o[s.SEMANTIC_TEXCOORD5]=11,o[s.SEMANTIC_TEXCOORD6]=12,o[s.SEMANTIC_TEXCOORD7]=13,o[s.SEMANTIC_ATTR0]=14,o[s.SEMANTIC_ATTR1]=15,o[s.SEMANTIC_ATTR2]=16,o[s.SEMANTIC_ATTR3]=17,o[s.SEMANTIC_ATTR4]=18,o[s.SEMANTIC_ATTR5]=19,o[s.SEMANTIC_ATTR6]=20,o[s.SEMANTIC_ATTR7]=21,o[s.SEMANTIC_ATTR8]=22,o[s.SEMANTIC_ATTR9]=23,o[s.SEMANTIC_ATTR10]=24,o[s.SEMANTIC_ATTR11]=25,o[s.SEMANTIC_ATTR12]=26,o[s.SEMANTIC_ATTR13]=27,o[s.SEMANTIC_ATTR14]=28,o[s.SEMANTIC_ATTR15]=29;const h={"unity_CameraWorldClipPlanes[0]":1,unity_MatrixMVP:2,unity_MatrixMV:4,unity_MatrixVP:8,unity_MatrixV:16,unity_MatrixInvV:32,glstate_matrix_projection:64,unity_MatrixTMV:128,unity_MatrixITMV:256,unity_ObjectToWorld:512,unity_WorldToObject:1024,unity_CameraProjection:2048,unity_CameraInvProjection:4096,"hlslcc_mtx4x4unity_MatrixMVP[0]":2,"hlslcc_mtx4x4unity_MatrixMV[0]":4,"hlslcc_mtx4x4unity_MatrixVP[0]":8,"hlslcc_mtx4x4unity_MatrixV[0]":16,"hlslcc_mtx4x4unity_MatrixInvV[0]":32,"hlslcc_mtx4x4glstate_matrix_projection[0]":64,"hlslcc_mtx4x4unity_MatrixTMV[0]":128,"hlslcc_mtx4x4unity_MatrixITMV[0]":256,"hlslcc_mtx4x4unity_ObjectToWorld[0]":512,"hlslcc_mtx4x4unity_WorldToObject[0]":1024,"hlslcc_mtx4x4unity_CameraProjection[0]":2048,"hlslcc_mtx4x4unity_CameraInvProjection[0]":4096},c=Object.assign({},{EVENT_MOUSEDOWN:"mousedown",EVENT_MOUSEMOVE:"mousemove",EVENT_MOUSEUP:"mouseup",EVENT_MOUSEWHEEL:"mousewheel",EVENT_TOUCHSTART:"touchstart",EVENT_TOUCHEND:"touchend",EVENT_TOUCHMOVE:"touchmove",EVENT_TOUCHCANCEL:"touchcancel",KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ENTER:13,KEY_SHIFT:16,KEY_CONTROL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PRINT_SCREEN:44,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_SEMICOLON:59,KEY_EQUAL:61,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_WINDOWS:91,KEY_CONTEXT_MENU:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SEPARATOR:108,KEY_SUBTRACT:109,KEY_DECIMAL:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_COMMA:188,KEY_PERIOD:190,KEY_SLASH:191,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_META:224,MOUSEBUTTON_NONE:-1,MOUSEBUTTON_LEFT:0,MOUSEBUTTON_MIDDLE:1,MOUSEBUTTON_RIGHT:2,PAD_1:0,PAD_2:1,PAD_3:2,PAD_4:3,PAD_FACE_1:0,PAD_FACE_2:1,PAD_FACE_3:2,PAD_FACE_4:3,PAD_L_SHOULDER_1:4,PAD_R_SHOULDER_1:5,PAD_L_SHOULDER_2:6,PAD_R_SHOULDER_2:7,PAD_SELECT:8,PAD_START:9,PAD_L_STICK_BUTTON:10,PAD_R_STICK_BUTTON:11,PAD_UP:12,PAD_DOWN:13,PAD_LEFT:14,PAD_RIGHT:15,PAD_VENDOR:16,PAD_L_STICK_X:0,PAD_L_STICK_Y:1,PAD_R_STICK_X:2,PAD_R_STICK_Y:3},{FILLMODE_NONE:"NONE",FILLMODE_FILL_WINDOW:"FILL_WINDOW",FILLMODE_KEEP_ASPECT:"KEEP_ASPECT",RESOLUTION_AUTO:"AUTO",RESOLUTION_FIXED:"FIXED",SCREEN_TYPE_WORLD:"world",SCREEN_TYPE_CAMERA:"camera",SCREEN_TYPE_SCREEN:"screen"},{FOG_NONE:"none",FOG_LINEAR:"linear",FOG_EXP:"exp",FOG_EXP2:"exp2"},{LIGHTTYPE_DIRECTIONAL:0,LIGHTTYPE_POINT:1,LIGHTTYPE_SPOT:2,SHADOW_PCF3:0,SHADOW_DEPTH:0,SHADOW_VSM8:1,SHADOW_VSM16:2,SHADOW_VSM32:3,SHADOW_PCF5:4,MASK_DYNAMIC:1,MASK_BAKED:2,MASK_LIGHTMAP:4},{PROJECTION_PERSPECTIVE:0,PROJECTION_ORTHOGRAPHIC:1,VIEW_CENTER:0,VIEW_LEFT:1,VIEW_RIGHT:2,ASPECT_AUTO:0,ASPECT_MANUAL:1},s,n,r);c.UniformDefaultValues=a,c.ShaderAttributeSlots=o,c.UNIFORMS_USAGE_MAP=h},(t,e,i)=>{"use strict";i.d(e,{a:()=>l,b:()=>ut,c:()=>C,d:()=>R,e:()=>Je,f:()=>x,g:()=>c,h:()=>h});var s=i(0),n=i(1);class r{constructor(t,e,i){this.scopeId=t,this.data=e,this.passFlags=i}}class a{constructor(){this.parameters={}}getParameter(t){const e=this.parameters[t];return e?e.data:null}setParameter(t,e,i=-524285){const s=this.parameters[t];s?(s.data=e,s.passFlags=i):this.parameters[t]=new r(null,e,i)}deleteParameter(t){this.parameters[t]&&delete this.parameters[t]}}const o=[0,0,0,0,0,0,0];o[n.c.TYPE_INT8]=1,o[n.c.TYPE_UINT8]=1,o[n.c.TYPE_INT16]=2,o[n.c.TYPE_UINT16]=2,o[n.c.TYPE_INT32]=4,o[n.c.TYPE_UINT32]=4,o[n.c.TYPE_FLOAT32]=4;class h{constructor(t,e){this.elements=[],this.hasUv0=!1,this.hasUv1=!1,this.hasColor=!1,this.hasTangents=!1,this.elementMap={},this.size=0;for(let i=0,s=e.length;i<s;i++){const s=e[i],r={name:s.semantic,offset:0,stride:0,stream:-1,scopeId:t.scope.resolve(s.semantic),dataType:s.type,numComponents:s.components,normalize:void 0!==s.normalize&&s.normalize,size:s.components*o[s.type]};this.elements.push(r),this.size+=4*Math.ceil(r.size/4),s.semantic===n.c.SEMANTIC_TEXCOORD0?this.hasUv0=!0:s.semantic===n.c.SEMANTIC_TEXCOORD1?this.hasUv1=!0:s.semantic===n.c.SEMANTIC_COLOR?this.hasColor=!0:s.semantic===n.c.SEMANTIC_TANGENT&&(this.hasTangents=!0)}let i=0;for(let t=0,e=this.elements.length;t<e;t++){const e=this.elements[t];e.offset=i,e.stride=this.size,i+=e.size,this.elementMap[e.name]=e}}getStructureFor(t,e=!1){let i=-1;const s=e?4:1;for(let e=0;e<this.elements.length;e++)if(this.elements[e].name===t){i=this.elements[e].offset;break}return{offset:i/s,stride:this.size/s}}}class c{constructor(t,e,i,s=n.c.BUFFER_STATIC,r=null){this.usage=s,this.format=e,this.numVertices=i,this.numBytes=e.size*i,t._vram.vb+=this.numBytes,this.device=t,this.bufferId=null,this._storage=null,r?this.setData(r):this.storage=new ArrayBuffer(this.numBytes),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"VertexBuffer")}destroy(){this.bufferId&&(this.device._vram.vb-=this.numBytes),this.invalidateBuffer()}getFormat(){return this.format}getUsage(){return this.usage}getNumVertices(){return this.numVertices}lock(){return this.storage}unlock(){const t=this.device.gl;let e;switch(this.bufferId||(this.bufferId=t.createBuffer()),this.usage){case n.c.BUFFER_STATIC:e=t.STATIC_DRAW;break;case n.c.BUFFER_DYNAMIC:e=t.DYNAMIC_DRAW;break;case n.c.BUFFER_STREAM:e=t.STREAM_DRAW;break;case n.c.BUFFER_GPUDYNAMIC:e=this.device.webgl2?t.DYNAMIC_COPY:t.STATIC_DRAW}t.bindBuffer(t.ARRAY_BUFFER,this.bufferId),t.bufferData(t.ARRAY_BUFFER,this.storage,e)}setData(t){return t.byteLength!==this.numBytes?(this.storage=null,console.error("VertexBuffer: wrong initial data size: expected "+this.numBytes+", got "+t.byteLength),!1):(this.storage=t,this.unlock(),!0)}resize(t){const e=t*this.format.size;if(e!==this.numBytes){this.device._vram.vb+=e-this.numBytes,this.numBytes=e,this.numVertices=t;const i=this.storage;this.storage=new ArrayBuffer(this.numBytes),new Uint8Array(this.storage).set(new Uint8Array(i.slice(0,this.numBytes))),this.invalidateBuffer()}}invalidateBuffer(){const t=this.device;if(this.bufferId){const e=t.gl;e.deleteBuffer(this.bufferId),this.bufferId=null,t.boundBuffer=null,t.vertexBuffers.length=0,t.vbOffsets.length=0,t.attributesInvalidated=!0;for(const i in t.enabledAttributes)e.disableVertexAttribArray(Number(i));t.enabledAttributes={}}}get storage(){return this._storage}set storage(t){this._storage=t}}class l{constructor(t,e,i,s=n.c.BUFFER_STATIC,r=null){this.usage=s,this.format=e,this.numIndices=i,this.device=t;const a=this.device.gl;let o=-1;e===n.c.INDEXFORMAT_UINT8?(o=1,this.glFormat=a.UNSIGNED_BYTE):e===n.c.INDEXFORMAT_UINT16?(o=2,this.glFormat=a.UNSIGNED_SHORT):e===n.c.INDEXFORMAT_UINT32&&(o=4,this.glFormat=a.UNSIGNED_INT),this.bytesPerIndex=o,this.numBytes=this.numIndices*o,this.preventDestroy=!1,this.bufferId=null,this.storage=null,r?this.setData(r):this.storage=new ArrayBuffer(this.numBytes),t._vram.ib+=this.numBytes,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"IndexBuffer")}destroy(){this.preventDestroy||(this.bufferId&&(this.device._vram.ib-=this.numBytes),this.invalidateBuffer())}getFormat(){return this.format}getNumIndices(){return this.numIndices}lock(){return this.storage}unlock(){const t=this.device.gl;let e;switch(this.bufferId||(this.bufferId=t.createBuffer()),this.usage){case n.c.BUFFER_STATIC:e=t.STATIC_DRAW;break;case n.c.BUFFER_DYNAMIC:e=t.DYNAMIC_DRAW;break;case n.c.BUFFER_STREAM:e=t.STREAM_DRAW;break;case n.c.BUFFER_GPUDYNAMIC:e=this.device.webgl2?t.DYNAMIC_COPY:t.STATIC_DRAW}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.bufferId),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.storage,e)}setData(t){return t.byteLength!==this.numBytes?(console.error("IndexBuffer: wrong initial data size: expected "+this.numBytes+", got "+t.byteLength),!1):(this.storage=t,this.unlock(),!0)}resize(t){const e=t*this.bytesPerIndex;if(e!==this.numBytes){this.numBytes=e,this.numIndices=t;const i=this.storage;this.storage=new ArrayBuffer(this.numBytes),new Uint8Array(this.storage).set(new Uint8Array(i.slice(0,this.numBytes))),this.invalidateBuffer()}}invalidateBuffer(){const t=this.device;if(this.bufferId){t.gl.deleteBuffer(this.bufferId),this.bufferId=null,t.indexBuffer===this&&(t.indexBuffer=null)}}}const u=[null,null,s.h,s.i,s.j],d=new Float32Array([1,1,1,1]),_=new Float32Array([0,0,0,0]),p=new Float32Array([0,0,0,1]),m=new Float32Array([1,0,0,1]),f=new Float32Array([0,0,1,1]),g=new s.a,y=new s.e,E=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1],A=[{semantic:n.c.SEMANTIC_POSITION,components:3,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_NORMAL,components:3,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TANGENT,components:4,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_BLENDWEIGHT,components:4,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_BLENDINDICES,components:4,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_COLOR,components:4,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TEXCOORD0,components:2,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TEXCOORD1,components:2,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TEXCOORD2,components:2,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TEXCOORD3,components:2,type:n.c.TYPE_FLOAT32}],T=[{semantic:n.c.SEMANTIC_POSITION,components:3,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_NORMAL,components:3,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TANGENT,components:4,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_COLOR,components:4,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TEXCOORD0,components:2,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TEXCOORD1,components:2,type:n.c.TYPE_FLOAT32}];class C{constructor(t=!1){this.name="",this._refCount=0,this.id=C.id++,this.$id="",this.vertexBuffer=t?null:this.defaultVertexBuffer(E,0,new ArrayBuffer(0)),this.indexBuffer=[null],this.primitive=[{type:0,base:0,count:0,indexed:!0}],this.skin=null,this.morph=null,this.meshInstance=null,this._aabb=new s.a,this.bindposes=[],this.subMeshes=[],this.boneAabb=null,this.boneUsed=[],this.version=0,this.bufferUsage=n.c.BUFFER_STATIC,this.vao=null,this.alphaCorrected=!1,this["__UnityEngine.Mesh"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Mesh")}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=null);for(let t=0;t<this.indexBuffer.length;t++)this.indexBuffer[t]&&this.indexBuffer[t].destroy(),this.indexBuffer=[]}defaultVertexBuffer(t,e,i){const s=[];for(let e=0;e<t.length;e++)t[e]&&s.push(A[e]);const r=new h(UnityEngine.Graphics.graphicsDevice,s);return new c(UnityEngine.Graphics.graphicsDevice,r,e,this.bufferUsage||n.c.BUFFER_STATIC,i)}getDescriptionForSemantics(t,e=null){if(e)return{semantic:t,components:e,type:n.c.TYPE_FLOAT32};for(let e=0;e<A.length;e++)if(A[e].semantic===t)return A[e];throw new Error("Unknown or unsupported semantic requested: "+t)}defaultIndexBuffer(t,e){return new l(UnityEngine.Graphics.graphicsDevice,n.c.INDEXFORMAT_UINT16,t,this.bufferUsage||n.c.BUFFER_STATIC,e)}markDynamic(){this.vertexBuffer&&(this.vertexBuffer.lock(),this.vertexBuffer.usage=n.c.BUFFER_DYNAMIC,this.vertexBuffer.unlock()),this.indexBuffer[0]&&(this.indexBuffer[0].lock(),this.indexBuffer[0].usage=n.c.BUFFER_DYNAMIC,this.indexBuffer[0].unlock()),this.bufferUsage=n.c.BUFFER_DYNAMIC}uploadMeshData(){this.vertexBuffer&&this.vertexBuffer.unlock();for(let t=0;t<this.subMeshes.length;t++){const e=this.subMeshes[t];e.vertexBuffer=this.vertexBuffer,e.indexBuffer[0]&&e.indexBuffer[0].unlock()}}clear(){this.vertexBuffer&&this.vertexBuffer.resize(0),this.indexBuffer[0]&&this.indexBuffer[0].resize(0),this.subMeshes=[this],this.version++}setIndicies(t,e,i,s,r){this.subMeshes.length>=i&&this.setSubMeshCount(i+1);const a=this.subMeshes[i];let o=0;switch(e){case UnityEngine.MeshTopology.Triangles:o=n.c.PRIMITIVE_TRIANGLES;break;case UnityEngine.MeshTopology.Lines:o=n.c.PRIMITIVE_LINES;break;case UnityEngine.MeshTopology.LineStrip:o=n.c.PRIMITIVE_LINESTRIP;break;case UnityEngine.MeshTopology.Points:o=n.c.PRIMITIVE_POINTS}if(null===o)throw new Error("Unknown or unsupported topology "+e+" passed!");a.primitive[0].type=o,a.primitive[0].base=r,a.primitive[0].count=t.length,a.primitive[0].indexed=!0,a.vertexBuffer=this.vertexBuffer,a.indexBuffer[0]=a.indexBuffer[0]||new l(UnityEngine.Graphics.graphicsDevice,n.c.INDEXFORMAT_UINT16,0,n.c.BUFFER_STATIC),a.indexBuffer[0].resize(t.length),new Uint16Array(a.indexBuffer[0].lock()).set(t),!1!==s&&this.recalculateBounds(),this.uploadMeshData(),this.version++}getIndicies(t){const e=this.subMeshes[t];return new Uint16Array(e.indexBuffer[0].lock())}getUVInTriangle(t,e){const i=this.vertexBuffer,r=new s.h;let a=3*t;if(!i)return r;const o=i.format.getStructureFor(n.c.SEMANTIC_TEXCOORD0);let h=0,c=new Uint16Array(this.subMeshes[h].indexBuffer[0].storage);for(;a>=c.length;)a-=c.length,h++,c=new Uint16Array(this.subMeshes[h].indexBuffer[0].storage);if(o.offset<0)return r;const l=(c[a+e]*o.stride+o.offset)/4,u=new Float32Array(i.storage);return r.set(u[l+0],u[l+1]),r}getVectorStream(t,e,i){const s=this.vertexBuffer;if(!s)return;const n=s.format.getStructureFor(e);if(n.offset<0)return;const r=new Float32Array(s.storage),a=new Array(s.numVertices);let o=0;for(let t=n.offset/4;t<r.length;t+=n.stride/4){const e=new u[i];e.x=r[t+0],e.y=r[t+1],i>2&&(e.z=r[t+2]),i>3&&(e.w=r[t+3]),a[o++]=e}t._items=a,t._size=a.length}setVectorStream(t,e,i){if(!t||0===t._size)return void this.disableSemantic(e);this.enableSemantic(e);const s=this.vertexBuffer;s.resize(Math.max(t._size,s.numVertices));const n=s.format.getStructureFor(e),r=new Float32Array(s.storage);let a=0;const o=t._size*n.stride/4;switch(i){case 2:for(let e=n.offset/4;e<o;e+=n.stride/4){const i=t._items[a++];r[e+0]=i.x,r[e+1]=i.y}break;case 3:for(let e=n.offset/4;e<o;e+=n.stride/4){const i=t._items[a++];r[e+0]=i.x,r[e+1]=i.y,r[e+2]=i.z}break;case 4:for(let e=n.offset/4;e<o;e+=n.stride/4){const i=t._items[a++];r[e+0]=i.x,r[e+1]=i.y,r[e+2]=i.z,r[e+3]=i.w}}this.meshInstance&&this.meshInstance._aabbVer++,this.uploadMeshData(),this.version++}getColorStream(t,e,i){const n=this.vertexBuffer;if(!n)return;const r=n.format.getStructureFor(e);if(r.offset<0)return;const a=new Float32Array(n.storage),o=new Array(n.numVertices);let h=0;for(let t=r.offset/4;t<a.length;t+=r.stride/4){const e=new s.b;e.r=a[t+0]*i,e.g=a[t+1]*i,e.b=a[t+2]*i,e.a=a[t+3]*i,o[h++]=e}t._items=o,t._size=o.length}getUIVertexStream(t,e){if(t._size=0,e._size=0,!this.vertexBuffer||!this.indexBuffer[0])return;t._size=t._items.length=this.vertexBuffer.numVertices,e._size=e._items.length=this.primitive[0].count,e._items=Array.from(new Uint16Array(this.indexBuffer[0].storage));const i=new Float32Array(this.vertexBuffer.storage),s=this.vertexBuffer.format.size/4,r=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_POSITION,!0),a=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_NORMAL,!0),o=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_TANGENT,!0),h=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_COLOR,!0),c=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_TEXCOORD0,!0),l=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_TEXCOORD1,!0);for(let e=0;e<i.length;e+=s){const n=new UnityEngine.UIVertex;let u=-1;t._items[e/s|0]=n,(u=r.offset)>=0&&n.position.set(i[e+u+0],i[e+u+1],i[e+u+2]),(u=a.offset)>=0&&n.normal.set(i[e+u+0],i[e+u+1],i[e+u+2]),(u=o.offset)>=0&&n.tangent.set(i[e+u+0],i[e+u+1],i[e+u+2],i[e+u+3]),(u=h.offset)>=0&&(n.color.r=255*i[e+u+0]|0,n.color.g=255*i[e+u+1]|0,n.color.b=255*i[e+u+2]|0,n.color.a=255*i[e+u+3]|0),(u=c.offset)>=0&&n.uv0.set(i[e+u+0],i[e+u+1]),(u=l.offset)>=0&&n.uv1.set(i[e+u+0],i[e+u+1])}}setUIVertexStream(t,e){if(this.vertexBuffer){const t=T,e=this.vertexBuffer.format;if(e.elements.length!==t.length)this.vertexBuffer.destroy(),this.vertexBuffer=null;else for(let i=0;i<t.length;i++)if(e.elements[i].name!==t[i].semantic){this.vertexBuffer.destroy(),this.vertexBuffer=null;break}}if(!this.vertexBuffer){const e=new h(UnityEngine.Graphics.graphicsDevice,T);this.vertexBuffer=new c(UnityEngine.Graphics.graphicsDevice,e,t._size,this.bufferUsage||n.c.BUFFER_STATIC,null)}e._items.length=e._size,this.setIndicies(e._items,UnityEngine.MeshTopology.Triangles,0,!0,0),this.vertexBuffer.resize(t._size);const i=new Float32Array(this.vertexBuffer.storage);for(let e=0;e<i.length;e+=18){const s=t._items[e/18];i[e+0]=s.position.x,i[e+1]=s.position.y,i[e+2]=s.position.z,i[e+3]=s.normal.x,i[e+4]=s.normal.y,i[e+5]=s.normal.z,i[e+6]=s.tangent.x,i[e+7]=s.tangent.y,i[e+8]=s.tangent.z,i[e+9]=s.tangent.w,i[e+10]=s.color.r/255,i[e+11]=s.color.g/255,i[e+12]=s.color.b/255,i[e+13]=s.color.a/255,i[e+14]=s.uv0.x,i[e+15]=s.uv0.y,i[e+16]=s.uv1.x,i[e+17]=s.uv1.y}this.uploadMeshData(),this.primitive[0].type=n.c.PRIMITIVE_TRIANGLES,this.primitive[0].base=0,this.primitive[0].count=e._items.length,this.primitive[0].indexed=!0}setColorStream(t,e,i){if(!t||0===t._size)return void this.disableSemantic(e);this.enableSemantic(e);const s=this.vertexBuffer;s.resize(Math.max(t._size,s.numVertices));const n=s.format.getStructureFor(e),r=new Float32Array(s.storage);let a=0;const o=t._size*n.stride/4,h=1/i;for(let e=n.offset/4;e<o;e+=n.stride/4){const i=t._items[a++];r[e+0]=i.r*h,r[e+1]=i.g*h,r[e+2]=i.b*h,r[e+3]=i.a*h}this.uploadMeshData(),this.version++}initializeBuffers(){this.destroy(),this.vertexBuffer=new c(UnityEngine.Graphics.graphicsDevice,new h(UnityEngine.Graphics.graphicsDevice,[]),0),this.vertexBuffer.numBytes=0,this.vertexBuffer.numVertices=0,this.indexBuffer=[new l(UnityEngine.Graphics.graphicsDevice,n.c.INDEXFORMAT_UINT16,0,n.c.BUFFER_STATIC)]}enableSemantic(t){let e=this.vertexBuffer;e||(e=new c(UnityEngine.Graphics.graphicsDevice,new h(UnityEngine.Graphics.graphicsDevice,[]),0),e.numBytes=0,e.numVertices=0,this.vertexBuffer=e);const i=e.format;if(i.getStructureFor(t).offset>=0)return;const s=new Float32Array(e.storage),n=[];for(let t=0;t<i.elements.length;t++){const e=i.elements[t];n.push({semantic:e.name,type:e.dataType,components:e.numComponents,normalize:e.normalize})}n.push(this.getDescriptionForSemantics(t));const r=new h(UnityEngine.Graphics.graphicsDevice,n),a=new Float32Array(r.size/4*e.numVertices);for(let t=0;t<e.numVertices;t++)for(let e=0;e<i.size/4;e++)a[t*r.size/4+e]=s[t*i.size/4+e];e.invalidateBuffer();const o=e.numVertices*e.format.size;e.device._vram.vb+=o-e.numBytes,e.format=r,e.numBytes=o,e.storage=a.buffer}disableSemantic(t){const e=this.vertexBuffer;if(!e)return;const i=e.format;if(i.getStructureFor(t).offset<0)return;const s=new Float32Array(e.storage),n=[];for(let e=0;e<i.elements.length;e++){const s=i.elements[e];s.name!==t&&n.push({semantic:s.name,type:s.dataType,components:s.numComponents,normalize:s.normalize})}const r=new h(UnityEngine.Graphics.graphicsDevice,n),a=new Float32Array(r.size/4*e.numVertices);let o=0;for(let t=0;t<e.numVertices;t++)a[o++]=s[t];e.invalidateBuffer();const c=e.numVertices*e.format.size;e.device._vram.vb+=c-e.numBytes,e.format=r,e.numBytes=c,e.storage=a.buffer}recalculateBounds(){const t=new s.i,e=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_POSITION,!0);if(e.offset<0)return void this._aabb.setMinMax(s.i.ZERO,s.i.ZERO);const i=new Float32Array(this.vertexBuffer.lock());this._aabb.setToInfinity();for(let n=0;n<this.subMeshes.length;n++){const r=new s.i(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),a=new s.i(-Number.MAX_SAFE_INTEGER,-Number.MAX_SAFE_INTEGER,-Number.MAX_SAFE_INTEGER),o=this.subMeshes[n],h=new Uint16Array(o.indexBuffer[0].storage);for(let s=0;s<h.length;s++){const n=h[s]*e.stride+e.offset;t.set(i[n+0],i[n+1],i[n+2]),r.x=r.x>t.x?t.x:r.x,r.y=r.y>t.y?t.y:r.y,r.z=r.z>t.z?t.z:r.z,a.x=a.x<t.x?t.x:a.x,a.y=a.y<t.y?t.y:a.y,a.z=a.z<t.z?t.z:a.z}h.length>0?o._aabb.setMinMax(r,a):o._aabb.setToInfinity(),h.length>0&&(this._aabb.expandToPoint(r),this._aabb.expandToPoint(a))}}getVertexArrayObject(){if(this.vao)return this.vao;const t=UnityEngine.Graphics.graphicsDevice;this.vao=t.gl.createVertexArray(),t.gl.bindVertexArray(this.vao),this.vertexBuffer.unlock(),this.indexBuffer[0].unlock();const e=this.vertexBuffer.format;for(let e=0;e<16;e++)t.gl.disableVertexAttribArray(e);t.gl.vertexAttrib4fv(n.c.ShaderAttributeSlots.POSITION,p),t.gl.vertexAttrib4fv(n.c.ShaderAttributeSlots.COLOR,d),t.gl.vertexAttrib4fv(n.c.ShaderAttributeSlots.TANGENT,m),t.gl.vertexAttrib4fv(n.c.ShaderAttributeSlots.NORMAL,f),t.gl.vertexAttrib4fv(n.c.ShaderAttributeSlots.TEXCOORD0,_);for(let i=0;i<e.elements.length;i++){const s=e.elements[i],r=n.c.ShaderAttributeSlots[s.name];t.gl.enableVertexAttribArray(r),t.gl.vertexAttribPointer(r,s.numComponents,t.glType[s.dataType],s.normalize,s.stride,s.offset)}return t.gl.bindVertexArray(null),this.vao}setSubMeshCount(t){for(let e=t;e<this.subMeshes.length;e++)this.subMeshes[e]._refCount=-1/0;this.subMeshes.length=t;for(let e=0;e<t;e++)this.subMeshes[e]||(this.subMeshes[e]=new C(!0),this.subMeshes[e].vertexBuffer=this.vertexBuffer,this.subMeshes[e].indexBuffer=[new l(UnityEngine.Graphics.graphicsDevice,n.c.INDEXFORMAT_UINT16,0,n.c.BUFFER_STATIC)]);this.version++}recalculateNormals(){this.enableSemantic(n.c.SEMANTIC_NORMAL);const t=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_POSITION,!0),e=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_NORMAL,!0),i=new Float32Array(this.vertexBuffer.lock()),r=new s.i,a=new s.i,o=new s.i;let h=-1;for(let s=0;s<this.subMeshes.length;s++){if(this.getTopology(s)!==UnityEngine.MeshTopology.Triangles)throw new Error("Cannot recalculate normals for non-triangle mesh");const n=this.subMeshes[s],c=new Uint16Array(n.indexBuffer[0].storage);for(let s=0;s<c.length;s+=3)h=c[s+0]*t.stride+t.offset,r.set(i[h+0],i[h+1],i[h+2]),h=c[s+1]*t.stride+t.offset,a.set(i[h+0],i[h+1],i[h+2]),h=c[s+2]*t.stride+t.offset,o.set(i[h+0],i[h+1],i[h+2]),a.sub(o),r.sub(o),o.cross(r,a),h=c[s+0]*e.stride+e.offset,i[h+0]=o.x,i[h+1]=o.y,i[h+2]=o.z,h=c[s+1]*e.stride+e.offset,i[h+0]=o.x,i[h+1]=o.y,i[h+2]=o.z,h=c[s+2]*e.stride+e.offset,i[h+0]=o.x,i[h+1]=o.y,i[h+2]=o.z}this.vertexBuffer.unlock()}recalculateTangents(){const t=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_TEXCOORD0,!0);if(t.offset<0)return;this.enableSemantic(n.c.SEMANTIC_TANGENT);const e=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_POSITION,!0),i=this.vertexBuffer.format.getStructureFor(n.c.SEMANTIC_TANGENT,!0),r=new Float32Array(this.vertexBuffer.lock()),a=new s.i,o=new s.i,h=new s.i,c=new s.h,l=new s.h,u=new s.h,d=new s.i;let _=-1;for(let s=0;s<this.subMeshes.length;s++){if(this.getTopology(s)!==UnityEngine.MeshTopology.Triangles)throw new Error("Cannot recalculate tangents for non-triangle mesh");const n=this.subMeshes[s],p=new Uint16Array(n.indexBuffer[0].storage);for(let s=0;s<p.length;s+=3){_=p[s+0]*e.stride+e.offset,a.set(r[_+0],r[_+1],r[_+2]),_=p[s+1]*e.stride+e.offset,o.set(r[_+0],r[_+1],r[_+2]),_=p[s+2]*e.stride+e.offset,h.set(r[_+0],r[_+1],r[_+2]),_=p[s+0]*t.stride+t.offset,c.set(r[_+0],r[_+1]),_=p[s+1]*t.stride+t.offset,l.set(r[_+0],r[_+1]),_=p[s+2]*t.stride+t.offset,u.set(r[_+0],r[_+1]);const n=l.x-c.x,m=u.x-c.x,f=l.x-u.x,g=l.y-c.y,y=u.y-c.y,E=l.y-u.y,A=Math.abs(n)+Math.abs(g),T=Math.abs(m)+Math.abs(y),C=Math.abs(f)+Math.abs(E);A>T?A>C?(d.sub2(o,a),d.x*=n>0?1:-1,d.y*=g>0?1:-1):(d.sub2(h,o),d.x*=f>0?1:-1,d.y*=E>0?1:-1):T>C?(d.sub2(h,a),d.x*=m>0?1:-1,d.y*=y>0?1:-1):(d.sub2(h,o),d.x*=f>0?1:-1,d.y*=E>0?1:-1),_=p[s+0]*i.stride+i.offset,r[_+0]=d.x,r[_+1]=d.y,r[_+2]=d.z,r[_+3]=1,_=p[s+1]*i.stride+i.offset,r[_+0]=d.x,r[_+1]=d.y,r[_+2]=d.z,r[_+3]=1,_=p[s+2]*i.stride+i.offset,r[_+0]=d.x,r[_+1]=d.y,r[_+2]=d.z,r[_+3]=1}}this.vertexBuffer.unlock()}getVertexCount(){return this.vertexBuffer?this.vertexBuffer.numVertices:0}getTopology(t){const e=this.subMeshes[t];switch(e.primitive[0].type){case n.c.PRIMITIVE_TRIANGLES:return UnityEngine.MeshTopology.Triangles;case n.c.PRIMITIVE_LINES:return UnityEngine.MeshTopology.Lines;case n.c.PRIMITIVE_LINESTRIP:return UnityEngine.MeshTopology.LineStrip;case n.c.PRIMITIVE_POINTS:return UnityEngine.MeshTopology.Points}throw new Error("Mesh's topology is set to "+e.primitive[0].type+", which is not supported by Unity API")}configureIndexBufferAsTriangleStrip(t,e){this.primitive[t].type=n.c.PRIMITIVE_TRISTRIP,this.primitive[t].base=0,this.primitive[t].count=e,this.primitive[t].indexed=!0}configureIndexBufferAsTriangles(t,e){this.primitive[t].type=n.c.PRIMITIVE_TRIANGLES,this.primitive[t].base=0,this.primitive[t].count=e,this.primitive[t].indexed=!0}clone(){const t=new C;t.name=this.name+" Instance",t.aabb.copy(this.aabb);const e=n.c.ShaderAttributeSlots,i=[...E],s=this.vertexBuffer.format.elements;for(let t=0;t<s.length;t++)i[e[s[t].name]]=!0;const r=t.defaultVertexBuffer(i,this.getVertexCount(),this.vertexBuffer.storage.slice(0,this.vertexBuffer.storage.byteLength));t.vertexBuffer=r,t.subMeshes=[];for(let e=0;e<this.subMeshes.length;e++){const i=this.subMeshes[e],s=i.indexBuffer[0],a=s.storage.slice(0,s.storage.byteLength),o=new Uint16Array(a),h=new C(!0);h.aabb.copy(i.aabb);const c=t.defaultIndexBuffer(o.length,o.buffer);h.vertexBuffer=r,h.indexBuffer[0]=c,h.primitive[0].type=n.c.PRIMITIVE_TRIANGLES,h.primitive[0].base=0,h.primitive[0].count=o.length,h.primitive[0].indexed=!0,t.subMeshes.push(h)}t.indexBuffer=t.subMeshes[0].indexBuffer,t.primitive[0].type=n.c.PRIMITIVE_TRIANGLES,t.primitive[0].base=0,t.primitive[0].count=t.indexBuffer[0].numIndices,t.primitive[0].indexed=!0;for(let e=0;e<this.bindposes.length;e++)t.bindposes.push(this.bindposes[e].clone());return t}get aabb(){return this.morph?this.morph.aabb:this._aabb}set aabb(t){this.morph?(this._aabb=this.morph._baseAabb=t,this.morph._calculateAabb()):this._aabb=t,this.version++}}C.id=0;class b extends a{constructor(t,e,i){super(),this._key=[0,0],this.id=C.id++,this.isStatic=!1,this.node=t,this._mesh=e,e._refCount++,e.meshInstance=this,this._material=i,this._element=null,this._nearestScreen=null,this._shaderDefs=0,this._shaderDefs|=e.vertexBuffer.format.hasUv0?n.c.SHADERDEF_UV0:0,this._shaderDefs|=e.vertexBuffer.format.hasUv1?n.c.SHADERDEF_UV1:0,this._shaderDefs|=e.vertexBuffer.format.hasColor?n.c.SHADERDEF_VCOLOR:0,this._shaderDefs|=e.vertexBuffer.format.hasTangents?n.c.SHADERDEF_TANGENTS:0,this._lightHash=0,this.visible=!0,this._receiveShadow=!0,this._flipFaces=!1,this.cull=!0,this.pick=!0,this.drawOrder=0,this.sortingLayerIndex=0,this.sortingOrder=0,this.zdist=0,this.mask=0,this.constAttributes={},this._worldAabbOverride=null,this.updateKey(),this._skinInstance=null,this._morphInstance=null,this.instancingData=null,this._aabb=new s.a,this._boneAabb=null,this._aabbVer=-1,this.drawOrder=0,this.visibleThisFrame=!1,this._lightProbe=null,this.stencilFront=null,this.stencilBack=null,this.lightmapIndex=-1,this.lightmapSceneIndex=-1,this.isCanvas=!1,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"MeshInstance")}updateKey(){const t=this.material,e=2e7-1e3*((t?t.renderQueue:null)||2e3)+(t?t.id:0);this._key[n.c.SORTKEY_FORWARD]=function(t,e){return(t?1:0)<<26|(33554431&e)<<0}(!1,e)}configureLightmap(){const t=UnityEngine.LightmapSettings.manager.getLightmap(this.lightmapSceneIndex,this.lightmapIndex);t&&t.lightmapColor?this.setParameter("unity_Lightmap",t.lightmapColor.handle):this.setParameter("unity_Lightmap",null),(this._shaderDefs&n.c.SHADERDEF_DIRLM)>0&&(t&&t.lightmapDirection?this.setParameter("unity_LightmapInd",t.lightmapDirection.handle):this.setParameter("unity_LightmapInd",null))}get mesh(){return this._mesh}set mesh(t){this._mesh&&this._mesh._refCount--,this._mesh=t,t&&t._refCount++}get aabb(){if(this.worldAabbOverride)return this.worldAabbOverride;let t;if(this.skinInstance){const e=this.mesh.skin.boneNames.length+5;let i,r;if(!this.mesh.boneAabb){this.mesh.boneAabb=[],this.mesh.boneUsed=[];const a=this.mesh.vertexBuffer.format.elements,o=this.mesh.vertexBuffer.numVertices,h=this.mesh.vertexBuffer.format.size;let c,l,u,d,_,p,m;for(r=0;r<a.length;r++)a[r].name===n.c.SEMANTIC_POSITION?l=a[r].offset:a[r].name===n.c.SEMANTIC_BLENDINDICES?u=a[r].offset:a[r].name===n.c.SEMANTIC_BLENDWEIGHT&&(d=a[r].offset);const f=new Float32Array(this.mesh.vertexBuffer.storage),g=new Float32Array(this.mesh.vertexBuffer.storage),y=l/4,E=d/4,A=u/4,T=h/4;let C,b,S,x,D;const M=[],R=[];for(i=this.mesh.boneUsed,r=0;r<e;r++)M[r]=new s.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),R[r]=new s.i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(_=0;_<o;_++)for(p=0;p<4;p++)g[_*T+E+p]>0&&(c=f[_*T+A+p],S=g[_*T+y],x=g[_*T+y+1],D=g[_*T+y+2],C=R[c],b=M[c],b.x>S&&(b.x=S),b.y>x&&(b.y=x),b.z>D&&(b.z=D),C.x<S&&(C.x=S),C.y<x&&(C.y=x),C.z<D&&(C.z=D),i[c]=!0);if(this.morphInstance){let t;const e=this.morphInstance.morph._targets,i=new Float32Array(3*o),s=new Float32Array(3*o);let n,r,a,h,c,l,u;for(_=0;_<o;_++)i[3*_]=s[3*_]=g[_*T+y],i[3*_+1]=s[3*_+1]=g[_*T+y+1],i[3*_+2]=s[3*_+2]=g[_*T+y+2];for(m=0;m<e.length;m++){h=e[m];for(let e=0;e<h.frames.length;e++)for(c=h.frames[e].indices,l=c.length,u=h.frames[e].deltaPositions,p=0;p<l;p++)t=c[p],n=u[3*p],r=u[3*p+1],a=u[3*p+2],n<0?i[3*t]+=n:s[3*t]+=n,r<0?i[3*t+1]+=r:s[3*t+1]+=r,a<0?i[3*t+2]+=a:s[3*t+2]+=a}}for(r=0;r<e;r++)t=new s.a,t.setMinMax(M[r],R[r]),this.mesh.boneAabb.push(t)}if(!this._boneAabb)for(this._boneAabb=[],r=0;r<this.mesh.boneAabb.length;r++)this._boneAabb[r]=new s.a;for(i=this.mesh.boneUsed,r=0;r<this.mesh.boneAabb.length;r++)i[r]&&this._boneAabb[r].setFromTransformedAabb(this.mesh.boneAabb[r],this.skinInstance.matrices[r]);const a=this.skinInstance.skin.rootBone?this.skinInstance.skin.rootBone.getWorldTransform():this.node.getWorldTransform();let o=!0;for(r=0;r<this.mesh.boneAabb.length;r++)i[r]&&(o?(g.center.copy(this._boneAabb[r].center),g.halfExtents.copy(this._boneAabb[r].halfExtents),o=!1):g.add(this._boneAabb[r]));this._aabb.setFromTransformedAabb(g,a)}else if(this.node._aabbVer!==this._aabbVer){t=this.mesh?this.mesh.aabb:this._aabb,this.mesh||t.setToInfinity();const e=this.parameters.localToWorldMatrix?y.set(this.parameters.localToWorldMatrix.data):this.node.getWorldTransform();this._aabb.setFromTransformedAabb(t,e),this._aabbVer=this.node._aabbVer}return this._aabb}set aabb(t){this._aabb=t}get worldAabbOverride(){return this._worldAabbOverride}set worldAabbOverride(t){this._worldAabbOverride=t}get material(){return this._material}set material(t){this._material=t}get skinInstance(){return this._skinInstance}set skinInstance(t){this._skinInstance=t,this._shaderDefs=t?this._shaderDefs|n.c.SHADERDEF_SKIN:this._shaderDefs&~n.c.SHADERDEF_SKIN}get morphInstance(){return this._morphInstance}set morphInstance(t){this._morphInstance=t}get key(){return this._key[n.c.SORTKEY_FORWARD]}set key(t){this._key[n.c.SORTKEY_FORWARD]=t}get renderQueue(){return this.material?this.material.renderQueue:2e3}get isIndexBufferEmpty(){return!1}}const S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];S[n.c.PIXELFORMAT_A8]=1,S[n.c.PIXELFORMAT_L8]=1,S[n.c.PIXELFORMAT_L8_A8]=1,S[n.c.PIXELFORMAT_R5_G6_B5]=2,S[n.c.PIXELFORMAT_R5_G5_B5_A1]=2,S[n.c.PIXELFORMAT_R4_G4_B4_A4]=2,S[n.c.PIXELFORMAT_R8_G8_B8]=4,S[n.c.PIXELFORMAT_R8_G8_B8_A8]=4,S[n.c.PIXELFORMAT_RGB16F]=8,S[n.c.PIXELFORMAT_RGBA16F]=8,S[n.c.PIXELFORMAT_RGB32F]=16,S[n.c.PIXELFORMAT_RGBA32F]=16,S[n.c.PIXELFORMAT_R32F]=4,S[n.c.PIXELFORMAT_DEPTH]=4,S[n.c.PIXELFORMAT_DEPTHSTENCIL]=4,S[n.c.PIXELFORMAT_111110F]=4,S[n.c.PIXELFORMAT_SRGB]=4,S[n.c.PIXELFORMAT_SRGBA]=4;class x{constructor(t,e){if(this.device=t,this.$id="",this.name=null,this._width=4,this._height=4,this._depth=1,this._pot=!0,this._format=n.c.PIXELFORMAT_R8_G8_B8_A8,this.rgbm=!1,this.intensity=1,this._cubemap=!1,this._volume=!1,this.fixCubemapSeams=!1,this._flipY=!0,this._premultiplyAlpha=!1,this._mipmaps=!0,this._minFilter=n.c.FILTER_LINEAR_MIPMAP_NEAREST,this._magFilter=n.c.FILTER_LINEAR,this._anisotropy=1,this._addressU=n.c.ADDRESS_CLAMP_TO_EDGE,this._addressV=n.c.ADDRESS_CLAMP_TO_EDGE,this._addressW=n.c.ADDRESS_CLAMP_TO_EDGE,this._glTexture=null,this._glTarget=0,this._glInternalFormat=0,this._glFormat=0,this._glPixelType=0,this._compareOnRead=!1,this._compareFunc=n.c.FUNC_LESS,this._levels=null,this._atlas=null,this._rects=null,this._buffer=null,this._levelsUpdated=null,this._needsUpload=!1,this._needsMipmapsUpload=!1,this._mipmapsUploaded=!1,this._parameterFlags=0,void 0!==e&&(this.name=e.name||null,this._width=void 0!==e.width?e.width:this._width,this._height=void 0!==e.height?e.height:this._height,this._pot=(0,s.n)(this._width)&&(0,s.n)(this._height),this._format=void 0!==e.format?e.format:this._format,this.rgbm=void 0!==e.rgbm?e.rgbm:this.rgbm,void 0!==e.mipmaps?this._mipmaps=e.mipmaps:this._mipmaps=void 0!==e.autoMipmap?e.autoMipmap:this._mipmaps,this._levels=e.levels||null,this._atlas=e.atlas||null,this._rects=e.rects||null,this._cubemap=void 0!==e.cubemap?e.cubemap:this._cubemap,this.fixCubemapSeams=void 0!==e.fixCubemapSeams?e.fixCubemapSeams:this.fixCubemapSeams,this._minFilter=void 0!==e.minFilter?e.minFilter:this._minFilter,this._magFilter=void 0!==e.magFilter?e.magFilter:this._magFilter,this._anisotropy=void 0!==e.anisotropy?e.anisotropy:this._anisotropy,this._addressU=void 0!==e.addressU?e.addressU:this._addressU,this._addressV=void 0!==e.addressV?e.addressV:this._addressV,this._compareOnRead=void 0!==e.compareOnRead?e.compareOnRead:this._compareOnRead,this._flipY=void 0!==e.flipY?e.flipY:this._flipY,this._premultiplyAlpha=void 0!==e.premultiplyAlpha?e.premultiplyAlpha:this._premultiplyAlpha,t.webgl2&&(this._depth=void 0!==e.depth?e.depth:this._depth,this._volume=void 0!==e.volume?e.volume:this._volume)),this._compressed=this._format===n.c.PIXELFORMAT_DXT1||this._format===n.c.PIXELFORMAT_DXT3||this._format===n.c.PIXELFORMAT_DXT5||this._format>=n.c.PIXELFORMAT_ETC1,this._invalid=!1,this._lockedLevel=-1,!this._levels)if(this._cubemap)this._levels=[[null,null,null,null,null,null]];else{const t=this.createBuffer(this._format,this._width,this._height);this._levels=[t]}this.dirtyAll(),this._gpuSize=0,this._needsUpdate=!1,this["__UnityEngine.Texture"]=null,this["__UnityEngine.Texture2D"]=null,this["__UnityEngine.Cubemap"]=null,this["__UnityEngine.RenderTexture"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,this instanceof pc.VideoTexture?"VideoTexture":"Texture")}destroy(){this.device&&this.device.destroyTexture(this),this.device=null,this._levels=null}dirtyAll(){this._levelsUpdated=this._cubemap?[[!0,!0,!0,!0,!0,!0]]:[!0],this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps,this._mipmapsUploaded=!1,this._parameterFlags=255}lock(t={level:0,face:0,mode:n.c.TEXTURELOCK_WRITE}){if(void 0===t.level&&(t.level=0),void 0===t.face&&(t.face=0),void 0===t.mode&&(t.mode=n.c.TEXTURELOCK_WRITE),this._lockedLevel=t.level,null===this._levels[t.level])switch(this._format){case n.c.PIXELFORMAT_A8:case n.c.PIXELFORMAT_L8:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth);break;case n.c.PIXELFORMAT_L8_A8:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*2);break;case n.c.PIXELFORMAT_R5_G6_B5:case n.c.PIXELFORMAT_R5_G5_B5_A1:case n.c.PIXELFORMAT_R4_G4_B4_A4:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth);break;case n.c.PIXELFORMAT_R8_G8_B8:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*3);break;case n.c.PIXELFORMAT_R8_G8_B8_A8:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*4);break;case n.c.PIXELFORMAT_DXT1:this._levels[t.level]=new Uint8Array(Math.floor((this._width+3)/4)*Math.floor((this._height+3)/4)*8*this._depth);break;case n.c.PIXELFORMAT_DXT3:case n.c.PIXELFORMAT_DXT5:this._levels[t.level]=new Uint8Array(Math.floor((this._width+3)/4)*Math.floor((this._height+3)/4)*16*this._depth);break;case n.c.PIXELFORMAT_RGB16F:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth*3);break;case n.c.PIXELFORMAT_RGB32F:this._levels[t.level]=new Float32Array(this._width*this._height*this._depth*3);break;case n.c.PIXELFORMAT_RGBA16F:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth*4);break;case n.c.PIXELFORMAT_RGBA32F:this._levels[t.level]=new Float32Array(this._width*this._height*this._depth*4)}return this._levels[t.level]}setSource(t){let e=!1,i=0,n=0;if(this._cubemap){if(Array.isArray(t)){i=t[0].width||0,n=t[0].height||0;for(let s=0;s<6;s++)if(!(t[s]&&t[s].width===i&&t[s].height===n&&(t[s]instanceof HTMLImageElement||t[s]instanceof HTMLCanvasElement||t[s]instanceof HTMLVideoElement))){e=!0;break}}else e=!0;if(!e)for(let e=0;e<6;e++)this._levels[0][e]!==t[e]&&(this._levelsUpdated[0][e]=!0)}else t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||(e=!0),e||(t!==this._levels[0]&&(this._levelsUpdated[0]=!0),i=t.width,n=t.height);if(e)if(this._width=4,this._height=4,this._pot=!0,this._cubemap)for(let t=0;t<6;t++)this._levels[0][t]=null,this._levelsUpdated[0][t]=!0;else this._levels[0]=null,this._levelsUpdated[0]=!0;else this._width=i,this._height=n,this._pot=(0,s.n)(this._width)&&(0,s.n)(this._height),this._levels[0]=t;this._invalid===e&&e||(this._invalid=e,this.upload())}unlock(){DEBUG&&-1===this._lockedLevel&&console.log("pc.Texture#unlock: Attempting to unlock a texture that is not locked."),this.upload(),this._lockedLevel=-1}upload(){this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps}clone(){const t={name:this.name,width:this._width,height:this._height,addressU:this._addressU,addressV:this._addressV,mipmaps:this._mipmaps,minFilter:this._minFilter,magFilter:this._magFilter,autoMipmap:this._mipmaps,rgbm:this.rgbm,anisotropy:this._anisotropy,format:this._format},e=new x(this.device,t);return e.setSource(this._levels[0]),e}createBuffer(t,e,i){switch(t){case n.c.PIXELFORMAT_R8_G8_B8:return new Uint8Array(3*e*i);case n.c.PIXELFORMAT_R8_G8_B8_A8:return new Uint8Array(4*e*i);default:return null}}toBuffer(){const t=this.device.gl;this._glTexture||(this.device.setTexture(this,0),this.device.uploadTexture(this));const e=this._glTexture,i=this.width,s=this.height;(this._needsUpload||this._needsMipmapsUpload)&&this.device.uploadTexture(this);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);const r=new Uint8Array(i*s*4);return t.readPixels(0,0,i,s,t.RGBA,t.UNSIGNED_BYTE,r),t.deleteFramebuffer(n),r}sync(t){const e=this.device.gl,i=this._glTexture,s=this.width/(1<<t),n=this.height/(1<<t),r=this.device.activeFramebuffer,a=e.createFramebuffer();if(this.device.setFramebuffer(a),this._cubemap){this._levels=this._levels||[],this._levels[t]=this._levels[t]||[];for(let r=0;r<6;r++)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,i,t),this._levels[t][r]=new Uint8Array(s*n*4),e.readPixels(0,0,s,n,e.RGBA,e.UNSIGNED_BYTE,this._levels[t][r])}else e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,t),this._levels=this._levels||[],this._levels[t]=new Uint8Array(s*n*4),e.readPixels(0,0,s,n,e.RGBA,e.UNSIGNED_BYTE,this._levels[t]);this.device.setFramebuffer(r)}markUploaded(){this._needsUpdate||(this._needsUpload=!1)}handlePositionInRepeatMode(t,e){return t>e-1||t<0?Math.abs(t%e):t}handlePositionInClampMode(t,e){return t<0?0:t>e-1?e-1:t}getPixel(t,e){this.bufferCheck();let i=t,r=e;this._addressU===n.c.ADDRESS_REPEAT&&this._addressV===n.c.ADDRESS_REPEAT?(i=this.handlePositionInRepeatMode(t,this.width),r=this.handlePositionInRepeatMode(e,this.height)):this._addressU===n.c.ADDRESS_CLAMP_TO_EDGE&&this._addressV===n.c.ADDRESS_CLAMP_TO_EDGE&&(i=this.handlePositionInClampMode(t,this.width),r=this.handlePositionInClampMode(e,this.height));const a=r*this.width*4+4*i,o=this._buffer[a],h=this._buffer[a+1],c=this._buffer[a+2],l=this._buffer[a+3];return new s.b(o/255,h/255,c/255,l/255)}getPixels(t,e,i,n,r){this.bufferCheck();const a=[];let o=0;for(let r=e;r<e+n;r++)for(let e=t;e<t+i;e++){const t=r*this.width*4+4*e,i=this._buffer[t],n=this._buffer[t+1],h=this._buffer[t+2],c=this._buffer[t+3];a[o++]=new s.b(i/255,n/255,h/255,c/255)}return a}getPixels32(t){this.bufferCheck(t);const e=this.width,i=this.height,n=[];let r=0;for(let t=0;t<0+i;t++)for(let i=0;i<0+e;i++){const e=t*this.width*4+4*i,a=this._buffer[e],o=this._buffer[e+1],h=this._buffer[e+2],c=this._buffer[e+3];n[r++]=new s.b(a,o,h,c)}return n}setPixel(t,e,i){this.bufferCheck();let s=t,r=e;this._addressU===n.c.ADDRESS_REPEAT&&this._addressV===n.c.ADDRESS_REPEAT?(s=this.handlePositionInRepeatMode(t,this.width),r=this.handlePositionInRepeatMode(e,this.height)):this._addressU===n.c.ADDRESS_CLAMP_TO_EDGE&&this._addressV===n.c.ADDRESS_CLAMP_TO_EDGE&&(s=this.handlePositionInClampMode(t,this.width),r=this.handlePositionInClampMode(e,this.height));const a=r*this.width*4+4*s;this.fillBuffer(a,i),this._levels[0]=this._buffer,this._needsUpload=!0}setPixels(t,e,i,s,n,r){this.bufferCheck(r);let a=0;for(let r=i;r<i+n;r++)for(let i=e;i<e+s;i++,a++){const e=r*this.width*4+4*i;this.fillBuffer(e,t[a])}this._levels[0]=this._buffer,this._needsUpload=!0}setPixels32(t,e,i,s,n,r){if(this.bufferCheck(r),t||e||i||s){let r=0;for(let a=e;a<e+s;a++)for(let e=t;e<t+i;e++,r++){const t=a*this.width*4+4*e;this.fillBuffer32(t,n[r])}}else for(let t=0;t<n.length;t++){const e=4*t;this.fillBuffer32(e,n[t])}this._levels[0]=this._buffer,this._needsUpload=!0}bufferCheck(t=-1){null===this._buffer&&(this._buffer=this.toBuffer())}fillBuffer(t,e){this._buffer[t]=255*e.r,this._buffer[t+1]=255*e.g,this._buffer[t+2]=255*e.b,this._buffer[t+3]=255*e.a}fillBuffer32(t,e){this._buffer[t]=e.r,this._buffer[t+1]=e.g,this._buffer[t+2]=e.b,this._buffer[t+3]=e.a}setPixelData(t){this.device.setTexture(this,0),this._levels=[t],this.device.uploadTexture(this)}copyCubemap(t){t._glTexture||this.device.uploadTexture(t),this._glTexture=t._glTexture,this._glTarget=t._glTarget,this._glInternalFormat=t._glInternalFormat,this._glFormat=t._glFormat,this._glPixelType=t._glPixelType,this._parameterFlags=t._parameterFlags,this.rgbm=t.rgbm,this._width=t._width,this._height=t._height,this._needsUpload=!1,this._needsMipmapsUpload=!1}toDataURI(){const t=this.width,e=this.height,i=this.toBuffer(),s=document.createElement("canvas");s.width=t,s.height=e;const n=s.getContext("2d",{alpha:!0}),r=n.createImageData(t,e);return r.data.set(i),n.putImageData(r,0,0),n.scale(1,-1),n.translate(0,-r.height),n.drawImage(n.canvas,0,0),s.toDataURL()}get minFilter(){return this._minFilter}set minFilter(t){this._minFilter!==t&&(this._minFilter=t,this._parameterFlags|=1)}get magFilter(){return this._magFilter}set magFilter(t){this._magFilter!==t&&(this._magFilter=t,this._parameterFlags|=2)}get addressU(){return this._addressU}set addressU(t){this._addressU!==t&&(this._addressU=t,this._parameterFlags|=4)}get addressV(){return this._addressV}set addressV(t){this._addressV!==t&&(this._addressV=t,this._parameterFlags|=8)}get addressW(){return this._addressW}set addressW(t){this.device.webgl2&&(this._volume?t!==this._addressW&&(this._addressW=t,this._parameterFlags|=16):console.warn("pc.Texture#addressW: Can't set W addressing mode for a non-3D texture."))}get compareOnRead(){return this._compareOnRead}set compareOnRead(t){this._compareOnRead!==t&&(this._compareOnRead=t,this._parameterFlags|=32)}get compareFunc(){return this._compareFunc}set compareFunc(t){this._compareFunc!==t&&(this._compareFunc=t,this._parameterFlags|=64)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy!==t&&(this._anisotropy=t,this._parameterFlags|=128)}get autoMipmap(){return this._mipmaps}set autoMipmap(t){this._mipmaps=t}get mipmaps(){return this._mipmaps}set mipmaps(t){this._mipmaps!==t&&(this._mipmaps=t,this._minFilterDirty=!0,t&&(this._needsMipmapsUpload=!0))}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get depth(){return this._depth}set depth(t){this._depth=t}get format(){return this._format}get cubemap(){return this._cubemap}get gpuSize(){let t=1;!this._pot||!this._mipmaps&&this._minFilter!==n.c.FILTER_NEAREST_MIPMAP_NEAREST&&this._minFilter!==n.c.FILTER_NEAREST_MIPMAP_LINEAR&&this._minFilter!==n.c.FILTER_LINEAR_MIPMAP_NEAREST&&this._minFilter!==n.c.FILTER_LINEAR_MIPMAP_LINEAR||this._compressed&&1===this._levels.length||(t=Math.round(Math.log2(Math.max(this._width,this._height))+1));let e=this._width,i=this._height,s=this._depth,r=0;for(let a=0;a<t;a++){if(this._compressed)if(this._format===n.c.PIXELFORMAT_ETC1)r+=Math.floor((e+3)/4)*Math.floor((i+3)/4)*8*s;else if(this._format===n.c.PIXELFORMAT_PVRTC_2BPP_RGB_1||this._format===n.c.PIXELFORMAT_PVRTC_2BPP_RGBA_1)r+=Math.max(e,16)*Math.max(i,8)/(4*s);else if(this._format===n.c.PIXELFORMAT_PVRTC_4BPP_RGB_1||this._format===n.c.PIXELFORMAT_PVRTC_4BPP_RGBA_1)r+=Math.max(e,8)*Math.max(i,8)/(2*s);else{const t=4,a=4,o=this._format===n.c.PIXELFORMAT_DXT1?8:16;r+=Math.floor((e+t-1)/t)*Math.floor((i+a-1)/a)*o*s}else r+=e*i*s*S[this._format];e=Math.max(.5*e,1),i=Math.max(.5*i,1),s=Math.max(.5*s,1)}return this._cubemap&&(r*=6),r}get volume(){return this._volume}get flipY(){return this._flipY}set flipY(t){this._flipY!==t&&(this._flipY=t,this._needsUpload=!0)}get premultiplyAlpha(){return this._premultiplyAlpha}set premultiplyAlpha(t){this._premultiplyAlpha!==t&&(this._premultiplyAlpha=t,this._needsUpload=!0)}}const D=new s.e;class M{constructor(t){this.skin=t,this._dirty=!0,this.bones=[];const e=t.inverseBindPose.length,i=t.device;if(i.supportsBoneTextures){let t;t=e>256?64:e>64?32:e>16?16:8,this.boneTexture=new x(i,{width:t,height:t,format:n.c.PIXELFORMAT_RGBA32F,mipmaps:!1,minFilter:n.c.FILTER_NEAREST,magFilter:n.c.FILTER_NEAREST}),this.matrixPalette=this.boneTexture.lock()}else this.matrixPalette=new Float32Array(16*e);this.matrices=[],this.bonesAabbVersions=[];for(let t=0;t<e;t++)this.matrices[t]=new s.e,this.bonesAabbVersions[t]=-1}updateMatrices(t){D.copy(t.getWorldTransform()).invert();for(let t=this.bones.length-1;t>=0;t--)null!==this.bones[t]&&(this.matrices[t].mul2(D,this.bones[t].getWorldTransform()),this.matrices[t].mul2(this.matrices[t],this.skin.inverseBindPose[t]))}updateMatrixPalette(){const t=this.matrixPalette;for(let e=this.bones.length-1;e>=0;e--){const i=this.matrices[e].data,s=16*e;t[s]=i[0],t[s+1]=i[1],t[s+2]=i[2],t[s+3]=i[3],t[s+4]=i[4],t[s+5]=i[5],t[s+6]=i[6],t[s+7]=i[7],t[s+8]=i[8],t[s+9]=i[9],t[s+10]=i[10],t[s+11]=i[11],t[s+12]=i[12],t[s+13]=i[13],t[s+14]=i[14],t[s+15]=i[15]}this.skin.device.supportsBoneTextures&&(this.boneTexture.lock(),this.boneTexture.unlock())}}class R{constructor(){this.meshInstances=[],this.morphInstance=null,this._materials=[],this._mesh=null,this._skin=null,this._bones=null,this._sortingLayerIndex=0,this._sortingOrder=0,this._cullingLayer=0,this._entity=null,this.entity=null,this._lightmapIndex=-1,this._lightmapSceneIndex=0,this._lightmapScaleOffset=new s.j,this._drawOrder=0,this._nearestScreen=null,this._stencil=null,this._element=null,this._visible=!0,this._parameters={},this._constAttributes={},this._isStatic=!1,this._needsUpdate=!0,this._masksChildren=!1,this._reflectionProbes=null,this._blendReflectionProbes=!1,this._lightProbe=null,this._lightProbeUsage=!1,this._flipFaces=!1,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Model")}setParameter(t,e){this._parameters[t]=e,this._needsUpdate||this._updateParameters()}deleteParameter(t){delete this._parameters[t],this._needsUpdate||this._updateParameters()}setConstant(t,e){this._constAttributes[t]=e,this._needsUpdate||this._updateConstants()}deleteConstant(t){delete this._constAttributes[t],this._needsUpdate||this._updateConstants()}update(){this._needsUpdate&&(this._needsUpdate=!1,this._configureMeshInstances())}setMeshDirectlyToMeshInstance(t){if(0===this.meshInstances.length)this.mesh!==t&&(this.mesh=t);else{const e=this.meshInstances[0];e.mesh!==t&&(e.mesh=t)}}setBlendShapeWeight(t,e){this.morphInstance?this.morphInstance.setWeight(t,e):console.error("SetBlendShapeWeight called for non blendable mesh.")}_configureMeshInstances(){if(!this._mesh)return void(this.meshInstances.length=0);if(!this._materials)return void console.log("Missing materials on "+this.entity.name);const t=this._mesh.subMeshes.length,e=this._materials.length;let i=0,s=!1;i=1===t?Math.max(1,e):t,this.meshInstances.length=i;for(let t=0;t<this.meshInstances.length;t++){const e=this._materials[Math.min(this._materials.length-1,t)],i=this._mesh.subMeshes[Math.min(this._mesh.subMeshes.length-1,t)];if(this.meshInstances[t]){const n=this.meshInstances[t].mesh!==i;s=s||n||this.meshInstances[t].material!==e,this.meshInstances[t].mesh=i,this.meshInstances[t].material=e,n&&(this.meshInstances[t]._aabbVer=-1)}else this.meshInstances[t]=new b(this.entity,i,e),s=!0,this.morphInstance&&(this.meshInstances[t].morphInstance=this.morphInstance)}this.entity&&(this.skin&&this.skin.rootBone?this._flipFaces=this.skin.rootBone._isOddlyScaled():this._flipFaces=this.entity._isOddlyScaled()),this._updateParameters(),this._updateConstants(),this._updateSkin(),this._updateFlipFaces(),this._updateSortingIndexes(),this._updateCulling(),this._updateEntity(),this._configureLightmaps(),this._updateLightProbe(),this._updateReflectionProbes(),this._updateReflectionProbesBlending(),this._updateVisibility(),this._updateElement(),this._updateNearestScreen(),this._updateDrawOrder(),this._updateStencil(),this._updateMasksChildren()}_configureLightmaps(){if(!this._mesh)return;let t=0;this._mesh.vertexBuffer.format.hasUv1||(t|=n.c.SHADERDEF_LMUV0),1===UnityEngine.LightmapSettings.environmentLightingMode&&(t|=n.c.SHADERDEF_LM_BAKED_AMBIENT),UnityEngine.LightmapSettings.lightmapsMode===UnityEngine.LightmapsMode.CombinedDirectional&&(t|=n.c.SHADERDEF_DIRLM);for(let e=0;e<this.meshInstances.length;e++){const i=this.meshInstances[e];!this._lightmapScaleOffset||this._lightmapIndex<0?(i._shaderDefs&=~(n.c.SHADERDEF_LM|n.c.SHADERDEF_DIRLM|n.c.SHADERDEF_LMUV0|n.c.SHADERDEF_LM_DLDR),i.deleteParameter("unity_Lightmap"),i.deleteParameter("unity_LightmapInd"),i.deleteParameter("unity_LightmapST")):(i._shaderDefs|=t|n.c.SHADERDEF_LM,i.setParameter("unity_LightmapST",[this._lightmapScaleOffset.x,this._lightmapScaleOffset.y,this._lightmapScaleOffset.z,this._lightmapScaleOffset.w]),i.lightmapIndex=this._lightmapIndex,i.lightmapSceneIndex=this._lightmapSceneIndex)}}_updateParameters(){const t=Object.keys(this._parameters);for(let e=0;e<this.meshInstances.length;e++){const i=this.meshInstances[e];i.parameters={};for(let e=0;e<t.length;e++)i.setParameter(t[e],this._parameters[t[e]])}}_updateConstants(){const t=Object.keys(this._constAttributes);for(let e=0;e<this.meshInstances.length;e++){const i=this.meshInstances[e];i.constAttributes={};for(let e=0;e<t.length;e++)i.constAttributes[t[e]]=this._constAttributes[t[e]]}}_updateSkin(){if(!this._skin)return;const t=new M(this._skin);t.bones=this._bones;for(let e=0;e<this.meshInstances.length;e++)this.meshInstances[e].mesh.skin=this._skin,this.meshInstances[e].skinInstance=t}_updateSortingIndexes(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].sortingLayerIndex=this._sortingLayerIndex,this.meshInstances[t].sortingOrder=this._sortingOrder}_updateFlipFaces(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t]._flipFaces=this._flipFaces}_updateReflectionProbes(){const t=this._reflectionProbes?this._reflectionProbes[0]:null,e=this._reflectionProbes?this._reflectionProbes[1]:null,i=pc.reflectionProbeUniforms;for(let s=0;s<this.meshInstances.length;s++){const n=this.meshInstances[s];if(null!=t){const e=t.getBox(n.aabb);n.setParameter(i[0],t.cubemap),n.setParameter(i[1],e.min.data),n.setParameter(i[2],e.max.data),n.setParameter(i[3],e.position.data)}else n.deleteParameter(i[0]),n.deleteParameter(i[1]),n.deleteParameter(i[2]),n.deleteParameter(i[3]);if(null!=e){const t=e.getBox(n.aabb);n.setParameter(i[4],e.cubemap),n.setParameter(i[5],t.min.data),n.setParameter(i[6],t.max.data),n.setParameter(i[7],t.position.data)}else n.deleteParameter(i[4]),n.deleteParameter(i[5]),n.deleteParameter(i[6]),n.deleteParameter(i[7])}}_updateReflectionProbesBlending(){for(let t=0;t<this.meshInstances.length;t++){const e=this.meshInstances[t];this._blendReflectionProbes?e._shaderDefs|=n.c.SHADERDEF_BLEND_REFLECTION_PROBES:e._shaderDefs&=~n.c.SHADERDEF_BLEND_REFLECTION_PROBES}}_updateLightProbe(){const t=(!this._lightmapScaleOffset||this._lightmapIndex<0)&&this.lightProbeUsage;for(let e=0;e<this.meshInstances.length;e++){const i=this.meshInstances[e];t?(i._shaderDefs|=n.c.SHADERDEF_LIGHTPROBES,i._lightProbe=this._lightProbe):(i._shaderDefs&=~n.c.SHADERDEF_LIGHTPROBES,i._lightProbe=null)}}_updateCulling(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].mask=1<<this._cullingLayer}_updateVisibility(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].visible=this._visible}_updateEntity(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].node=this.entity}_updateElement(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t]._element=this._element}_updateNearestScreen(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t]._nearestScreen=this._nearestScreen}_updateDrawOrder(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].drawOrder=this._drawOrder}_updateStencil(){for(let t=0;t<this.meshInstances.length;t++){const e=this.meshInstances[t];e.stencilBack=this._stencil,e.stencilFront=this._stencil,this._stencil?e._shaderDefs|=n.c.SHADERDEF_STENCIL_OVERRIDE:e._shaderDefs&=~n.c.SHADERDEF_STENCIL_OVERRIDE}}_updateMasksChildren(){for(let t=0;t<this.meshInstances.length;t++){const e=this.meshInstances[t];this._masksChildren?e._shaderDefs|=n.c.SHADERDEF_UI_MASK:e._shaderDefs&=~n.c.SHADERDEF_UI_MASK}}destroy(){const t=this.meshInstances;for(let e=0;e<t.length;e++){const i=t[e],s=i.mesh;if(s&&(s._refCount--,s._refCount<1)){s.vertexBuffer&&(s.vertexBuffer.destroy(),s.vertexBuffer=null);for(let t=0;t<s.indexBuffer.length;t++){const e=s.indexBuffer[t];e&&e.destroy()}s.indexBuffer.length=0}const n=i.skinInstance;if(n){const t=n.boneTexture;t&&t.destroy()}i.skinInstance=null;const r=i.morphInstance;r&&r.destroy(),i.morphInstance=null,i.material=null}}get visible(){return this._visible}set visible(t){this._visible=t,this._needsUpdate||this._updateVisibility()}get stencil(){return this._stencil}set stencil(t){this._stencil=t,this._needsUpdate||this._updateStencil()}get element(){return this._element}set element(t){this._element=t,this._needsUpdate||this._updateElement()}get nearestScreen(){return this._nearestScreen}set nearestScreen(t){this._nearestScreen=t,this._needsUpdate||this._updateNearestScreen()}get lightmapIndex(){return this._lightmapIndex}set lightmapIndex(t){this._lightmapIndex=t,this._needsUpdate||this._configureLightmaps()}get lightmapScaleOffset(){return this._lightmapScaleOffset}set lightmapScaleOffset(t){this._lightmapScaleOffset=t,this._needsUpdate||this._configureLightmaps()}get materials(){return this._materials}set materials(t){this._materials=t,this._needsUpdate=!0}get material(){return this._materials?this._materials[0]:null}set material(t){this._materials=this._materials||[],this._materials[0]=t,this._needsUpdate=!0}get mesh(){return this._mesh}set mesh(t){this._mesh=t,this._needsUpdate=!0}get skin(){return this._skin}set skin(t){this._skin=t,this._needsUpdate||this._updateSkin()}get bones(){return this._bones}set bones(t){this._bones=t,this._needsUpdate||this._updateSkin()}get sortingLayerIndex(){return this._sortingLayerIndex}set sortingLayerIndex(t){this._sortingLayerIndex=t,this._needsUpdate||this._updateSortingIndexes()}get sortingOrder(){return this._sortingOrder}set sortingOrder(t){this._sortingOrder=t,this._needsUpdate||this._updateSortingIndexes()}get drawOrder(){return this._drawOrder}set drawOrder(t){this._drawOrder=t,this._needsUpdate||this._updateDrawOrder()}get cullingLayer(){return this._cullingLayer}set cullingLayer(t){this._cullingLayer=t,this._needsUpdate||this._updateCulling()}get lightProbe(){return this._lightProbe}set lightProbe(t){this._lightProbe=t,this._needsUpdate||this._updateLightProbe()}get lightProbeUsage(){return this._lightProbeUsage}set lightProbeUsage(t){t!==this._lightProbeUsage&&(this._lightProbeUsage=t,this._needsUpdate||this._updateLightProbe())}get blendReflectionProbes(){return this._blendReflectionProbes}set blendReflectionProbes(t){this._blendReflectionProbes!==t&&(this._blendReflectionProbes=t,this._needsUpdate||this._updateReflectionProbesBlending())}get reflectionProbes(){return this._reflectionProbes}set reflectionProbes(t){null===this._reflectionProbes&&null===t||(this._reflectionProbes=t,this._needsUpdate||this._updateReflectionProbes())}get flipFaces(){return this._flipFaces}set flipFaces(t){this._flipFaces!==t&&(this._flipFaces=t,this._needsUpdate||this._updateFlipFaces())}get isStatic(){return this._isStatic}set isStatic(t){this._isStatic=t}get masksChildren(){return this._masksChildren}set masksChildren(t){this._masksChildren=t,this._needsUpdate||this._updateMasksChildren()}}var I=i(2);const O=32,F=Math.ceil(10),P={namesToIds:{},idsToNames:{},nextId:0,getIdByName(t){if(void 0===this.namesToIds[t]){if(this.nextId>=320)return console.warn("320 keywords limit exceed. "+t+" was not added!"),null;this.namesToIds[t]=this.nextId,this.idsToNames[this.nextId]=t,this.nextId++}return this.namesToIds[t]}};class v{constructor(){this.bitfield=new Uint32Array(F),this.cardinality=0}setEnabledKeywords(t){this.clear();for(let e=0;e<t.length;e++)this.enableKeyword(t[e])}enableKeyword(t){this.enableKeywordId(P.getIdByName(t))}disableKeyword(t){void 0!==P.namesToIds[t]&&this.disableKeywordId(P.getIdByName(t))}enableKeywordId(t){if(t>=P.nextId||t<0)return;const e=Math.floor(t/O),i=1<<t%O;(this.bitfield[e]&i)===i||(this.cardinality++,this.bitfield[e]|=i)}disableKeywordId(t){if(t>=P.nextId||t<0)return;const e=Math.floor(t/O),i=1<<t%O;(this.bitfield[e]&i)===i&&(this.cardinality--,this.bitfield[e]&=~i)}isKeywordEnabled(t){return void 0!==P.namesToIds[t]&&this.isKeywordIdEnabled(P.getIdByName(t))}isKeywordIdEnabled(t){if(t>=P.nextId||t<0)return!1;const e=Math.floor(t/O),i=1<<t%O;return(this.bitfield[e]&i)===i}subset(t){let e=!0;for(let i=0;i<F;i++){const s=this.bitfield[i],n=t.bitfield[i];e=e&&(n&s)===s}return e}getEnabledKeywords(){const t=P.nextId,e=[];for(let i=0;i<t;i++){const t=P.idsToNames[i];this.isKeywordEnabled(t)&&e.push(t)}return e}getEnabledKeywordsIds(){const t=P.nextId,e=[];for(let i=0;i<t;i++)this.isKeywordIdEnabled(i)&&e.push(i);return e}merge(t){for(let e=0;e<F;e++){const i=this.bitfield[e],s=t.bitfield[e];this.bitfield[e]=i|s}this.updateCardinality()}clear(){for(let t=0;t<F;t++)this.bitfield[t]=0;this.cardinality=0}copy(t){for(let e=0;e<F;e++)this.bitfield[e]=t.bitfield[e];this.cardinality=t.cardinality}updateCardinality(){this.cardinality=0;for(let t=0;t<F;t++){let e=this.bitfield[t];0!==e&&(e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),this.cardinality+=16843009*(e+(e>>4)&252645135)>>24)}}}v.union=function(t,e,i=new v){i.clear();for(let s=0;s<F;s++)i.bitfield[s]=t.bitfield[s]|e.bitfield[s];return i.updateCardinality(),i},v.intersection=function(t,e,i=new v){i.clear();for(let s=0;s<F;s++)i.bitfield[s]=t.bitfield[s]&e.bitfield[s];return i.updateCardinality(),i},v.differenceLeft=function(t,e,i=new v){i.clear();for(let s=0;s<F;s++)i.bitfield[s]=(t.bitfield[s]^e.bitfield[s])&t.bitfield[s];return i.updateCardinality(),i},v.differenceRight=function(t,e,i){return v.differenceLeft(e,t,i)},v.difference=function(t,e,i=new v){i.clear();for(let s=0;s<F;s++)i.bitfield[s]=t.bitfield[s]^e.bitfield[s];return i.updateCardinality(),i};const w={LIGHTMAP_ON:P.getIdByName("LIGHTMAP_ON"),DIRLIGHTMAP_COMBINED:P.getIdByName("DIRLIGHTMAP_COMBINED"),POINT_COOKIE:P.getIdByName("POINT_COOKIE"),POINT:P.getIdByName("POINT"),SPOT:P.getIdByName("SPOT"),DIRECTIONAL_COOKIE:P.getIdByName("DIRECTIONAL_COOKIE"),DIRECTIONAL:P.getIdByName("DIRECTIONAL"),VERTEXLIGHT_ON:P.getIdByName("VERTEXLIGHT_ON"),LIGHTPROBE_SH:P.getIdByName("LIGHTPROBE_SH"),FOG_LINEAR:P.getIdByName("FOG_LINEAR"),FOG_EXP:P.getIdByName("FOG_EXP"),FOG_EXP2:P.getIdByName("FOG_EXP2")},L=/void\s+main\s*\(\s*(void)?\s*\)\s*{/,B="attribute\\s+(highp\\s*|lowp\\s*|mediump\\s*)?vec[2|3|4]\\s+",U=/\s*vec(2|3|4)\s*/,N="\\s*;",k=/uniform mat4 matrix_viewProjection;/,z=/texture2D\s*\(\s*unity_Lightmap\s*,/,V="  ",j="// #define BONE_LIMIT 128 // will be added in code\nuniform mat4 matrix_pose[BONE_LIMIT];\nmat4 getBoneMatrix(const in float i) {\n    mat4 bone = matrix_pose[int(i)];\n    return bone;\n}\n",G="uniform sampler2D texture_poseMap;\nuniform vec2 texture_poseMapSize;\nmat4 getBoneMatrix(const in float i)\n{\n    float j = i * 4.0;\n    float x = mod(j, float(texture_poseMapSize.x));\n    float y = floor(j / float(texture_poseMapSize.x));\n    float dx = 1.0 / float(texture_poseMapSize.x);\n    float dy = 1.0 / float(texture_poseMapSize.y);\n    y = dy * (y + 0.5);\n    vec4 v1 = texture2D(texture_poseMap, vec2(dx * (x + 0.5), y));\n    vec4 v2 = texture2D(texture_poseMap, vec2(dx * (x + 1.5), y));\n    vec4 v3 = texture2D(texture_poseMap, vec2(dx * (x + 2.5), y));\n    vec4 v4 = texture2D(texture_poseMap, vec2(dx * (x + 3.5), y));\n    mat4 bone = mat4(v1, v2, v3, v4);\n    return bone;\n}\n",H="attribute vec4 vertex_boneWeights;\nattribute vec4 vertex_boneIndices;\nmat4 skinnedMatrix;\n\nmat4 getSkinnedModelMatrix() {\n    return (\n    getBoneMatrix( vertex_boneIndices.x ) * vertex_boneWeights.x +\n    getBoneMatrix( vertex_boneIndices.y ) * vertex_boneWeights.y +\n    getBoneMatrix( vertex_boneIndices.z ) * vertex_boneWeights.z +\n    getBoneMatrix( vertex_boneIndices.w ) * vertex_boneWeights.w );\n}\n\nvec4 get_POSITION( vec4 pos )\n{\n    return skinnedMatrix * pos;\n}\n\nvec4 get_NORMAL( vec4 normal )\n{\n    return skinnedMatrix * normal;\n}\n\nvec4 get_TANGENT( vec4 tangent )\n{\n    return skinnedMatrix * tangent;\n}\n",Q="// Instancing attributes\nattribute vec3 instancing_translation;\nattribute vec4 instancing_rotation;\nattribute vec3 instancing_scale;\nattribute vec4 instancing_color;\nattribute vec4 instancing_st;\n\n// Uniforms\nuniform highp mat4 matrix_viewInverse;\nuniform highp mat4 matrix_mainCameraSpace;\nuniform highp mat4 matrix_viewProjection;\nuniform highp mat4 matrix_modelRotation;\nuniform highp mat4 matrix_modelTranslation;\nuniform highp mat4 matrix_modelRotationInverse;\nuniform highp vec3 system_scale;\nuniform int renderer_alignment;\nuniform float worldSimulationSpace;\n\n// Quaternion multiplication\n// http://mathworld.wolfram.com/Quaternion.html\nvec4 quaternion_multiply( vec4 lhs, vec4 rhs ) {\n    return vec4(\n    rhs.xyz * lhs.w + lhs.xyz * rhs.w + cross( lhs.xyz, rhs.xyz ),\n    lhs.w * rhs.w - dot( lhs.xyz, rhs.xyz )\n    );\n}\n\n// Vector rotation with a quaternion\n// http://mathworld.wolfram.com/Quaternion.html\nvec3 quaternion_rotate_vector( vec3 vector, vec4 quaternion ) {\n    vec4 quaternion_conjugate = quaternion * vec4( -1, -1, -1, 1 );\n    return quaternion_multiply( quaternion, quaternion_multiply( vec4( vector, 0 ), quaternion_conjugate ) ).xyz;\n}\n\nmat4 transpose( mat4 m ) {\n    return mat4(\n    m[ 0 ][ 0 ], m[ 1 ][ 0 ], m[ 2 ][ 0 ], m[ 3 ][ 0 ],\n    m[ 0 ][ 1 ], m[ 1 ][ 1 ], m[ 2 ][ 1 ], m[ 3 ][ 1 ],\n    m[ 0 ][ 2 ], m[ 1 ][ 2 ], m[ 2 ][ 2 ], m[ 3 ][ 2 ],\n    m[ 0 ][ 3 ], m[ 1 ][ 3 ], m[ 2 ][ 3 ], m[ 3 ][ 3 ]);\n}\n\nmat4 getFacingAlignmentRotation( vec4 particlePosition ) {\n    vec3 eye = matrix_mainCameraSpace[ 3 ].xyz;\n    vec3 pivot = particlePosition.xyz;\n\n    // Find desired rotation between two vectors\n    vec4 cameraZ = vec4( normalize( pivot - eye ), 0 );\n    vec4 cameraY = matrix_mainCameraSpace * vec4( 0, 1, 0, 0 );\n    vec4 cameraX = vec4( cross(cameraY.xyz, cameraZ.xyz), 0 );\n    cameraY = vec4( cross(cameraZ.xyz, cameraX.xyz), 0 );\n\n    mat4 extraRotation = mat4( 0.0 );\n    extraRotation[ 0 ] = cameraX;\n    extraRotation[ 1 ] = cameraY;\n    extraRotation[ 2 ] = cameraZ;\n    extraRotation[ 3 ][ 3 ] = 1.0;\n\n    return extraRotation;\n}\n\n// Applies rotation, then scale, then translate to the\n// vertex coordinates.\n\n#define VIEW_ALIGNMENT      0\n#define WORLD_ALIGNMENT     1\n#define LOCAL_ALIGNMENT     2\n#define FACING_ALIGNMENT    3\n\nmat4 alignment_rotation;\nmat4 simulationSpace_rotation;\nmat4 simulationSpace_translation;\n\nvec4 transform_vertex( vec4 vertex, mat4 matrix_scale ) {\n    vec4 v = matrix_scale * vertex;\n    v = vec4( quaternion_rotate_vector( v.xyz, instancing_rotation ), 1.0 );\n    v = alignment_rotation * v;\n\n    v += vec4( instancing_translation, 0 );\n\n    v = simulationSpace_rotation * v;\n    v = simulationSpace_translation * v;\n\n    return v;\n}\n\n\nvec4 get_POSITION( vec4 position ) {\n    if ( worldSimulationSpace > 0.0 ) {\n        simulationSpace_rotation = mat4( 1.0 );\n        simulationSpace_translation = mat4( 1.0 );\n    } else {\n        simulationSpace_rotation = matrix_modelRotation;\n        simulationSpace_translation = mat4( 1.0 );\n        simulationSpace_translation[ 3 ] = matrix_modelTranslation[ 3 ];\n    }\n\n    if ( LOCAL_ALIGNMENT == renderer_alignment ) {\n        // local alignment means rotation starts with hierarchy rotation\n        alignment_rotation = matrix_modelRotation;\n    } else if ( WORLD_ALIGNMENT ==  renderer_alignment ) {\n        // world alignment means rotation starts with E\n        alignment_rotation = mat4( 1.0 );\n    } else if ( ( VIEW_ALIGNMENT == renderer_alignment ) || ( FACING_ALIGNMENT == renderer_alignment ) ) {\n        // view alignment means rotation starts with camera rotation\n        // Assume scales are 0\n        alignment_rotation = matrix_mainCameraSpace;\n        alignment_rotation[ 3 ] = vec4( 0, 0, 0, 1 );\n    }\n\n    alignment_rotation = transpose( simulationSpace_rotation ) * alignment_rotation;\n\n    mat4 scale;\n    scale[ 0 ] = vec4( system_scale.x * instancing_scale.x, 0, 0, 0 );\n    scale[ 1 ] = vec4( 0, system_scale.y * instancing_scale.y, 0, 0 );\n    scale[ 2 ] = vec4( 0, 0, system_scale.z * instancing_scale.z, 0 );\n    scale[ 3 ] = vec4( 0, 0, 0, 1 );\n\n    vec4 vertex = vec4( position.xyz, 1 );\n    vec4 vertexPosition = transform_vertex( vertex, scale );\n\n    if ( FACING_ALIGNMENT == renderer_alignment ) {\n        vec4 pivot_vertex = vec4( 0, 0, 0, 1 );\n        vec4 pivot = transform_vertex( pivot_vertex, scale );\n\n        alignment_rotation = transpose( simulationSpace_rotation ) * getFacingAlignmentRotation( pivot );\n        vertexPosition = transform_vertex( vertex, scale );\n    }\n\n    return vertexPosition;\n}\n\nvec4 get_COLOR( vec4 color ) {\n    return color * instancing_color;\n}\n\nvec4 get_TEXCOORD0( vec4 texcoord ) {\n    return vec4( ( texcoord.xy + instancing_st.zw ) * instancing_st.xy, texcoord.zw );\n}\n\nvec4 get_NORMAL( vec4 normal ) {\n    normal = vec4( quaternion_rotate_vector( normal.xyz, instancing_rotation ), 0 );\n    normal = alignment_rotation * normal;\n    normal = simulationSpace_rotation * normal;\n    return normal;\n}\n\nvec4 get_TANGENT( vec4 tangent ) {\n    tangent = vec4( quaternion_rotate_vector( tangent.xyz, instancing_rotation ), 0 );\n    tangent = alignment_rotation * tangent;\n    tangent = simulationSpace_rotation * tangent;\n    return tangent;\n}",X=function(t,e,i,s){return t.substring(0,e)+s+t.substring(e+i)},Y=function(t,e,i,s){let n=t,r=e[0].search(i);return r+=e.index,n=X(n,r,i.length,s),n},K=function(t,e){let i=t;return i=X(i,e.index,e[0].length,""),i},W=function(t,e,i,s,n){let r=t;const a=new RegExp(B+i+N),o=r.match(a);if(null!=o){const t=o[0].match(U)[0].trim();r=Y(r,o,"attribute","");const s="_patched_"+e;if(n.defines+="attribute "+t+" "+s+";\n","vec4"===t)n.main+=V+i+" = get_"+e+"( "+s+" );\n";else{let r="",a="";"vec2"===t?(r=".xy",a=", 0, 0"):"vec3"===t&&(r=".xyz",a=", 0"),n.main+=V+i+" = get_"+e+"( vec4( "+s+a+") )"+r+";\n"}}return r},q=function(t,e,i){let s=null;for(const n in e){if(e[n]!==i)continue;const r=new RegExp(B+n+N);if(null!=t.match(r)){s=n;break}}return s},J=function(t,e,i,s){let n=t;for(let t=0;t<e.length;t++){const r=e[t],a=q(n,i,r);if(null!==a){n=W(n,r,a,0,s)}}return n},$=function(t,e){const i=t.match("\\s*#version [0-9]+\\s*");if(null==i)return t;const s=i[0].trim(),n=K(t,i);return e.defines=s+"\n\n"+e.defines,n};class Z{constructor(t,e){this.baseShader=t,this.patchShader=e,this.defines="",this.main="",this.getMain=function(){return"void main() {\n"+this.main+"  _main(); // Initial main function call\n}\n"},this.combine=function(){return"\n// Patched defines\n"+this.defines+"\n// Patch shader\n"+this.patchShader+"\n\n// Base shader\n"+this.baseShader+"\n\n// Partched main\n"+this.getMain()}}}const tt=function(t,e){console.error('Shader "'+t+'" with id #'+e+" is replaced as missing shader.");return new at(I.a.getApplication().graphicsDevice,{attributes:{_glesVertex:n.c.SEMANTIC_POSITION,_glesNormal:n.c.SEMANTIC_NORMAL,_glesTangent:n.c.SEMANTIC_TANGENT,_glesMultiTexCoord0:n.c.SEMANTIC_TEXCOORD0,_glesMultiTexCoord1:n.c.SEMANTIC_TEXCOORD1,_glesMultiTexCoord2:n.c.SEMANTIC_TEXCOORD2,_glesMultiTexCoord3:n.c.SEMANTIC_TEXCOORD3,_glesColor:n.c.SEMANTIC_COLOR},vshader:"// This is a VP stub for shader #"+e+" \n attribute vec3 _glesVertex; varying highp vec2 xlv_TEXCOORD0; uniform mat4 matrix_model;\nuniform mat4 matrix_viewProjection;\nvoid main() { gl_Position = matrix_viewProjection * matrix_model * vec4(_glesVertex, 1.0); }",fshader:"// This is a FP stub for shader #"+e+" \n uniform sampler2D _MainTex; void main(void) { gl_FragColor = vec4(1, 0, 0.5, 1); }"})},et=/^#extension.*$/gm,it=function(t){const e=new RegExp(et),i=t.match(e);return i?(t=t.replace(e,""),t=i[0]+"\n"+t):t},st={patchParticlesVertexShader:function(t,e){const i=new Z(t,Q);i.baseShader=function(t){const e=new RegExp(k),i=t.match(e);return null===i?t:K(t,i)}(i.baseShader);const s=[n.c.SEMANTIC_POSITION,n.c.SEMANTIC_COLOR,n.c.SEMANTIC_TEXCOORD0,n.c.SEMANTIC_NORMAL,n.c.SEMANTIC_TANGENT];i.baseShader=$(i.baseShader,i),i.baseShader=J(i.baseShader,s,e,i);const r=new RegExp(L),a=i.baseShader.match(r);return null===a?(console.error("Shader patching error. Main function not found\n"+t),null):(i.baseShader=Y(i.baseShader,a,"main","_main"),i.combine())},patchSkinningVertexShader:function(t,e){const i=I.a.getApplication().graphicsDevice;let s;i.supportsBoneTextures?s=new Z(t,G+"\n"+H):(s=new Z(t,j+"\n"+H),s.defines+="#define BONE_LIMIT "+i.getBoneLimit()+"\n"),s.main+="  skinnedMatrix = getSkinnedModelMatrix();\n";const r=[n.c.SEMANTIC_POSITION,n.c.SEMANTIC_NORMAL,n.c.SEMANTIC_TANGENT];s.baseShader=$(s.baseShader,s),s.baseShader=J(s.baseShader,r,e,s);const a=new RegExp(L),o=s.baseShader.match(a);if(null===o)return console.error("Shader patching error. Main function not found\n"+t),null;s.baseShader=Y(s.baseShader,o,"main","_main");let h=s.combine();const c="vec3 _patched_POSITION;",l=new RegExp(c);return s.defines.match(l)&&(h=h.replace(c,"vec4 _patched_POSITION;"),h=h.replace("vec4( _patched_POSITION, 0)","_patched_POSITION")),h},patchTexture2DLightmap:function(t){const e=new RegExp(z),i=t.match(e);if(!i)return t;return t=function(t,e){const i=t.match(L);return null==i?t:(s=t,n=i.index,r=e,s.substring(0,n)+r+s.substring(n));var s,n,r}(t=Y(t,i,"texture2D","texture2D_LM"),"// Patched method to support RGBm decoding\nuniform mediump vec4 unity_Lightmap_HDR;\nmediump vec4 texture2D_LM( sampler2D texture, mediump vec2 uv ) {\n    mediump vec4 rgbmColor = texture2D( texture, uv );    mediump vec4 color = vec4( rgbmColor.rgb * ( rgbmColor.w * unity_Lightmap_HDR.x ), rgbmColor.w );    return color;\n}\n\n")},particlesPatch:Q,skinConstVS:j,skinTexVS:G,skinPatch:H},nt={vertex_position:n.c.SEMANTIC_POSITION,vertex_normal:n.c.SEMANTIC_NORMAL,vertex_tangent:n.c.SEMANTIC_TANGENT,vertex_texCoord0:n.c.SEMANTIC_TEXCOORD0,vertex_texCoord1:n.c.SEMANTIC_TEXCOORD1,vertex_color:n.c.SEMANTIC_COLOR,vertex_boneWeights:n.c.SEMANTIC_BLENDWEIGHT,vertex_boneIndices:n.c.SEMANTIC_BLENDINDICES,instancing_translation:n.c.SEMANTIC_TEXCOORD5,instancing_rotation:n.c.SEMANTIC_TEXCOORD6,instancing_scale:n.c.SEMANTIC_TEXCOORD7,instancing_color:n.c.SEMANTIC_ATTR0,instancing_st:n.c.SEMANTIC_ATTR1,_glesVertex:n.c.SEMANTIC_POSITION,_glesNormal:n.c.SEMANTIC_NORMAL,_glesTangent:n.c.SEMANTIC_TANGENT,_glesMultiTexCoord0:n.c.SEMANTIC_TEXCOORD0,_glesMultiTexCoord1:n.c.SEMANTIC_TEXCOORD1,_glesMultiTexCoord2:n.c.SEMANTIC_TEXCOORD2,_glesMultiTexCoord3:n.c.SEMANTIC_TEXCOORD3,_glesColor:n.c.SEMANTIC_COLOR,_glesTANGENT:n.c.SEMANTIC_TANGENT,in_POSITION0:n.c.SEMANTIC_POSITION,in_NORMAL0:n.c.SEMANTIC_NORMAL,in_TANGENT0:n.c.SEMANTIC_TANGENT,in_TEXCOORD0:n.c.SEMANTIC_TEXCOORD0,in_TEXCOORD1:n.c.SEMANTIC_TEXCOORD1,in_TEXCOORD2:n.c.SEMANTIC_TEXCOORD2,in_TEXCOORD3:n.c.SEMANTIC_TEXCOORD3,in_COLOR0:n.c.SEMANTIC_COLOR,_patched_POSITION:n.c.SEMANTIC_POSITION,_patched_COLOR:n.c.SEMANTIC_COLOR,_patched_NORMAL:n.c.SEMANTIC_NORMAL,_patched_TANGENT:n.c.SEMANTIC_TANGENT,_patched_TEXCOORD0:n.c.SEMANTIC_TEXCOORD0},rt=new v;class at{constructor(t,e){this.device=t,this.definition=e,this.attributes=[],this.uniforms=[],this.samplers=[],this._supportsKeywords=!1,this.ready=!1,this._refCount=0,this._glVertexShader=null,this._glFragmentShader=null,this._glProgram=null,this.uniformsUsage=0,this.device.createShader(this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Shader")}destroy(){this.device.destroyShader(this)}}class ot{constructor(t,e,i,s,n){this.graphicsDevice=t,this.keywords=new v,this.shader=null,this._particlesShader=null,this._skinnedShader=null,this._sourceShader=n,this.setupKeywords(e),this.setupShader(i,s),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"UnityShaderVariant")}getShader(t){return t&n.c.SHADERDEF_PARTICLES_INSTANCING?this.getParticlesShader():t&n.c.SHADERDEF_SKIN?this.getSkinnedShader():this.shader}applyMissingShader(t){const e=tt(this._sourceShader.name,this._sourceShader.$id);return t&n.c.SHADERDEF_PARTICLES_INSTANCING?this._particlesShader=e:t&n.c.SHADERDEF_SKIN?this._skinnedShader=e:this.shader=e,e}getParticlesShader(){return null===this._particlesShader&&(this._particlesShader=new at(this.graphicsDevice,{attributes:nt,vshader:st.patchParticlesVertexShader(this.shader.definition.vshader,nt),fshader:this.shader.definition.fshader})),this._particlesShader}getSkinnedShader(){return null===this._skinnedShader&&(this._skinnedShader=new at(this.graphicsDevice,{attributes:nt,vshader:st.patchSkinningVertexShader(this.shader.definition.vshader,nt),fshader:this.shader.definition.fshader})),this._skinnedShader}setupKeywords(t){this.keywords.setEnabledKeywords(t)}setupShader(t,e){2===UnityEngine.LightmapSettings.lightmapEncodingQuality&&(e=st.patchTexture2DLightmap(e)),this.shader=new at(this.graphicsDevice,{attributes:nt,vshader:t,fshader:e})}}class ht{constructor(t){this.$id="",this.graphicsDevice=t,this.name=null,this.passes=[],this.defaultParameterValues=[],this.defaultParameters={},this.defaultParameterNames=null,this.lightModes=[[],[],[],[],[],[],[]],this.supportedKeywords=new v,this._refCount=0,this["__UnityEngine.Shader"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"UnityShader")}setup(){this.setupPasses(),this.setupDefaultParameters()}setupPasses(){for(let t=0;t<this.passes.length;t++){const e=this.passes[t];e.graphicsDevice=this.graphicsDevice,e.sourceShader=this,e.setupTags(),e.setupVariants(),e.setupRenderSettings(),this.lightModes[e.lightMode].push(e);for(let t=0;t<e.variants.length;t++){const i=e.variants[t];this.supportedKeywords.merge(i.keywords)}}}setupDefaultParameters(){this.defaultParameterNames={};for(let t=0;t<this.defaultParameterValues.length;t++){const e=this.defaultParameterValues[t];switch(this.defaultParameterNames[e.name]=!0,e.type){case Luna.Unity.DTO.UnityEngine.Assets.Shader.ShaderParameterType.Vector:case Luna.Unity.DTO.UnityEngine.Assets.Shader.ShaderParameterType.Color:this.defaultParameters[e.name]=e.value.data;break;case Luna.Unity.DTO.UnityEngine.Assets.Shader.ShaderParameterType.Scalar:this.defaultParameters[e.name]=e.value.x;break;case Luna.Unity.DTO.UnityEngine.Assets.Shader.ShaderParameterType.Texture:{const t=UnityEngine.Texture2D[e.textureValue+"Texture"];this.defaultParameters[e.name]=t?t.handle:null;break}}}}supportsKeyword(t){return this.supportedKeywords.isKeywordEnabled(t)}}ht.globalKeywords=new v,ht.globalUniforms={},ht.setGlobalUniform=function(t,e){this.globalUniforms[t]=this.globalUniforms[t]||new ct,this.globalUniforms[t].value=e},ht.enableKeyword=function(t){this.globalKeywords.enableKeyword(t)},ht.disableKeyword=function(t){this.globalKeywords.disableKeyword(t)},ht.getEnabledKeywords=function(){return this.globalKeywords.getEnabledKeywords()};class ct{constructor(){this.value=null,this.scopeId=null}}let lt=0;class ut extends a{constructor(){super(),this.name="Untitled",this.id=lt++,this._shader=null,this.meshInstances=[],this.dirty=!0,this.enableAutoInstancing=!1}get shader(){return this._shader}set shader(t){this._shader&&this._shader._refCount--,t.handle instanceof ht&&(t=t.handle),this._shader=t,t&&t._refCount++}}var dt=i(5);class _t extends ut{constructor(){super(),this.$id="",this.keywords=new v,this.drawOrder=0,this.renderQueue=0,this.enableInstancing=!1,this.floatParameters=[],this.colorParameters=[],this.vectorParameters=[],this.textureParameters=[],this.materialFlags=[],this["__UnityEngine.Material"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"UnityMaterial")}getPass(t,e=[]){if(e.length=0,!this._shader)return e;for(let i=0;i<this._shader.passes.length;i++){const s=this._shader.passes[i];s.lightMode===t&&e.push(s)}return e}setPass(t){if(!this._shader)return void console.log("Missing shader.");const e=this._shader.passes.length;if(t<0||t>e)return void console.log("Shader pass out of range setup attempt.");const i=this._shader.passes[t];UnityEngine.GL.SetPassMaterial=this["__UnityEngine.Material"],dt.a.getApplication().renderer.setPass(this,i)}setParametersFromShaderDefaults(){if(!this.shader)return;const t=this.shader.defaultParameters;for(const e in t)this.setParameter(e,this.cloneParameterData(t[e])),t[e]instanceof x&&this.setParameter(e+"_ST",this.cloneParameterData([1,1,0,0]))}setup(){for(let t=0;t<this.floatParameters.length;t++)this.setParameter(this.floatParameters[t].name,this.floatParameters[t].value);for(let t=0;t<this.colorParameters.length;t++)this.setParameter(this.colorParameters[t].name,this.colorParameters[t].value.data);for(let t=0;t<this.vectorParameters.length;t++)this.setParameter(this.vectorParameters[t].name,this.vectorParameters[t].value.data);for(let t=0;t<this.textureParameters.length;t++){const e=this.textureParameters[t].value;this.setParameter(this.textureParameters[t].name,e?e.handle:null)}const t=[];for(let e=0;e<this.materialFlags.length;e++){const i=this.materialFlags[e];i.enabled&&t.push(i.name)}this.shaderKeywords=t}deleteParameter(t){super.deleteParameter(t);const e=this._shader.defaultParameters[t];e&&this.setParameter(t,e)}setParameter(t,e,i=0){if(super.setParameter(t,e),null===e&&this._shader){const e=this._shader.defaultParameters[t];e&&this.setParameter(t,e)}else e instanceof x&&!e.device.webgl2&&(e._pot||0!==e._addressU||0!==e._addressV||console.warn("Material's '"+this.name+"' texture '"+e.name+"' wrap mode is set to 'Repeat', but it's resolution NOT POWER OF TWO (NPOT)\nOnly textures with Power Of Two (POT) resolution can be used with WrapMode=Repeat"))}clone(){const t=new _t;return t.name=this.name,t._shader=this._shader,t.copyPropertiesFromMaterial(this),t}hasProperty(t){return this.parameters.hasOwnProperty(t)||this.shader.defaultParameterNames.hasOwnProperty(t)}copyPropertiesFromMaterial(t){this.renderQueue=t.renderQueue,this.enableInstancing=t.enableInstancing,this.keywords.copy(t.keywords),this.$id=t.$id;for(const e in t.parameters)this.setParameter(e,this.cloneParameterData(t.parameters[e].data))}cloneParameterData(t){return t instanceof Float32Array||Array.isArray(t)?new Float32Array(t):t}get shaderKeywords(){return this.keywords.getEnabledKeywords()}set shaderKeywords(t){this.keywords.setEnabledKeywords(t)}get passCount(){return this._shader.passes.length}}const pt=new s.i,mt=new s.i,ft=new s.i,gt=new s.i;const yt={radius:0,center:null},Et=function(t,e,i=null){return yt.center=e.center,yt.radius=e.halfExtents.length(),0!==t.containsSphere(yt,i)},At={cull:function(t,e,i,s){let n=0,r=0;const a=void 0===t.cullingMask?4294967295:t.cullingMask,o=[],h=t.frustum;for(let t=0;t<i;t++){const i=e[t],s=!0;if(i.material&&((!i._mesh||i._mesh._refCount!==-1/0)&&i.visible))if(i.cull){if(s){const t=i.node.cullingLayer||0,e=1<<t;if(t<0)continue;if(0==(e&a))continue}o[r++]=i,i.visibleThisFrame=!0}else o[r++]=i,i.visibleThisFrame=!0}for(let e=0;e<o.length;e++){const i=o[e];let r=!0;i.cull&&(r=t._component.layerCullDistancesActivated?Et(h,i.aabb,t._component.layerCullDistances[i.node.cullingLayer]):Et(h,i.aabb)),r?(s[n++]=i,i.visibleThisFrame=!0):i.visibleThisFrame=!1}return n},cullUi:function(t,e,i){let s=0,n=0;const r=e.length,a=[],o=t.frustum;for(let t=0;t<r;t++){const i=e[t];i&&(i.material&&(i._mesh&&i._mesh._refCount===-1/0||i.visible&&(i.cull,a[n++]=i,i.visibleThisFrame=!0)))}for(let t=0;t<a.length;t++){const e=a[t];let n=!0;const r=!e._nearestScreen;e.cull&&r&&(n=Et(o,e.aabb)),n?(i[s++]=e,e.visibleThisFrame=!0):e.visibleThisFrame=!1}return s},reset:function(t,e){for(let i=0;i<e;i++)t[i].visibleThisFrame=!1},isAABBVisibleInFrustum:Et},Tt=new s.i,Ct=new s.e,bt=new s.e,St=new s.e,xt=(new s.e).setTRS(new s.i(-.5,-.5,0),s.f.IDENTITY,s.i.ONE);let Dt=0;class Mt{constructor(){this.id=Dt++,this._type=n.c.LIGHTTYPE_DIRECTIONAL,this._color=new s.b(.8,.8,.8),this._intensity=1,this._castShadows=!1,this._enabled=!1,this._mask=1,this._cullingMask=-1,this._renderMode=0,this._nodeAabbVer=0,this.isStatic=!1,this.key=0,this._aabb=new s.a,this._attenuationEnd=10,this._shadowType=n.c.SHADOW_PCF3,this._cookie=null,this._cookieScale=new s.h(1,1),this._outerConeAngle=45,this._finalColor=new Float32Array([.8,.8,.8,1]);const t=Math.pow(this._finalColor[0],2.2);this._linearFinalColor=new Float32Array([t,t,t,t]),this._worldToLightMatrix=new s.e,this._node=null,this._luminance=0,this._effectiveLuminance=0,this._range=0,this._priority=0,this._directionToLight=new s.i,this._position=new s.i}destroy(){}update(t){if(!this._node)return!1;if(this._nodeAabbVer===this._node.aabbVersion)return At.isAABBVisibleInFrustum(t.frustum,this._aabb);const e=this._node.worldTransformInverse,i=1/this._attenuationEnd;return this._position.copy(this._node.getPosition()),this._type===n.c.LIGHTTYPE_POINT?(this._worldToLightMatrix.copy(e).scale(i),this._worldToLightMatrix.data[15]=1):this._type===n.c.LIGHTTYPE_SPOT?(Ct.setIdentity(),Ct.data[11]=2*Math.tan(s.c*this._outerConeAngle*.5),Ct.data[15]=0,bt.setScale(i,i,i),bt.data[15]=i,this._worldToLightMatrix.mul2(bt,Ct),this._worldToLightMatrix.mul2(this._worldToLightMatrix,e)):(Tt.set(this._cookieScale.x,this._cookieScale.x,this._cookieScale.x),St.setTRS(this._node.getPosition(),this._node.getRotation(),Tt),this._worldToLightMatrix.mul2(St,xt).invert(),this._worldToLightMatrix.data[2]=0,this._worldToLightMatrix.data[6]=0,this._worldToLightMatrix.data[10]=0,this._worldToLightMatrix.data[14]=0,this._directionToLight.copy(this._node.forward).scale(-1)),this._nodeAabbVer=this._node.aabbVersion,this.getBoundingBox(this._aabb),At.isAABBVisibleInFrustum(t.frustum,this._aabb)}getColor(){return this._color}getBoundingBox(t){if(this._type===n.c.LIGHTTYPE_SPOT){const e=this.attenuationEnd,i=this._outerConeAngle,n=this._node,r=Math.abs(Math.tan(i*s.c*.5)*e);t.center.set(0,0,.5*e),t.halfExtents.set(r,r,.5*e),t.setFromTransformedAabb(t,n.getWorldTransform())}else this._type===n.c.LIGHTTYPE_POINT?(t.center.copy(this._node.getPosition()),t.halfExtents.set(this.attenuationEnd,this.attenuationEnd,this.attenuationEnd)):this._type===n.c.LIGHTTYPE_DIRECTIONAL&&(t.center.copy(this._node.getPosition()),t.halfExtents.set(1/0,1/0,1/0))}_updateFinalColor(){const t=this._color,e=t.r,i=t.g,s=t.b,n=t.a,r=this._intensity,a=this._finalColor,o=this._linearFinalColor;a[0]=e*r,a[1]=i*r,a[2]=s*r,a[3]=n*r,r>=1?(o[0]=Math.pow(e,2.2)*r,o[1]=Math.pow(i,2.2)*r,o[2]=Math.pow(s,2.2)*r,o[3]=Math.pow(n,2.2)*r):(o[0]=Math.pow(a[0],2.2),o[1]=Math.pow(a[1],2.2),o[2]=Math.pow(a[2],2.2),o[3]=Math.pow(a[3],2.2)),this._luminance=(.3*e+.59*i+.11*s)*r}setColor(t,e,i){let n=t;t instanceof s.b&&(n=t.r,e=t.g,i=t.b),this._color.set(n,e,i),this._updateFinalColor()}updateKey(){this.key=this._type<<29|(this._castShadows?1:0)<<28|this._shadowType<<25|(this._cookie?1:0)<<24}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(this._enabled=t)}get type(){return this._type}set type(t){if(this._type===t)return;this._type=t,this.updateKey();const e=this._shadowType;this._shadowType=null,this.shadowType=e}get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t)}get renderMode(){return this._renderMode}set renderMode(t){this._renderMode!==t&&(this._renderMode=t)}get cullingMask(){return this._cullingMask}set cullingMask(t){this._cullingMask!==t&&(this._cullingMask=t)}get shadowType(){return this._shadowType}set shadowType(t){if(this._shadowType===t)return;const e=I.a.getApplication().graphicsDevice;this._type===n.c.LIGHTTYPE_POINT&&(t=n.c.SHADOW_PCF3),t!==n.c.SHADOW_PCF5||e.webgl2||(t=n.c.SHADOW_PCF3),t!==n.c.SHADOW_VSM32||e.textureFloatRenderable||(t=n.c.SHADOW_VSM16),t!==n.c.SHADOW_VSM16||e.textureHalfFloatRenderable||(t=n.c.SHADOW_VSM8),this._shadowType=t,this.updateKey()}get castShadows(){return this._castShadows&&this._mask!==n.c.MASK_LIGHTMAP&&0!==this._mask}set castShadows(t){this._castShadows!==t&&(this._castShadows=t,this.updateKey())}get outerConeAngle(){return this._outerConeAngle}set outerConeAngle(t){this._outerConeAngle!==t&&(this._outerConeAngle=t,this._nodeAabbVer=-1)}get intensity(){return this._intensity}set intensity(t){this._intensity!==t&&(this._intensity=t,this._updateFinalColor())}get cookie(){return this._cookie}set cookie(t){this._cookie!==t&&(this._cookie=t,this.updateKey())}get cookieScale(){return this._cookieScale}set cookieScale(t){this._cookieScale=t,this._nodeAabbVer=-1}get attenuationEnd(){return this._attenuationEnd}set attenuationEnd(t){this._attenuationEnd=t,this._nodeAabbVer=-1}}Mt.LightDefaults={type:"point",color:new s.b(1,1,1,1),cookieScale:s.h.ONE,intensity:1,range:10,cullingMask:-1};const Rt=new s.i,It=new s.i;class Ot{constructor(t,e){switch(this.index=0,this.numComponents=e.numComponents,e.dataType){case n.c.TYPE_INT8:this.array=new Int8Array(t,e.offset);break;case n.c.TYPE_UINT8:this.array=new Uint8Array(t,e.offset);break;case n.c.TYPE_INT16:this.array=new Int16Array(t,e.offset);break;case n.c.TYPE_UINT16:this.array=new Uint16Array(t,e.offset);break;case n.c.TYPE_INT32:this.array=new Int32Array(t,e.offset);break;case n.c.TYPE_UINT32:this.array=new Uint32Array(t,e.offset);break;case n.c.TYPE_FLOAT32:this.array=new Float32Array(t,e.offset)}}get(t){return this.array[this.index+t]}set(t,e=0,i=0,s=0){this.array[this.index]=t,1!==this.numComponents&&(this.array[this.index+1]=e,2!==this.numComponents&&(this.array[this.index+2]=i,3!==this.numComponents&&(this.array[this.index+3]=s)))}}class Ft{constructor(t){this.vertexBuffer=t,this.buffer=this.vertexBuffer.lock(),this.accessors=[],this.element={};const e=this.vertexBuffer.getFormat();for(let t=0;t<e.elements.length;t++){const i=e.elements[t];this.accessors[t]=new Ot(this.buffer,i),this.element[i.name]=this.accessors[t]}}next(t=1){let e=0;const i=this.accessors,s=this.accessors.length,n=this.vertexBuffer.getFormat();for(;e<s;){const s=i[e++];s.index+=t*n.size/s.array.BYTES_PER_ELEMENT}}end(){this.vertexBuffer.unlock()}setVector4(t,e){this.element[t].set(e[0],e[1],e[2]||0,e[3]||1)}setVector3(t,e){this.element[t].set(e[0],e[1],e[2])}setVector2(t,e){this.element[t].set(e[0],e[1])}}const Pt=new s.i,vt=new s.i,wt=new s.j,Lt="zDHiP9sPyT/bD8k/f6ziP9sPyT/bD8k/2w/JP3+s4j/MMeI/f6ziP7VT+z/MMeI/L/7jP9sPyT/bD8k/+FDkP9sPyT/bD8k/2w/JP/hQ5D8v/uM/+FDkP+zj/j8v/uM/L/7jP+zj/j/DYf4/f6ziP8Nh/j+1U/s/w2H+P3+s4j8v/uM/f6ziP9sPyT8v/uM/6esLQOTLFkDlOgpAw2H+P+U6CkC1U/s/5ToKQMNh/j/p6wtAw2H+P+zj/j/p6wtA+FDkP9sPyT/bD8k/L/7jP9sPyT/bD8k/2w/JPy/+4z/4UOQ/L/7jP+zj/j/4UOQ/ruzVP9sPyT/bD8k/2w/JP67s1T/bD8k/f6ziP67s1T/bD8k/8mHPP9sPyT/bD8k/2w/JP/Jhzz/bD8k/bLDVP/Jhzz/bD8k/2w/JP9sPyT/xYc8/2w/JP/Fhzz9ssNU/2w/JP9sPyT/xYc8/7PbbP2yw1T/xYc8/zDHiP/Fhzz/bD8k/zDHiP+z22z/xYc8/7PbbP8wx4j9IaeI/D5DiP+z22z9IaeI/bLDVP+z22z8PkOI/fqbiP3+s4j/jNNw/D5DiP+M03D9ssNU/D5DiP36m4j/jNNw/8mHPP2yw1T/jNNw/2w/JP+M03D9/rOI/2w/JP/Jhzz/jNNw/u/foP3+s4j9+puI/D5DiP7v36D9+puI/9C/vP7v36D8PkOI/SGniP8wx4j+Lu+g/D5DiP4u76D/0L+8/D5DiP0hp4j+Lu+g/P1D1P/Qv7z+Lu+g/tVP7P4u76D/MMeI/tVP7Pz9Q9T+Lu+g/P1D1P7VT+z8PUvw/rSn9Pz9Q9T8PUvw/9C/vPz9Q9T+tKf0/t9n9P8Nh/j/S3fY/rSn9P9Ld9j/0L+8/rSn9P7fZ/T/S3fY/u/foP/Qv7z/S3fY/f6ziP9Ld9j/DYf4/f6ziP7v36D/S3fY/E17xP8Nh/j/29f4/7OP+PxNe8T/29f4/L/7jPxNe8T/s4/4/E17xPy/+4z/nfeM/f6ziPxNe8T/nfeM/w2H+PxNe8T9/rOI/ruzVP3+s4j/nfeM/L/7jP67s1T/nfeM/2w/JP67s1T8v/uM//NQOQOnrC0BgsQtATFULQPzUDkBgsQtAB6ERQPzUDkBMVQtAHdgKQOU6CkBKAQ5ATFULQEoBDkAHoRFATFULQB3YCkBKAQ5AjEoUQAehEUBKAQ5A5MsWQEoBDkDlOgpA5MsWQIxKFEBKAQ5A1dIFQOzj/j/29f4/w2H+P9XSBUD29f4/6esLQNXSBUDDYf4/p5wHQOU6CkAd2ApATFULQKecB0Ad2ApA2eMEQKecB0BMVQtAYLELQOnrC0BGeghATFULQEZ6CEDZ4wRATFULQGCxC0BGeghAORQCQNnjBEBGeghAw2H+P0Z6CEDp6wtAw2H+PzkUAkBGeghAORQCQMNh/j+32f0/rSn9PzkUAkC32f0/2eMEQDkUAkCtKf0/D1L8P7VT+z+iUgFArSn9P6JSAUDZ4wRArSn9Pw9S/D+iUgFAp5wHQNnjBECiUgFA5ToKQKJSAUC1U/s/5ToKQKecB0CiUgFAjEoUQOTLFkBiHhlAjzobQIxKFEBiHhlAB6ERQIxKFECPOhtAfhgdQFevHkAOVRhAjzobQA5VGEAHoRFAjzobQH4YHUAOVRhA/NQOQAehEUAOVRhA6esLQA5VGEBXrx5A6esLQPzUDkAOVRhAngkYQFevHkBG5yBA1qshQJ4JGEBG5yBAG/IQQJ4JGEDWqyFAngkYQBvyEEDb2A5A6esLQJ4JGEDb2A5AV68eQJ4JGEDp6wtA1dIFQOnrC0Db2A5A7OP+P9vYDkAb8hBA7OP+P9XSBUDb2A5AG/IQQNarIUBXrx5A6esLQFevHkDkyxZAV68eQOnrC0Ab8hBA6esLQOzj/j8b8hBAG/IQQOzj/j9BuQBAG/IQQEG5AEDs4/4/QbkAQBvyEEAb8hBAG/IQQNarIUAb8hBA+FDkP9sPyT/4UOQ/QbkAQPhQ5D/s4/4/+FDkP0G5AED4UOQ/QbkAQOzj/j/4UOQ/IKM/QOJ+PEDBFj9ATsdCQMEWP0BYHkBATsdCQCCjP0DBFj9AOpdEQFgeQEDBFj9A4n48QDqXREDBFj9A2w9JQDqXREDifjxAOpdEQNsPSUCS60VATsdCQDqXRECS60VAWB5AQDqXREBOx0JAcDY2QO3tL0BE4TRA4n48QEThNECT0zZA4n48QHA2NkBE4TRAkfo7QOJ+PEDBFj9AV8E6QMEWP0BYHkBAV8E6QJH6O0DBFj9AIXk7QFgeQEDBFj9A4n48QCF5O0DBFj9Ak9M2QCF5O0DifjxAIXk7QJPTNkAc/DhAV8E6QCF5O0Ac/DhAWB5AQCF5O0BXwTpAHPw4QJPTNkA3UjZAV8E6QDdSNkBE4TRAV8E6QBz8OEA3UjZAmuM4QEThNEACrzJA7e0vQJrjOEACrzJA4n48QJrjOEDt7S9AmuM4QOJ+PECR+jtAV8E6QJrjOECR+jtAROE0QJrjOEBXwTpAQM4qQO3tL0DjXCNAV68eQONcI0DkyxZA41wjQFevHkBAzipAV68eQNarIUBAzipAc5ImQEDOKkDkCyxA1qshQOQLLEBAzipA1qshQHOSJkDkCyxA5i8vQO3tL0ACrzJA1w0uQAKvMkBE4TRA1w0uQOYvL0ACrzJA/eYvQEThNEA3UjZAk9M2QP3mL0A3UjZAQM4qQP3mL0CT0zZA/eYvQEDOKkCykyxA1w0uQP3mL0CykyxAROE0QP3mL0DXDS5ARBAxQEDOKkDkCyxAk9M2QOQLLEBAzipAk9M2QEQQMUDkCyxARBAxQJPTNkBE4TRAQM4qQEThNEDt7S9AQM4qQEQQMUBE4TRAvDEgQFevHkB+GB1AtH0hQH4YHUCPOhtAtH0hQLwxIEB+GB1A4mUfQI86G0BiHhlA5MsWQOJlH0BiHhlA41wjQOJlH0DkyxZA4mUfQONcI0DijSJAtH0hQOJlH0DijSJAjzobQOJlH0C0fSFAspMsQEDOKkCMkSlA1w0uQIyRKUAT3ydA1w0uQLKTLECMkSlA5wosQBPfJ0DhxyVA41wjQOcKLEDhxyVA7e0vQOcKLEDjXCNA5wosQO3tL0DmLy9A1w0uQOcKLEDmLy9AE98nQOcKLEDXDS5A4o0iQONcI0DhxyVAtH0hQOHHJUAT3ydAtH0hQOKNIkDhxyVAqFgjQBPfJ0CMkSlAQM4qQKhYI0CMkSlAV68eQKhYI0BAzipAqFgjQFevHkC8MSBAtH0hQKhYI0C8MSBAE98nQKhYI0C0fSFAc5ImQNarIUBG5yBAQM4qQEbnIEBXrx5AQM4qQHOSJkBG5yBA",Bt="2w/JP9sPyT/MMeI/2DPjP8wx4j+1U/s/zDHiP9gz4z/bD8k/2DPjP9sPyT/bD8k/bKn/P7VT+z/lOgpAKfkMQOU6CkDkyxZA5ToKQCn5DEBsqf8/KfkMQFQ0AkBsqf8/bKn/P1Q0AkADjuY/2DPjPwOO5j/bD8k/A47mP9gz4z9sqf8/2DPjP7VT+z9sqf8/QpLqP9sPyT/bD8k/A47mP9sPyT/bD8k/2w/JPwOO5j9Ckuo/A47mP1Q0AkBCkuo/n54gQOTLFkDjXCNAEsMtQONcI0Dt7S9A41wjQBLDLUCfniBAEsMtQHRjK0CfniBATOY1QO3tL0BwNjZA4n48QEzmNUBwNjZA3P07QEzmNUDifjxAWJk/QOJ+PEAgoz9ATsdCQFiZP0Agoz9AprdCQFiZP0BOx0JAkutFQNsPSUDT5UVATsdCQNPlRUCmt0JATsdCQJLrRUDT5UVA5t1FQKa3QkDT5UVA2w9JQNPlRUDbD0lA2w9JQObdRUDT5UVA5t1FQNsPSUD2y0VAgIdCQObdRUD2y0VAprdCQObdRUCAh0JAs0I/QNz9O0B2YT9AgIdCQHZhP0Cmt0JAgIdCQLNCP0B2YT9AWJk/QKa3QkB2YT9A4n48QHZhP0Dc/TtA4n48QFiZP0B2YT9AhB8/QNz9O0CzQj9AgIdCQIQfP0CzQj9AVlVCQIQfP0CAh0JA9stFQNsPSUCkvUVAgIdCQKS9RUBWVUJAgIdCQPbLRUCkvUVA2KNFQFZVQkCkvUVA2w9JQKS9RUDbD0lA2w9JQNijRUCkvUVA2KNFQNsPSUDcZ0VAAbpBQNijRUDcZ0VAVlVCQNijRUABukFAVwc+QMZQOkDuaT5AAbpBQO5pPkBWVUJAAbpBQFcHPkDuaT5AhB8/QFZVQkDuaT5A3P07QO5pPkDGUDpA3P07QIQfP0DuaT5AAdQzQMZQOkDC2zJAdGMrQAHUM0DC2zJAEsMtQAHUM0B0YytAAdQzQBLDLUBu4jRA3P07QAHUM0Bu4jRAxlA6QAHUM0Dc/TtATOY1QNz9O0Bu4jRAEsMtQEzmNUBu4jRA7e0vQEzmNUASwy1A+A48QKdOOEAwjDxAwsJAQPgOPEAwjDxAaRRAQPgOPEDCwkBAnO9EQNsPSUBtxERAwsJAQG3EREBpFEBAwsJAQJzvREBtxERANmdEQGkUQEBtxERA2w9JQG3EREDbD0lA2w9JQDZnREBtxERAhHwxQHRjK0DC2zJAxlA6QIR8MUDC2zJAp044QIR8MUDGUDpA1BlFQNsPSUCc70RAwsJAQNQZRUCc70RAJFZBQNQZRUDCwkBAMIw8QKdOOEBP+jxAwsJAQE/6PEAkVkFAwsJAQDCMPEBP+jxApb89QCRWQUBP+jxAxlA6QE/6PECnTjhAxlA6QKW/PUBP+jxApb89QMZQOkBXBz5AAbpBQKW/PUBXBz5AJFZBQKW/PUABukFA3GdFQNsPSUDqTUVAAbpBQOpNRUAkVkFAAbpBQNxnRUDqTUVA1BlFQCRWQUDqTUVA2w9JQOpNRUDbD0lA2w9JQNQZRUDqTUVANmdEQNsPSUDGCURAUaA+QDZnREDGCURAaRRAQDZnREBRoD5AMtA4QCqbMkCGEDpAUaA+QIYQOkBpFEBAUaA+QDLQOECGEDpA+A48QGkUQECGEDpAp044QIYQOkAqmzJAp044QPgOPECGEDpAbysqQCqbMkAUJSVA5MsWQG8rKkAUJSVABW4jQG8rKkDkyxZAbysqQAVuI0CHLy5Ap044QG8rKkCHLy5AKpsyQG8rKkCnTjhAhHwxQKdOOECHLy5AdGMrQIcvLkAFbiNAdGMrQIR8MUCHLy5AwykKQOTLFkA7+fU/QpLqPzv59T/bD8k/O/n1P0KS6j/DKQpAQpLqP1Q0AkDDKQpAwykKQFQ0AkDkyxZABW4jQOTLFkB0YytA5MsWQAVuI0DDKQpABW4jQOTLFkDDKQpAKfkMQOTLFkCfniBA5MsWQJ+eIEB0YytAn54gQOTLFkAp+QxA5MsWQFQ0AkAp+QxA2w/JP9sPyT+9ffI/2w/JP7198j/kyxZA2w/JP9sPyT+9ffI/5MsWQOTLFkDqWDRA2w9JQOTLFkDqWDRAAAAAAOTLFkDbD0lA5MsWQAAAAADbD8k/2w/JP+TLFkDbD8k/5MsWQOTLFkDbD8k/2w/JP9sPyT86OfM/2w/JPzo58z/kyxZA2w/JP9sPyT86OfM/giI5QNsPSUDqWDRATiYrQOpYNEDkyxZATiYrQIIiOUDqWDRA5MsWQOTLFkC9ffI/2w/JP+TLFkC9ffI/5MsWQOTLFkDbD8k/5MsWQOTLFkBpwh9ATiYrQOTLFkBpwh9A5MsWQOTLFkBOJitAacIfQOTLFkBQHiZATiYrQFAeJkAr+zNATiYrQGnCH0BQHiZArRk8QCv7M0B6oj9A2w9JQK0ZPEB6oj9A2w9JQK0ZPEDbD0lArRk8QNsPSUCCIjlATiYrQK0ZPECCIjlAK/szQK0ZPEBOJitA0AYDQNsPyT/bD8k/O/n1P9sPyT/bD8k/2w/JPzv59T/QBgNAO/n1P+TLFkDQBgNABYEfQPiQKkDkyxZA5MsWQOTLFkDQBgNA5MsWQAWBH0DkyxZATntAQNsPSUB6oj9Abnc4QHqiP0Ar+zNAbnc4QE57QEB6oj9ANWEuQCv7M0BQHiZA5MsWQDVhLkBQHiZA+JAqQDVhLkDkyxZANWEuQPiQKkCTJTFAbnc4QDVhLkCTJTFAK/szQDVhLkBudzhAA44KQNAGA0DkyxZA5MsWQOTLFkD4kCpA5MsWQAOOCkDkyxZAA44KQOTLFkA6OfM/0AYDQDo58z/bD8k/0AYDQAOOCkA6OfM/icY3QCqbMkAy0DhAbUI9QDLQOEBRoD5AbUI9QInGN0Ay0DhAkmhDQFGgPkDGCURA2w9JQJJoQ0DGCURA2w9JQJJoQ0DbD0lAkmhDQNsPSUAXCUNAbUI9QJJoQ0AXCUNAUaA+QJJoQ0BtQj1AkyUxQPiQKkC6UTNAbnc4QLpRM0DKWjtAbnc4QJMlMUC6UTNAslJBQMpaO0C4mUJA2w9JQLJSQUC4mUJA2w9JQLJSQUDbD0lAslJBQNsPSUBOe0BAbnc4QLJSQUBOe0BAylo7QLJSQUBudzhAFwlDQNsPSUC4mUJAbUI9QLiZQkDKWjtAbUI9QBcJQ0C4mUJAmoI2QMpaO0C6UTNA+JAqQJqCNkC6UTNAKpsyQJqCNkD4kCpAmoI2QCqbMkCJxjdAbUI9QJqCNkCJxjdAylo7QJqCNkBtQj1ABYEfQOTLFkAUJSVA+JAqQBQlJUAqmzJA+JAqQAWBH0AUJSVA";function Ut(t,e,i=new s.i){const n=Math.sin(t),r=Math.cos(t),a=Math.sin(e),o=Math.cos(e);return i.x=n*o,i.y=n*a,i.z=r,i}function Nt(t){const e=window.atob(t),i=e.length/Float32Array.BYTES_PER_ELEMENT,s=new DataView(new ArrayBuffer(Float32Array.BYTES_PER_ELEMENT)),n=new Float32Array(i);let r=0;for(let t=0;t<i;t++)r=4*t,s.setUint8(0,e.charCodeAt(r)),s.setUint8(1,e.charCodeAt(r+1)),s.setUint8(2,e.charCodeAt(r+2)),s.setUint8(3,e.charCodeAt(r+3)),n[t]=s.getFloat32(0,!0);return n}function kt(t,e,i,n=new s.j){return vt.x=t,vt.y=e,vt.z=i,n.x=vt.dot(s.i.RIGHT),n.y=vt.dot(s.i.UP),n.z=vt.dot(s.i.BACK),n.w=1,n}class zt{loadSkyboxMesh(){const t=new C,e=Nt(Lt),i=Nt(Bt),r=e.length,a=8*r*3,o=3*r,u=4*r,d=I.a.getApplication().graphicsDevice,_=new Float32Array(a),p=new Float32Array(4*r*8),m=function(t,e){const i=new Uint16Array(t*e);for(let s=0;s<e;s++)for(let e=0;e<t;e++){const n=e+t*s;s%2==0?i[n]=n:(i[n]=n+2,i[n+2]=n,i[n+1]=n+1,e+=2)}return i}(630,8);for(let t=0;t<r;t++){Ut(e[t],i[t],Pt),Pt.y=(0,s.k)(Pt.y,0,1);const n=3*t,r=4*t;_[n]=Pt.x,_[n+1]=Pt.y,_[n+2]=Pt.z,kt(Pt.x,Pt.y,Pt.z,wt),p[r]=wt.x,p[r+1]=wt.y,p[r+2]=wt.z,p[r+3]=wt.w,_[n+o]=-Pt.x,_[n+o+1]=Pt.y,_[n+o+2]=Pt.z,kt(-Pt.x,Pt.y,Pt.z,wt),p[r+u]=wt.x,p[r+u+1]=wt.y,p[r+u+2]=wt.z,p[r+u+3]=wt.w,_[n+2*o]=-Pt.x,_[n+2*o+1]=Pt.y,_[n+2*o+2]=-Pt.z,kt(-Pt.x,Pt.y,-Pt.z,wt),p[r+2*u]=wt.x,p[r+2*u+1]=wt.y,p[r+2*u+2]=wt.z,p[r+2*u+3]=wt.w,_[n+3*o]=Pt.x,_[n+3*o+1]=Pt.y,_[n+3*o+2]=-Pt.z,kt(Pt.x,Pt.y,-Pt.z,wt),p[r+3*u]=wt.x,p[r+3*u+1]=wt.y,p[r+3*u+2]=wt.z,p[r+3*u+3]=wt.w,_[n+4*o]=-Pt.x,_[n+4*o+1]=-Pt.y,_[n+4*o+2]=Pt.z,kt(-Pt.x,-Pt.y,Pt.z,wt),p[r+4*u]=wt.x,p[r+4*u+1]=wt.y,p[r+4*u+2]=wt.z,p[r+4*u+3]=wt.w,_[n+5*o]=-Pt.x,_[n+5*o+1]=-Pt.y,_[n+5*o+2]=-Pt.z,kt(-Pt.x,-Pt.y,-Pt.z,wt),p[r+5*u]=wt.x,p[r+5*u+1]=wt.y,p[r+5*u+2]=wt.z,p[r+5*u+3]=wt.w,_[n+6*o]=Pt.x,_[n+6*o+1]=-Pt.y,_[n+6*o+2]=-Pt.z,kt(Pt.x,-Pt.y,-Pt.z,wt),p[r+6*u]=wt.x,p[r+6*u+1]=wt.y,p[r+6*u+2]=wt.z,p[r+6*u+3]=wt.w,_[n+7*o]=Pt.x,_[n+7*o+1]=-Pt.y,_[n+7*o+2]=Pt.z,kt(Pt.x,-Pt.y,Pt.z,wt),p[r+7*u]=wt.x,p[r+7*u+1]=wt.y,p[r+7*u+2]=wt.z,p[r+7*u+3]=wt.w}const f=[{semantic:n.c.SEMANTIC_POSITION,components:3,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TEXCOORD0,components:4,type:n.c.TYPE_FLOAT32}],g=_.length/3,y=new h(d,f),E=new c(d,y,g),A=new Ft(E);for(let t=0;t<g;t++)A.element[n.c.SEMANTIC_POSITION].set(_[3*t],_[3*t+1],_[3*t+2]),A.element[n.c.SEMANTIC_TEXCOORD0].set(p[4*t],p[4*t+1],p[4*t+2],p[4*t+3]),A.next();return A.end(),t.vertexBuffer=E,t.indexBuffer[0]=new l(d,n.c.INDEXFORMAT_UINT16,5040,n.c.BUFFER_STATIC,m.buffer),t.primitive[0].type=n.c.PRIMITIVE_TRIANGLES,t.primitive[0].base=0,t.primitive[0].count=m.length,t.primitive[0].indexed=!0,t.aabb.setToInfinity(),t}}class Vt{constructor(t){if(this._colorBuffer=t.colorBuffer,this._glFrameBuffer=null,this._glDepthBuffer=null,this._depthBuffer=t.depthBuffer,this._face=void 0!==t.face?t.face:0,this._depthBuffer){const t=this._depthBuffer._format;t===n.c.PIXELFORMAT_DEPTH?(this._depth=!0,this._stencil=!1):t===n.c.PIXELFORMAT_DEPTHSTENCIL?(this._depth=!0,this._stencil=!0):(console.warn("Incorrect depthBuffer format. Must be PIXELFORMAT_DEPTH or PIXELFORMAT_DEPTHSTENCIL"),this._depth=!1,this._stencil=!1)}else this._depth=void 0===t.depth||t.depth,this._stencil=void 0!==t.stencil&&t.stencil;this._samples=void 0!==t.samples?t.samples:1,this.autoResolve=void 0===t.autoResolve||t.autoResolve,this._glResolveFrameBuffer=null,this._glMsaaColorBuffer=null,this._glMsaaDepthBuffer=null,this._device=null}destroy(){if(!this._device)return;const t=this._device,e=t.targets.indexOf(this);-1!==e&&t.targets.splice(e,1);const i=t.gl;this._glFrameBuffer&&(i.deleteFramebuffer(this._glFrameBuffer),this._glFrameBuffer=null),this._glDepthBuffer&&(i.deleteRenderbuffer(this._glDepthBuffer),this._glDepthBuffer=null),this._glResolveFrameBuffer&&(i.deleteFramebuffer(this._glResolveFrameBuffer),this._glResolveFrameBuffer=null),this._glMsaaColorBuffer&&(i.deleteRenderbuffer(this._glMsaaColorBuffer),this._glMsaaColorBuffer=null),this._glMsaaDepthBuffer&&(i.deleteRenderbuffer(this._glMsaaDepthBuffer),this._glMsaaDepthBuffer=null)}resolve(t=!0,e=!!this._depthBuffer){if(!this._device)return;if(!this._device.webgl2)return;const i=this._device.gl;i.bindFramebuffer(n.c.READ_FRAMEBUFFER,this._glFrameBuffer),i.bindFramebuffer(n.c.DRAW_FRAMEBUFFER,this._glResolveFrameBuffer),i.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,(t?i.COLOR_BUFFER_BIT:0)|(e?i.DEPTH_BUFFER_BIT:0),i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this._glFrameBuffer)}get colorBuffer(){return this._colorBuffer}get depthBuffer(){return this._depthBuffer}get face(){return this._face}get width(){return this._colorBuffer?this._colorBuffer.width:this._depthBuffer.width}get height(){return this._colorBuffer?this._colorBuffer.height:this._depthBuffer.height}}var jt=i(6);const Gt={precisionCode:function(t){let e="precision "+t.precision+" float;\n";return t.webgl2&&(e+="#ifdef GL2\nprecision "+t.precision+" sampler2DShadow;\n#endif\n"),e},versionCode:function(t){return t.webgl2?"#version 300 es\n":""},dummyFragmentCode:function(){return"void main(void) {gl_FragColor = vec4(0.0);}"},begin:function(){return"void main(void)\n{\n"},end:function(){return"}\n"}},Ht={vertex_position:jt.a.SEMANTIC_POSITION,vertex_normal:jt.a.SEMANTIC_NORMAL,vertex_tangent:jt.a.SEMANTIC_TANGENT,vertex_texCoord0:jt.a.SEMANTIC_TEXCOORD0,vertex_texCoord1:jt.a.SEMANTIC_TEXCOORD1,vertex_texCoord2:jt.a.SEMANTIC_TEXCOORD2,vertex_texCoord3:jt.a.SEMANTIC_TEXCOORD3,vertex_texCoord4:jt.a.SEMANTIC_TEXCOORD4,vertex_texCoord5:jt.a.SEMANTIC_TEXCOORD5,vertex_texCoord6:jt.a.SEMANTIC_TEXCOORD6,vertex_texCoord7:jt.a.SEMANTIC_TEXCOORD7,vertex_color:jt.a.SEMANTIC_COLOR,vertex_boneIndices:jt.a.SEMANTIC_BLENDINDICES,vertex_boneWeights:jt.a.SEMANTIC_BLENDWEIGHT},Qt={convolveLastMipOfCubemapPS:"#extension GL_EXT_shader_texture_lod : enable\nhighp vec4 sampleCubeLod(highp samplerCube sampler, highp vec3 coord, mediump float lod) {\n#if defined(GL_EXT_shader_texture_lod)\n    return textureCubeLodEXT( sampler, coord, lod );\n#else\n    return textureCube( sampler, coord, lod );\n#endif\n}\nuniform highp samplerCube _Cubemap_; \nuniform highp float _Level_; \nvoid main() { \n    // just sample all directions (+X, -X etc) and average the result\n    gl_FragColor = vec4(( \n        sampleCubeLod( _Cubemap_, vec3( 1.0, 0.0, 0.0 ),  _Level_ ) + \n        sampleCubeLod( _Cubemap_, vec3( -1.0, 0.0, 0.0 ), _Level_ ) + \n        sampleCubeLod( _Cubemap_, vec3( 0.0, 1.0, 0.0 ),  _Level_ ) + \n        sampleCubeLod( _Cubemap_, vec3( 0.0, -1.0, 0.0 ), _Level_ ) + \n        sampleCubeLod( _Cubemap_, vec3( 0.0, 0.0, 1.0 ),  _Level_ ) +\n        sampleCubeLod( _Cubemap_, vec3( 0.0, 0.0, -1.0 ), _Level_ ) \n    ) * 0.1666666667); \n}",convolveLastMipOfCubemapVS:"attribute vec2 vertex_position; \nvoid main() { \n    gl_Position = vec4( vertex_position, 0.5, 1.0 ); \n}",fullscreenQuadVS:"attribute vec2 vertex_position;\nvarying vec2 vUv0;\nvoid main(void)\n{\n    gl_Position = vec4(vertex_position, 0.5, 1.0);\n    vUv0 = vertex_position.xy*0.5+0.5;\n}\n",gles3PS:"#define varying in\nout highp vec4 pc_fragColor;\n#define gl_FragColor pc_fragColor\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad\n#define GL2\n",gles3VS:"#define attribute in\n#define varying out\n#define texture2D texture\n#define GL2\n#define VERTEXSHADER\n"},Xt={convolveLastMipOfCubemapPS:Qt.convolveLastMipOfCubemapPS,convolveLastMipOfCubemapVS:Qt.convolveLastMipOfCubemapVS,fullscreenQuadVS:Qt.fullscreenQuadVS,gles3PS:Qt.gles3PS,gles3VS:Qt.gles3VS,collectAttribs(t){const e={};let i=0,s=t.indexOf("attribute");for(;s>=0&&!(s>0&&"/"===t[s-1]);){const n=t.indexOf(";",s),r=t.lastIndexOf(" ",n),a=t.substr(r+1,n-(r+1)),o=Ht[a];void 0!==o?e[a]=o:(e[a]="ATTR"+i,i++),s=t.indexOf("attribute",s+1)}return e},createShader(t,e,i,s=!1){let n=Qt[e],r=Gt.precisionCode(t)+"\n"+Qt[i];r=it(r);const a=this.collectAttribs(n);return t.webgl2&&(n=Gt.versionCode(t)+this.gles3VS+n,r=Gt.versionCode(t)+this.gles3PS+r),new at(t,{attributes:a,vshader:n,fshader:r,useTransformFeedback:s})},createShaderFromCode(t,e,i,s,n=!1){const r=t.programLib._cache,a=r[s];if(void 0!==a)return a;i=Gt.precisionCode(t)+"\n"+(i||Gt.dummyFragmentCode()),i=it(i);const o=this.collectAttribs(e);return t.webgl2&&(e=Gt.versionCode(t)+this.gles3VS+e,i=Gt.versionCode(t)+this.gles3PS+i),r[s]=new at(t,{attributes:o,vshader:e,fshader:i,useTransformFeedback:n}),r[s]}};let Yt=null;const Kt={type:n.c.PRIMITIVE_TRISTRIP,base:0,count:4,indexed:!1};const Wt=new Uint8Array([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1]),qt=new s.i(1,1,-1),Jt=new s.i(1,-1,-1);let $t=null,Zt=null;class te{constructor(t){this._device=t,this._cache={},this._generators={},this._isClearingCache=!1}register(t,e){this._generators[t]=e}clearCache(){const t=this._cache;this._isClearingCache=!0;for(const e in t)t.hasOwnProperty(e)&&t[e].destroy();this._cache={},this._isClearingCache=!1}removeFromCache(t){if(this._isClearingCache)return;const e=this._cache;for(const i in e)if(e.hasOwnProperty(i)&&e[i]===t){delete e[i];break}}}class ee{constructor(){this.globalId=0,this.revision=0}equals(t){return this.globalId===t.globalId&&this.revision===t.revision}notequals(t){return this.globalId!==t.globalId||this.revision!==t.revision}copy(t){this.globalId=t.globalId,this.revision=t.revision}reset(){this.globalId=0,this.revision=0}}class ie{constructor(t,e,i,s){this.locationId=s,this.scopeId=t.scope.resolve(e),this.version=new ee,i===n.c.UNIFORMTYPE_FLOAT&&"[0]"===e.substr(e.length-3)&&(i=n.c.UNIFORMTYPE_FLOATARRAY),this.dataType=i,this.value=null,this.dataType===n.c.UNIFORMTYPE_VEC2?this.value=[null,null]:this.dataType===n.c.UNIFORMTYPE_VEC3?this.value=[null,null,null]:this.value=[null,null,null,null],this.array=[],this.slot=-1,this.meta=null}}let se=0;class ne{constructor(){se++,this.version=new ee,this.version.globalId=se}increment(){this.version.revision++}}class re{constructor(t){this.name=t,this.value=null,this.previous_value=null,this.versionObject=new ne}setValue(t){this.value=t,this.previous_value=null,this.versionObject.increment()}pushValue(t){if(this.previous_value)throw new Error("pushValue is limited to storing 1 previous value");const e=this.value;this.setValue(t),this.previous_value=e}popValue(){this.setValue(this.previous_value)}getValue(){return this.value}}class ae{constructor(t){this.name=t,this.variables={}}resolve(t){return this.variables.hasOwnProperty(t)||(this.variables[t]=new re(t)),this.variables[t]}}const oe="resizecanvas",he=new Float32Array([1,1,1,1]),ce=new Float32Array([0,0,0,0]),le=new Float32Array([0,0,0,1]),ue=new Float32Array([1,0,0,1]),de=new Float32Array([0,0,1,1]),_e=function(t,e){const i=t.width,s=t.height;if(i>e||s>e){const n=e/Math.max(i,s),r=Math.floor(i*n),a=Math.floor(s*n);console.warn("Image dimensions larger than max supported texture size of "+e+". Resizing from "+i+", "+s+" to "+r+", "+a+".");const o=document.createElement("canvas");o.width=r,o.height=a;return o.getContext("2d").drawImage(t,0,0,i,s,0,0,r,a),o}return t};function pe(t,e){let i=!0;const s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null);const n=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&(i=!1),t.bindTexture(t.TEXTURE_2D,null),t.deleteTexture(s),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(n),i}class me{constructor(t){this.func=void 0===t.func?n.c.FUNC_ALWAYS:t.func,this.ref=t.ref||0,this.readMask=void 0===t.readMask?255:t.readMask,this.writeMask=void 0===t.writeMask?255:t.writeMask,this.fail=t.fail||n.c.STENCILOP_KEEP,this.zfail=t.zfail||n.c.STENCILOP_KEEP,this.zpass=t.zpass||n.c.STENCILOP_KEEP}clone(){return new me({func:this.func,ref:this.ref,readMask:this.readMask,writeMask:this.writeMask,fail:this.fail,zfail:this.zfail,zpass:this.zpass})}}const fe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ge=1/(4*Math.PI),ye=1/(2*Math.PI),Ee=15/(16*Math.PI),Ae=5/(64*Math.PI),Te=15/(64*Math.PI),Ce=new s.b,be=new s.i,Se=new Float64Array(fe);class xe{constructor(t=fe){this.data=new Float64Array(t),this.uniforms=null}get(t,e){return this.data[9*t+e]}set(t,e,i){this.data[9*t+e]=i}copy(t){for(let e=0;e<this.data.length;e++)this.data[e]=t.data[e]}clear(){for(let t=0;t<this.data.length;t++)this.data[t]=0}setFromInterpolation(t,e){for(let i=0;i<this.data.length;i++){this.data[i]=0;for(let s=0;s<t.length;s++)this.data[i]+=t[s].data[i]*e[s]}}addCubemap(t,e){const i=t.width;let s=0;const n=this.data;Se.set(fe),this.data=Se;for(let n=0;n<6;n++){const r=t._levels[0][n];for(let t=0;t<i;t++)for(let a=0;a<i;a++){const o=t*i+a,h=a/(i-1)*2-1,c=t/(i-1)*2-1,l=1+h*h+c*c,u=4/(Math.sqrt(l)*l);switch(be.set(h,-c,1).normalize(),n){case 0:be.set(be.z,-be.y,-be.x);break;case 1:be.set(-be.z,-be.y,be.x);break;case 2:be.set(be.x,be.z,be.y);break;case 3:be.set(be.x,-be.z,-be.y);break;case 4:be.set(be.x,-be.y,be.z);break;case 5:be.set(-be.x,-be.y,-be.z)}Ce.set(r[4*o+0]/255,r[4*o+1]/255,r[4*o+2]/255,1),this.addDirectionalLight(be,Ce,e,u/2.956),s+=u}}for(let t=0;t<this.data.length;t++)n[t]+=4*Se[t]*Math.PI/s;this.data=n}addAmbientLight(t){Ce.copy(t).toLinear(),this.data[0]+=Ce.r,this.data[9]+=Ce.g,this.data[18]+=Ce.b}addSkyGradient(t,e,i){this.addAmbientLight(e),this.addDirectionalLight(s.i.UP,t,1,1),this.addDirectionalLight(s.i.DOWN,i,1,1)}addPointLight(t,e,i,n){const r=t.length()/n;be.copy(t).normalize();const a=(0,s.k)(1/(1+25*r*r)*(0,s.k)(5*(1-r),0,1),0,1);this.addDirectionalLight(be,e,i,a)}addSpotLight(t,e,i,s,n){this.addPointLight(t,e,i,s)}addDirectionalLight(t,e,i,s){Ce.copy(e).scale(i).toLinear().scale(2.956*s),this.addLightFromDirection(t,Ce)}addLightFromDirection(t,e){const i=ge,s=ye*t.y,n=ye*t.z,r=ye*t.x,a=Ee*(t.x*t.y),o=Ee*(t.y*t.z),h=Ae*(3*t.z*t.z-1),c=Ee*(t.x*t.z),l=Te*(t.x*t.x-t.y*t.y);this.data[0]+=e.r*i,this.data[1]+=e.r*s,this.data[2]+=e.r*n,this.data[3]+=e.r*r,this.data[4]+=e.r*a,this.data[5]+=e.r*o,this.data[6]+=e.r*h,this.data[7]+=e.r*c,this.data[8]+=e.r*l,this.data[9]+=e.g*i,this.data[10]+=e.g*s,this.data[11]+=e.g*n,this.data[12]+=e.g*r,this.data[13]+=e.g*a,this.data[14]+=e.g*o,this.data[15]+=e.g*h,this.data[16]+=e.g*c,this.data[17]+=e.g*l,this.data[18]+=e.b*i,this.data[19]+=e.b*s,this.data[20]+=e.b*n,this.data[21]+=e.b*r,this.data[22]+=e.b*a,this.data[23]+=e.b*o,this.data[24]+=e.b*h,this.data[25]+=e.b*c,this.data[26]+=e.b*l}updateUniforms(){this.uniforms||(this.uniforms=[new s.j,new s.j,new s.j,new s.j,new s.j,new s.j,new s.j]);for(let t=0;t<3;t++)this.uniforms[t].x=this.get(t,3),this.uniforms[t].y=this.get(t,1),this.uniforms[t].z=this.get(t,2),this.uniforms[t].w=this.get(t,0)-this.get(t,6);for(let t=0;t<3;t++)this.uniforms[t+3].x=this.get(t,4),this.uniforms[t+3].y=this.get(t,5),this.uniforms[t+3].z=3*this.get(t,6),this.uniforms[t+3].w=this.get(t,7);this.uniforms[6].x=this.get(0,8),this.uniforms[6].y=this.get(1,8),this.uniforms[6].z=this.get(2,8),this.uniforms[6].w=1;for(let t=0;t<7;t++)this.uniforms[t].data}isEmpty(){for(let t=0;t<this.data.length;t++)if(Math.abs(this.data[t])>=1e-8)return!1;return!0}}xe.fromArray=function(t){const e=new xe([]);return e.data=t,e};const De=[new s.h(0,1),new s.h(1,1),new s.h(0,0),new s.h(1,0)],Me=[0,1,2,2,1,3],Re=[0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,4,5,9,9,8,4,5,6,10,10,9,5,6,7,11,11,10,6,8,9,13,13,12,8,9,10,14,14,13,9,10,11,15,15,14,10],Ie=[!0,!1,!1,!1,!1,!1,!0,!1,!1,!1],Oe=(t,e,i,s,n,r)=>{t[e]=i,t[e+1]=s,t[e+2]=0,t[e+3]=n,t[e+4]=r},Fe=(t,e,i)=>{if(t<=e)return 1;{const s=t/e,n=Math.ceil(s)-s<1e-5?Math.ceil(s):s;return Math.floor(t%e/e/e<i?n:n+1)}},Pe=(t,e,i)=>{const n=i.x,r=i.y,a=.5*n,o=.5*r,h=new s.h(t.pivotNormalized.x*n,t.pivotNormalized.y*r),c=t.getBorderUnits(),l=t.getInnerUvRect(),u=t.getOuterUvRect(),d=new s.h(n-c.x-c.z,r-c.y-c.w),_=n>c.x+c.z?[-h.x,-h.x+c.x,-h.x+c.x+d.x,-h.x+n]:[-h.x,-h.x+a,-h.x+a,-h.x+n],p=r>c.y+c.w?[-h.y,-h.y+c.y,-h.y+c.y+d.y,-h.y+r]:[-h.y,-h.y+o,-h.y+o,-h.y+r],m=[u.x,l.x,l.z,u.z],f=[u.y,l.y,l.w,u.w],g=e.vertexBuffer;return((t,e,i,s,n)=>{for(let r=0;r<4;r++)for(let a=0;a<4;a++)Oe(t,5*(4*r+a),e[a],i[r],s[a],n[r])})(new Float32Array(g.storage),_,p,m,f),g.unlock(),e.recalculateBounds(),e},ve=(t,e,i,r)=>{const a=new h(I.a.getApplication().graphicsDevice,[{semantic:n.c.SEMANTIC_POSITION,components:3,type:n.c.TYPE_FLOAT32},{semantic:n.c.SEMANTIC_TEXCOORD0,components:2,type:n.c.TYPE_FLOAT32}]),o=e.x,u=e.y,d=t.border,_=t.pixelSize,p=t.pixelsPerUnit,m=(new s.j).copy(d).scale(1/p),f=new s.h((_.x-d.x-d.z)/p,(_.y-d.y-d.w)/p),g=new s.h(o-m.x-m.z,u-m.y-m.w);let y,E=4,A=4;if(i===UnityEngine.SpriteTileMode.Continuous)E+=2*Math.max(0,Math.ceil(g.x/f.x)),A+=2*Math.max(0,Math.ceil(g.y/f.y)),y=new s.h(g.x%f.x,g.y%f.y);else if(i===UnityEngine.SpriteTileMode.Adaptive){const t=Fe(g.x,f.x,r);f.x=g.x/t,E+=Math.max(0,2*t);const e=Fe(g.y,f.y,r);f.y=g.y/e,A+=Math.max(0,2*e),y=f}const T=E*A,b=(E-1)*(A-1)*6,S=new l(I.a.getApplication().graphicsDevice,n.c.INDEXFORMAT_UINT16,b);let x=0;const D=new Uint16Array(S.lock());for(let t=0;t<A-1;t++)for(let e=0;e<E-1;e++){const i=t*E+e;D[x++]=i,D[x++]=i+1,D[x++]=i+E,D[x++]=i+1,D[x++]=i+1+E,D[x++]=i+E}S.unlock(),S.preventDestroy=!0;const M=new Float32Array(5*T),R=new c(I.a.getApplication().graphicsDevice,a,0);R.storage=M.buffer,R.numVertices=T,R.unlock();const O=new C;return O.vertexBuffer=R,O.indexBuffer[0]=S,O.primitive[0].type=n.c.PRIMITIVE_TRIANGLES,O.primitive[0].base=0,O.primitive[0].count=b,O.primitive[0].indexed=!0,O.aabb=new s.a(new s.i(t.aabb[0],t.aabb[1],t.aabb[2]),new s.i(t.aabb[3],t.aabb[4],t.aabb[5])),O.subMeshes=[O],((t,e,i,n,r,a,o)=>{const h=i.x,c=i.y,l=new s.h(t.pivotNormalized.x*h,t.pivotNormalized.y*c),u=t.border,d=t.borderUv,_=t.getBorderUnits(),p=t.getInnerUvRect(),m=t.getOuterUvRect(),f=new s.h(1-d.z-d.x,1-d.w-d.y),g=new s.h(h-_.x-_.z,c-_.y-_.w),y=new s.h(f.x*(o.x/a.x),f.y*(o.y/a.y));let E,A;const T=_.x+_.z;if(h>T)E=[-l.x,-l.x+_.x,-l.x+_.x+g.x,-l.x+h],A=[m.x,p.x,p.z,m.z];else{const t=u.x/(u.x+u.z)*h;E=[-l.x,-l.x+t,-l.x+t,-l.x+h];const e=h/T;A=[m.x,m.x+d.x*e,p.z,p.z+d.z*e]}let C,b;const S=_.y+_.w;if(c>S)C=[-l.y,-l.y+_.y,-l.y+_.y+g.y,-l.y+c],b=[m.y,p.y,p.w,m.w];else{const t=c/S,e=u.y/(u.y+u.w)*c;C=[-l.y,-l.y+e,-l.y+e,-l.y+c],b=[m.y,m.y+d.y*t,p.w,p.w+d.w*t]}const x=e.vertexBuffer,D=new Float32Array(x.storage);let M=0,R=0,I=0;const O=new s.h(E[0],C[0]);for(let t=0;t<r;t++){let e=0;for(0===t?(e=b[0],O.y=C[0]):1===t?(e=b[1],O.y=C[1]):t===r-3?(e=b[1]+y.y,O.y=C[2]):t===r-2?(e=b[2],O.y=C[2]):t===r-1?(e=b[3],O.y=C[3]):e=t%2==0?b[1]:b[2],R=t*n,I=5*R,Oe(D,I,E[0],O.y,A[0],e),R+=1,I=5*R,Oe(D,I,E[1],O.y,A[1],e),O.x=E[1],M=2;M<n-4;M+=2)R=t*n+M,I=5*R,Oe(D,I,O.x,O.y,A[1],e),O.x+=M===n-4?o.x:a.x,R+=1,I=5*R,Oe(D,I,O.x,O.y,A[2],e);n>4&&(M=n-4,R=t*n+M,I=5*R,Oe(D,I,O.x,O.y,A[1],e),O.x+=o.x,R+=1,I=5*R,Oe(D,I,E[2],O.y,A[1]+y.x,e)),M=n-2,R=t*n+M,I=5*R,Oe(D,I,E[2],O.y,A[2],e),M=n-1,R=t*n+M,I=5*R,Oe(D,I,E[3],O.y,A[3],e),t===r-4?O.y+=o.y:t%2==0&&(O.y+=a.y)}x.unlock()})(t,O,e,E,A,f,y),O};class we{constructor(t){this.$id="",this.attributes=t,this.$sprite=!0,this.mesh=null,this["__UnityEngine.Sprite"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Sprite")}getUvRect(){const t=this.textureRect,e=this.texture;return new s.j(t.x/e.width,t.y/e.height,(t.z-t.x)/e.width,(t.w-t.y)/e.height)}getInnerUvRect(){const t=this.uvRect,e=this.borderUv;return new s.j(t.x+e.x,t.y+e.y,t.x+t.z-e.z,t.y+t.w-e.w)}getOuterUvRect(){const t=this.uvRect;return new s.j(t.x,t.y,t.x+t.z,t.y+t.w)}getPivot(){return this.attributes.pivot}getPivotNormalized(){const t=this.attributes.textureRect;return new s.h((this.attributes.pivot.x-t.x)/t.z,(this.attributes.pivot.y-t.y)/t.w)}getAABB(){return this.attributes.aabb}getVertices(){const t=new Array(this.attributes.vertices.length/5);for(let e=0;e<t.length;e++)t[e]=new s.h(this.attributes.vertices[5*e],this.attributes.vertices[5*e+1]);return t}getTriangles(){return this.attributes.triangles}getTextureRect(){return this.attributes.textureRect}getBorder(){return this.attributes.border}getBorderUnits(){const t=this.border,e=this.pixelsPerUnit;return(new s.j).copy(t).scale(1/e)}getBorderUv(){const t=this.uvRect,e=this.border,i=this.pixelSize;return new s.j(t.z*(e.x/i.x),t.w*(e.y/i.y),t.z*(e.z/i.x),t.w*(e.w/i.y))}getTexture(){return this.attributes.texture}getTransparency(){return this.attributes.transparency}getBounds(){return this.attributes.bounds}getPixelsPerUnit(){return this.attributes.pixelsPerUnit}getTextureRectOffset(){return this.attributes.textureRectOffset}getMesh(){return this.mesh||(this.mesh=this.attributes.vertices?(t=>{const e=new C,i=new Float32Array(t.attributes.vertices),s=t.attributes.vertices.length/5;return e.vertexBuffer=e.defaultVertexBuffer(Ie,s,i.buffer),e.setIndicies(t.attributes.triangles,UnityEngine.MeshTopology.Triangles,0,!0,0),e})(this):(t=>{const e=new C,i=t.pixelsPerUnit,r=t.pixelSize,a=t.getPivotNormalized(),o=new s.i(-a.x*r.x/i,-a.y*r.y/i,0),h=new s.i((1-a.x)*r.x/i,(1-a.y)*r.y/i,0),c=[new s.i(o.x,h.y,0),new s.i(h.x,h.y,0),new s.i(o.x,o.y,0),new s.i(h.x,o.y,0)];return e.setVectorStream({_items:c,_size:c.length},n.c.SEMANTIC_POSITION,3),e.setVectorStream({_items:De,_size:De.length},n.c.SEMANTIC_TEXCOORD0,2),e.setIndicies(Me,UnityEngine.MeshTopology.Triangles,0,!0,0),e})(this)),this.mesh}get9SlicedMesh(t){return((t,e)=>{const i=new C,s=new Float32Array(80);return i.vertexBuffer=i.defaultVertexBuffer(Ie,16,s.buffer),i.setIndicies(Re,UnityEngine.MeshTopology.Triangles,0,!1,0),Pe(t,i,e)})(this,t)}updateMesh(t,e){return Pe(this,t,e)}get9TiledMesh(t,e,i){return ve(this,t,e,i)}updateMeshTiled(t,e){return Pe(this,t,e)}get pivotNormalized(){return this.getPivotNormalized()}get pivot(){return this.getPivot()}get aabb(){return this.getAABB()}get transparency(){return this.getTransparency()}get textureRect(){return this.getTextureRect()}get pixelsPerUnit(){return this.getPixelsPerUnit()}get texture(){return this.getTexture()}get border(){return this.getBorder()}get borderUv(){return this.getBorderUv()}get uvRect(){return this.getUvRect()}get vertices(){return this.getVertices()}get pixelSize(){return new s.h(this.textureRect.z,this.textureRect.w)}}we.create=(t,e,i,n,r,a,o)=>{const h=(e.z-e.x)/2/n,c=(e.w-e.y)/2/n;return new we({aabb:[0,0,0,h,c,0],border:o,bounds:[-h,-c,h,c],pixelsPerUnit:n,texture:t,textureRect:(new s.j).copy(e),transparency:new s.j(0,0,0,0),triangles:[0,1,2,2,1,3],vertices:[-h,c,0,0,1,h,c,0,1,1,-h,-c,0,0,0,h,-c,0,1,0],pivot:i.clone()})};class Le{constructor(t,e,i,s,n,r){this.mesh=t,this.matrix=e,this.material=i,this.submeshIndex=s,this.shaderPass=n,this.materialPropertyBlock=r}}const Be={x:0,y:0,width:1,height:1},Ue=new v,Ne=new s.e;let ke=null,ze=null;const Ve={executeCommandBuffer:function(t){if(!t)return;ke||(ke=new I.c,ke.name="CommandBufferDrawCall");const e=I.a.getApplication().renderer,i=e.device,s=t.renderTargetIdentifier.target["__UnityEngine.RenderTexture"].renderTarget;i.setRenderTarget(s),i.updateBegin(),i.setColorWrite(!0,!0,!0,!0),i.setDepthWrite(!0),e.setupViewport(Be,s.width,s.height),t.view&&t.proj?Ne.mul2(t.proj,t.view):Ne.copy(UnityEngine.GL.matrix),e.viewProjId.setValue(Ne.data),e.unityIds.viewProjId.setValue(Ne.data);const n=t.clearCommand;n&&s&&e.clearTarget(s,n);for(let i=0;i<t.commands.length;i++){const s=t.commands[i],n=s.mesh,r=-1===s.submeshIndex?n.subMeshes:[n.subMeshes[s.submeshIndex]];for(let t=0;t<r.length;t++){const i=r[t];ke.setWorldTransform(s.matrix),ze?(ze.node=ke,ze.mesh=i,ze.material=s.material):ze=new b(ke,i,s.material);const n=s.materialPropertyBlock;n&&n.applyToMeshInstance(ze),e.renderMeshInstance(Ue,null,null,ze,null)}}}};const je=new s.i;let Ge=3;const He=[n.c.STENCILOP_KEEP,n.c.STENCILOP_ZERO,n.c.STENCILOP_REPLACE,n.c.STENCILOP_INCREMENT,n.c.STENCILOP_INCREMENT,n.c.STENCILOP_DECREMENT,n.c.STENCILOP_INVERT,n.c.STENCILOP_INCREMENTWRAP,n.c.STENCILOP_DECREMENTWRAP],Qe=[n.c.CULLFACE_NONE,n.c.CULLFACE_FRONT,n.c.CULLFACE_BACK],Xe=[n.c.BLENDMODE_ZERO,n.c.BLENDMODE_ONE,n.c.BLENDMODE_DST_COLOR,n.c.BLENDMODE_SRC_COLOR,n.c.BLENDMODE_ONE_MINUS_DST_COLOR,n.c.BLENDMODE_SRC_ALPHA,n.c.BLENDMODE_ONE_MINUS_SRC_COLOR,n.c.BLENDMODE_DST_ALPHA,n.c.BLENDMODE_ONE_MINUS_DST_ALPHA,n.c.BLENDMODE_SRC_ALPHA_SATURATE,n.c.BLENDMODE_ONE_MINUS_SRC_ALPHA],Ye=function(t,e){return e._priority-t._priority},Ke=new s.i,We=[],qe={opacityMapChannelIDs:{r:1,g:2,b:3,a:4},getLightsData(t,e,i){if(i.reset(),We.length=0,0===e.length)return;let r=-1;const a=t.node,o=1<<a.cullingLayer,h=a.getPosition(),c=t.aabb,l=c.getMax(),u=c.getMin(),d=(l.x-u.x)*(l.y-u.y)*(l.z-u.z);Ge=UnityEngine.RenderSettings._pixelLightCount;for(let t=0;t<e.length;t++){const a=e[t];if(0==(a._cullingMask&o))continue;if(0==(a._mask&n.c.MASK_DYNAMIC))continue;const _=a._aabb.getMax(),p=a._aabb.getMin();let m=Math.max(0,Math.min(l.x,_.x)-Math.max(u.x,p.x))*Math.max(0,Math.min(l.y,_.y)-Math.max(u.y,p.y))*Math.max(0,Math.min(l.z,_.z)-Math.max(u.z,p.z));if(0===d)m=a._aabb.intersects(c)?1:0;else if(m<=0)continue;if(a._type===n.c.LIGHTTYPE_DIRECTIONAL&&!a._cookie&&a._renderMode!==UnityEngine.LightRenderMode.ForceVertex){const t=i.mainLight;(null===t||t._luminance<a._luminance||t._luminance===a._luminance&&a._renderMode===UnityEngine.LightRenderMode.ForcePixel&&t._renderMode!==UnityEngine.LightRenderMode.ForcePixel)&&(i.mainLight=a)}if(a._effectiveLuminance=a._luminance,a._type!==n.c.LIGHTTYPE_DIRECTIONAL){Ke.sub2(a._position,h),a._directionToLight.copy(Ke);const t=Ke.length()/a.attenuationEnd;a._effectiveLuminance*=(0,s.k)(1/(1+25*t*t)*(0,s.k)(5*(1-t),0,1),0,1),a._range=t}We.push(a),a===i.mainLight&&(r=We.length-1),a._priority=m/(0===d?1:d),a._renderMode===UnityEngine.LightRenderMode.ForcePixel&&(a._priority+=1e4),a._renderMode===UnityEngine.LightRenderMode.Auto&&(a._priority+=100)}r>=0&&(We[r]=We[We.length-1],We.length-=1),We.sort(Ye);let _=0;for(_=0;_<We.length;_++){const t=We[_];if(i.pixelLights.length>=Ge)break;if(t._renderMode===UnityEngine.LightRenderMode.ForceVertex)break;i.pixelLights.push(t)}for(;_<We.length;_++){const t=We[_];if(!(t._effectiveLuminance<1e-4)){if(i.vertexLights.length>=4)break;t._type===n.c.LIGHTTYPE_DIRECTIONAL?i.otherLights.push(t):i.vertexLights.push(t)}}for(;_<We.length;_++)i.otherLights.push(We[_]);i.combineAllLights()},unityCompareFunctionToPlaycanvas:t=>t-1,unityStencilOpToPlaycanvas:t=>He[t],unityBlendModeToPlaycanvas:t=>Xe[t],unityCullModeToPlaycanvas:t=>Qe[t],unityBlendOpToPlaycanvas:t=>t<=UnityEngine.Rendering.BlendOp.Max?t:null},Je={genericSort:function(t,e){const i=t._material,s=e._material;if(!i||!s)return 0;if(i.renderQueue!==s.renderQueue)return i.renderQueue-s.renderQueue;if(t.sortingLayerIndex!==e.sortingLayerIndex)return t.sortingLayerIndex-e.sortingLayerIndex;if(t.sortingOrder!==e.sortingOrder)return t.sortingOrder-e.sortingOrder;if(t.drawOrder!==e.drawOrder)return t.drawOrder-e.drawOrder;const n=i.renderQueue>2500?-1:1;return t.zdist&&e.zdist&&t.zdist!==e.zdist?(t.zdist-e.zdist)*n:i.id!==s.id?i.id-s.id:t.mesh.id-e.mesh.id},uiElementsSort:function(t,e){return t.drawOrder-e.drawOrder},calculateSortDistances:function(t,e,i){for(let s=0;s<t.length;s++){const n=t[s],r=n.aabb.center;n.zdist=(r.x-e.x)*i.x+(r.y-e.y)*i.y+(r.z-e.z)*i.z}},cameraCompare:function(t,e){return t.priority-e.priority},sortOverlayCanvases:function(t,e){return t.sortingOrder!==e.sortingOrder?t.sortingOrder-e.sortingOrder:t.$id-e.$id}},$e="unity_GUIZTestMode";pc.Mesh=C,pc.MeshInstance=b,pc.Model=R,pc.Material=ut,pc.UnityMaterial=_t,pc.Camera=class{constructor(){this._projection=n.c.PROJECTION_PERSPECTIVE,this._nearClip=.1,this._farClip=1e4,this._fov=45,this._orthoHeight=10,this._aspect=16/9,this._horizontalFov=!1,this.cullingMask=4294967295,this._lastAabbVer=-1,this._projMatDirty=!0,this._projMat=new s.e,this._projInvMat=new s.e,this._viewMatDirty=!0,this._viewMat=new s.e,this._viewInvMat=new s.e,this._viewProjMatDirty=!0,this._viewProjMat=new s.e,this._invViewProjMat=new s.e,this._projMatOverride=null,this._rect={x:0,y:0,width:1,height:1},this._scissorRect={x:0,y:0,width:1,height:1},this._frustumDirty=!0,this._frustum=new s.d(this._projMat,this._viewMat),this.renderTarget=null,this._clearOptions={color:[.5,.5,.5,1],depth:1,stencil:0,flags:n.c.CLEARFLAG_COLOR|n.c.CLEARFLAG_DEPTH|n.c.CLEARFLAG_STENCIL|n.c.CLEARFLAG_USE_SKYBOX,skybox:!0},this._node=null,this.calculateTransform=null,this._overrideCalculateTransform=!1,this._component=null,this._zbufferParams=new Float32Array(4),this._screenParams=new Float32Array(4),this._orthoParams=new Float32Array(4),this._projectionParams=new Float32Array(4)}worldToScreen(t,e,i,n=new s.i){return this.viewProjMat.multiplyPoint(t,n),n.x=.5*(n.x+1)*e,n.y=.5*(n.y+1)*i,gt.sub2(t,this._node.getPosition()),n.z=gt.dot(this._node.forward),n}screenToWorld(t,e,i,r,a,o=new s.i){const h=this._node.getPosition(),c=this.invViewProjMat;if(this._projection===n.c.PROJECTION_PERSPECTIVE){mt.set(t/r*2-1,e/a*2-1,1),c.transformPoint(mt,ft);const s=mt.x*c.data[3]+mt.y*c.data[7]+mt.z*c.data[11]+c.data[15];ft.scale(1/s);const n=i/this._farClip;o.lerp(h,ft,n)}else{const n=this._farClip-this._nearClip;pt.set(t/r,e/a,(i-this._nearClip)/n),pt.scale(2),pt.sub(s.i.ONE),c.transformPoint(pt,o)}return o}setProjectionMatrix(t){this._projMatOverride=t?t.clone():null,this._projMatDirty=!0}_updateScreens(){const t=I.a.getApplication().scene.worldScreens;for(let e=0;e<t.length;e++){const i=t[e];i.screenType===n.c.SCREEN_TYPE_CAMERA&&i._calcProjectionMatrix()}}getRect(){return this._rect}setRect(t,e,i,s){this._rect.x=t,this._rect.y=e,this._rect.width=i,this._rect.height=s,this._projMatDirty=!0}setScissorRect(t,e,i,s){this._scissorRect.x=t,this._scissorRect.y=e,this._scissorRect.width=i,this._scissorRect.height=s}resetProjectionMatrix(){this._projMatOverride=null,this._projMatDirty=!0}updateProjMat(){if(this._projMatOverride)this._projMat.copy(this._projMatOverride);else if(this._projection===n.c.PROJECTION_PERSPECTIVE)this._projMat.setPerspective(this._fov,this._aspect,this._nearClip,this._farClip,this._horizontalFov);else{const t=this._orthoHeight,e=t*this._aspect;this._projMat.setOrtho(-e,e,-t,t,this._nearClip,this._farClip)}const t=this._nearClip,e=this._farClip,i=this.aspectRatio,s=this.orthoHeight;this._orthoParams[0]=s*i,this._orthoParams[1]=s,this._orthoParams[2]=0,this._orthoParams[3]=this.projection===n.c.PROJECTION_ORTHOGRAPHIC?1:0,this._zbufferParams[0]=1-e/t,this._zbufferParams[1]=e/t,this._zbufferParams[2]=this._zbufferParams[0]/e,this._zbufferParams[3]=this._zbufferParams[1]/e,this._projectionParams[0]=1,this._projectionParams[1]=t,this._projectionParams[2]=e,this._projectionParams[3]=1/e,this._projInvMat.copy(this._projMat).invert(),this._updateScreens(),this._frustumDirty=!0,this._projMatDirty=!1,this._viewProjMatDirty=!0}updateViewMat(){const t=this._node;if(this._overrideCalculateTransform)this.calculateTransform(this._viewInvMat,n.c.VIEW_CENTER);else{const e=t.getPosition(),i=t.getRotation();this._viewInvMat.setTRS(e,i,s.i.REVERSED_Z)}this._viewMat.copy(this._viewInvMat).invert();const e=t.getLossyScale();0!==e.x&&0!==e.y&&0!==e.z||console.warn("Camera world transform matrix has 0 scale. That leads to losing rotation data"),this._frustumDirty=!0,this._viewMatDirty=!1,this._viewProjMatDirty=!0,this._lastAabbVer=t._aabbVer}set overrideCalculateTransform(t){this._viewMatDirty=!0,this._overrideCalculateTransform=t}get viewMatDirty(){return this._viewMatDirty||this._lastAabbVer!==this._node._aabbVer}get viewMat(){return this.viewMatDirty&&this.updateViewMat(),this._viewMat}get viewInvMat(){return this.viewMatDirty&&this.updateViewMat(),this._viewInvMat}get projMat(){return this._projMatDirty&&this.updateProjMat(),this._projMat}get projInvMat(){return this._projMatDirty&&this.updateProjMat(),this._projInvMat}get viewProjMat(){return(this.viewMatDirty||this._projMatDirty||this._viewProjMatDirty)&&(this._viewProjMat.mul2(this.projMat,this.viewMat),this._viewProjMatDirty=!1),this._viewProjMat}get invViewProjMat(){return(this.viewMatDirty||this._projMatDirty||this._viewProjMatDirty)&&this._invViewProjMat.copy(this.viewProjMat).invert(),this._invViewProjMat}get frustum(){return(this._frustumDirty||this.viewMatDirty||this._projMatDirty)&&(this._frustum.update(this.projMat,this.viewMat),this._frustumDirty=!1),this._frustum}get aspectRatio(){return this._aspect}set aspectRatio(t){this._aspect!==t&&(this._aspect=t,this._projMatDirty=!0)}get projection(){return this._projection}set projection(t){this._projection!==t&&(this._projection=t,this._projMatDirty=!0)}get nearClip(){return this._nearClip}set nearClip(t){this._nearClip!==t&&(this._nearClip=t,this._projMatDirty=!0)}get farClip(){return this._farClip}set farClip(t){this._farClip!==t&&(this._farClip=t,this._projMatDirty=!0)}get fov(){return this._fov}set fov(t){this._fov!==t&&(this._fov=t,this._projMatDirty=!0)}get horizontalFov(){return this._horizontalFov}set horizontalFov(t){this._horizontalFov!==t&&(this._horizontalFov=t,this._projMatDirty=!0)}get orthoHeight(){return this._orthoHeight}set orthoHeight(t){this._orthoHeight!==t&&(this._orthoHeight=t,this._projMatDirty=!0)}get clearColor(){return this._clearOptions.color}set clearColor(t){this._clearOptions.color[0]=t[0],this._clearOptions.color[1]=t[1],this._clearOptions.color[2]=t[2],this._clearOptions.color[3]=t[3]}get clearDepth(){return this._clearOptions.depth}set clearDepth(t){this._clearOptions.depth=t}get clearSkybox(){return this._clearOptions.skybox}set clearSkybox(t){this._clearOptions.skybox=t}get clearStencil(){return this._clearOptions.stencil}set clearStencil(t){this._clearOptions.stencil=t}get clearFlags(){return this._clearOptions.flags}set clearFlags(t){this._clearOptions.flags=t}},pc.Light=Mt,pc.Skin=class{constructor(t,e,i){this.device=t,this.inverseBindPose=e,this.boneNames=i,this.rootBone=null}},pc.MorphTargetFrame=class{constructor(t){const e=t.deltaPositions;this.indices=[];for(let t=0;t<e.length;t++)this.indices.push(t);this.deltaPositions=t.deltaPositions,this.deltaNormals=t.deltaNormals,this.deltaTangents=t.deltaTangents,this.weight=t.weight}},pc.Morph=class{constructor(t){this.aabb=new s.a,this._baseBuffer=null,this._baseAabb=null,this._targets=t,this._dirty=!0,this._aabbDirty=!0,this._baseData=null,this._offsetPF=0,this._offsetNF=0,this._offsetTF=0,this._vertSizeF=0}_setBaseMesh(t){this._baseBuffer=t.vertexBuffer,this._baseAabb=t._aabb,this._baseData=new Float32Array(this._baseBuffer.storage);let e=-1,i=-1,s=-1;const r=this._baseBuffer.format.elements,a=this._baseBuffer.format.size;for(let t=0;t<r.length;t++)r[t].name===n.c.SEMANTIC_POSITION?e=r[t].offset:r[t].name===n.c.SEMANTIC_NORMAL?i=r[t].offset:r[t].name===n.c.SEMANTIC_TANGENT&&(s=r[t].offset);this._offsetPF=e/4,this._offsetNF=i/4,this._offsetTF=s/4,this._vertSizeF=a/4,this._dirty=!0}_calculateAabb(){if(!this._baseBuffer)return;this.aabb.copy(this._baseAabb);const t=this._vertSizeF,e=this._offsetPF,i=this._baseData;for(let s=0;s<this._targets.length;s++){const n=this._targets[s];if(!n.aabb&&n.indices.length>0){n.aabb=this.aabb.clone(),Rt.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),It.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);const s=n.indices.length;for(let r=0;r<n.frames.length;r++){const a=n.frames[r].deltaPositions;for(let r=0;r<s;r++){const s=n.indices[r]*t+e,o=i[s]+a[3*r],h=i[s+1]+a[3*r+1],c=i[s+2]+a[3*r+2];Rt.x>o&&(Rt.x=o),Rt.y>h&&(Rt.y=h),Rt.z>c&&(Rt.z=c),It.x<o&&(It.x=o),It.y<h&&(It.y=h),It.z<c&&(It.z=c)}}n.aabb.setMinMax(Rt,It)}n.aabb&&this.aabb.add(n.aabb)}this._aabbDirty=!1}addTarget(t){this._targets.push(t),this._aabbDirty=!0}removeTarget(t){const e=this._targets.indexOf(t);-1!==e&&(this._targets.splice(e,1),this._aabbDirty=!0)}getTarget(t){return this._targets[t]}},pc.MorphInstance=class{constructor(t){this.morph=t,this._vertexBuffer=null,this._vertexData=null,this.weights={},this._dirty=!0}_setBaseMesh(t){this.destroy(),this._vertexBuffer=new c(this.morph._baseBuffer.device,this.morph._baseBuffer.format,this.morph._baseBuffer.numVertices,n.c.BUFFER_DYNAMIC,this.morph._baseBuffer.storage.slice(0)),this._vertexData=new Float32Array(this._vertexBuffer.storage),this.weights={};for(let t=0;t<this.morph._targets.length;t++)this.weights[this.morph._targets[t].name]=0;this._dirty=!0}destroy(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._vertexBuffer=null)}getWeight(t){const e=Object.keys(this.weights)[t];return this.weights[e]}setWeight(t,e){const i=Object.keys(this.weights)[t];this.weights[i]=e,this._dirty=!0}updateBounds(t){this.morph._baseBuffer!==t.vertexBuffer&&this.morph._setBaseMesh(t),this._vertexData||this._setBaseMesh(t),this.morph._aabbDirty&&this.morph._calculateAabb()}update(t){this.morph._baseBuffer!==t.vertexBuffer&&this.morph._setBaseMesh(t),this._vertexData||this._setBaseMesh(t);const e=this.morph._targets,i=Object.keys(this.weights).map((t=>this.weights[t]));this._vertexData.set(this.morph._baseData);for(let t=0;t<e.length;t++){const s=i[t];if(0===s)continue;const n=e[t],r=n.frames;if(1===r.length&&this._applyFrame(r[0],s,n),r.length>1){if(s<r[0].weight){const t=r[0],e=s/t.weight;this._applyFrame(t,e,n);continue}if(s>r[r.length-1].weight){const t=r[r.length-1],e=s/t.weight;this._applyFrame(t,e,n);continue}if(2===r.length){const t=r[0],e=r[1];this._applyFrame(t,1,n);const i=(s-t.weight)/(e.weight-t.weight);this._applyFrame(e,i,n);continue}let t,e;for(let i=0;i<r.length-1&&(t=i,e=i+1,!(r[t].weight<s&&s<r[e].weight));i++);const i=(s-r[t].weight)/(r[e].weight-r[t].weight);this._applyFrame(r[t],1-i,n),this._applyFrame(r[e],i,n)}}this._vertexBuffer.unlock()}_applyFrame(t,e,i){e/=100;const s=t.indices.length,n=this.morph._vertSizeF,r=this.morph._offsetPF,a=this.morph._offsetNF,o=this.morph._offsetTF,h=this._vertexData;for(let a=0;a<s;a++){const s=t.deltaPositions,o=3*a,c=i.indices[a]*n+r;h[c]+=s[o]*e,h[c+1]+=s[o+1]*e,h[c+2]+=s[o+2]*e}if(t.deltaNormals){const r=t.deltaNormals;for(let t=0;t<s;t++){const s=3*t,o=i.indices[t]*n+a;h[o]+=r[s]*e,h[o+1]+=r[s+1]*e,h[o+2]+=r[s+2]*e}}if(t.deltaTangents){const r=t.deltaTangents;for(let t=0;t<s;t++){const s=4*t,a=i.indices[t]*n+o;h[a]+=r[s]*e,h[a+1]+=r[s+1]*e,h[a+2]+=r[s+2]*e,h[a+3]+=r[s+3]*e,h[a+3]=h[a+3]>0?1:-1}}}},pc.MorphTarget=class{constructor(t={}){this.frames=t.frames||[],this.name=t.name||"",this.aabb=t.aabb||null}get indices(){return this.frames[0].indices}},pc.VertexFormat=h,pc.VertexBuffer=c,pc.IndexBuffer=l,pc.Texture=x,pc.Skybox=class{constructor(t){this.app=t,this.indirectSpecular=new s.b(.4465786,.4964123,.5748172,1),this.meshInstances=[]}install(t){const e=new I.c;e.cullingLayer=-1;const i=new zt,r=new b(e,i.loadSkyboxMesh(),new _t);r.cull=!1,r._shaderDefs=n.c.SHADERDEF_RENDERTYPE_BACKGROUND;(new R).meshInstances=[r],e._sync(),this.meshInstance=r,this.meshInstances.push(r),this.matrix_projection=new s.e,this.matrix_view=new s.e,this.matrix_viewProjection=new s.e,this.sunPosition=new s.i,this.blackCube=new x(UnityEngine.Graphics.graphicsDevice,{cubemap:!0,rgbm:!1,width:2,height:2}),this.blackCube._levels[0]=[Wt,Wt,Wt,Wt,Wt,Wt],this.environmentCubemap=this.blackCube,t.addRenderer(this)}getMeshInstancesForRender(){return this.meshInstances}setSkyboxEnabled(t){this.meshInstance.cull=!t}update(){const t=UnityEngine.RenderSettings._skybox;if(!t||!t.handle)return this.indirectSpecular.set(0,0,0,1),void(this.meshInstance.visible=!1);this.meshInstance.material=t.handle,this.meshInstance.visible=!0,this.app.systems.reflectionprobe.scheduleProbeUpdate()}updateSkyDrawCall(t,e){this.matrix_view.setTRS(s.i.ZERO,t._node.getRotation(),e?Jt:qt).invert(),t._projection===n.c.PROJECTION_PERSPECTIVE?this.matrix_projection.setPerspective(t._fov,t._aspect,.01,1,t._horizontalFov):this.matrix_projection.setPerspective(90,t._aspect,.01,1,t._horizontalFov),this.matrix_viewProjection.mul2(this.matrix_projection,this.matrix_view),this.meshInstance.setParameter(this.app.renderer.unityIds.viewProjId.name,this.matrix_viewProjection.data);let i=UnityEngine.RenderSettings.sun;if(i)i=i.handle;else{const t=this.app.systems.light.store,e=Object.keys(t);for(let s=0;s<e.length;s++){const n=t[e[s]];if(n.data.enabled&&n.entity.enabled&&"directional"===n.data.type){i=n.data.light;break}}}const r=i?i._node?i._node:i.entity:null;i&&r&&r.enabled?(this.meshInstance.setParameter("_LightColor0",i._color.data),this.sunPosition.set(0,0,-1),r.transformDirection(this.sunPosition,this.sunPosition),this.meshInstance.setParameter("_WorldSpaceLightPos0",[this.sunPosition.x,this.sunPosition.y,this.sunPosition.z,0])):(this.meshInstance.setParameter("_LightColor0",[0,0,0,0]),this.meshInstance.setParameter("_WorldSpaceLightPos0",[0,0,0,0]))}getSkyDrawCall(t){return this.meshInstance}bakeEnvironmentReflections(){const t=UnityEngine.RenderSettings._defaultReflectionResolution||128;switch(UnityEngine.RenderSettings.defaultReflectionMode){case UnityEngine.Rendering.DefaultReflectionMode.Skybox:this.environmentCubemap=this.bakeToCubemap(t);break;case UnityEngine.Rendering.DefaultReflectionMode.Custom:{const t=UnityEngine.RenderSettings.customReflection;this.environmentCubemap=(t?t.handle:null)||this.blackCube;break}}this.updateReflectionIntensity(),this.computeIndirectSpecular(),UnityEngine.RenderSettings._defaultReflectionMode===UnityEngine.Rendering.DefaultReflectionMode.Skybox&&(UnityEngine.LightmapSettings.reflectionProbes.environmentProbe.cubemap=this.environmentCubemap)}updateReflectionIntensity(){this.environmentCubemap.intensity=UnityEngine.RenderSettings._reflectionIntensity}computeIndirectSpecular(){if(!this.environmentCubemap||this.environmentCubemap===this.blackCube)return;this.indirectSpecular.set(0,0,0,1);const t=this.app.graphicsDevice,e=Math.log(this.environmentCubemap.width)/Math.log(2)|0,i=t.activeFramebuffer;if(!$t){const e=new x(t,{mipmaps:!1,width:1,height:1,format:n.c.PIXELFORMAT_R8_G8_B8_A8});$t=new Vt({depth:!1,colorBuffer:e})}Zt||(Zt=Xt.createShaderFromCode(t,Xt.convolveLastMipOfCubemapVS,Xt.convolveLastMipOfCubemapPS,"convolveLastMipOfCubemap")),t.scope.resolve("_Cubemap_").setValue(this.environmentCubemap),t.scope.resolve("_Level_").setValue(e),function(t,e,i){if(null===Yt){const e=new h(t,[{semantic:n.c.SEMANTIC_POSITION,components:2,type:n.c.TYPE_FLOAT32}]);Yt=new c(t,e,4);const i=new Ft(Yt);i.element[n.c.SEMANTIC_POSITION].set(-1,-1),i.next(),i.element[n.c.SEMANTIC_POSITION].set(1,-1),i.next(),i.element[n.c.SEMANTIC_POSITION].set(-1,1),i.next(),i.element[n.c.SEMANTIC_POSITION].set(1,1),i.end()}const s=t.renderTarget;t.setRenderTarget(e),t.updateBegin();const r=e?e.width:t.width,a=e?e.height:t.height,o=r,l=a;t.setViewport(0,0,r,a),t.setScissor(0,0,o,l);const u=t.getDepthTest(),d=t.getDepthWrite(),_=t.getCullMode();t.setDepthTest(!1),t.setDepthWrite(!1),t.setCullMode(n.c.CULLFACE_NONE),t.setBlending(!1),t.setVertexBuffer(Yt,0),t.setShader(i),t.draw(Kt,1,{}),t.setDepthTest(u),t.setDepthWrite(d),t.setCullMode(_),t.updateEnd(),t.setRenderTarget(s),t.updateBegin()}(t,$t,Zt);const s=$t._colorBuffer.toBuffer();this.indirectSpecular.set(s[0],s[1],s[2],255).scale(1/255),t.setFramebuffer(i)}bakeEnvironmentLighting(){UnityEngine.RenderSettings.ambientMode===UnityEngine.Rendering.AmbientMode.Skybox&&(this.update(),this.meshInstance.visible?(this.lightingCubemap=this.bakeToCubemap(8),this.lightingCubemap.sync(0)):this.lightingCubemap=null)}bakeToCubemap(t,e=new x(this.app.graphicsDevice,{cubemap:!0,rgbm:!1})){const i=this.app.graphicsDevice,s=new I.c,r=s.addComponent("camera",{projection:n.c.PROJECTION_ORTHOGRAPHIC,aspectRatio:1,orthoHeight:1});if(e._width=e._height=t,!this.meshInstance.visible)return e;const a=[[0,90,0],[0,-90,0],[-90,0,0],[90,0,0],[0,0,0],[0,180,0]];for(let t=0;t<6;t++)s.setLocalEulerAngles(a[t][0],a[t][1],a[t][2]),s._sync(),this.updateSkyDrawCall(r.camera,!0),r.renderTarget=new Vt({colorBuffer:e,face:t,depth:!1}),this.app.renderer.setCamera(r.camera,r.renderTarget,!0),this.app.renderer.renderMeshInstance(new v,null,r.camera,this.meshInstance,[[],[],[]]);return i.gl.generateMipmap(e._glTarget),e.markUploaded(),e}},pc.VertexIterator=Ft,pc.GraphicsDevice=class{constructor(t,e=null){this.canvas=t,this.shader=null,this.precision="mediump",this.maxCubeMapSize=0,this.maxTextureSize=0,this.maxVolumeSize=0,this.maxAnisotropy=0,this.indexBuffer=null,this.vertexBuffers=[],this.vbOffsets=[],this._enableAutoInstancing=!1,this.autoInstancingMaxObjects=16384,this.attributesInvalidated=!0,this.boundBuffer=null,this.boundElementBuffer=null,this.instancedAttribs={},this.enabledAttributes={},this.attributePointers={},this.activeFramebuffer=null,this.textureUnit=0,this.textureUnits=[],this._maxPixelRatio=2,this.renderTarget=null,this._width=0,this._height=0,this.updateClientRect(),this.vertexShaderCache={},this.fragmentShaderCache={},this.shaders=[],this.textures=[],this.targets=[],this.contextLost=!1,this._contextLostHandler=function(t){t.preventDefault(),this.contextLost=!0,DEBUG&&console.log("GraphicsDevice: WebGL context lost.")}.bind(this),this._contextRestoredHandler=function(){DEBUG&&console.log("GraphicsDevice: WebGL context restored."),this.initializeContext(),this.contextLost=!1}.bind(this),t.addEventListener("webglcontextlost",this._contextLostHandler,!1),t.addEventListener("webglcontextrestored",this._contextRestoredHandler,!1);const i=!(!e||void 0===e.preferWebGl2)&&e.preferWebGl2;this.webgl2=!1;const s=i?["webgl2","experimental-webgl2","webgl","experimental-webgl"]:["webgl","experimental-webgl"];let r=null;(e=e||{}).stencil=!0,e.antialias=!e.disableAntiAliasing&&window.devicePixelRatio<2,e.alpha=!1;for(let n=0;n<s.length;n++){try{r=t.getContext(s[n],e)}catch(t){}if(r){this.webgl2=i&&n<2;break}}if(!r)throw new Error("WebGL not supported");r.blendColor(0,0,0,0),this.blending=!1,this.blendSrc=n.c.BLENDMODE_ONE,this.blendDst=n.c.BLENDMODE_ZERO,this.blendSrcAlpha=n.c.BLENDMODE_ONE,this.blendDstAlpha=n.c.BLENDMODE_ZERO,this.separateAlphaBlend=!1,this.blendEquation=n.c.BLENDEQUATION_ADD,this.blendAlphaEquation=n.c.BLENDEQUATION_ADD,this.separateAlphaEquation=!1,this.writeRed=!0,this.writeGreen=!0,this.writeBlue=!0,this.writeAlpha=!0,this.depthTest=!0,this.depthFunc=n.c.FUNC_LESSEQUAL,this.depthWrite=!0,this.stencil=!1,this.stencilFuncFront=this.stencilFuncBack=n.c.FUNC_ALWAYS,this.stencilRefFront=this.stencilRefBack=0,this.stencilMaskFront=this.stencilMaskBack=255,this.stencilFailFront=this.stencilFailBack=n.c.STENCILOP_KEEP,this.stencilZfailFront=this.stencilZfailBack=n.c.STENCILOP_KEEP,this.stencilZpassFront=this.stencilZpassBack=n.c.STENCILOP_KEEP,this.stencilWriteMaskFront=255,this.stencilWriteMaskBack=255,this.alphaToCoverage=!1,this.raster=!0,this.depthBiasEnabled=!1,this.vx=this.vy=this.vw=this.vh=0,this.sx=this.sy=this.sw=this.sh=0,this.cullMode=n.c.CULLFACE_BACK,this.cullFace=r.BACK,this.unpackFlipY=!1,this.unpackPremultiplyAlpha=!1,this.clearDepth=1,this.clearRed=0,this.clearBlue=0,this.clearGreen=0,this.clearAlpha=0,this.clearStencil=0,this.gl=r,this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState();for(let t=0;t<this.maxCombinedTextures;t++)this.textureUnits.push([null,null,null]);this.defaultClearOptions={color:[0,0,0,1],depth:1,stencil:0,flags:n.c.CLEARFLAG_COLOR|n.c.CLEARFLAG_DEPTH},this.glAddress=[r.REPEAT,r.CLAMP_TO_EDGE,r.MIRRORED_REPEAT],this.glBlendEquation=[r.FUNC_ADD,r.FUNC_SUBTRACT,r.FUNC_REVERSE_SUBTRACT,this.webgl2?r.MIN:this.extBlendMinmax?this.extBlendMinmax.MIN_EXT:r.FUNC_ADD,this.webgl2?r.MAX:this.extBlendMinmax?this.extBlendMinmax.MAX_EXT:r.FUNC_ADD],this.glBlendFunction=[r.ZERO,r.ONE,r.SRC_COLOR,r.ONE_MINUS_SRC_COLOR,r.DST_COLOR,r.ONE_MINUS_DST_COLOR,r.SRC_ALPHA,r.SRC_ALPHA_SATURATE,r.ONE_MINUS_SRC_ALPHA,r.DST_ALPHA,r.ONE_MINUS_DST_ALPHA],this.glComparison=[r.NEVER,r.LESS,r.EQUAL,r.LEQUAL,r.GREATER,r.NOTEQUAL,r.GEQUAL,r.ALWAYS],this.glStencilOp=[r.KEEP,r.ZERO,r.REPLACE,r.INCR,r.INCR_WRAP,r.DECR,r.DECR_WRAP,r.INVERT],this.glClearFlag=[0,r.COLOR_BUFFER_BIT,r.DEPTH_BUFFER_BIT,r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT,r.STENCIL_BUFFER_BIT,r.STENCIL_BUFFER_BIT|r.COLOR_BUFFER_BIT,r.STENCIL_BUFFER_BIT|r.DEPTH_BUFFER_BIT,r.STENCIL_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT],this.glCull=[0,r.BACK,r.FRONT,r.FRONT_AND_BACK],this.glFilter=[r.NEAREST,r.LINEAR,r.NEAREST_MIPMAP_NEAREST,r.NEAREST_MIPMAP_LINEAR,r.LINEAR_MIPMAP_NEAREST,r.LINEAR_MIPMAP_LINEAR],this.glPrimitive=[r.POINTS,r.LINES,r.LINE_LOOP,r.LINE_STRIP,r.TRIANGLES,r.TRIANGLE_STRIP,r.TRIANGLE_FAN],this.glType=[r.BYTE,r.UNSIGNED_BYTE,r.SHORT,r.UNSIGNED_SHORT,r.INT,r.UNSIGNED_INT,r.FLOAT],this.pcUniformType={},this.pcUniformType[r.BOOL]=n.c.UNIFORMTYPE_BOOL,this.pcUniformType[r.INT]=n.c.UNIFORMTYPE_INT,this.pcUniformType[r.FLOAT]=n.c.UNIFORMTYPE_FLOAT,this.pcUniformType[r.FLOAT_VEC2]=n.c.UNIFORMTYPE_VEC2,this.pcUniformType[r.FLOAT_VEC3]=n.c.UNIFORMTYPE_VEC3,this.pcUniformType[r.FLOAT_VEC4]=n.c.UNIFORMTYPE_VEC4,this.pcUniformType[r.INT_VEC2]=n.c.UNIFORMTYPE_IVEC2,this.pcUniformType[r.INT_VEC3]=n.c.UNIFORMTYPE_IVEC3,this.pcUniformType[r.INT_VEC4]=n.c.UNIFORMTYPE_IVEC4,this.pcUniformType[r.BOOL_VEC2]=n.c.UNIFORMTYPE_BVEC2,this.pcUniformType[r.BOOL_VEC3]=n.c.UNIFORMTYPE_BVEC3,this.pcUniformType[r.BOOL_VEC4]=n.c.UNIFORMTYPE_BVEC4,this.pcUniformType[r.FLOAT_MAT2]=n.c.UNIFORMTYPE_MAT2,this.pcUniformType[r.FLOAT_MAT3]=n.c.UNIFORMTYPE_MAT3,this.pcUniformType[r.FLOAT_MAT4]=n.c.UNIFORMTYPE_MAT4,this.pcUniformType[r.SAMPLER_2D]=n.c.UNIFORMTYPE_TEXTURE2D,this.pcUniformType[r.SAMPLER_CUBE]=n.c.UNIFORMTYPE_TEXTURECUBE,this.webgl2&&(this.pcUniformType[r.SAMPLER_2D_SHADOW]=n.c.UNIFORMTYPE_TEXTURE2D_SHADOW,this.pcUniformType[r.SAMPLER_CUBE_SHADOW]=n.c.UNIFORMTYPE_TEXTURECUBE_SHADOW,this.pcUniformType[r.SAMPLER_3D]=n.c.UNIFORMTYPE_TEXTURE3D),this.targetToSlot={},this.targetToSlot[r.TEXTURE_2D]=0,this.targetToSlot[r.TEXTURE_CUBE_MAP]=1,this.targetToSlot[r.TEXTURE_3D]=2,this.commitFunction=[],this.commitFunction[n.c.UNIFORMTYPE_BOOL]=function(t,e){t.value!==e&&(r.uniform1i(t.locationId,e),t.value=e)},this.commitFunction[n.c.UNIFORMTYPE_INT]=this.commitFunction[n.c.UNIFORMTYPE_BOOL],this.commitFunction[n.c.UNIFORMTYPE_FLOAT]=function(t,e){t.value!==e&&(r.uniform1f(t.locationId,e),t.value=e)},this.commitFunction[n.c.UNIFORMTYPE_VEC2]=function(t,e){const i=t.value,s=e[0],n=e[1];i[0]===s&&i[1]===n||(i[0]=s,i[1]=n,r.uniform2fv(t.locationId,i))},this.commitFunction[n.c.UNIFORMTYPE_VEC3]=function(t,e){const i=t.value,s=e[0],n=e[1],a=e[2];i[0]===s&&i[1]===n&&i[2]===a||(i[0]=s,i[1]=n,i[2]=a,r.uniform3fv(t.locationId,i))},this.commitFunction[n.c.UNIFORMTYPE_VEC4]=function(t,e){const i=t.value,s=e[0],n=e[1],a=e[2],o=e[3];(e.length>4||i[0]!==s||i[1]!==n||i[2]!==a||i[3]!==o)&&(r.uniform4fv(t.locationId,e),i[0]=s,i[1]=n,i[2]=a,i[3]=o)},this.commitFunction[n.c.UNIFORMTYPE_IVEC2]=function(t,e){const i=t.value,s=e[0],n=e[1];i[0]===s&&i[1]===n||(r.uniform2iv(t.locationId,e),i[0]=s,i[1]=n)},this.commitFunction[n.c.UNIFORMTYPE_BVEC2]=this.commitFunction[n.c.UNIFORMTYPE_IVEC2],this.commitFunction[n.c.UNIFORMTYPE_IVEC3]=function(t,e){const i=t.value,s=e[0],n=e[1],a=e[2];i[0]===s&&i[1]===n&&i[2]===a||(r.uniform3iv(t.locationId,e),i[0]=s,i[1]=n,i[2]=a)},this.commitFunction[n.c.UNIFORMTYPE_BVEC3]=this.commitFunction[n.c.UNIFORMTYPE_IVEC3],this.commitFunction[n.c.UNIFORMTYPE_IVEC4]=function(t,e){const i=t.value,s=e[0],n=e[1],a=e[2],o=e[3];i[0]===s&&i[1]===n&&i[2]===a&&i[3]===o||(r.uniform4iv(t.locationId,e),i[0]=s,i[1]=n,i[2]=a,i[3]=o)},this.commitFunction[n.c.UNIFORMTYPE_BVEC4]=this.commitFunction[n.c.UNIFORMTYPE_IVEC4],this.commitFunction[n.c.UNIFORMTYPE_MAT2]=function(t,e){r.uniformMatrix2fv(t.locationId,!1,e)},this.commitFunction[n.c.UNIFORMTYPE_MAT3]=function(t,e){r.uniformMatrix3fv(t.locationId,!1,e)},this.commitFunction[n.c.UNIFORMTYPE_MAT4]=function(t,e){r.uniformMatrix4fv(t.locationId,!1,e)},this.commitFunction[n.c.UNIFORMTYPE_FLOATARRAY]=function(t,e){r.uniform1fv(t.locationId,e)},this.scope=new ae("Device"),this.programLib=new te(this);for(const t in Gt)Gt.hasOwnProperty(t)&&this.programLib.register(t,Gt[t]);this.events=new n.a(this),this.supportsBoneTextures=this.extTextureFloat&&this.maxVertexTextures>0,this.useTexCubeLod=this.extTextureLod&&this.maxTextures<16;let a=this.vertexUniformsCount;a-=16,a-=8,a-=1,a-=16,this.boneLimit=Math.floor(a/4),this.boneLimit=Math.min(this.boneLimit,128),"Mali-450 MP"===this.unmaskedRenderer&&(this.boneLimit=34),"Apple A8 GPU"===this.unmaskedRenderer&&(this.forceCpuParticles=!0),this._drawCallsPerFrame=0,this._vram={tex:0,vb:0,ib:0},this._shaderStats={vsCompiled:0,fsCompiled:0,linked:0,materialShaders:0,compileTime:0},this.constantTexSource=this.scope.resolve("source"),this.extTextureFloat?this.webgl2?this.textureFloatRenderable=!!this.extColorBufferFloat:this.textureFloatRenderable=pe(r,r.FLOAT):this.textureFloatRenderable=!1,this.extTextureHalfFloat?this.webgl2?this.textureHalfFloatRenderable=!!this.extColorBufferFloat:this.textureHalfFloatRenderable=pe(r,this.extTextureHalfFloat.HALF_FLOAT_OES):this.textureHalfFloatRenderable=!1,this.initializeGrabPassTexture(),this.activeDrawCall=null}getPrecision(){const t=this.gl;let e="highp";if(t.getShaderPrecisionFormat){const i=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),s=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),n=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),r=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),a=i.precision>0&&n.precision>0,o=s.precision>0&&r.precision>0;a||(o?(e="mediump",DEBUG&&console.warn("WARNING: highp not supported, using mediump")):(e="lowp",DEBUG&&console.warn("WARNING: highp and mediump not supported, using lowp")))}return e}initializeExtensions(){const t=this.gl,e=t.getSupportedExtensions(),i=function(...i){let s=null;for(let n=0;n<i.length;n++)-1!==e.indexOf(i[n])&&(s=t.getExtension(i[n]));return s};if(this.webgl2)this.extBlendMinmax=!0,this.extDrawBuffers=!0,this.extInstancing=!0,this.extStandardDerivatives=!0,this.extTextureFloat=!0,this.extTextureHalfFloat=!0,this.extTextureHalfFloatLinear=!0,this.extTextureLod=!0,this.extUintElement=!0,this.extVertexArrayObject=!0,this.extColorBufferFloat=i("EXT_color_buffer_float");else{if(this.extBlendMinmax=i("EXT_blend_minmax"),this.extDrawBuffers=i("EXT_draw_buffers"),this.extInstancing=i("ANGLE_instanced_arrays"),this.extInstancing){const e=this.extInstancing;t.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),t.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),t.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e)}if(this.extStandardDerivatives=i("OES_standard_derivatives"),this.extTextureFloat=i("OES_texture_float"),this.extTextureHalfFloat=i("OES_texture_half_float"),this.extTextureHalfFloatLinear=i("OES_texture_half_float_linear"),this.extTextureLod=i("EXT_shader_texture_lod"),this.extUintElement=i("OES_element_index_uint"),this.extVertexArrayObject=i("OES_vertex_array_object"),this.extVertexArrayObject){const e=this.extVertexArrayObject;t.createVertexArray=e.createVertexArrayOES.bind(e),t.deleteVertexArray=e.deleteVertexArrayOES.bind(e),t.isVertexArray=e.isVertexArrayOES.bind(e),t.bindVertexArray=e.bindVertexArrayOES.bind(e)}this.extColorBufferFloat=null}this.extDebugRendererInfo=i("WEBGL_debug_renderer_info"),this.extTextureFloatLinear=i("OES_texture_float_linear"),this.extTextureFilterAnisotropic=i("EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"),this.extCompressedTextureETC1=i("WEBGL_compressed_texture_etc1"),this.extCompressedTextureETC=i("WEBGL_compressed_texture_etc"),this.extCompressedTexturePVRTC=i("WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"),this.extCompressedTextureS3TC=i("WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"),this.extParallelShaderCompile=i("KHR_parallel_shader_compile")}initializeCapabilities(){const t=this.gl;let e;this.maxPrecision=this.precision=this.getPrecision();const i=t.getContextAttributes();this.supportsMsaa=i.antialias,this.supportsStencil=i.stencil,this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubeMapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxRenderBufferSize=t.getParameter(t.MAX_RENDERBUFFER_SIZE),this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxCombinedTextures=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.vertexUniformsCount=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.fragmentUniformsCount=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.webgl2?(this.maxDrawBuffers=t.getParameter(t.MAX_DRAW_BUFFERS),this.maxColorAttachments=t.getParameter(t.MAX_COLOR_ATTACHMENTS),this.maxVolumeSize=t.getParameter(t.MAX_3D_TEXTURE_SIZE)):(e=this.extDrawBuffers,this.maxDrawBuffers=e?t.getParameter(e.MAX_DRAW_BUFFERS_EXT):1,this.maxColorAttachments=e?t.getParameter(e.MAX_COLOR_ATTACHMENTS_EXT):1,this.maxVolumeSize=1),e=this.extDebugRendererInfo,this.unmaskedRenderer=e?t.getParameter(e.UNMASKED_RENDERER_WEBGL):"",this.unmaskedVendor=e?t.getParameter(e.UNMASKED_VENDOR_WEBGL):"",e=this.extTextureFilterAnisotropic,this.maxAnisotropy=e?t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}initializeRenderState(){const t=this.gl;this.blending=!1,t.disable(t.BLEND),this.blendSrc=n.c.BLENDMODE_ONE,this.blendDst=n.c.BLENDMODE_ZERO,this.blendSrcAlpha=n.c.BLENDMODE_ONE,this.blendDstAlpha=n.c.BLENDMODE_ZERO,this.separateAlphaBlend=!1,this.blendEquation=n.c.BLENDEQUATION_ADD,this.blendAlphaEquation=n.c.BLENDEQUATION_ADD,this.separateAlphaEquation=!1,t.blendFunc(t.ONE,t.ZERO),t.blendEquation(t.FUNC_ADD),this.writeRed=!0,this.writeGreen=!0,this.writeBlue=!0,this.writeAlpha=!0,t.colorMask(!0,!0,!0,!0),this.cullMode=n.c.CULLFACE_BACK,t.enable(t.CULL_FACE),t.cullFace(t.BACK),this.depthTest=!0,t.enable(t.DEPTH_TEST),this.depthFunc=n.c.FUNC_LESSEQUAL,t.depthFunc(t.LEQUAL),this.depthWrite=!0,t.depthMask(!0),this.stencil=!1,t.disable(t.STENCIL_TEST),this.stencilFuncFront=this.stencilFuncBack=n.c.FUNC_ALWAYS,this.stencilRefFront=this.stencilRefBack=0,this.stencilMaskFront=this.stencilMaskBack=255,t.stencilFunc(t.ALWAYS,0,255),this.stencilFailFront=this.stencilFailBack=n.c.STENCILOP_KEEP,this.stencilZfailFront=this.stencilZfailBack=n.c.STENCILOP_KEEP,this.stencilZpassFront=this.stencilZpassBack=n.c.STENCILOP_KEEP,this.stencilWriteMaskFront=255,this.stencilWriteMaskBack=255,t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilMask(255),this.alphaToCoverage=!1,this.raster=!0,this.webgl2&&(t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.RASTERIZER_DISCARD)),this.depthBiasEnabled=!1,t.disable(t.POLYGON_OFFSET_FILL),this.clearDepth=1,t.clearDepth(1),this.clearRed=0,this.clearBlue=0,this.clearGreen=0,this.clearAlpha=0,t.clearColor(0,0,0,0),this.clearStencil=0,t.clearStencil(0),this.vx=this.vy=this.vw=this.vh=0,this.sx=this.sy=this.sw=this.sh=0,this.webgl2?t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.NICEST):this.extStandardDerivatives&&t.hint(this.extStandardDerivatives.FRAGMENT_SHADER_DERIVATIVE_HINT_OES,t.NICEST),t.enable(t.SCISSOR_TEST),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),this.unpackFlipY=!1,t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.unpackPremultiplyAlpha=!1,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.depthRange=new s.h(0,1),t.depthRange(this.depthRange.x,this.depthRange.y)}initializeContext(){this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState();for(let t=0,e=this.shaders.length;t<e;t++)this.compileAndLinkShader(this.shaders[t]);this.shader=null,this.boundBuffer=null,this.boundElementBuffer=null,this.indexBuffer=null,this.attributesInvalidated=!0,this.enabledAttributes={},this.vertexBuffers=[];for(let t=0,e=this.textures.length;t<e;t++){const e=this.textures[t];this.destroyTexture(e),e.dirtyAll()}this.textureUnit=0,this.textureUnits.length=0;for(let t=0;t<this.maxCombinedTextures;t++)this.textureUnits.push([null,null,null]);for(let t=0,e=this.targets.length;t<e;t++)this.targets[t]._glFrameBuffer=null,this.targets[t]._glDepthBuffer=null,this.targets[t]._glResolveFrameBuffer=null,this.targets[t]._glMsaaColorBuffer=null,this.targets[t]._glMsaaDepthBuffer=null;this.renderTarget=null,this.activeFramebuffer=null}initializeGrabPassTexture(){if(this.grabPassTexture)return;const t=new x(this,{format:n.c.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!1});t.minFilter=n.c.FILTER_LINEAR,t.magFilter=n.c.FILTER_LINEAR,t.addressU=n.c.ADDRESS_CLAMP_TO_EDGE,t.addressV=n.c.ADDRESS_CLAMP_TO_EDGE,t.name="texture_grabPass",t.setSource(this.canvas);const e=this.scope.resolve(t.name);e.setValue(t),this.grabPassTextureId=e,this.grabPassTexture=t}updateClientRect(){this.clientRect=this.canvas.getBoundingClientRect()}setViewport(t,e,i,s){this.vx===t&&this.vy===e&&this.vw===i&&this.vh===s||(this.gl.viewport(t,e,i,s),this.vx=t,this.vy=e,this.vw=i,this.vh=s)}setDepthRange(t,e){this.depthRange.x===t&&this.depthRange.y===e||(this.depthRange.set(t,e),this.gl.depthRange(t,e))}setScissor(t,e,i,s){this.sx===t&&this.sy===e&&this.sw===i&&this.sh===s||(this.gl.scissor(t,e,i,s),this.sx=t,this.sy=e,this.sw=i,this.sh=s)}getProgramLibrary(){return this.programLib}setProgramLibrary(t){this.programLib=t}setFramebuffer(t){this.activeFramebuffer!==t&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.activeFramebuffer=t)}_checkFbo(){const t=this.gl;switch(t.checkFramebufferStatus(t.FRAMEBUFFER)){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case t.FRAMEBUFFER_UNSUPPORTED:console.error("ERROR: FRAMEBUFFER_UNSUPPORTED");break;case t.FRAMEBUFFER_COMPLETE:}}updateBegin(){const t=this.gl;this.boundBuffer=null,this.boundElementBuffer=null;const e=this.renderTarget;if(e)if(e._glFrameBuffer){this.setFramebuffer(e._glFrameBuffer);const t=e._colorBuffer;t&&(this.setViewport(0,0,t._width,t._height),this.setScissor(0,0,t._width,t._height))}else{e._device=this,e._glFrameBuffer=t.createFramebuffer(),this.setFramebuffer(e._glFrameBuffer);const i=e._colorBuffer;i&&(i._glTexture||(i._width=Math.min(i.width,this.maxRenderBufferSize),i._height=Math.min(i.height,this.maxRenderBufferSize),this.setTexture(i,0)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,i._cubemap?t.TEXTURE_CUBE_MAP_POSITIVE_X+e._face:t.TEXTURE_2D,i._glTexture,0));const s=e._depthBuffer;if(s&&this.webgl2)s._glTexture||(s._width=Math.min(s.width,this.maxRenderBufferSize),s._height=Math.min(s.height,this.maxRenderBufferSize),this.setTexture(s,0)),e._stencil?t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,s._cubemap?t.TEXTURE_CUBE_MAP_POSITIVE_X+e._face:t.TEXTURE_2D,e._depthBuffer._glTexture,0):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,s._cubemap?t.TEXTURE_CUBE_MAP_POSITIVE_X+e._face:t.TEXTURE_2D,e._depthBuffer._glTexture,0);else if(e._depth){e._samples>1&&this.webgl2||(e._glDepthBuffer||(e._glDepthBuffer=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,e._glDepthBuffer),e._stencil?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e._glDepthBuffer)):(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e._glDepthBuffer)),t.bindRenderbuffer(t.RENDERBUFFER,null))}DEBUG&&this._checkFbo(),this.webgl2&&e._samples>1&&(e._glResolveFrameBuffer=e._glFrameBuffer,e._glFrameBuffer=t.createFramebuffer(),this.setFramebuffer(e._glFrameBuffer),i&&(e._glMsaaColorBuffer||(e._glMsaaColorBuffer=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,e._glMsaaColorBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,e._samples,i._glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e._glMsaaColorBuffer)),e._depth&&(e._glMsaaDepthBuffer||(e._glMsaaDepthBuffer=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,e._glMsaaDepthBuffer),e._stencil?(t.renderbufferStorageMultisample(t.RENDERBUFFER,e._samples,t.DEPTH24_STENCIL8,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e._glMsaaDepthBuffer)):(t.renderbufferStorageMultisample(t.RENDERBUFFER,e._samples,t.DEPTH_COMPONENT32F,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e._glMsaaDepthBuffer))),DEBUG&&this._checkFbo()),this.targets.push(e)}else this.setFramebuffer(null)}updateEnd(){const t=this.gl,e=this.renderTarget;if(e){const i=e._colorBuffer;i&&i._glTexture&&i.mipmaps&&i._pot&&(this.activeTexture(this.maxCombinedTextures-1),this.bindTexture(i),t.generateMipmap(i._glTarget)),this.webgl2&&e._samples>1&&e.autoResolve&&e.resolve()}}initializeTexture(t){const e=this.gl;let i;switch(t._glTexture=e.createTexture(),t._levels&&t._levels[0]&&"VIDEO"===t._levels[0].tagName&&(t._needsUpdate=!0),t._glTarget=t._cubemap?e.TEXTURE_CUBE_MAP:t._volume?e.TEXTURE_3D:e.TEXTURE_2D,t._format){case n.c.PIXELFORMAT_A8:t._glFormat=e.ALPHA,t._glInternalFormat=e.ALPHA,t._glPixelType=e.UNSIGNED_BYTE;break;case n.c.PIXELFORMAT_L8:t._glFormat=e.LUMINANCE,t._glInternalFormat=e.LUMINANCE,t._glPixelType=e.UNSIGNED_BYTE;break;case n.c.PIXELFORMAT_L8_A8:t._glFormat=e.LUMINANCE_ALPHA,t._glInternalFormat=e.LUMINANCE_ALPHA,t._glPixelType=e.UNSIGNED_BYTE;break;case n.c.PIXELFORMAT_R5_G6_B5:t._glFormat=e.RGB,t._glInternalFormat=e.RGB,t._glPixelType=e.UNSIGNED_SHORT_5_6_5;break;case n.c.PIXELFORMAT_R5_G5_B5_A1:t._glFormat=e.RGBA,t._glInternalFormat=e.RGBA,t._glPixelType=e.UNSIGNED_SHORT_5_5_5_1;break;case n.c.PIXELFORMAT_R4_G4_B4_A4:t._glFormat=e.RGBA,t._glInternalFormat=e.RGBA,t._glPixelType=e.UNSIGNED_SHORT_4_4_4_4;break;case n.c.PIXELFORMAT_R8_G8_B8:t._glFormat=e.RGB,t._glInternalFormat=this.webgl2?e.RGB8:e.RGB,t._glPixelType=e.UNSIGNED_BYTE;break;case n.c.PIXELFORMAT_R8_G8_B8_A8:t._glFormat=e.RGBA,t._glInternalFormat=this.webgl2?e.RGBA8:e.RGBA,t._glPixelType=e.UNSIGNED_BYTE;break;case n.c.PIXELFORMAT_DXT1:i=this.extCompressedTextureS3TC,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case n.c.PIXELFORMAT_DXT3:i=this.extCompressedTextureS3TC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case n.c.PIXELFORMAT_DXT5:i=this.extCompressedTextureS3TC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case n.c.PIXELFORMAT_ETC1:i=this.extCompressedTextureETC1,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB_ETC1_WEBGL;break;case n.c.PIXELFORMAT_PVRTC_2BPP_RGB_1:i=this.extCompressedTexturePVRTC,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case n.c.PIXELFORMAT_PVRTC_2BPP_RGBA_1:i=this.extCompressedTexturePVRTC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case n.c.PIXELFORMAT_PVRTC_4BPP_RGB_1:i=this.extCompressedTexturePVRTC,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case n.c.PIXELFORMAT_PVRTC_4BPP_RGBA_1:i=this.extCompressedTexturePVRTC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;case n.c.PIXELFORMAT_ETC2_RGB:i=this.extCompressedTextureETC,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB8_ETC2;break;case n.c.PIXELFORMAT_ETC2_RGBA:i=this.extCompressedTextureETC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA8_ETC2_EAC;break;case n.c.PIXELFORMAT_RGB16F:i=this.extTextureHalfFloat,t._glFormat=e.RGB,this.webgl2?(t._glInternalFormat=e.RGB16F,t._glPixelType=e.HALF_FLOAT):(t._glInternalFormat=e.RGB,t._glPixelType=i.HALF_FLOAT_OES);break;case n.c.PIXELFORMAT_RGBA16F:i=this.extTextureHalfFloat,t._glFormat=e.RGBA,this.webgl2?(t._glInternalFormat=e.RGBA16F,t._glPixelType=e.HALF_FLOAT):(t._glInternalFormat=e.RGBA,t._glPixelType=i.HALF_FLOAT_OES);break;case n.c.PIXELFORMAT_RGB32F:t._glFormat=e.RGB,this.webgl2?t._glInternalFormat=e.RGB32F:t._glInternalFormat=e.RGB,t._glPixelType=e.FLOAT;break;case n.c.PIXELFORMAT_RGBA32F:t._glFormat=e.RGBA,this.webgl2?t._glInternalFormat=e.RGBA32F:t._glInternalFormat=e.RGBA,t._glPixelType=e.FLOAT;break;case n.c.PIXELFORMAT_R32F:t._glFormat=e.RED,t._glInternalFormat=e.R32F,t._glPixelType=e.FLOAT;break;case n.c.PIXELFORMAT_DEPTH:this.webgl2?(t._glFormat=e.DEPTH_COMPONENT,t._glInternalFormat=e.DEPTH_COMPONENT32F,t._glPixelType=e.FLOAT):(t._glFormat=e.DEPTH_COMPONENT,t._glInternalFormat=e.DEPTH_COMPONENT,t._glPixelType=e.UNSIGNED_SHORT);break;case n.c.PIXELFORMAT_DEPTHSTENCIL:t._glFormat=e.DEPTH_STENCIL,t._glInternalFormat=e.DEPTH24_STENCIL8,t._glPixelType=e.UNSIGNED_INT_24_8;break;case n.c.PIXELFORMAT_111110F:t._glFormat=e.RGB,t._glInternalFormat=e.R11F_G11F_B10F,t._glPixelType=e.FLOAT;break;case n.c.PIXELFORMAT_SRGB:t._glFormat=e.RGB,t._glInternalFormat=e.SRGB8,t._glPixelType=e.UNSIGNED_BYTE;break;case n.c.PIXELFORMAT_SRGBA:t._glFormat=e.RGBA,t._glInternalFormat=e.SRGB8_ALPHA8,t._glPixelType=e.UNSIGNED_BYTE}this.textures.push(t)}destroyTexture(t){if(t._glTexture){const e=this.textures.indexOf(t);-1!==e&&this.textures.splice(e,1);for(const e in this.scope.variables)if(this.scope.variables.hasOwnProperty(e)){const i=this.scope.variables[e];i.value===t&&(i.value=null)}for(let e=0;e<this.textureUnits.length;e++){const i=this.textureUnits[e];for(let e=0;e<i.length;e++)i[e]===t._glTexture&&(i[e]=null)}this.gl.deleteTexture(t._glTexture),delete t._glTexture,delete t._glTarget,delete t._glFormat,delete t._glInternalFormat,delete t._glPixelType,this._vram.tex-=t._gpuSize}}setUnpackFlipY(t){if(this.unpackFlipY!==t){this.unpackFlipY=t;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t)}}setUnpackPremultiplyAlpha(t){if(this.unpackPremultiplyAlpha!==t){this.unpackPremultiplyAlpha=t;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t)}}uploadCubemapFromAtlas(t){const e=t._atlas,i=this.gl,s=this.textureUnits[0],n=s?s[0]:null;e._glTexture||(this.setTexture(e,0),this.uploadTexture(e));const r=this.activeFramebuffer,a=i.createFramebuffer();this.setFramebuffer(a),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e._glTexture,0),t._needsUpload=!1,t._needsMipmapsUpload=!1,this.setTexture(t,0);for(let s=0;s<t._rects.length;s+=4){const n=t._rects[s+0]*e._width,r=t._rects[s+1]*e._height,a=t._rects[s+2]*e._width-n,o=t._rects[s+3]*e._height-r,h=s/4|0,c=h/6|0,l=h%6|0;i.copyTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,c,t._glInternalFormat,n,r,a,o,0)}t._mipmaps&&24===t._rects.length&&i.generateMipmap(t._glTarget),this.setFramebuffer(r),n&&(i.bindTexture(i.TEXTURE_2D,n),this.textureUnits[0][0]=n)}uploadTexture(t){const e=this.gl;if(!t._needsUpload&&(t._needsMipmapsUpload&&t._mipmapsUploaded||!t._pot))return;let i,s,n=0;for(t._cubemap&&t._atlas&&t._rects&&this.uploadCubemapFromAtlas(t);t._levels[n]||0===n;)if(t._needsUpload||0!==n){if(n&&(!t._needsMipmapsUpload||!t._mipmaps))break;if(i=t._levels[n],1!==n||t._compressed||(e.generateMipmap(t._glTarget),t._mipmapsUploaded=!0),t._cubemap){let r;if(i[0]instanceof HTMLCanvasElement||i[0]instanceof HTMLImageElement||i[0]instanceof HTMLVideoElement)for(r=0;r<6;r++){if(!t._levelsUpdated[0][r])continue;let s=i[r];s instanceof HTMLImageElement&&(s.width>this.maxCubeMapSize||s.height>this.maxCubeMapSize)&&(s=_e(s,this.maxCubeMapSize),0===n&&(t.width=s.width,t.height=s.height)),this.setUnpackFlipY(t._flipY),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,n,t._glInternalFormat,t._glFormat,t._glPixelType,s)}else for(this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),s=1/Math.pow(2,n),r=0;r<6;r++){if(!t._levelsUpdated[0][r])continue;const a=i[r];t._compressed?e.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,n,t._glInternalFormat,Math.max(t._width*s,1),Math.max(t._height*s,1),0,a):(this.setUnpackFlipY(t._flipY),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,n,t._glInternalFormat,Math.max(t._width*s,1),Math.max(t._height*s,1),0,t._glFormat,t._glPixelType,a))}}else t._volume?(s=1/Math.pow(2,n),t._compressed?e.compressedTexImage3D(e.TEXTURE_3D,n,t._glInternalFormat,Math.max(t._width*s,1),Math.max(t._height*s,1),Math.max(t._depth*s,1),0,i):(this.setUnpackFlipY(!1),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage3D(e.TEXTURE_3D,n,t._glInternalFormat,Math.max(t._width*s,1),Math.max(t._height*s,1),Math.max(t._depth*s,1),0,t._glFormat,t._glPixelType,i))):(i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement?(i instanceof HTMLImageElement&&(i.width>this.maxTextureSize||i.height>this.maxTextureSize)&&(i=_e(i,this.maxTextureSize),0===n&&(t.width=i.width,t.height=i.height)),this.setUnpackFlipY(t._flipY),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_2D,n,t._glInternalFormat,t._glFormat,t._glPixelType,i)):(s=1/Math.pow(2,n),t._compressed?e.compressedTexImage2D(e.TEXTURE_2D,n,t._glInternalFormat,Math.max(t._width*s,1),Math.max(t._height*s,1),0,i):(this.setUnpackFlipY(!1),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_2D,n,t._glInternalFormat,Math.max(t._width*s,1),Math.max(t._height*s,1),0,t._glFormat,t._glPixelType,i))),t._mipmapsUploaded=0!==n);n++}else n++;if(t._needsUpload)if(t._cubemap)for(let e=0;e<6;e++)t._levelsUpdated[0][e]=!1;else t._levelsUpdated[0]=!1;!t._compressed&&t._mipmaps&&t._needsMipmapsUpload&&t._pot&&1===t._levels.length&&(e.generateMipmap(t._glTarget),t._mipmapsUploaded=!0),t._gpuSize&&(this._vram.tex-=t._gpuSize),t._gpuSize=t.gpuSize,this._vram.tex+=t._gpuSize}activeTexture(t){this.textureUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.textureUnit=t)}bindTexture(t){const e=t._glTarget,i=t._glTexture,s=this.textureUnit,n=this.targetToSlot[e];this.textureUnits[s][n]!==i&&(this.gl.bindTexture(e,i),this.textureUnits[s][n]=i)}bindTextureOnUnit(t,e){const i=t._glTarget,s=t._glTexture,n=this.targetToSlot[i];this.textureUnits[e][n]!==s&&(this.activeTexture(e),this.gl.bindTexture(i,s),this.textureUnits[e][n]=s)}setTextureParameters(t){const e=this.gl,i=t._parameterFlags,s=t._glTarget;if(1&i){let i=t._minFilter;(!t._pot||!t._mipmaps||t._compressed&&1===t._levels.length)&&(i===n.c.FILTER_NEAREST_MIPMAP_NEAREST||i===n.c.FILTER_NEAREST_MIPMAP_LINEAR?i=n.c.FILTER_NEAREST:i!==n.c.FILTER_LINEAR_MIPMAP_NEAREST&&i!==n.c.FILTER_LINEAR_MIPMAP_LINEAR||(i=n.c.FILTER_LINEAR)),e.texParameteri(s,e.TEXTURE_MIN_FILTER,this.glFilter[i])}if(2&i&&e.texParameteri(s,e.TEXTURE_MAG_FILTER,this.glFilter[t._magFilter]),4&i&&(this.webgl2?e.texParameteri(s,e.TEXTURE_WRAP_S,this.glAddress[t._addressU]):e.texParameteri(s,e.TEXTURE_WRAP_S,this.glAddress[t._pot?t._addressU:n.c.ADDRESS_CLAMP_TO_EDGE])),8&i&&(this.webgl2?e.texParameteri(s,e.TEXTURE_WRAP_T,this.glAddress[t._addressV]):e.texParameteri(s,e.TEXTURE_WRAP_T,this.glAddress[t._pot?t._addressV:n.c.ADDRESS_CLAMP_TO_EDGE])),16&i&&this.webgl2&&e.texParameteri(s,e.TEXTURE_WRAP_R,this.glAddress[t._addressW]),32&i&&this.webgl2&&e.texParameteri(s,e.TEXTURE_COMPARE_MODE,t._compareOnRead?e.COMPARE_REF_TO_TEXTURE:e.NONE),64&i&&this.webgl2&&e.texParameteri(s,e.TEXTURE_COMPARE_FUNC,this.glComparison[t._compareFunc]),128&i){const i=this.extTextureFilterAnisotropic;i&&e.texParameterf(s,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.max(1,Math.min(Math.round(t._anisotropy),this.maxAnisotropy)))}}setTexture(t,e){t._glTexture||this.initializeTexture(t),t._parameterFlags>0||t._needsUpload||t._needsMipmapsUpload?(this.activeTexture(e),this.bindTexture(t),t._parameterFlags&&(this.setTextureParameters(t),t._parameterFlags=0),(t._needsUpload||t._needsMipmapsUpload)&&(this.uploadTexture(t),t!==this.grabPassTexture&&(t.markUploaded(),t._needsMipmapsUpload=!1))):this.bindTextureOnUnit(t,e)}setBuffers(t,e={},i){const s=this.gl;let r,a,o,h,c;const l=this.shader.attributes;if(this.attributesInvalidated){for(let e=0,i=l.length;e<i;e++){r=l[e];const i=r.locationId;a=r.scopeId.value;const u="TEXCOORD1"===r.scopeId.name&&this.activeDrawCall&&(this.activeDrawCall._shaderDefs&n.c.SHADERDEF_LMUV0)>0;if(null!==a&&(o=this.vertexBuffers[a.stream],h=this.vbOffsets[a.stream]||0,o&&!o.format.elementMap[a.name]&&!u)){const t=r.locationId;s.disableVertexAttribArray(t),this.enabledAttributes[t]=!1,a=null}if(null==a)s.disableVertexAttribArray(i),this.enabledAttributes[i]=!1,"POSITION"===r.scopeId.name?s.vertexAttrib4fv(i,le):"COLOR"===r.scopeId.name?s.vertexAttrib4fv(i,he):"TANGENT"===r.scopeId.name?s.vertexAttrib4fv(i,ue):"NORMAL"===r.scopeId.name?s.vertexAttrib4fv(i,de):s.vertexAttrib4fv(i,ce);else{if(void 0===o)continue;let e;if(c=o.bufferId,this.boundBuffer!==c&&(s.bindBuffer(s.ARRAY_BUFFER,c),this.attributePointers={},this.boundBuffer=c),this.enabledAttributes[i]||(s.enableVertexAttribArray(i),this.enabledAttributes[i]=!0),u)for(let t=0;t<l.length;t++){const i=l[t].scopeId;if("TEXCOORD0"===i.name){e=i.value;break}}else e=a;const n=(e.numComponents<<24)+(e.dataType<<21)+(e.normalize?1<<20:0)+(e.stride<<10)+(e.offset+h<<0);this.attributePointers[i]!==n&&(s.vertexAttribPointer(i,e.numComponents,this.glType[e.dataType],e.normalize,e.stride,e.offset+h),this.attributePointers[i]=n),1===a.stream&&t>0?this.instancedAttribs[i]||(s.vertexAttribDivisor(i,1),this.instancedAttribs[i]=!0):this.instancedAttribs[i]&&(s.vertexAttribDivisor(i,0),this.instancedAttribs[i]=!1)}}this.attributesInvalidated=!1}for(let t=0,i=l.length;t<i;t++){r=l[t];const i=e[r.scopeId.name];if(!i)continue;const n=r.locationId;this.enabledAttributes[n]=!1,s.disableVertexAttribArray(n),s.vertexAttrib4fv(n,i)}c=this.indexBuffer?this.indexBuffer.bufferId:null,this.boundElementBuffer!==c&&(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,c),this.boundElementBuffer=c)}draw(t,e,i,s={},r=null){const a=this.gl;let o,h,c,l,u,d,_,p,m,f,g,y;const E=this.shader,A=E.samplers,T=E.uniforms;if(0===e)return;this.activeDrawCall=r,e>0&&(this.boundBuffer=null,this.attributesInvalidated=!0),this.setBuffers(e,s);let C=0;for(o=0,c=A.length;o<c;o++)if(u=A[o],d=u.scopeId.value,l=u.scopeId.name,null==d&&(d=i[u.scopeId.name]||n.c.UniformDefaultValues[u.dataType]),u.meta||(u.meta={hdr:this.scope.resolve(l+"_HDR"),texels:this.scope.resolve(l+"_TexelSize")}),d instanceof x)_=d,this.setTexture(_,C),_.rgbm?u.meta.hdr.setValue([5*_.intensity,1,0,1]):u.meta.hdr.setValue([1*_.intensity,1,0,0]),u.meta.texels.setValue([1/_.width,1/_.height,_.width,_.height]),DEBUG&&this.renderTarget&&this.renderTarget._samples<2&&(this.renderTarget.colorBuffer&&this.renderTarget.colorBuffer===_?console.error("Trying to bind current color buffer as a texture"):this.renderTarget.depthBuffer&&this.renderTarget.depthBuffer===_&&console.error("Trying to bind current depth buffer as a texture")),u.slot!==C&&(a.uniform1i(u.locationId,C),u.slot=C),C++;else{for(u.array.length=0,p=d.length,h=0;h<p;h++)_=d[h],this.setTexture(_,C),u.array[h]=C,C++;a.uniform1iv(u.locationId,u.array)}for(o=0,c=T.length;o<c;o++)m=T[o],f=m.scopeId,g=m.version,y=f.versionObject.version,g.globalId===y.globalId&&g.revision===y.revision||(g.globalId=y.globalId,g.revision=y.revision,null==f.value?this.commitFunction[m.dataType](m,i[f.name]||n.c.UniformDefaultValues[m.dataType]):this.commitFunction[m.dataType](m,f.value));const b=this.glPrimitive[t.type],S=t.count;if(t.indexed){const i=this.indexBuffer,s=i.glFormat,n=t.base*i.bytesPerIndex;e>0?a.drawElementsInstanced(b,S,s,n,e):a.drawElements(b,S,s,n)}else{const i=t.base;e>0?a.drawArraysInstanced(b,i,S,e):a.drawArrays(b,i,S)}this._drawCallsPerFrame++,this.activeDrawCall=null}clear(t){const e=this.defaultClearOptions,i=n.c.CLEARFLAG_COLOR|n.c.CLEARFLAG_STENCIL|n.c.CLEARFLAG_DEPTH,s=void 0===(t=t||e).flags||null===t.flags?e.flags:t.flags;if(0!==s){const r=this.gl;if(s&n.c.CLEARFLAG_COLOR){const i=t.color?t.color:e.color;this.setClearColor(i[0],i[1],i[2],i[3])}if(s&n.c.CLEARFLAG_DEPTH){const i=void 0===t.depth||null===t.depth?e.depth:t.depth;this.setClearDepth(i),this.depthWrite||r.depthMask(!0)}if(s&n.c.CLEARFLAG_STENCIL){const i=void 0===t.stencil||null===t.stencil?e.stencil:t.stencil;this.setClearStencil(i)}r.clear(this.glClearFlag[s&i]),s&n.c.CLEARFLAG_DEPTH&&(this.depthWrite||r.depthMask(!1))}}readPixels(t,e,i,s,n){const r=this.gl;r.readPixels(t,e,i,s,r.RGBA,r.UNSIGNED_BYTE,n)}setClearDepth(t){t!==this.clearDepth&&(this.gl.clearDepth(t),this.clearDepth=t)}setClearColor(t,e,i,s){t===this.clearRed&&e===this.clearGreen&&i===this.clearBlue&&s===this.clearAlpha||(this.gl.clearColor(t,e,i,s),this.clearRed=t,this.clearGreen=e,this.clearBlue=i,this.clearAlpha=s)}setClearStencil(t){t!==this.clearStencil&&(this.gl.clearStencil(t),this.clearStencil=t)}setRenderTarget(t){this.renderTarget=t}getRenderTarget(){return this.renderTarget}getDepthTest(){return this.depthTest}setDepthTest(t){if(this.depthTest!==t){const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.depthTest=t}}setDepthFunc(t){this.depthFunc!==t&&(this.gl.depthFunc(this.glComparison[t]),this.depthFunc=t)}getDepthWrite(){return this.depthWrite}setDepthWrite(t){this.depthWrite!==t&&(this.gl.depthMask(t),this.depthWrite=t)}setColorWrite(t,e,i,s){this.writeRed===t&&this.writeGreen===e&&this.writeBlue===i&&this.writeAlpha===s||(this.gl.colorMask(t,e,i,s),this.writeRed=t,this.writeGreen=e,this.writeBlue=i,this.writeAlpha=s)}setDepthBias(t){this.depthBiasEnabled!==t&&(this.depthBiasEnabled=t,t?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL))}setDepthBiasValues(t,e){this.gl.polygonOffset(e,t)}getBlending(){return this.blending}setBlending(t){if(this.blending!==t){const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.blending=t}}setStencilTest(t){if(this.stencil!==t){const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.stencil=t}}setStencilFunc(t,e,i){if(this.stencilFuncFront!==t||this.stencilRefFront!==e||this.stencilMaskFront!==i||this.stencilFuncBack!==t||this.stencilRefBack!==e||this.stencilMaskBack!==i){this.gl.stencilFunc(this.glComparison[t],e,i),this.stencilFuncFront=this.stencilFuncBack=t,this.stencilRefFront=this.stencilRefBack=e,this.stencilMaskFront=this.stencilMaskBack=i}}setStencilFuncFront(t,e,i){if(this.stencilFuncFront!==t||this.stencilRefFront!==e||this.stencilMaskFront!==i){const s=this.gl;s.stencilFuncSeparate(s.FRONT,this.glComparison[t],e,i),this.stencilFuncFront=t,this.stencilRefFront=e,this.stencilMaskFront=i}}setStencilFuncBack(t,e,i){if(this.stencilFuncBack!==t||this.stencilRefBack!==e||this.stencilMaskBack!==i){const s=this.gl;s.stencilFuncSeparate(s.BACK,this.glComparison[t],e,i),this.stencilFuncBack=t,this.stencilRefBack=e,this.stencilMaskBack=i}}setStencilOperation(t,e,i,s){this.stencilFailFront===t&&this.stencilZfailFront===e&&this.stencilZpassFront===i&&this.stencilFailBack===t&&this.stencilZfailBack===e&&this.stencilZpassBack===i||(this.gl.stencilOp(this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailFront=this.stencilFailBack=t,this.stencilZfailFront=this.stencilZfailBack=e,this.stencilZpassFront=this.stencilZpassBack=i),this.stencilWriteMaskFront===s&&this.stencilWriteMaskBack===s||(this.gl.stencilMask(s),this.stencilWriteMaskFront=s,this.stencilWriteMaskBack=s)}setStencilOperationFront(t,e,i,s){this.stencilFailFront===t&&this.stencilZfailFront===e&&this.stencilZpassFront===i||(this.gl.stencilOpSeparate(this.gl.FRONT,this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailFront=t,this.stencilZfailFront=e,this.stencilZpassFront=i),this.stencilWriteMaskFront!==s&&(this.gl.stencilMaskSeparate(this.gl.FRONT,s),this.stencilWriteMaskFront=s)}setStencilOperationBack(t,e,i,s){this.stencilFailBack===t&&this.stencilZfailBack===e&&this.stencilZpassBack===i||(this.gl.stencilOpSeparate(this.gl.BACK,this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailBack=t,this.stencilZfailBack=e,this.stencilZpassBack=i),this.stencilWriteMaskBack!==s&&(this.gl.stencilMaskSeparate(this.gl.BACK,s),this.stencilWriteMaskBack=s)}setBlendFunction(t,e){(this.blendSrc!==t||this.blendDst!==e||this.separateAlphaBlend)&&(this.gl.blendFunc(this.glBlendFunction[t],this.glBlendFunction[e]),this.blendSrc=t,this.blendDst=e,this.separateAlphaBlend=!1)}setBlendFunctionSeparate(t,e,i,s){this.blendSrc===t&&this.blendDst===e&&this.blendSrcAlpha===i&&this.blendDstAlpha===s&&this.separateAlphaBlend||(this.gl.blendFuncSeparate(this.glBlendFunction[t],this.glBlendFunction[e],this.glBlendFunction[i],this.glBlendFunction[s]),this.blendSrc=t,this.blendDst=e,this.blendSrcAlpha=i,this.blendDstAlpha=s,this.separateAlphaBlend=!0)}setBlendEquationSeparate(t,e){this.blendEquation===t&&this.blendAlphaEquation===e&&this.separateAlphaEquation||(this.gl.blendEquationSeparate(this.glBlendEquation[t],this.glBlendEquation[e]),this.blendEquation=t,this.blendAlphaEquation=e,this.separateAlphaEquation=!0)}setCullMode(t){if(this.cullMode!==t){if(t===n.c.CULLFACE_NONE)this.gl.disable(this.gl.CULL_FACE);else{this.cullMode===n.c.CULLFACE_NONE&&this.gl.enable(this.gl.CULL_FACE);const e=this.glCull[t];this.cullFace!==e&&(this.gl.cullFace(e),this.cullFace=e)}this.cullMode=t}}getCullMode(){return this.cullMode}setIndexBuffer(t){this.indexBuffer=t}setVertexBuffer(t,e,i){if(null!=t&&(this.vertexBuffers[e]!==t||this.vbOffsets[e]!==i)){this.vertexBuffers[e]=t,this.vbOffsets[e]=i;let s=0;const n=t.getFormat().elements,r=n.length;for(;s<r;){const t=n[s++];t.stream=e,t.scopeId.setValue(t)}this.attributesInvalidated=!0}}compileShaderSource(t,e){const i=this.gl;let s=e?this.vertexShaderCache[t]:this.fragmentShaderCache[t];return s||(s=i.createShader(e?i.VERTEX_SHADER:i.FRAGMENT_SHADER),i.shaderSource(s,t),i.compileShader(s),e?this.vertexShaderCache[t]=s:this.fragmentShaderCache[t]=s),s}compileAndLinkShader(t){const e=this.gl,i=t.definition,s=this.compileShaderSource(i.vshader,!0),r=this.compileShaderSource(i.fshader,!1),a=e.createProgram();if(e.attachShader(a,s),e.attachShader(a,r),this.webgl2&&i.useTransformFeedback){const t=i.attributes,s=[];for(const e in t)t.hasOwnProperty(e)&&s.push("out_"+e);e.transformFeedbackVaryings(a,s,e.INTERLEAVED_ATTRIBS)}for(const t in i.attributes)if(i.attributes.hasOwnProperty(t)){const s=i.attributes[t],r=n.c.ShaderAttributeSlots[s];e.bindAttribLocation(a,r,t)}e.linkProgram(a),t._glVertexShader=s,t._glFragmentShader=r,t._glProgram=a,t.ready=!1}createShader(t){this.compileAndLinkShader(t),this.shaders.push(t)}destroyShader(t){const e=this.shaders.indexOf(t);-1!==e&&this.shaders.splice(e,1),t._glProgram&&(this.gl.deleteProgram(t._glProgram),t._glProgram=null,this.removeShaderFromCache(t))}_addLineNumbers(t){const e=t.split("\n");for(let t=0,i=e.length;t<i;t++)e[t]=t+1+":\t"+e[t];return e.join("\n")}postLink(t){const e=this.gl,i=t._glVertexShader,s=t._glFragmentShader,n=t._glProgram,r=t.definition;if(!e.getShaderParameter(i,e.COMPILE_STATUS))return console.error("Failed to compile vertex shader:\n\n"+this._addLineNumbers(r.vshader)+"\n\n"+e.getShaderInfoLog(i)),!1;if(!e.getShaderParameter(s,e.COMPILE_STATUS))return console.error("Failed to compile fragment shader:\n\n"+this._addLineNumbers(r.fshader)+"\n\n"+e.getShaderInfoLog(s)),!1;if(!e.getProgramParameter(n,e.LINK_STATUS))return console.error("Failed to link shader program. Error: "+e.getProgramInfoLog(n)),!1;let a,o,h,c;a=0;const l=e.getProgramParameter(n,e.ACTIVE_ATTRIBUTES);for(;a<l;)o=e.getActiveAttrib(n,a++),h=e.getAttribLocation(n,o.name),void 0===r.attributes[o.name]&&console.error('Vertex shader attribute "'+o.name+'" is not mapped to a semantic in shader definition.'),c=new ie(this,r.attributes[o.name],this.pcUniformType[o.type],h),t.attributes.push(c);t.samplers=[],t.uniforms=[],a=0;const u=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(;a<u;)o=e.getActiveUniform(n,a++),h=e.getUniformLocation(n,o.name),c=new ie(this,o.name,this.pcUniformType[o.type],h),o.type===e.SAMPLER_2D||o.type===e.SAMPLER_CUBE||this.webgl2&&(o.type===e.SAMPLER_2D_SHADOW||o.type===e.SAMPLER_CUBE_SHADOW||o.type===e.SAMPLER_3D)?t.samplers.push(c):t.uniforms.push(c);return t.ready=!0,!0}setShader(t){if(t!==this.shader){if(!t.ready){if(!this.postLink(t))return!1;t.uniformsUsage=this.getUniformsInUse(t.uniforms)}this.shader=t,this.gl.useProgram(t._glProgram),this.attributesInvalidated=!0}return!0}getHdrFormat(){return this.textureHalfFloatRenderable?n.c.PIXELFORMAT_RGB16F:this.textureFloatRenderable?n.c.PIXELFORMAT_RGB32F:n.c.PIXELFORMAT_R8_G8_B8_A8}getBoneLimit(){return this.boneLimit}setBoneLimit(t){this.boneLimit=t}resizeCanvas(t,e){this._width=t,this._height=e;const i=Math.min(this._maxPixelRatio,window.devicePixelRatio);t*=i,e*=i,this.canvas.width=t,this.canvas.height=e,this.events.fire(oe,t,e,this._width,this._height)}setResolution(t,e){this._width=t,this._height=e,this.canvas.width=t,this.canvas.height=e,this.events.fire(oe,t,e,this._width,this._height)}getUniformsInUse(t){let e=0;for(let i=0;i<t.length;i++){const s=t[i],r=n.c.UNIFORMS_USAGE_MAP[s.scopeId.name];void 0!==r&&(e|=r)}return e}applyStencilState(t,e,i){t||e||!i?(t||e)&&(this.setStencilTest(!0),t===e?(this.setStencilFunc(t.func,t.ref,t.readMask),this.setStencilOperation(t.fail,t.zfail,t.zpass,t.writeMask)):(t?(this.setStencilFuncFront(t.func,t.ref,t.readMask),this.setStencilOperationFront(t.fail,t.zfail,t.zpass,t.writeMask)):(this.setStencilFuncFront(n.c.FUNC_ALWAYS,0,255),this.setStencilOperationFront(n.c.STENCILOP_KEEP,n.c.STENCILOP_KEEP,n.c.STENCILOP_KEEP,255)),e?(this.setStencilFuncBack(e.func,e.ref,e.readMask),this.setStencilOperationBack(e.fail,e.zfail,e.zpass,e.writeMask)):(this.setStencilFuncBack(n.c.FUNC_ALWAYS,0,255),this.setStencilOperationBack(n.c.STENCILOP_KEEP,n.c.STENCILOP_KEEP,n.c.STENCILOP_KEEP,255)))):this.setStencilTest(!1)}clearShaderCache(){const t=this.gl;let e;for(e in this.fragmentShaderCache)this.fragmentShaderCache.hasOwnProperty(e)&&(t.deleteShader(this.fragmentShaderCache[e]),delete this.fragmentShaderCache[e]);for(e in this.vertexShaderCache)this.vertexShaderCache.hasOwnProperty(e)&&(t.deleteShader(this.vertexShaderCache[e]),delete this.vertexShaderCache[e]);this.programLib.clearCache()}removeShaderFromCache(t){this.programLib.removeFromCache(t)}destroy(){this.grabPassTexture.destroy(),this.clearShaderCache(),this.canvas.removeEventListener("webglcontextlost",this._contextLostHandler,!1),this.canvas.removeEventListener("webglcontextrestored",this._contextRestoredHandler,!1),this._contextLostHandler=null,this._contextRestoredHandler=null,this.canvas=null,this.gl=null}get width(){return this.gl.drawingBufferWidth||this.canvas.width}get height(){return this.gl.drawingBufferHeight||this.canvas.height}get enableAutoInstancing(){return this._enableAutoInstancing}set enableAutoInstancing(t){this._enableAutoInstancing=t&&this.extInstancing}get maxPixelRatio(){return this._maxPixelRatio}set maxPixelRatio(t){this._maxPixelRatio=t,this.resizeCanvas(this._width,this._height)}},pc.Keywords=w,pc.KeywordSet=v,pc.Shader=at,pc.UnityShader=ht,pc.UnityShaderPass=class{constructor(){this.lightMode=n.c.SHADER_PASS_ALWAYS,this.renderType=n.c.RENDER_TYPE_OPAQUE,this.grabPassTextureName=null,this.graphicsDevice=null,this.shaders=[],this.boundParameters=[],this.sourceShader=null,this.passType=0,this.zTest=null,this.zWrite=null,this.culling=null,this.blending=null,this.alphaBlending=null,this.colorWriteMask=null,this.offsetUnits=null,this.offsetFactor=null,this.stencilRef=null,this.stencilReadMask=null,this.stencilWriteMask=null,this.stencilOp=null,this.stencilOpFront=null,this.stencilOpBack=null,this.tags=null,this.variants=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"UnityShaderPass")}setupTags(){for(let t=0;t<this.tags.length;t++){const e=this.tags[t];e.name===n.c.LIGHT_MODE_TAG_NAME&&(e.value===n.c.LIGHT_MODE_FORWARD_BASE_NAME&&(this.lightMode=n.c.SHADER_PASS_FORWARD_BASE),e.value===n.c.LIGHT_MODE_FORWARD_ADD_NAME&&(this.lightMode=n.c.SHADER_PASS_FORWARD_ADD),e.value===n.c.LIGHT_MODE_SHADOW_CASTER_NAME&&(this.lightMode=n.c.SHADER_PASS_SHADOW_CASTER),e.value===n.c.LIGHT_MODE_VERTEX_NAME&&(this.lightMode=n.c.SHADER_PASS_VERTEX),e.value===n.c.LIGHT_MODE_VERTEX_LM_NAME&&(this.lightMode=n.c.SHADER_PASS_VERTEX_LM)),e.name===n.c.GRAB_PASS_TAG_NAME&&(this.lightMode=n.c.SHADER_PASS_GRAB_PASS),e.name===n.c.GRAB_PASS_TEXTURE_NAME_TAG_NAME&&(this.grabPassTextureName=e.value),e.name===n.c.RENDER_TYPE_TAG_NAME&&e.value===n.c.RENDER_TYPE_BACKGROUND_NAME&&(this.renderType=n.c.RENDER_TYPE_BACKGROUND)}}getVariant(t){let e=null;for(let i=0;i<this.variants.length;i++){const s=this.variants[i];v.intersection(t,s.keywords,rt),rt.cardinality===s.keywords.cardinality&&(null===e||e.keywords.cardinality<rt.cardinality)&&(e=s)}return e}setupVariants(){const t=[];for(let e=0;e<this.variants.length;e++){const i=this.variants[e],s=ShaderProgramsLibrary[i.vertexProgram],n=ShaderProgramsLibrary[i.fragmentProgram];t.push(new ot(this.graphicsDevice,i.keywords,s,n,this.sourceShader))}this.variants=t}updateRenderState(t){for(let e=0;e<this.boundParameters.length;e++){const i=t.parameters[this.boundParameters[e].name];i&&i.data?this.boundParameters[e].val=i.data:this.boundParameters[e].val=0}}setupRenderSettings(){this._collectBoundParameters(this.zTest,this.boundParameters),this._collectBoundParameters(this.zWrite,this.boundParameters),this._collectBoundParameters(this.culling,this.boundParameters),this._collectBoundParameters(this.blending,this.boundParameters),this._collectBoundParameters(this.alphaBlending,this.boundParameters),this._collectBoundParameters(this.colorWriteMask,this.boundParameters),this._collectBoundParameters(this.offsetUnits,this.boundParameters),this._collectBoundParameters(this.offsetFactor,this.boundParameters),this._collectBoundParameters(this.stencilRef,this.boundParameters),this._collectBoundParameters(this.stencilReadMask,this.boundParameters),this._collectBoundParameters(this.stencilWriteMask,this.boundParameters),this._collectBoundParameters(this.stencilOp,this.boundParameters),this._collectBoundParameters(this.stencilOpFront,this.boundParameters),this._collectBoundParameters(this.stencilOpBack,this.boundParameters)}_collectBoundParameters(t,e){if(t)if("Luna.Unity.DTO.UnityEngine.Assets.Shader.Pass+Value"===t.$$fullname&&t.name)e.push(t);else for(const i in t){if(!t.hasOwnProperty(i))continue;const s=t[i];s&&s.$$fullname&&this._collectBoundParameters(s,e)}}applyMissingVariant(t){const e=I.a.getApplication().graphicsDevice,i=tt(this.sourceShader.name,this.sourceShader.$id),s=new ot(e,t,i.definition.vshader,i.definition.fshader,this.sourceShader);return s.shader=i,this.variants.push(s),s}},pc.StencilParameters=me,pc.SphericalHarmonicsL2=xe,pc.RenderTarget=Vt,pc.Sprite=we,pc.CommandBuffer=class{constructor(){this.device=I.a.getApplication().graphicsDevice,this._name="",this.commands=[],this.renderTargetIdentifier=null,this.clearCommand=null,this.view=null,this.proj=null}clear(){this.commands.length=0,this.renderTargetIdentifier=null,this.clearCommand=null}clearRenderTarget(t,e,i){let s=0;t&&(s|=n.c.CLEARFLAG_DEPTH),e&&(s|=n.c.CLEARFLAG_COLOR),this.clearCommand={color:i.data,depth:1,flags:s}}setRenderTarget(t){this.renderTargetIdentifier=t}drawMesh(t,e=s.e.IDENTITY.clone(),i=null,n=-1,r=-1,a=null){const o=new Le(t,e,i,n,r,a);this.commands.push(o)}setViewMatrix(t){this.view=t}setProjectionMatrix(t){this.proj=t}get name(){return this._name}set name(t){this._name=t}},pc.Graphics=Ve,pc.UnityMaterialPropertyBlock=class extends a{constructor(){super(),this.parametersCount=0}copyFromMeshInstance(t){for(const e in t.parameters)this.setParameter(e,this.cloneParameterData(t.parameters[e].data))}applyToMeshInstance(t){t.parameters={};for(const e in this.parameters)t.setParameter(e,this.cloneParameterData(this.parameters[e].data))}getParameter(t){const e=this.parameters[t];return e?this.cloneAsPlainArray(e.data):null}setParameter(t,e){this.parameters.hasOwnProperty(t)||this.parametersCount++,super.setParameter(t,this.cloneParameterData(e))}clear(){this.parameters={},this.parametersCount=0}cloneParameterData(t){return t instanceof Float32Array||Array.isArray(t)?new Float32Array(t):t}cloneAsPlainArray(t){return t instanceof Float32Array?t.slice():t}get isEmpty(){return 0===this.parametersCount}},pc.RenderTargetIdentifier=class{constructor(){this._name="",this._target=null}get target(){return this._target}set target(t){this._target=t}},pc.ReflectionProbeData=class{constructor(){this.boxProjection=!1,this.cubemap=new x(UnityEngine.Graphics.graphicsDevice,{cubemap:!0,rgbm:!1}),this.position=new s.j,this.min=new s.j,this.max=new s.j,this.box={min:new s.j,max:new s.j,position:new s.j}}getBox(t){return this.box.min.copy(this.min),this.box.max.copy(this.max),this.box.position.copy(this.position),this.boxProjection,this.box}},pc.ScopeId=re,pc.Culling=At,pc.LightData=class{constructor(){this.mainLight=null,this.pixelLights=[],this.vertexLights=[],this.otherLights=[],this.allLights=[]}reset(){this.mainLight=null,this.pixelLights.length=0,this.vertexLights.length=0,this.otherLights.length=0,this.allLights.length=0}addOtherLights(t){for(let e=0;e<this.otherLights.length;e++){const i=this.otherLights[e];je.copy(i._directionToLight),i._type===n.c.LIGHTTYPE_DIRECTIONAL?t.addDirectionalLight(je,i._color,i._intensity,1):i._type===n.c.LIGHTTYPE_POINT&&t.addPointLight(je,i._color,i._intensity,i.attenuationEnd),i._type===n.c.LIGHTTYPE_SPOT&&t.addSpotLight(je,i._color,i._intensity,i.attenuationEnd,i._outerConeAngle)}}combineAllLights(){this.allLights.length=0,this.mainLight&&this.allLights.push(this.mainLight);for(let t=0;t<this.pixelLights.length;t++)this.allLights.push(this.pixelLights[t]);for(let t=0;t<this.vertexLights.length;t++)this.allLights.push(this.vertexLights[t]);for(let t=0;t<this.otherLights.length;t++)this.allLights.push(this.otherLights[t])}toString(){return"{ "+(this.mainLight?this.mainLight._node.name:"<NONE>")+", Pixel = ["+this.pixelLights.map((t=>t._node.name)).join(", ")+"], Vertex = ["+this.vertexLights.map((t=>t._node.name)).join(", ")+"], SH = ["+this.otherLights.map((t=>t._node.name)).join(", ")+"] }"}},pc.RenderingUtils=qe,pc.SortUtils=Je,pc._createMissingShader=tt,pc.ShaderPatches=st,pc.CanvasMeshInstance=class{constructor(t){this.id=C.id++,this.entity=t.entity,this.parentScreen=t,this.renderers=[],this.device=I.a.getApplication().graphicsDevice,this.renderer=I.a.getApplication().renderer,this.renderersDirty=!1,this._aabb=new s.a,this.node=t.entity,this.visible=!0,this.cull=!0,this.isCanvas=!0,this._material=UnityEngine.Canvas.GetDefaultCanvasMaterial().handle,this._material.setParameter($e,n.c.FUNC_ALWAYS+1);const e=this._material.parameters[$e];e.scopeId||(e.scopeId=this.device.scope.resolve($e)),this._mesh=null,this._nearestScreen=null,this.scene=I.a.getApplication().scene,this.visibleThisFrame=!0,this.zdist=0,this._shaderDefs=0,this.drawCalls=[],this.meshInstances=[],TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"CanvasMeshInstance")}uiElementsSort(t,e){return Je.uiElementsSort(t.model,e.model)}render(t,e,i,s,r){this.checkDirtyAndUpdateHierarchy(),this.drawCalls.length=0,this.meshInstances.length=0;const a=this.renderers,o=[];for(let t=0;t<a.length;t++){const e=a[t];if(!e.isCanvas&&(0===e._groupAlpha||e.culledByTransparency))continue;!e.isCanvas&&e.popMaterialCount>0&&o.push(e);const i=e.model.meshInstances;for(let t=0;t<i.length;t++){const e=i[t];(e.isCanvas||0!==e._mesh.primitive[0].count)&&(e.material&&this.meshInstances.push(e))}}i?At.cullUi(i,this.meshInstances,this.drawCalls):this.drawCalls=this.meshInstances;for(let t=0;t<o.length;t++){const e=o[t],i=this.getLastDrawChild(e.entity,this.drawCalls,0);if(i){const t=i.node._guid;this.scene.activeUiMasks[t]||(this.scene.activeUiMasks[t]=[]),this.scene.activeUiMasks[t].push(e)}}const h=this.parentScreen.screenType!==n.c.SCREEN_TYPE_SCREEN?n.c.FUNC_LESSEQUAL+1:n.c.FUNC_ALWAYS+1;for(let n=0;n<this.drawCalls.length;n++){const a=this.drawCalls[n];if(a.isCanvas){a.render(t,e,i,s,r);continue}a.material.setParameter($e,h),this.renderer.renderMeshInstance(t,e,i,a,r);const o=this.scene.activeUiMasks[a.node._guid];if(o){for(let s=0;s<o.length;s++){const n=o[s],a=n._popMaterials,h=n.model.meshInstances[0];if(h)for(let s=0;s<a.length;s++){const n=a[s].handle;this.clearMask(t,e,i,h,r,n)}}this.scene.activeUiMasks[a.node._guid]=null}}if(!this.parentScreen.parentScreen)for(const t in this.scene.activeUiMasks)this.scene.activeUiMasks[t]=null}getLastDrawChild(t,e,i){let s=null;const n=t.allChildren();for(let t=i+1;t<e.length;t++){const i=e[t],r=i.node;n.indexOf(r)>=0&&(s=i)}return s}clearMask(t,e,i,s,n,r){const a=s.material,o=s.parameters.hasOwnProperty("_ColorMask")?s.parameters._ColorMask.data:null;s.material=r,o&&(s.parameters._ColorMask.data=r.parameters._ColorMask.data),this.renderer.renderMeshInstance(t,e,i,s,n),s.material=a,o&&(s.parameters._ColorMask.data=o)}addRenderer(t){this.renderers.includes(t)||(this.renderers.push(t),this.renderersDirty=!0)}removeRenderer(t){this.renderers.includes(t)&&(this.renderers.splice(this.renderers.indexOf(t),1),this.renderersDirty=!0)}checkDirtyAndUpdateHierarchy(){if(this.updateModel(),!this.renderersDirty)return;this.parentScreen.system._syncDrawOrder(),this.parentScreen._updateStencilParameters(),this.renderers.sort(this.uiElementsSort),this._aabb.setToInfinity();const t=this.renderers;for(let e=0;e<t.length;e++){const i=t[e].model.meshInstances;for(let t=0;t<i.length;t++)this._aabb.add(i[t].aabb)}this.renderersDirty=!1}updateModel(){const t=this.renderers;for(let e=0;e<t.length;e++){const i=t[e];i.isCanvas||i.model.update()}}get aabb(){return this.checkDirtyAndUpdateHierarchy(),this._aabb}get mesh(){return this._mesh}get sortingLayerIndex(){return this.parentScreen.sortingLayerIndex}get sortingOrder(){return this.parentScreen.sortingOrder}get drawOrder(){return this.parentScreen.drawOrder}get material(){return this._material}set material(t){this._material=t}get model(){return this.parentScreen}}},(t,e,i)=>{"use strict";i.d(e,{b:()=>h,a:()=>c});var s=i(1);const n=3,r=1e-5,a={x:0,y:1,z:2,w:3},o={r:0,g:1,b:2,a:3};class h{constructor(t,e,i,s,r=0,a=0,o=0){this.time=t,this.value=e,this.inTangent=i,this.outTangent=s,this.leftConstant=a===n||7===r||71===r||103===r,this.rightConstant=o===n||97===r||101===r||103===r,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Keyframe")}}class c{constructor(t){this.id=(0,s.b)(),this.path=t.path,this.componentType=t.componentType,this.property=t.property,this.targetsLocalEulerAnglesRaw=!1,this.targetObject=null,this.targetProperty=null,this.isVectorProperty=!1,this.vectorPropertyIndex=-1,this.isMaterialPropertyCurve=!1,this.objectCurve=!1,this.keys=[],this.componentType&&0!==this.componentType.indexOf("UnityEngine.")&&(this.property=this.property.substring(0,1).toLowerCase()+this.property.substring(1));const e=this.property?this.property.split("."):[];if(this.property&&e.length>1?(this.targetObject=e[0],this.targetProperty=e[1],"localEulerAnglesRaw"===this.targetObject?this.targetsLocalEulerAnglesRaw=!0:"blendShape"===this.targetObject&&(this.targetProperty=this.property.substring(11,this.property.length))):(this.targetProperty=this.property,this.targetObject=null),this.keyId=this.path+":"+this.componentType+"."+this.property,this.componentType){this.isMaterialPropertyCurve=this.componentType.indexOf("Renderer")>=0&&"material"===this.targetObject;const t=this.property.split(".");if(this.isVectorProperty=t.length>2,this.isVectorProperty){const e=t[t.length-1],i=o.hasOwnProperty(e)?o:a;this.vectorPropertyIndex=i[e]}else this.vectorPropertyIndex=-1}if(t.keyframes)this.keys=t.keyframes;else if(t.keys_flow){const e=t.keys_flow;this.keys=[];for(let t=0;t<e.length;t+=7)this.keys.push(new h(e[t],e[t+1],e[t+2],e[t+3],e[t+4],e[t+5],e[t+6]))}else{if(this.keys=[],t.keys)for(let e=0;e<t.keys.length;e++){const i=t.keys[e];this.keys.push(new h(i[0],i[1],i[2],i[3],i[4],i[5],i[6]))}if(t.objectReferenceKeys)for(let e=0;e<t.objectReferenceKeys.length;e++){const i=t.objectReferenceKeys[e];this.keys.push(new h(i[0],i[1],i[2],i[3],i[4],i[5],i[6]))}this.objectCurve=!!t.objectReferenceKeys}TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"AnimationCurve")}setValue(t,e){0!==this.keys.length&&(t>=this.keys.length?this.keys[this.keys.length-1].value=e:this.keys[t].value=e)}getValue(t){return 0===this.keys.length?-1:t>=this.keys.length?this.keys[this.keys.length-1].value:this.keys[t].value}findKeyIndexAt(t){if(t<=this.keys[0].time)return 0;if(t>=this.keys[this.keys.length-1].time)return this.keys.length-2;for(let e=0;e<this.keys.length-1;e++)if(this.keys[e+1].time-t>r)return e;return-1}sample(t,e){const i=t.getOrCreateKey(this,this.keyId);i.set(this.value(e,i))}value(t,e=null){if(0===this.keys.length)return 0;if(1===this.keys.length)return this.keys[0].value;if(this.keys[this.keys.length-1].time-t<=r)return e&&(e.idx=0),this.keys[this.keys.length-1].value;let i=null,s=null;if(2===this.keys.length)i=this.keys[0],s=this.keys[1];else{e&&null!=e.idx&&(i=this.keys[e.idx],s=this.keys[e.idx+1],(i.time>t||s.time<t)&&(e.idx=null));let n=null;e?(null==e.idx&&(e.idx=this.findKeyIndexAt(t)),n=e.idx):n=this.findKeyIndexAt(t),i=this.keys[n],s=this.keys[n+1]}if(s.time-t<=r)return e&&this.keys.length>e.idx&&e.idx++,s.value;if(null==i.outTangent||null==s.inTangent||t<i.time)return i.value;if(t>=s.time)return s.value;if(i.rightConstant||s.leftConstant||i.outTangent===1/0||s.inTangent===1/0)return i.value;const n=s.time-i.time,a=(t-i.time)/n;if(this.objectCurve)return a<s.value?i.value:s.value;const o=i.outTangent*n,h=s.inTangent*n,c=a*a,l=c*a,u=l-2*c+a,d=l-c,_=-2*l+3*c;return(2*l-3*c+1)*i.value+u*o+d*h+_*s.value}clone(){return new c({keyframes:[...this.keys],path:this.path,componentType:this.componentType,property:this.property})}_keysAt(t){if(1===this.keys.length)return this.keys;if(t>=this.keys[this.keys.length-1].time)return[this.keys[this.keys.length-1]];if(t<=this.keys[0].time)return[this.keys[0]];for(let e=0;e<this.keys.length;e++)if(this.keys[e].time>t)return[this.keys[e-1],this.keys[e]];return null}}c.createLinear=function(t,e,i,s){return new c({keys:[[t,e,0,0],[i,s,0,0]]})},c.createEaseInOut=function(t,e,i,s){return new c(t===i?{keys:[[t,e,0,0]]}:{keys:[[t,e,0,0],[i,s,0,0]]})}},(t,e,i)=>{"use strict";i.d(e,{a:()=>u});var s=i(4),n=i(3);const r=0,a=1;let o,h;const c={lower:null,upper:null},l={lower:null,upper:null};class u{constructor(t,e,i){t=t||[],e=e||[],this._colorKeys="object"!=typeof t[0]?this.formatColorKeys(t):t,this._alphaKeys="object"!=typeof e[0]?this.formatAlphaKeys(e):e,this._mode=i||r,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"ColorGradient")}sampleInplace(t,e){if(this.findExtremeColors(t,c),this.findExtremeAlphaValues(t,l),c.lower===c.upper&&l.lower===l.upper)return e.copy(c.lower.color),void(e.a=l.lower.alpha);switch(this._mode){case a:return void(c.lower.time===t?(e.copy(c.lower.color),e.a=l.lower.alpha):(e.copy(c.upper.color),e.a=l.upper.alpha));case r:{const i=(t-c.lower.time)/(c.upper.time-c.lower.time),s=(t-l.lower.time)/(l.upper.time-l.lower.time);return void this.lerpColorInPlace(c.lower.color,c.upper.color,l.lower.alpha,l.upper.alpha,i,s,e)}default:console.error("Gradient mode: "+this._mode+" Not supported")}}evaluate(t){const e=new s.a;return this.sampleInplace(t,e),e}evaluateRef(t,e){return this.sampleInplace(t,e),e}findExtremeColors(t,e){o=h=this._colorKeys[0];for(let e=0;e<this._colorKeys.length;e++){if(!(this._colorKeys[e].time<t)){h=this._colorKeys[e];break}o=h=this._colorKeys[e]}e.lower=o,e.upper=h}findExtremeAlphaValues(t,e){o=h=this._alphaKeys[0];for(let e=0;e<this._alphaKeys.length;e++){if(!(this._alphaKeys[e].time<t)){h=this._alphaKeys[e];break}o=h=this._alphaKeys[e]}e.lower=o,e.upper=h}lerpColorInPlace(t,e,i,s,r,a,o){o.r=(0,n.f)(t.r,e.r,r),o.g=(0,n.f)(t.g,e.g,r),o.b=(0,n.f)(t.b,e.b,r),o.a=(0,n.f)(i,s,a)}formatColorKeys(t){const e=[];for(let i=0;i<t.length;i+=5){const n={};n.time=t[i],n.color=new s.a(t[i+1],t[i+2],t[i+3],t[i+4]),e.push(n)}return e}formatAlphaKeys(t){const e=[];for(let i=0;i<t.length;i+=2){const s={};s.time=t[i],s.alpha=t[i+1],e.push(s)}return e}setKeys(t,e){this._colorKeys=("object"!=typeof t[0]?this.formatColorKeys(t):t)||[],this._alphaKeys=("object"!=typeof e[0]?this.formatAlphaKeys(e):e)||[]}setKey(t,e){for(let e=0;e<this._colorKeys.length;e++)if(this._colorKeys[e].time===t.time){this._colorKeys[e]=t,t=null;break}null!=t&&this._colorKeys.push(t);for(let t=0;t<this._alphaKeys.length;t++)if(this._alphaKeys[t].time===e.time){this._alphaKeys[t]=e,e=null;break}null!=e&&this._alphaKeys.push(e)}get mode(){return this._mode}set mode(t){this._mode=t}get alphaKeys(){return this._alphaKeys}set alphaKeys(t){this._alphaKeys=t}get colorKeys(){return this._colorKeys}set colorKeys(t){this._colorKeys=t}}},(t,e,i)=>{"use strict";i.d(e,{a:()=>n});var s=i(1);class n{constructor(t){this.app=t,this.store={},this.ComponentType=null,this.id="",this.events=new s.a(this)}addComponent(t,e){const i=new this.ComponentType(this,t);return e=e||{},this.store[t.getGuid()]={entity:t,data:i.data},t.c[this.id]=i,this.initializeComponentData(i,e,[]),i}removeComponent(t,e=null){const i=this.store[t.getGuid()],s=t.c[this.id];this.events.fire("beforeremove",t,s),delete this.store[t.getGuid()],delete t.c[this.id],this.events.fire("remove",t,i.data)}initializeComponentData(t,e,i){e=e||{};for(let s=0,n=i.length;s<n;s++){const n=i[s],r=e[n];void 0!==r&&(t[n]=r)}t.enabled&&t.entity.enabled&&t.onEnable()}destroy(){this.events.off()}}n.events=new s.a(null),n.update=t=>{n.events.fire("update",t)},n.destroy=()=>{n.events.off("update")}},(t,e,i)=>{"use strict";i.d(e,{a:()=>o,b:()=>l});var s=i(1);function n(t){return"string"==typeof t?t.toUpperCase().charCodeAt(0):t}const r={9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",27:"Escape",37:"Left",38:"Up",39:"Right",40:"Down",46:"Delete",91:"Win"};class a{constructor(t,e){const i=t._getTargetCoords(e);this.x=NaN,this.y=NaN,i&&(this.x=i.x,this.y=i.y),this.wheel=e instanceof WheelEvent?-e.deltaY:0,this.dx=this.x-t._lastX,this.dy=this.y-t._lastY,this.button=s.c.MOUSEBUTTON_NONE,e instanceof MouseEvent&&("mousedown"===e.type||"mouseup"===e.type)&&(this.button=e.button),this.buttons=t._buttons.slice(0),this.element=e.target,this.ctrlKey=e.ctrlKey||!1,this.altKey=e.altKey||!1,this.shiftKey=e.shiftKey||!1,this.metaKey=e.metaKey||!1,this.event=e}}class o{constructor(t){this._lastX=0,this._lastY=0,this._buttons=[!1,!1,!1],this._lastbuttons=[!1,!1,!1],this._upHandler=this._handleUp.bind(this),this._downHandler=this._handleDown.bind(this),this._moveHandler=this._handleMove.bind(this),this._wheelHandler=this._handleWheel.bind(this),this._target=null,this._attached=!1,this.attach(t),this.events=new s.a(this)}_contextMenuHandler(t){t.preventDefault()}attach(t){this._target=t,this._attached||(this._attached=!0,window.addEventListener("mouseup",this._upHandler,!1),window.addEventListener("mousedown",this._downHandler,!1),window.addEventListener("mousemove",this._moveHandler,!1),window.addEventListener("wheel",this._wheelHandler,!1))}detach(){this._attached&&(this._attached=!1,this._target=null,window.removeEventListener("mouseup",this._upHandler),window.removeEventListener("mousedown",this._downHandler),window.removeEventListener("mousemove",this._moveHandler),window.removeEventListener("wheel",this._wheelHandler))}disableContextMenu(){this._target&&this._target.addEventListener("contextmenu",this._contextMenuHandler)}enableContextMenu(){this._target&&this._target.removeEventListener("contextmenu",this._contextMenuHandler)}update(){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2]}isPressed(t){return this._buttons[t]}wasPressed(t){return this._buttons[t]&&!this._lastbuttons[t]}wasReleased(t){return!this._buttons[t]&&this._lastbuttons[t]}_handleUp(t){this._buttons[t.button]=!1;const e=new a(this,t);Number.isNaN(e.x)||this.events.fire(s.c.EVENT_MOUSEUP,e)}_handleDown(t){this._buttons[t.button]=!0;const e=new a(this,t);Number.isNaN(e.x)||this.events.fire(s.c.EVENT_MOUSEDOWN,e)}_handleMove(t){const e=new a(this,t);Number.isNaN(e.x)||(this.events.fire(s.c.EVENT_MOUSEMOVE,e),this._lastX=e.x,this._lastY=e.y)}_handleWheel(t){const e=new a(this,t);Number.isNaN(e.x)||this.events.fire(s.c.EVENT_MOUSEWHEEL,e)}_getTargetCoords(t){const e=this._target.getBoundingClientRect(),i=Math.floor(e.left),s=Math.floor(e.top);return t.clientX<i||t.clientX>=i+this._target.clientWidth||t.clientY<s||t.clientY>=s+this._target.clientHeight?null:{x:t.clientX-i,y:t.clientY-s}}}class h{constructor(t,e){const i=function(t,e){let i=0,s=0;for(;!(e instanceof HTMLElement);)e=e.parentNode;let n=e;do{i+=n.offsetLeft-n.scrollLeft,s+=n.offsetTop-n.scrollTop,n=n.offsetParent}while(n);return{x:t.pageX-i,y:t.pageY-s}}(t,e);this.id=t.identifier,this.x=i.x,this.y=i.y,this.target=e,this.touch=t}}class c{constructor(t,e){if(this.element=t.target||e,this.event=t,this.touches=[],this.changedTouches=[],t){let e,i=t.touches.length;for(e=0;e<i;e++)this.touches.push(new h(t.touches[e],this.element));for(i=t.changedTouches.length,e=0;e<i;e++)this.changedTouches.push(new h(t.changedTouches[e],this.element))}}getTouchById(t,e){let i;const s=e.length;for(i=0;i<s;i++)if(e[i].id===t)return e[i];return null}}class l{constructor(t){this._element=null,this._startHandler=this._handleTouchStart.bind(this),this._endHandler=this._handleTouchEnd.bind(this),this._moveHandler=this._handleTouchMove.bind(this),this._cancelHandler=this._handleTouchCancel.bind(this),this.attach(t),this.events=new s.a(this)}attach(t){this._element&&this.detach(),this._element=t,this._element.addEventListener("touchstart",this._startHandler,!1),this._element.addEventListener("touchend",this._endHandler,!1),this._element.addEventListener("touchmove",this._moveHandler,!1),this._element.addEventListener("touchcancel",this._cancelHandler,!1)}detach(){this._element&&(this._element.removeEventListener("touchstart",this._startHandler,!1),this._element.removeEventListener("touchend",this._endHandler,!1),this._element.removeEventListener("touchmove",this._moveHandler,!1),this._element.removeEventListener("touchcancel",this._cancelHandler,!1)),this._element=null}_handleTouchStart(t){this.events.fire("touchstart",new c(t))}_handleTouchEnd(t){this.events.fire("touchend",new c(t))}_handleTouchMove(t){t.preventDefault(),this.events.fire("touchmove",new c(t))}_handleTouchCancel(t){this.events.fire("touchcancel",new c(t))}}pc.Keyboard=class{constructor(t){this._element=null,this._keyDownHandler=this._handleKeyDown.bind(this),this._keyUpHandler=this._handleKeyUp.bind(this),this.events=new s.a(this),this._keymap={},this._lastmap={},t&&this.attach(t)}attach(t){this._element&&this.detach(),this._element=t,this._element.addEventListener("keydown",this._keyDownHandler,!1),this._element.addEventListener("keyup",this._keyUpHandler,!1)}detach(){this._element.removeEventListener("keydown",this._keyDownHandler),this._element.removeEventListener("keyup",this._keyUpHandler),this._element=null}toKeyIdentifier(t){t=n(t);const e=r[t.toString()];if(e)return e;let i=t.toString(16).toUpperCase();const s=i.length;for(let t=0;t<4-s;t++)i="0"+i;return"U+"+i}_handleKeyDown(t){const e=t.keyCode||t.charCode;if(void 0===e)return;const i=this.toKeyIdentifier(e);this._keymap[i]=!0}_handleKeyUp(t){const e=t.keyCode||t.charCode;if(void 0===e)return;const i=this.toKeyIdentifier(e);delete this._keymap[i]}update(){this._lastmap=Object.assign({},this._keymap)}isPressed(t){const e=n(t),i=this.toKeyIdentifier(e);return!!this._keymap[i]}wasPressed(t){const e=n(t),i=this.toKeyIdentifier(e);return!!this._keymap[i]&&!this._lastmap[i]}wasReleased(t){const e=n(t),i=this.toKeyIdentifier(e);return!this._keymap[i]&&!!this._lastmap[i]}anyKey(){return Object.keys(this._keymap).length>0}anyKeyDown(){for(const t in this._keymap)if(this._keymap.hasOwnProperty(t)&&!this._lastmap.hasOwnProperty(t))return!0;return!1}},pc.Mouse=o,pc.Touch=h,pc.TouchDevice=l,pc.TouchEvent=c},(t,e,i)=>{"use strict";i.d(e,{a:()=>C});var s=i(0),n=i(1);const r=new s.f,a=new s.f,o=new s.e,h=new s.e,c=new s.i,l=new s.i,u=new s.i,d=new s.i,_={invRotation:new s.f,invScale:new s.i,invRotationMatrix:new s.e,invScaleMatrix:new s.e},p={parentLocalRotation:new s.f,rotationMultiplier:new s.i},m={newLocalRotation:new s.f},f={invLocalRotation:new s.f,rotationMultiplier:new s.i},g={currentRSInverse:new s.e},y={newLocalRotation:new s.f},E={tempVector:new s.i},A={tmpVector:new s.i},T={tmpVector:new s.i,tmpMatrix:new s.e,desiredLocalScale:new s.i,desiredWorldPosition:new s.i};class C{constructor(t="Untitled"){this.name=t,this.tag=null,this._localPosition=new s.i(0,0,0),this._localRotation=new s.f(0,0,0,1),this._localScale=new s.i(1,1,1),this._localEulerAngles=new s.i(0,0,0),this._localTransform=new s.e,this._position=new s.i(0,0,0),this._rotation=new s.f(0,0,0,1),this._eulerAngles=new s.i(0,0,0),this._lossyScale=new s.i(1,1,1),this._worldTransform=new s.e,this._worldTransformInverse=new s.e,this._hijackedLocalPosition=new s.i,this._hijackedLocalScale=new s.i,this._hijackedLocalEulerAngles=new s.i,this._hijackedLocalRotation=new s.f,this._aabbVer=0,this._right=null,this._up=null,this._forward=null,this._static=!1,this._parent=null,this._children=[],this._graphDepth=0,this._cullingLayer=0,this.layerMask=0,this._activeSelf=!0,this._enabledInHierarchy=!1,this.hasChanged=!0,this._layoutElements=[],this._layoutControllers=[],this._layoutSelfControllers=[],this._dimensionListeners=[],this._canvasElements=[],this._canvasGroups=[],this._meshModifiers=[],this.isPrefab=!1,this._app=null,this.events=new n.a(this),this._unityComponents={rigidbody:[],collider:[],joint:[],rigidbody2D:[],collider2D:[],joint2D:[],uiBehaviour:[],monoBehaviour:[],animator:[],animation:[],particlesystem:[],particleSystemRenderer:[],reflectionprobe:[],videoPlayer:[],canvasRenderer:[],audiosourceunity:[],renderer:[],meshFilter:[],effector2D:[]},this.c={},this.flags=0,this.scene=null}get fullname(){return this.parent?`${this.parent.fullname}/${this.name}`:this.name}get element(){return this.c.element}get camera(){return this.c.camera}get light(){return this.c.light}get screen(){return this.c.screen}removeOrReparent(t,e=!1){t?this.parent.removeChild(this):this.reparent(t)}destroy(){this.removeOrReparent(null)}getLossyScale(){return this.flags&C.Flags.LossyScaleDirty?(this.flags&=~C.Flags.LossyScaleDirty,r.copy(this.getRotation()),h.setTRS(s.i.ZERO,r.invert(),s.i.ONE),this.getWorldRotationAndScale(o),h.mul2(h,o),this._lossyScale.set(h.data[0],h.data[5],h.data[10]),this._lossyScale):this._lossyScale}_onInsertChild(t){t._parent=this,t.element&&(this.setupCanvasGroups(t),t.notifyCanvasGroupChanged(t)),t.notifyScreenHierarchyChanged();const e=t._activeSelf&&this.enabled;if(t._enabledInHierarchy!==e&&(t._enabledInHierarchy=e,t._notifyHierarchyStateChanged(t,e)),t._updateGraphDepth(),t.onParentChanged(),t.events.fire("insert",this),!t.element)for(let e=0;e<t._children.length;e++){const i=t._children[e].element;i&&i._onInsert(t)}this.notifyTransformChildrenChanged(),t.notifyTransformParentChanged();const i=this._app.systems;i.physics.syncHierarchy(t),i.physics2D.syncHierarchy(t)}muteTransformModificationCallback(){this.flags|=C.Flags.TransformModificationCallbackMuted}unmuteTransformModificationCallback(){this.flags&=~C.Flags.TransformModificationCallbackMuted,this.flags&C.Flags.TransformModificationCallbackRequested&&(this._onModifyTransform(),this.flags&=~C.Flags.TransformModificationCallbackRequested)}_onModifyTransform(){if(this.flags&C.Flags.TransformModificationCallbackMuted)return void(this.flags|=C.Flags.TransformModificationCallbackRequested);if(!this._app)return;const t=this._app.systems;t.physics.syncTransforms(this),t.physics2D.syncTransforms(this)}lookAt(t,e){c.copy(t),l.copy(e),o.setLookAt(this.getPosition(),c,l),r.setFromMat4(o),this.setRotation(r)}translate(t,e,i){t instanceof s.i?c.copy(t):c.set(t,e,i),c.add(this.getPosition()),this.setPosition(c)}translateLocal(t,e,i){t instanceof s.i?c.copy(t):c.set(t,e,i),this.getLocalRotation().transformVector(c,c),c.add(this.getLocalPosition()),this.setLocalPosition(c)}rotate(t,e,i){if(t instanceof s.i?r.setFromEulerAngles(t.x,t.y,t.z):r.setFromEulerAngles(t,e,i),null===this._parent)a.mul2(r,this.getLocalRotation()),this.setLocalRotation(a);else{const t=this.getRotation(),e=this._parent.getRotation();a.copy(e).invert().mul2(a,r).mul2(r,t),this.setLocalRotation(a)}}rotateLocal(t,e,i){t instanceof s.i?r.setFromEulerAngles(t.x,t.y,t.z):r.setFromEulerAngles(t,e,i),r.mul2(this.getLocalRotation(),r),this.setLocalRotation(r)}_isOddlyScaled(){const t=this.getWorldTransform().data,e=t[0],i=t[1],s=t[2],n=t[4],r=t[5],a=t[6],o=t[8],h=t[9],c=t[10];return e*(r*c-a*h)-n*(i*c-s*h)+o*(i*a-s*r)<0}_sync(){this.flags&C.Flags.HijackedByElementComponent?this._syncElementComponent():this._syncGraphNode()}_syncElementComponent(){const{tmpVector:t}=A;this.parent&&this.parent._sync();const e=this.element,i=e._dirtyRect,n=e._dirtyScreen;let r=this.element._lastSyncAABBVersion!==this.aabbVersion;if(!i&&!n&&!r)return;this.hasChanged=!0,this.flags&=~C.Flags.HijackedByElementComponent;const a=e._width,o=e._height;if(i||r){const i=e._findParentElement();if(i){const n=i.element;if(e._width=(e._anchors.z-e._anchors.x)*n._width+e._sizeDelta.x,e._height=(e._anchors.w-e._anchors.y)*n._height+e._sizeDelta.y,this._parent===i){const i=n._width*e._anchors.x,r=n._width*e._anchors.z,a=n._height*e._anchors.y,o=n._height*e._anchors.w;t.set((0,s.l)(i,r,e._pivot.x)+e._anchoredPosition.x,(0,s.l)(a,o,e._pivot.y)+e._anchoredPosition.y,0),this.setLocalPosition(t.x-n._pivotPoint.x,t.y-n._pivotPoint.y,this.getLocalPosition().z)}else this.setLocalPosition(e._anchoredPosition.x,e._anchoredPosition.y,this.getLocalPosition().z)}else e._width=e._sizeDelta.x,e._height=e._sizeDelta.y,this.setLocalPosition(e._anchoredPosition.x,e._anchoredPosition.y,this.getLocalPosition().z)}if(r=this.element._lastSyncAABBVersion!==this.aabbVersion,r||n||i){e._pivotPoint.set(e._width*e._pivot.x,e._height*e._pivot.y,0),this._tryResizeScreen();const t=e.cachedRect;t.m_XMin=-e._pivotPoint.x,t.m_YMin=-e._pivotPoint.y,t.m_Width=e._width,t.m_Height=e._height,t.m_XMax=t.m_XMin+t.m_Width,t.m_YMax=t.m_YMin+t.m_Height,e.events.fire("resize",e._width,e._height)}e._lastSyncAABBVersion=this.aabbVersion,e._dirtyRect=!1,e._dirtyScreen=!1,this.flags|=C.Flags.HijackedByElementComponent;const h=e._width!==a,c=e._height!==o;i||!h&&!c||e.triggerOnElementDimesionsChange(h,c)}_tryResizeScreen(){const t=this.element,{tmpMatrix:e,tmpVector:i,desiredLocalScale:r,desiredWorldPosition:a}=T,o=this.screen;if(!(o&&!o._findParentScreen()))return;const h=o.resolution;switch(o.screenType){case n.c.SCREEN_TYPE_SCREEN:{t._width=h.x/o.scale,t._height=h.y/o.scale,a.set(.5*h.x,.5*h.y,0),this.setPosition(a),i.set(o.scale,o.scale,o.scale),e.setTRS(s.i.ZERO,this.getRotation(),i),this.setWorldRotationAndScale(e);const n=this.getLocalPosition();t._anchoredPosition.set(n.x,n.y),t._pivotPoint.set(.5*t._width,.5*t._height,0);break}case n.c.SCREEN_TYPE_CAMERA:{const e=o.camera._component.entity;t._width=h.x/o.scale,t._height=h.y/o.scale,t._sizeDelta.copy(h),r.set(1,1,1),r.scale(o._planeHeight/t._height),i.set(0,0,o._screenDistance),e.transformPoint(i,i,!0),this.setPosition(i),this.setRotation(e.getRotation()),this.setLocalScale(r);const s=this.getLocalPosition();t._anchoredPosition.set(s.x,s.y),t._pivotPoint.set(.5*t._width,.5*t._height,0);break}case n.c.SCREEN_TYPE_WORLD:t._width=t._sizeDelta.x,t._height=t._sizeDelta.y,this.setLocalPosition(t._anchoredPosition.x,t._anchoredPosition.y,this.getLocalPosition().z)}t._sizeDelta.set(t._width,t._height)}_syncGraphNode(){this.parent&&this.parent._sync()}findByNameImmediate(t){for(let e=0;e<this._children.length;e++){const i=this._children[e];if(i.name===t)return i}return null}findByNameEnabled(t){return t?this.findByNamesEnabledInternal(t.split("/"),0):null}findByNamesEnabledInternal(t,e){if(!this.enabled)return null;if(this.scene||this.name!==t[e])e=0;else{if(e===t.length-1)return this;e++}for(let i=0;i<this._children.length;i++){const s=this._children[i].findByNamesEnabledInternal(t,e);if(null!==s)return s}return null}getWorldRotationAndScale(t=new s.e){if(t.setTRS(s.i.ZERO,this.getLocalRotation(),this.getLocalScale()),this.parent){const e=this.parent.getWorldRotationAndScale();t.mul2(e,t)}return t}getWorldRotationAndScaleInverse(t=new s.e,e=null){const{invRotation:i,invRotationMatrix:n,invScale:r,invScaleMatrix:a}=_;if(i.copy(this.getLocalRotation()).invert(),n.setRotation(i),r.copy(e||this.getLocalScale()).invertSafe(),a.setScale(r.x,r.y,r.z),t.mul2(a,n),this.parent){const e=this.parent.getWorldRotationAndScaleInverse();t.mul2(t,e)}return t}setWorldRotationAndScale(t){const{currentRSInverse:e}=g;this.getWorldRotationAndScaleInverse(e,s.i.ONE),e.mul2(e,t),this.setLocalScale(e.data[0],e.data[5],e.data[10])}getLocalRotationAndScale(t=new s.e){return t.setTRS(s.i.ZERO,this.getLocalRotation(),this.getLocalScale()),t}setParent(t,e){if(e){const e=this.getPosition().clone(),i=this.getRotation().clone(),s=this.getWorldRotationAndScale();this.removeOrReparent(t,!0),this.muteTransformModificationCallback(),this.setPosition(e),this.setRotation(i),this.setWorldRotationAndScale(s),this.unmuteTransformModificationCallback()}else{const e=this.getLocalScale().clone(),i=this.getLocalPosition(),s=this.getLocalRotation().clone();this.removeOrReparent(t,!0),this.muteTransformModificationCallback(),this.setLocalScale(e),this.setLocalPosition(i),this.setLocalRotation(s),this.unmuteTransformModificationCallback()}if(this.element){const t=pc.UIUtils.findParentScreen(this);this.reparentElementRecursive(t)}}reparentElementRecursive(t){if(this.element){const e=this._unityComponents?this._unityComponents.canvasRenderer[0]:null;e&&e.reparentCanvas(t)}const e=this.children;for(let i=0;i<e.length;i++){e[i].reparentElementRecursive(t)}}isParentOf(t){const e=t._graphDepth-this._graphDepth;if(e<=0||e>=t._graphDepth||null===t.parent)return!1;let i=t;for(let t=0;t<e;t++)i=i.parent;return i===this}isChildOf(t){return t.isParentOf(this)}_notifyHierarchyStateChanged(t,e){t._onHierarchyStateChanged(e);const i=t._children;for(let t=0,s=i.length;t<s;t++)i[t]._activeSelf&&this._notifyHierarchyStateChanged(i[t],e)}_elementDimesionsChange(){}_onHierarchyStateChanged(t){this._enabledInHierarchy=t}findByTag(t){return this._findByTag(t)}_findByTag(t){const e=[];for(let i=0;i<this._children.length;i++){const s=this._children[i];if(!s._enabledInHierarchy)continue;s.tag===t&&e.push(s);const n=s._findByTag(t);n.length&&e.push(...n)}return e}findByName(t){if(this.name===t)return this;for(let e=0;e<this._children.length;e++){const i=this._children[e].findByName(t);if(null!==i)return i}return null}getRoot(){return this.root}getParent(){return this._parent}parents(){const t=[];let e=this.parent;for(;null!=e;)t.push(e),e=e.parent;return t}allChildren(t=[]){for(let e=0;e<this.children.length;e++)t.push(this.children[e]),this.children[e].allChildren(t);return t}getScene(){const t=this.parent;return t?t.scene?t.scene:t.getScene():null}isDescendantOf(t){let e=this._parent;for(;e;){if(e===t)return!0;e=e._parent}return!1}isAncestorOf(t){return t.isDescendantOf(this)}getChildren(){return this._children}getEulerAngles(){return this.flags&C.Flags.EulerAnglesDirty&&(this.getRotation().getEulerAngles_Unity(this._eulerAngles),this.flags&=~C.Flags.EulerAnglesDirty),this._eulerAngles}setEulerAngles(t,e,i){t instanceof s.i?r.setFromEulerAngles_Unity(t.x,t.y,t.z):r.setFromEulerAngles_Unity(t,e,i),this.setRotation(r)}getLocalEulerAngles(){return this.flags&C.Flags.LocalEulersAnglesDirty&&(this.getLocalRotation().getEulerAngles_Unity(this._localEulerAngles),this.flags&=~C.Flags.LocalEulersAnglesDirty),this._localEulerAngles}setLocalEulerAngles(t,e,i){const{newLocalRotation:n}=y;t instanceof s.i?n.setFromEulerAngles_Unity(t.x,t.y,t.z):n.setFromEulerAngles_Unity(t,e,i),this.setLocalRotation(n)}getLocalPosition(){return this.flags&C.Flags.HijackedByElementComponent?this.getLocalPositionElementComponent():this.getLocalPositionGraphNode()}getLocalPositionGraphNode(){return this._localPosition}getLocalPositionElementComponent(){return this.element.getRect(),this.getLocalPositionGraphNode()}setLocalPosition(t,e,i){this.flags&C.Flags.HijackedByElementComponent?this.setLocalPositionElementComponent(t,e,i):this.setLocalPositionGraphNode(t,e,i)}setLocalPositionGraphNode(t,e,i){t instanceof s.i?l.copy(t):l.set(t,e,i),this._localPosition.approximatelyEquals(l,Number.EPSILON)||(this._localPosition.copy(l),this.onLocalPositionChanged(),this._onModifyTransform())}setLocalPositionElementComponent(t,e,i){const{tempVector:n}=E;n.copy(this.getLocalPositionElementComponent()),t instanceof s.i?(this.setLocalPositionGraphNode(n.x,n.y,t.z),n.sub2(t,n)):(this.setLocalPositionGraphNode(n.x,n.y,i),n.x=t-n.x,n.y=e-n.y),this.element._anchoredPosition.add(n),this.element.dirtifyRect()}getLocalRotation(){return this._localRotation}setLocalRotation(t,e,i,n){t instanceof s.f?r.copy(t):r.set(t,e,i,n),r.normalize(),this._localRotation.approximatelyEquals(r,Number.EPSILON)||(this._localRotation.copy(r),this.onLocalRotationChanged(),this._onModifyTransform())}getLocalScale(){return this._localScale}setLocalScale(t,e,i){t instanceof s.i?c.copy(t):c.set(t,e,i),this._localScale.approximatelyEquals(c,Number.EPSILON)||(this._localScale.copy(c),this.onLocalScaleChanged(),this._onModifyTransform())}getLocalScaleSign(t){const e=this.getLocalScale();t.set(Math.sign(e.x)||1,Math.sign(e.y)||1,Math.sign(e.z)||1)}getLocalScaleRotationMultipliers(t){this.getLocalScaleSign(t);const e=t.x,i=t.y,s=t.z,n=i*s,r=e*s,a=e*i;t.set(n,r,a)}getLocalTransform(){return this.flags&C.Flags.LocalTransformDirty?(this.flags&=~C.Flags.LocalTransformDirty,this._localTransform.setTRS(this.getLocalPosition(),this.getLocalRotation(),this.getLocalScale()),this._localTransform):this._localTransform}setLocalTransform(t){this.muteTransformModificationCallback(),this.setLocalPosition(t.getTranslation()),this.setLocalRotation(t.getRotation()),this.setLocalScale(t.getScale()),this.unmuteTransformModificationCallback()}getPosition(){if(!(this.flags&C.Flags.PositionDirty))return this._position;this.flags&=~C.Flags.PositionDirty,this._position.copy(this.getLocalPosition());let t=this.parent;for(;t;)this._position.mul(t.getLocalScale()),t.getLocalRotation().transformVector(this._position,this._position),this._position.add(t.getLocalPosition()),t=t.parent;return this._position}setPosition(t,e,i){t instanceof s.i?u.copy(t):u.set(t,e,i),this.parent&&this.parent.transformPointInverse(u,u),this.setLocalPosition(u)}getRotation(){if(!(this.flags&C.Flags.RotationDirty))return this._rotation;this.flags&=~C.Flags.RotationDirty;const{parentLocalRotation:t,rotationMultiplier:e}=p;this._rotation.copy(this.getLocalRotation());let i=this.parent;for(;i;){i.getLocalScaleRotationMultipliers(e);const s=e.x,n=e.y,r=e.z;t.copy(i.getLocalRotation()),t.x*=s,t.y*=n,t.z*=r,this._rotation.mul2(t,this._rotation),this._rotation.x*=s,this._rotation.y*=n,this._rotation.z*=r,i=i.parent}return this._rotation}setRotation(t,e,i,n){const{newLocalRotation:r}=m;t instanceof s.f?r.copy(t):r.set(t,e,i,n),this.parent?this.setLocalRotation(this.parent.transformQuaternionInverse(r)):this.setLocalRotation(r)}getWorldTransform(){return this.flags&C.Flags.WorldTransformDirty?(this.flags&=~C.Flags.WorldTransformDirty,this.parent?this._worldTransform.mul2(this._parent.getWorldTransform(),this.getLocalTransform()):this._worldTransform.copy(this.getLocalTransform()),this._worldTransform):this._worldTransform}setWorldTransform(t){this.muteTransformModificationCallback(),this.setPosition(t.getTranslation()),this.setRotation(t.getRotation());const e=t.clone();e.data[12]=e.data[13]=e.data[14]=0,this.setWorldRotationAndScale(e),this.unmuteTransformModificationCallback()}getWorldTransformInverse(){return this.flags&C.Flags.WorldTransformInverseDirty?(this.flags&=~C.Flags.WorldTransformInverseDirty,this._worldTransformInverse.copy(this.getWorldTransform()).invert(),this._worldTransformInverse):this._worldTransformInverse}transformPoint(t,e=new s.i,i=!1){e.copy(t);let n=this;for(;n;)i||e.mul(n.getLocalScale()),n.getLocalRotation().transformVector(e,e),e.add(n.getLocalPosition()),n=n.parent;return e}transformPointInverse(t,e=new s.i){return this.parent?this.parent.transformPointInverse(t,e):e.copy(t),e.sub(this.getLocalPosition()),r.copy(this.getLocalRotation()).invert().transformVector(e,e),e.mul(l.copy(this.getLocalScale()).invertSafe()),e}transformVector(t,e=new s.i){e.copy(t);let i=this;for(;i;)e.mul(i.getLocalScale()),i.getLocalRotation().transformVector(e,e),i=i.parent;return e}transformVectorInverse(t,e=new s.i){return this.parent?this.parent.transformVectorInverse(t,e):e.copy(t),r.copy(this.getLocalRotation()).invert().transformVector(e,e),e.mul(l.copy(this.getLocalScale()).invertSafe()),e}transformDirection(t,e=new s.i){e.copy(t),this.getLocalRotation().transformVector(e,e);let i=this.parent;for(;i;)i.getLocalScaleSign(d),e.x*=d.x,e.y*=d.y,e.z*=d.z,i.getLocalRotation().transformVector(e,e),i=i.parent;return e}transformDirectionInverse(t,e=new s.i,i=!1){if(this.parent?this.parent.transformDirectionInverse(t,e,!0):e.copy(t),r.copy(this.getLocalRotation()).invert().transformVector(e,e),i){const t=this.getLocalScale(),i=Math.sign(t.x)||1,s=Math.sign(t.y)||1,n=Math.sign(t.z)||1;e.x*=i,e.y*=s,e.z*=n}return e}transformQuaternionInverse(t,e=new s.f){const{invLocalRotation:i,rotationMultiplier:n}=f;return this.parent?this.parent.transformQuaternionInverse(t,e):e.copy(t),i.copy(this.getLocalRotation()).invert(),e.mul2(i,e),this.getLocalScaleRotationMultipliers(n),e.x*=n.x,e.y*=n.y,e.z*=n.z,e}hijackLocalPosition(){return this.flags&C.Flags.LocalPositionHijacked||(this.flags|=C.Flags.LocalPositionHijacked,this._hijackedLocalPosition.copy(this.getLocalPosition())),this._hijackedLocalPosition}hijackLocalScale(){return this.flags&C.Flags.LocalScaleHijacked||(this.flags|=C.Flags.LocalScaleHijacked,this._hijackedLocalScale.copy(this.getLocalScale())),this._hijackedLocalScale}hijackLocalEulerAngles(){return this.flags&C.Flags.LocalEulerAnglesHijacked||(this.flags|=C.Flags.LocalEulerAnglesHijacked,this._hijackedLocalEulerAngles.copy(this.getEulerAngles())),this._hijackedLocalEulerAngles}hijackLocalRotation(){return this.flags&C.Flags.LocalRotationHijacked||(this.flags|=C.Flags.LocalRotationHijacked,this._hijackedLocalRotation.copy(this.getLocalRotation())),this._hijackedLocalRotation}releaseHijackedProperties(){this.flags&C.Flags.LocalPositionHijacked&&(this.flags&=~C.Flags.LocalPositionHijacked,this.setLocalPosition(this._hijackedLocalPosition)),this.flags&C.Flags.LocalScaleHijacked&&(this.flags&=~C.Flags.LocalScaleHijacked,this.setLocalScale(this._hijackedLocalScale)),this.flags&C.Flags.LocalRotationHijacked&&(this.flags&=~C.Flags.LocalRotationHijacked,this.setLocalRotation(this._hijackedLocalRotation)),this.flags&C.Flags.LocalEulerAnglesHijacked&&(this.flags&=~C.Flags.LocalEulerAnglesHijacked,this.setLocalEulerAngles(this._hijackedLocalEulerAngles))}reparent(t,e){this.notifyBeforeTransformParentChanged();const i=this._parent;if(this.element&&this.element._nearestScreen&&(this.element._nearestScreen.canvasMeshInstance.renderersDirty=!0),i)if(i!==t)i.removeChild(this,!0),i.notifyTransformChildrenChanged();else if(t)return void t.moveChildIndex(this,e);t&&(e>=0?t.insertChild(this,e):t.addChild(this)),this._app.scene.addDirty(this)}addChild(t){if(null!==t._parent)throw new Error("GraphNode is already parented");this._children.push(t),this._onInsertChild(t)}insertChild(t,e){if(null!==t._parent)throw new Error("GraphNode is already parented");this._children.splice(e,0,t),this._onInsertChild(t)}moveChildIndex(t,e){if(e<0){const e=this._children.indexOf(t);this._children.push(this._children.splice(e,1)[0])}else{const i=this._children.indexOf(t);this._children.splice(i,1),this._children.splice(e,0,t)}t.onParentChanged(),this.element&&this.element.triggerOnElementDimesionsChange(!0,!0)}setupCanvasGroups(t){let e=t.parent;for(;e&&e.element&&0===t._parent.element._canvasGroups.length;)e=e.parent;e&&e.element&&t._parent.element._canvasGroups.length>0&&(t.element._canvasGroups=t._parent.element._canvasGroups.slice()),this.setupCanvasGroupsInChildren(t,t.element._canvasGroups)}setupCanvasGroupsInChildren(t,e){if(t.element){t.element._canvasGroups=e.slice();for(let e=0;e<t._canvasGroups.length;e++)t.element._canvasGroups.unshift(t._canvasGroups[e]);for(let e=0;e<t.children.length;e++)this.setupCanvasGroupsInChildren(t.children[e],t.element._canvasGroups)}}notifyScreenHierarchyChanged(){const t=pc.UIUtils.findParentScreen(this.parent);this.notifyScreenChanged(t),this.tryReparentScreen(t,this.children)}tryReparentScreen(t,e){for(let i=0;i<e.length;i++){const s=e[i];s.screen?s.screen.setParentScreen(t,!0):s.tryReparentScreen(t,s.children)}}_updateGraphDepth(){this._parent?this._graphDepth=this._parent._graphDepth+1:this._graphDepth=0;for(let t=0,e=this._children.length;t<e;t++)this._children[t]._updateGraphDepth()}removeChild(t,e=!1){t.notifyScreenHierarchyChanged(),e||t._notifyHierarchyStateChanged(t,!1);for(let e=0;e<this._children.length;++e)if(this._children[e]===t)return this._children.splice(e,1),t._parent=null,void t.notifyScreenHierarchyChanged()}syncHierarchy(){if(!this.enabled)return;this._sync();const t=this._children;for(let e=0,i=t.length;e<i;e++)t[e].syncHierarchy()}notifyCanvasGroupChanged(t){if(this.isPrefab)return;const e=t._unityComponents.monoBehaviour,i=t._unityComponents.canvasRenderer[0];for(let t=0;t<e.length;t++){e[t].onCanvasGroupChanged()}i&&i.onCanvasGroupChanged();const s=t.children;for(let t=0;t<s.length;t++)this.notifyCanvasGroupChanged(s[t])}notifyScreenChanged(t){if(this.isPrefab)return;this.screen&&(t=this.screen);const e=this._unityComponents.canvasRenderer[0];e&&e.onScreenChanged(t);const i=this.children;for(let e=0;e<i.length;e++)i[e].notifyScreenChanged(t)}notifyBeforeTransformParentChanged(){if(this.isPrefab)return;const t=this._unityComponents.monoBehaviour;for(let e=0;e<t.length;e++){t[e].onBeforeTransformParentChanged()}}notifyTransformParentChanged(){if(this.isPrefab)return;const t=this._unityComponents.monoBehaviour;for(let e=0;e<t.length;e++){t[e].onTransformParentChanged()}}notifyTransformChildrenChanged(){if(this.isPrefab)return;const t=this._unityComponents.monoBehaviour;for(let e=0;e<t.length;e++){t[e].onTransformChildrenChanged()}}onLocalRotationChanged(){this.flags|=C.Flags.LocalEulersAnglesDirty,this.flags|=C.Flags.LossyScaleDirty,this.flags&C.Flags.LocalTransformDirty||(this.flags|=C.Flags.LocalTransformDirty,this.onLocalTransformChanged()),this.flags&C.Flags.RotationDirty||(this.flags|=C.Flags.RotationDirty,this.onRotationChanged());for(const t of this.children)t.onParentLocalRotationChanged();this.increaseTransformVersion()}onLocalScaleChanged(){this.flags|=C.Flags.LossyScaleDirty,this.flags&C.Flags.LocalTransformDirty||(this.flags|=C.Flags.LocalTransformDirty,this.onLocalTransformChanged());for(const t of this.children)t.onParentLocalScaleChanged();this.increaseTransformVersion()}onLocalPositionChanged(){this.flags|=C.Flags.PositionDirty,this.flags&C.Flags.LocalTransformDirty||(this.flags|=C.Flags.LocalTransformDirty,this.onLocalTransformChanged());for(const t of this.children)t.onParentLocalPositionChanged();this.increaseTransformVersion()}onRotationChanged(){this.flags|=C.Flags.EulerAnglesDirty,this.flags|=C.Flags.LossyScaleDirty,this.increaseTransformVersion()}onLocalTransformChanged(){this.flags&C.Flags.WorldTransformDirty||(this.flags|=C.Flags.WorldTransformDirty,this.onWorldTransformChanged()),this.increaseTransformVersion()}onWorldTransformChanged(){this.flags|=C.Flags.WorldTransformInverseDirty;for(const t of this.children)t.onParentWorldTransformChanged();this.increaseTransformVersion()}onParentLocalRotationChanged(){this.flags|=C.Flags.LossyScaleDirty,this.flags|=C.Flags.PositionDirty,this.flags&C.Flags.RotationDirty||(this.flags|=C.Flags.RotationDirty,this.onRotationChanged());for(const t of this.children)t.onParentLocalRotationChanged();this.increaseTransformVersion()}onParentLocalScaleChanged(){this.flags|=C.Flags.LossyScaleDirty,this.flags|=C.Flags.PositionDirty,this.flags&C.Flags.RotationDirty||(this.flags|=C.Flags.RotationDirty,this.onRotationChanged());for(const t of this.children)t.onParentLocalScaleChanged();this.increaseTransformVersion()}onParentLocalPositionChanged(){this.flags|=C.Flags.PositionDirty;for(const t of this.children)t.onParentLocalPositionChanged();this.increaseTransformVersion()}onParentWorldTransformChanged(){this.flags&C.Flags.WorldTransformDirty||(this.flags|=C.Flags.WorldTransformDirty,this.onWorldTransformChanged()),this.increaseTransformVersion()}onParentChanged(){this.onParentLocalPositionChanged(),this.onParentLocalRotationChanged(),this.onParentLocalScaleChanged(),this.onParentWorldTransformChanged()}increaseTransformVersion(){this._aabbVer++,this.flags&C.Flags.HijackedByElementComponent&&this._app.scene.addDirty(this)}get static(){return this._static}set static(t){this._static=t}get right(){return this._right||(this._right=new s.i),this.getWorldTransform().getX(this._right).normalize()}get up(){return this._up||(this._up=new s.i),this.getWorldTransform().getY(this._up).normalize()}get forward(){return this._forward||(this._forward=new s.i),this.getWorldTransform().getZ(this._forward).normalize()}get aabbVersion(){return this._aabbVer}get enabled(){return this._activeSelf&&this._enabledInHierarchy}set enabled(t){this._activeSelf!==t&&(this._activeSelf=t,t&&this._app.scene.addDirty(this),this._parent&&!this._parent.enabled||this._notifyHierarchyStateChanged(this,t))}get activeSelf(){return this._activeSelf}get parent(){return this._parent}get root(){let t=this._parent;if(!t)return this;for(;t._parent;)t=t._parent;return t}get children(){return this._children}get graphDepth(){return this._graphDepth}get cullingLayer(){return this._cullingLayer}set cullingLayer(t){this._cullingLayer=t,this.layerMask=1<<t}get lossyScale(){return this.getLossyScale()}get eulerAngles(){return this.getEulerAngles()}set eulerAngles(t){this.setEulerAngles(t)}get localEulerAngles(){return this.getLocalEulerAngles()}set localEulerAngles(t){this.setLocalEulerAngles(t)}get localPosition(){return this.getLocalPosition()}set localPosition(t){this.setLocalPosition(t)}get localRotation(){return this.getLocalRotation()}set localRotation(t){this.setLocalRotation(t)}get localScale(){return this.getLocalScale()}set localScale(t){this.setLocalScale(t)}get localTransform(){return this.getLocalTransform()}set localTransform(t){this.setLocalTransform(t)}get position(){return this.getPosition()}set position(t){this.setPosition(t)}get rotation(){return this.getRotation()}set rotation(t){this.setRotation(t)}get worldTransform(){return this.getWorldTransform()}set worldTransform(t){this.setWorldTransform(t)}get worldTransformInverse(){return this.getWorldTransformInverse()}}C.Flags={LocalEulersAnglesDirty:1,RotationDirty:2,EulerAnglesDirty:4,LossyScaleDirty:8,PositionDirty:16,LocalTransformDirty:32,WorldTransformDirty:64,WorldTransformInverseDirty:128,TransformModificationCallbackMuted:256,TransformModificationCallbackRequested:512,LocalPositionHijacked:1024,LocalScaleHijacked:2048,LocalEulerAnglesHijacked:4096,LocalRotationHijacked:8192,HijackedByElementComponent:16384}},(t,e,i)=>{"use strict";i.d(e,{a:()=>c});var s=i(1),n=i(12),r=i(5),a=i(16),o=i(17);let h=!1;class c extends n.a{constructor(t,e,i=!1){if(t instanceof r.a&&(e=t,t="Untitled"),super(t),this._app=e,!e&&(this._app=r.a.getApplication(),!this._app))throw new Error("Couldn't find current application");this.$id=null,this.objectJson=null,this.isPrefab=!0===i,this.getGuid(),this["__UnityEngine.Transform"]=null,this["__UnityEngine.RectTransform"]=null,this["__UnityEngine.GameObject"]=null,this._destroying=!1,this._cullingLayer=0,this._beingDestroyed=!1,this._destroyed=!1,this._magicMethods={},this._eventHanders=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Entity")}sendMessageToScripts(t,e,i){const s=this._unityComponents.monoBehaviour;if(0!==s.length&&t)for(let n=0;n<s.length;n++){const r=s[n].code;if(r!==i)try{if(r&&r[t]){const i=r[t].apply(r,e);i&&"Bridge.GeneratorEnumerator"===i.$$fullname&&new UnityEngine.Coroutine(i,r.handle)}}catch(t){console.error(t)}}}_elementDimesionsChange(){for(let t=0;t<this._dimensionListeners.length;t++){this._dimensionListeners[t].OnRectTransformDimensionsChange()}}sendPhysicsEvent(t,e){if(!this._magicMethods)return!1;const i=this._magicMethods[t];if(!i)return!1;for(let s=0;s<i.length;s++){const n=i[s];try{const i=n.code[t].call(n.code,e);i&&"Bridge.GeneratorEnumerator"===i.$$fullname&&new UnityEngine.Coroutine(i,n.code.handle)}catch(t){console.error(t)}}return!0}removeOrReparent(t,e=!1){if(null===t)if(e){const t=this.getWorldTransform().clone();let e=this.getScene();e||(e=$scene),this.reparent(e.root,-1),this.setLocalTransform(t)}else this.parent.removeChild(this);else this.reparent(t,-1)}getComponents(t){const e=[];if(!t)for(const t in this.c)this.c.hasOwnProperty(t)&&e.push(this.c[t]);for(const t in this._unityComponents){if(!this._unityComponents.hasOwnProperty(t))continue;const i=this._unityComponents[t];for(const t in i)i.hasOwnProperty(t)&&e.push(i[t])}return e}getUnityComponents(t){const e=[],i=this._unityComponents;if(!i)return e;for(let s=0,n=t.length;s<n;++s){const n=t[s];if(!i.hasOwnProperty(n))continue;const r=i[n];for(const t in r)r.hasOwnProperty(t)&&e.push(r[t])}return e}getUnityComponent(t){return this._unityComponents&&this._unityComponents[t][0]||null}collectAllUnityComponents(){let t=this.getUnityComponents(o.a);const e=this.allChildren();for(let i=0;i<e.length;i++){t=e[i].getUnityComponents(o.a).concat(t)}return t}addComponent(t,e){const i=this._app.systems.getSystemByName(t);if(!i)throw new Error("addComponent: System "+t+" doesn't exist");return this.c[t]?(DEBUG&&console.warn("addComponent: Entity already has "+t+" component. (Check for components duplicates, e.g. SkinnedMesh & MeshFilter are both 'Models')"),null):i.addComponent(this,e)}addUnityComponentFromDeserialization(t,e){this._app.systems.getSystemByName(t).addComponent(this,e)}addUnityComponent(t,e){const i=[];if(LunaUnity.Application.Instance.app.systems.unitymanager.disableCallbacks(),this._app.systems.getSystemByName(t).addComponent(this,e),i.push(e),!h){h=!0,a.a.addRequiredComponents(this,e.code,i),LunaUnity.Application.Instance.app.systems.unitymanager.enableCallbacks();for(let t=i.length-1;t>=0;t--){const e=i[t];e instanceof a.a&&(e.configureForEntity(this),e.onAttached(),e.onInit(),this.enabled&&e.enabled&&e._onEntityStateChanged(!0))}h=!1}}removeComponent(t){const e=this._app.systems.getSystemByName(t);if(!e)throw new Error("removeComponent: System "+t+" doesn't exist");this.c[t]?e.removeComponent(this):DEBUG&&console.warn("removeComponent: Entity doesn't have "+t+" component")}getGuid(){return this._guid||this.setGuid((0,s.b)()),this._guid}setGuid(t){const e=this._app._entityIndex;this._guid&&delete e[this._guid],this._guid=t,e[this._guid]=this}_onHierarchyStateChanged(t){if(super._onHierarchyStateChanged.call(this,t),this._unityComponents)for(let e=0;e<o.a.length;e++){const i=this._unityComponents[o.a[e]];for(let e=0;e<i.length;e++)i[e]._onEntityStateChanged(t)}let e;const i=this.c;for(const s in i)i.hasOwnProperty(s)&&(e=i[s],e.enabled&&(t?e.onEnable():e.onDisable()))}findByGuid(t){if(this._guid===t)return this;const e=this._app._entityIndex[t];return e&&(e===this||e.isDescendantOf(this))?e:null}destroy(){let t;for(t in this._destroying=!0,this.c)this.c.hasOwnProperty(t)&&(this.c[t].enabled=!1);for(t in this.c)this.c.hasOwnProperty(t)&&this.c[t].system.removeComponent(this);for(let t=0;t<o.a.length;t++){const e=this._unityComponents[o.a[t]];for(let t=0;t<e.length;t++)e[t].destroy()}this._parent&&this._parent.removeChild(this);const e=this._children;let i=e.shift();for(;i;)i instanceof c&&i.destroy(),i._parent=null,i=e.shift();this.events.off(),this._destroying=!1,this._destroyed=!0,this._layoutElements.length=0,this._layoutControllers.length=0,this._layoutSelfControllers.length=0,this._dimensionListeners.length=0,this._canvasElements.length=0,this._canvasGroups.length=0,this._meshModifiers.length=0}}},(t,e,i)=>{"use strict";i.d(e,{a:()=>r});var s=i(1);class n{constructor(){this.timestamps={scripts:0,animations:0,animators:0,physics2d:0,physics:0,render:0,frame:0},this.times={scripts:0,animations:0,animators:0,physics2d:0,physics:0,render:0,frame:0},this.drawCalls=0,this.frames=0}reset(){this.times.scripts=0,this.times.animations=0,this.times.animators=0,this.times.physics2d=0,this.times.physics=0,this.times.render=0,this.times.frame=0,this.drawCalls=0,this.frames=0}}class r{constructor(t){this.sample=new n,this.current=new n,this.webglVersion=window.WebGL2RenderingContext?2:1,this.webglExtensions=t.gl.getSupportedExtensions()}getSnapshot(){const t=this.sample,e=Math.max(1,t.frames),i={scriptsTime:t.times.scripts/e,animationsTime:t.times.animations/e,animatorsTime:t.times.animators/e,physics2dTime:t.times.physics2d/e,physicsTime:t.times.physics/e,renderTime:t.times.render/e,frameTime:t.times.frame/e,drawCalls:t.drawCalls/e,webglVersion:this.webglVersion,webglExtensions:this.webglExtensions};return t.reset(),i}tick(){this.sample.frames++,this.sample.times.scripts+=this.current.times.scripts,this.sample.times.animations+=this.current.times.animations,this.sample.times.animators+=this.current.times.animators,this.sample.times.physics2d+=this.current.times.physics2d,this.sample.times.physics+=this.current.times.physics,this.sample.times.render+=this.current.times.render,this.sample.times.frame+=this.current.times.frame,this.sample.drawCalls+=this.current.drawCalls,this.current.reset()}recordDrawCalls(t){this.current.drawCalls+=t}startSection(t){this.current.timestamps[t]=s.d.now()}endSection(t){this.current.times[t]+=s.d.now()-this.current.timestamps[t]}}r.SCRIPTS="scripts",r.ANIMATIONS="animations",r.ANIMATORS="animators",r.PHYSICS2D="physics2d",r.PHYSICS="physics",r.RENDER="render",r.FRAME="frame"},(t,e,i)=>{"use strict";i.d(e,{a:()=>r});var s=i(1),n=i(7);class r{constructor(){this.ambientLight=null,this.skyboxHelper=null,this.meshInstancesCount=0,this._meshInstances=[],this._renderers=new Set,this._cameras=[],this._lights=[],this._overlayScreensDirty=!1,this._overlayScreens=[],this._worldScreens=[],this.activeUiMasks={},this.dirtyEntities=new Set,this.events=new s.a(this)}addDirty(t){this.dirtyEntities.add(t)}syncHierarchy(){const t=[...this.dirtyEntities];for(const e of t)e.syncHierarchy();this.dirtyEntities.clear()}addRenderer(t){this._renderers.add(t)}removeRenderer(t){this._renderers.delete(t)}getMeshInstances(){for(let t=0;t<this.meshInstancesCount;t++)this._meshInstances[t]=null;this.meshInstancesCount=0;for(const t of this._renderers){const e=t.getMeshInstancesForRender();for(let t=0;t<e.length;t++){const i=e[t];i.isIndexBufferEmpty&&!i.isCanvas||(this._meshInstances.length===this.meshInstancesCount?this._meshInstances.push(i):this._meshInstances[this.meshInstancesCount]=i,this.meshInstancesCount++)}}return this._meshInstances}getMeshInstancesCached(){return this._meshInstances}addCamera(t){this._cameras.includes(t)||this._cameras.push(t)}removeCamera(t){this._cameras.splice(this._cameras.indexOf(t),1)}addLight(t){this._lights.includes(t)||this._lights.push(t)}removeLight(t){this._lights.splice(this._lights.indexOf(t),1)}addScreen(t){const e=t.screenType===s.c.SCREEN_TYPE_SCREEN?this._overlayScreens:this._worldScreens;e.includes(t)||(e.push(t),e===this._overlayScreens&&(this._overlayScreensDirty=!0))}removeScreen(t){const e=t.screenType===s.c.SCREEN_TYPE_SCREEN?this._overlayScreens:this._worldScreens;e.includes(t)&&e.splice(e.indexOf(t),1)}get overlayScreens(){return this._overlayScreensDirty&&(this._overlayScreensDirty=!1,this._overlayScreens.sort(n.e.sortOverlayCanvases)),this._overlayScreens}get worldScreens(){return this._worldScreens}}},(t,e,i)=>{"use strict";i.d(e,{a:()=>r});let s=0;const n={};class r{constructor(){this._enabled=!0,this._destroyed=!1,this.$id="0",this._id=null,this._entity=null,this._system=null,this._code=null,this.internalExecutionOrder=0,this.scriptsExecutionOrder=0,this._scriptsExecutionOrder=0,this._sortingOrderInQueue=s++,this._activatedCallbacks={onAwake:!1,onEnable:!1,onStart:!1,onDisable:!0,onDestroy:!1}}get code(){return this._code}set code(t){this._code=t}get sortingOrderInQueue(){return parseInt(this.$id,10)}get enabled(){return this._enabled}set enabled(t){const e=this._enabled&&this._entity&&this._entity.enabled,i=t&&this._entity&&this._entity.enabled;this._enabled=t,e===i||LunaUnity.Application.Instance.app.systems.unitymanager.callbacksDisabled||(i?this.onEnable():this.onDisable())}get entity(){return this._entity}get system(){return this._system}set system(t){this._system=t}configureForEntity(t){}onInit(t){return!this._destroyed&&!this._activatedCallbacks.onAwake&&(this._activatedCallbacks.onAwake=!0,this._activatedCallbacks.onDestroy=!1,this.onAwake(t),!0)}onAwake(t){}onAttached(){}onEnable(){return!this._destroyed&&!this._activatedCallbacks.onEnable&&(this._activatedCallbacks.onEnable=!0,this._activatedCallbacks.onDisable=!1,this._system._onComponentEnabled(this),this._activatedCallbacks.onStart||this._system._componentShouldStart(this),!0)}onStart(){}onDisable(){return!this._destroyed&&!this._activatedCallbacks.onDisable&&(this._activatedCallbacks.onDisable=!0,this._activatedCallbacks.onEnable=!1,this._system._onComponentDisabled(this),!0)}onDestroy(){return!this._destroyed&&!this._activatedCallbacks.onDestroy&&(this._activatedCallbacks.onDestroy=!0,!0)}rememberCallback(t){t in this._activatedCallbacks&&(this._activatedCallbacks[t]=!0)}callbackActivated(t){return this._activatedCallbacks[t]}_onEntityStateChanged(t){LunaUnity.Application.Instance.app.systems.unitymanager.callbacksDisabled||(t?this.onEnable():this.onDisable())}_queuesToSubscribe(){return[]}destroy(){this._system&&this._entity&&this._system.removeComponent(this._entity,this),this._destroyed=!0}toUnityObject(){return this.unityClass?UnityEngine.Object.FromHandle(this.unityClass,this):null}}r.prototype.unityClass=null,r.addRequiredComponents=(t,e,i)=>{if(!e)return;const s=Bridge.getTypeName(e),a=Deserializers.typeNameToIdMap[s];if(void 0===a)return;let o;n.hasOwnProperty(a)?o=n[a]:(o=[],o.push(a),r.getAllRequiredComponents(a,o),n[a]=o);const h=UnityEngine.Object.FromHandle(UnityEngine.GameObject,t);for(let t=1;t<o.length;t++){const e=o[t],s=Bridge._getTypeByName(Deserializers.types[e]);if(!h.GetComponent(s)){const t=h.AddComponent(s);i.push(t.handle)}}},r.getAllRequiredComponents=(t,e)=>{const i=Deserializers.requiredComponents[t];if(i&&0!==i.length)for(let t=0;t<i.length;t++){const s=i[t];e.indexOf(s)>=0||(e.push(s),r.getAllRequiredComponents(s,e))}}},(t,e,i)=>{"use strict";i.d(e,{a:()=>a,b:()=>o});var s=i(1),n=i(10),r=i(22);const a=["rigidbody","collider","joint","rigidbody2D","collider2D","joint2D","uiBehaviour","monoBehaviour","animator","animation","particlesystem","particleSystemRenderer","reflectionprobe","videoPlayer","canvasRenderer","audiosourceunity","renderer","meshFilter","effector2D"];class o extends n.a{constructor(t){super(t),this.id="unity",this.description="Supports Unity-like components.",this.creatingPrefabs=!1,this._components={},this.app.systems.unitymanager.registerSystem(this),this.queues={onStart:new r.a,onBeforeUpdates:new r.a,onFixedUpdate:new r.a,onUpdate:new r.a,onPostUpdate:new r.a,onBeforeRender:new r.a,onAfterRender:new r.a,onApplicationFocus:new r.a}}addComponent(t,e){if(e._id)throw new Error("Component already belongs somewhere!");return e._id=(0,s.b)(),e._entity=t,e.system=this,e.scriptsExecutionOrder=0,t._unityComponents[this.id].push(e),this._components[e._id]=e,e.onAttached(),t.enabled&&e.enabled&&e._onEntityStateChanged(!0),e}removeComponent(t,e){this._onComponentDisabled(e);const i=t._unityComponents[e._system.id],s=i.indexOf(e);s<0||(i[s]=i[i.length-1],i.length-=1)}onStart(t){this._invokeQueue("onStart",t,!0)}onBeforeUpdates(t){this._invokeQueue("onBeforeUpdates",t)}onFixedUpdate(t){this._invokeQueue("onFixedUpdate",t)}onUpdate(t){this._invokeQueue("onUpdate",t)}onPostUpdate(t){this._invokeQueue("onPostUpdate",t)}onBeforeRender(t){this._invokeQueue("onBeforeRender",t)}onAfterRender(t){this._invokeQueue("onAfterRender",t)}onApplicationFocus(t){this._invokeQueue("onApplicationFocus",t)}_invokeQueue(t,e,i=!1){const s=this.queues[t];if(0===s.length)return;const n=s.processing,r=s.getComponents();n||(s.processing=!0),i&&s.clear();for(let i=0;i<r.length;i++){const s=r[i];s.entity._enabledInHierarchy&&!s.callbackActivated(t)&&(s.rememberCallback(t),s[t].call(s,e))}i&&this.queues[t].length>0&&this._invokeQueue(t,e,i),n||(this.queues[t].processing=!1)}_onComponentEnabled(t){const e=t._queuesToSubscribe();for(let i=0;i<e.length;i++)this.queues[e[i]].push(t)}_componentShouldStart(t){this.queues.onStart.push(t)}_onComponentDisabled(t){const e=t._queuesToSubscribe();for(let i=0;i<e.length;i++)this.queues[e[i]].delete(t._id);this.queues.onStart.delete(t._id)}}},(t,e,i)=>{"use strict";i.d(e,{a:()=>a});var s=i(0);const n=new s.e,r=new s.i;class a{constructor(t){this.options=t,this._rigidbodies=[],this._fauxBodies={},this._colliders=[],this._constraints=[],this._isSimulating=!1,this._world=null,this.setup()}enableRigidbody(t){t.body._component=t,this.addRigidbody(t.body),this._rigidbodies.push(t),this.reattachCollidersInChildren(t.entity)}disableRigidbody(t){const e=this._rigidbodies,i=e.indexOf(t);i<0||(this.removeRigidbody(t.body),t.body._component=null,e[i]=e[e.length-1],e.pop(),this.reattachCollidersInChildren(t.entity))}enableCollider(t){t.shape&&(t.shape._component=t);const e=this.fetchBody(t.entity);t._body=e,this.getRelTransformAndAccumScale(e,t,n,r),t.updateShape(n,r,e),this.addCollider(e,t),this._colliders.push(t)}disableCollider(t){const e=this._colliders,i=e.indexOf(t);i<0||(t._body&&this.removeCollider(t._body,t),e[i]=e[e.length-1],e.length-=1)}enableConstraint(t){t.constraint._component=t,this.addConstraint(t),this._constraints.push(t)}disableConstraint(t){const e=this._constraints,i=e.indexOf(t);i<0||(this.removeConstraint(t),e[i]=e[e.length-1],e.length-=1)}fetchBody(t){let e=t;for(;e;){if(e._enabledInHierarchy){const t=this.getAttachedRigidbody(e);if(t)return t}e=e._parent}let i=this._fauxBodies[t._guid];return i||(i=this._fauxBodies[t._guid]=this.attachFauxRigidbody(t),i._body=i,i._entity=t,i)}onFixedUpdate(t){this._isSimulating=!0,this.onBeforeSimulation(),this.onSimulationStep(t),this.onAfterSimulation(),this._isSimulating=!1}onBeforeSimulation(){const t=this._rigidbodies;t.sort(this.compareBodyDepths);for(let e=0;e<t.length;e++)this.preSimulationSynchronization(t[e],a.PreSyncStages.TransformToPhysics);for(let e=0;e<t.length;e++)this.preSimulationSynchronization(t[e],a.PreSyncStages.PhysicsToTransform);for(const t in this._fauxBodies)this.preSimulationSynchronization(this._fauxBodies[t],a.PreSyncStages.TransformToPhysics);for(let t=0;t<this._constraints.length;++t)this.updateConstraint(this._constraints[t]);for(let t=0;t<this._colliders.length;t++)this.preSimulationSynchronizationForCollider(this._colliders[t])}onAfterSimulation(){const t=this._rigidbodies;for(let e=0;e<t.length;e++){const i=t[e];this.postSimulationSynchronization(i);const s=i._entity;i._worldTransformVersion=s.aabbVersion}const e=this._colliders;for(let t=0;t<e.length;t++){const i=e[t],s=i._entity;i._worldTransformVersion=s.aabbVersion}this.handleContacts()}compareBodyDepths(t,e){return t._entity.graphDepth-e._entity.graphDepth}dispatchContact(t,e,i){return t.sendPhysicsEvent(e,i)}entityHasEventListeners(t,e){return!!t._magicMethods[e]&&0!==t._magicMethods[e].length}setIgnoreCollisionBetweenLayers(t,e,i){const s=this._world.collision_matrix,n=s[t]=s[t]||0,r=s[e]=s[e]||0;i?(s[t]=n|1<<e,s[e]=r|1<<t):(s[t]=n&~(1<<e),s[e]=r&~(1<<t))}reattachCollidersInChildren(t){if(!t._enabledInHierarchy)return;const e=this.getAttachedColliders(t);for(let i=0;i<e.length;i++){const s=e[i];!s.enabled||!s._body||s._body._component&&s._body._component._entity===t||(this.disableCollider(s),this.enableCollider(s))}const i=t._children;for(let t=0,e=i.length;t<e;t++){const e=i[t];this.getAttachedRigidbody(e)||this.reattachCollidersInChildren(e)}}syncHierarchy(t){if(t._enabledInHierarchy){if(this.getAttachedRigidbody(t))return;this.reattachCollidersInChildren(t)}}syncTransformsInChildren(t){if(!t._enabledInHierarchy)return;const e=this.getAttachedRigidbody(t);let i=e&&e._component;i&&this.preSimulationSynchronization(i,a.PreSyncStages.TransformToPhysics),i=this._fauxBodies[t._guid],i&&this.preSimulationSynchronization(i,a.PreSyncStages.TransformToPhysics);const s=this.getAttachedColliders(t);for(let t=0;t<s.length;t++){const e=s[t];e.enabled&&e._body&&this.preSimulationSynchronizationForCollider(e)}const n=t._children;for(let t=0,e=n.length;t<e;t++)this.syncTransformsInChildren(n[t])}syncTransforms(t){this._isSimulating||this.syncTransformsInChildren(t)}setup(){throw new Error("Not Implemented")}onSimulationStep(t){throw new Error("Not Implemented")}getAttachedColliders(t){throw new Error("Not Implemented")}getAttachedRigidbody(t){throw new Error("Not Implemented")}attachFauxRigidbody(t){throw new Error("Not Implemented")}addRigidbody(t){throw new Error("Not Implemented")}removeRigidbody(t){throw new Error("Not Implemented")}addCollider(t,e){throw new Error("Not Implemented")}removeCollider(t,e){throw new Error("Not Implemented")}handleContacts(){throw new Error("Not Implemented")}addConstraint(t){throw new Error("Not Implemented")}removeConstraint(t){throw new Error("Not Implemented")}updateConstraint(t){throw new Error("Not Implemented")}getRelTransformAndAccumScale(t,e,i,s){throw new Error("Not Implemented")}preSimulationSynchronization(t,e){throw new Error("Not Implemented")}preSimulationSynchronizationForCollider(t){const e=t._entity.aabbVersion;t._worldTransformVersion!==e&&(this.getRelTransformAndAccumScale(t._body,t,n,r),t.updateShape(n,r),t._worldTransformVersion=e)}postSimulationSynchronization(t){throw new Error("Not Implemented")}}a.PreSyncStages={TransformToPhysics:1,PhysicsToTransform:2},pc.BasePhysicsAdapter=a},,,(t,e,i)=>{"use strict";i.d(e,{a:()=>s});class s{constructor(){this.list=[],this.map={}}getSystemByName(t){const e=this.map[t];if(!e)throw new Error(`Unknown system "${t}"`);return e}get animation(){return this.map.animation}get animator(){return this.map.animator}get audiosourceunity(){return this.map.audiosourceunity}get monoBehaviour(){return this.map.monoBehaviour}get uiBehaviour(){return this.map.uiBehaviour}get camera(){return this.map.camera}get element(){return this.map.element}get canvasRenderer(){return this.map.canvasRenderer}get light(){return this.map.light}get meshFilter(){return this.map.meshFilter}get particlesystem(){return this.map.particlesystem}get particleSystemRenderer(){return this.map.particleSystemRenderer}get physics(){return this.map.physics}get collider(){return this.map.collider}get joint(){return this.map.joint}get rigidbody(){return this.map.rigidbody}get physics2D(){return this.map.physics2D}get collider2D(){return this.map.collider2D}get effector2D(){return this.map.effector2D}get joint2D(){return this.map.joint2D}get rigidbody2D(){return this.map.rigidbody2D}get reflectionprobe(){return this.map.reflectionprobe}get renderer(){return this.map.renderer}get screen(){return this.map.screen}get unitymanager(){return this.map.unitymanager}get videoPlayer(){return this.map.videoPlayer}get unity(){return this.map.unity}add(t){const e=t.id;if(this.map[e])throw new Error(`ComponentSystem name '${e}' already registered or not allowed`);this.map[e]=t,this.list.push(t)}remove(t){const e=t.id;if(!this.map[e])throw new Error(`No ComponentSystem named '${e}' registered"`);this.map[e]=null;const i=this.list.indexOf(this.map[e]);-1!==i&&this.list.splice(i,1)}}},(t,e,i)=>{"use strict";i.d(e,{a:()=>n});const s=function(t,e){const i=t.internalExecutionOrder-e.internalExecutionOrder;return 0!==i?i:t._scriptsExecutionOrder-e._scriptsExecutionOrder};class n{constructor(){this._components=[],this._needsSort=!1,this.processing=!1}push(t){t._scriptsExecutionOrder=4294967296*(t.scriptsExecutionOrder+32768)+(t.sortingOrderInQueue+2147483648),0!==this._components.length&&t._scriptsExecutionOrder<this._components[this._components.length-1]._scriptsExecutionOrder&&(this._needsSort=!0),this._components.push(t)}getComponents(){return this._needsSort&&(this._needsSort=!1,this._components.sort(s)),this._components.slice()}delete(t){for(let e=0;e<this._components.length;e++)if(t===this._components[e]._id)return void this._components.splice(e,1)}clear(){this._components.length=0}get length(){return this._components.length}}}]]),(self.webpackChunk=self.webpackChunk||[]).push([[2],{},0,[[1,0,1]]]),(self.webpackChunk=self.webpackChunk||[]).push([[5],{},0,[[0,0,1]]]),(self.webpackChunk=self.webpackChunk||[]).push([[4],{},0,[[11,0,1]]]),(self.webpackChunk=self.webpackChunk||[]).push([[3],{},0,[[2,0,1]]]),(self.webpackChunk=self.webpackChunk||[]).push([[9],{},0,[[7,0,1]]]),(self.webpackChunk=self.webpackChunk||[]).push([[8],{},0,[[18,0,1]]]),pc.extend(pc,function(){const t=new pc.LightData,e=new pc.KeywordSet,i=new pc.SphericalHarmonicsL2,s=new Float32Array([0,0,0,0]),n=new Float32Array(4),r=new Float32Array(4),a=new Float32Array(4),o=new Float32Array(4),h=new Float32Array(4),c=new Float32Array(16),l=new Float32Array(16),u=new Float32Array(4),d=new Float32Array(4),_=new pc.KeywordSet,p=[],m=[],f=[],g=[],y=[],E=[],A={};let T={},C={},b=null,S=!1;return{BuiltInForwardRenderer:{renderMeshInstance:function(t,e,i,s,n){const r=this.device,a=s.material,o=s.mesh,h=(s._shaderDefs&pc.SHADERDEF_LM)>0;if(b=i,!a||0===s.mesh.primitive.count)return;a.getPass(pc.SHADER_PASS_ALWAYS,p),a.getPass(pc.SHADER_PASS_FORWARD_BASE,m),a.getPass(pc.SHADER_PASS_FORWARD_ADD,f),a.getPass(pc.SHADER_PASS_VERTEX,g),a.getPass(pc.SHADER_PASS_VERTEX_LM,y),a.getPass(pc.SHADER_PASS_GRAB_PASS,E);const c=m.length>0||f.length,l=g.length>0;if(0!==p.length||!c||!l){for(let t=0;t<E.length;t++){const e=E[t];C[e.grabPassTextureName]=e,S=!0}h&&s.configureLightmap(),d[0]=this.device.sx,d[1]=this.device.sy,d[2]=this.device.sw,d[3]=this.device.sh,r.setVertexBuffer(s.morphInstance&&s.morphInstance._vertexBuffer?s.morphInstance._vertexBuffer:o.vertexBuffer,0),r.setIndexBuffer(o.indexBuffer[0]),this.setSkinning(r,s,a),this.setMaterial(r,a),this.pushUniforms(r,s.parameters),this.setDrawCall(r,s),r.setDepthRange((s._shaderDefs&pc.SHADERDEF_RENDERTYPE_BACKGROUND)>0?1:0,1),t.merge(a.keywords),h&&t.enableKeywordId(pc.Keywords.LIGHTMAP_ON),(s._shaderDefs&pc.SHADERDEF_DIRLM)>0&&t.enableKeywordId(pc.Keywords.DIRLIGHTMAP_COMBINED);for(let e=0;e<p.length;e++){const i=p[e];this.renderMeshInstancePass(i,t,s)}if(!c&&!l)return this.popUniforms(r,s.parameters),void this.setDrawCall(r,null);c?this.drawForwardPasses(m,f,s,n,t,h,e,i):this.drawVertexPasses(g,y,s,n,t,h,e,i),this.restoreScissorTest(),this.popUniforms(r,s.parameters),this.setDrawCall(r,null)}},drawForwardPasses:function(s,n,r,a,o,h,c,l){pc.RenderingUtils.getLightsData(r,a,t),e.copy(o),!h&&c?i.copy(c):i.clear(),t.addOtherLights(i),this.dispatchLightProbe(i,e,h),this.dispatchVertexLights(t.vertexLights,e),this.dispatchMainLight(l,t.mainLight,e),this.renderMeshInstancePasses(s,e,r);for(let i=0;i<t.pixelLights.length;i++){const s=t.pixelLights[i];e.copy(o),this.dispatchMainLight(l,s,e),this.renderMeshInstancePasses(n,e,r)}},drawVertexPasses:function(i,s,n,r,a,o,h,c){pc.RenderingUtils.getLightsData(n,r,t),e.copy(a),this.dispatchVertexLights(t.allLights,e);const l=o?s:i;this.renderMeshInstancePasses(l,e,n)},renderMeshInstancePasses:function(t,e,i){for(let s=0;s<t.length;s++){const n=t[s];this.renderMeshInstancePass(n,e,i)}},renderGrabPass:function(t,e){const i=this.device,s=e.grabPassTextureName,n=this.initializeGrabPassTexture(t,s);i.setTexture(n,0),i.gl.copyTexSubImage2D(i.gl.TEXTURE_2D,0,0,0,0,0,n._width,n._height),i.scope.resolve(s).setValue(n)},initializeGrabPassTexture:function(t,e){let i=A[e];const s=t?t._screenParams:[this.device.width,this.device.height];return i&&i._width===s[0]&&i._height===s[1]||(i=new pc.Texture(this,{format:pc.PIXELFORMAT_R8_G8_B8,autoMipmap:!0,mipmaps:!1,width:s[0],height:s[1],minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,levels:[null]}),this.device.initializeTexture(i),A[e]=i),i},restoreScissorTest:function(){this.device.setScissor(d[0],d[1],d[2],d[3])},dispatchMainLight:function(t,e,i){e?(s.set(e._finalColor),e._type===pc.LIGHTTYPE_DIRECTIONAL?(n[0]=e._directionToLight.x,n[1]=e._directionToLight.y,n[2]=e._directionToLight.z,n[3]=0):(n[0]=e._position.x,n[1]=e._position.y,n[2]=e._position.z,n[3]=1),this.lightIds.matrix.setValue(e._worldToLightMatrix.data)):(s[0]=0,s[1]=0,s[2]=0,s[3]=0,n[0]=0,n[1]=0,n[2]=0,n[3]=0),this.lightIds.color.setValue(s),this.lightIds.position.setValue(n),e&&e._type===pc.LIGHTTYPE_POINT?e._cookie?(i.enableKeywordId(pc.Keywords.POINT_COOKIE),this.lightIds.attenuationTexture.setValue(e._cookie||UnityEngine.Texture2D.spotTexture.handle),this.lightIds.fallOffTexture.setValue(UnityEngine.Texture2D.attenuationTexture.handle)):(i.enableKeywordId(pc.Keywords.POINT),this.lightIds.attenuationTexture.setValue(UnityEngine.Texture2D.attenuationTexture.handle)):e&&e._type===pc.LIGHTTYPE_SPOT?(i.enableKeywordId(pc.Keywords.SPOT),this.lightIds.attenuationTexture.setValue(e._cookie||UnityEngine.Texture2D.spotTexture.handle),this.lightIds.fallOffTexture.setValue(UnityEngine.Texture2D.attenuationTexture.handle)):e&&e._cookie?(i.enableKeywordId(pc.Keywords.DIRECTIONAL_COOKIE),this.lightIds.attenuationTexture.setValue(e._cookie)):i.enableKeywordId(pc.Keywords.DIRECTIONAL)},dispatchVertexLights:function(t,e){if(0===t.length)e.disableKeywordId(pc.Keywords.VERTEXLIGHT_ON);else{e.enableKeywordId(pc.Keywords.VERTEXLIGHT_ON);for(let e=0;e<4;e++)if(e<t.length){const i=t[e],s=i._type===pc.LIGHTTYPE_DIRECTIONAL?i._directionToLight:i._position,n=i._finalColor,u=i._range;r[e]=s.x,a[e]=s.y,o[e]=s.z,c[4*e+0]=n[0],c[4*e+1]=n[1],c[4*e+2]=n[2],c[4*e+3]=n[3],l[4*e+0]=s.x,l[4*e+1]=s.y,l[4*e+2]=-s.z,l[4*e+3]=i._type===pc.LIGHTTYPE_DIRECTIONAL?0:1,h[e]=25/(u*u)}else r[e]=0,a[e]=0,o[e]=0,c[4*e+0]=0,c[4*e+1]=0,c[4*e+2]=0,c[4*e+3]=0,l[4*e+0]=0,l[4*e+1]=0,l[4*e+2]=0,l[4*e+3]=0,h[e]=0;this.lightIds.vertexX.setValue(r),this.lightIds.vertexY.setValue(a),this.lightIds.vertexZ.setValue(o),this.lightIds.vertexAttenuation.setValue(h),this.lightIds.vertexLightColors.setValue(c),this.lightIds.vertexLightPositions.setValue(l)}},dispatchLightProbe:function(t,e,i){if(i)e.disableKeywordId(pc.Keywords.LIGHTPROBE_SH);else{e.enableKeywordId(pc.Keywords.LIGHTPROBE_SH),t.updateUniforms();for(let e=0;e<this.unityIds.lightProbeIds.length;e++)this.unityIds.lightProbeIds[e].setValue(t.uniforms[e]._data)}},renderMeshInstancePass:function(t,e,i){const s=this.device,n=i.material,r=i.mesh;if(!r||!r.indexBuffer[0])return;if(window.spector&&i.node){const e=i.node._unityComponents,s=e&&e.canvasRenderer&&e.canvasRenderer[0]?e.canvasRenderer[0]._parentCanvas.entity.name:"",n=""===s?i.node.name:s+" - "+i.node.name;window.spector.setMarker(n+": "+pc.LIGHT_MODE_NAMES[t.lightMode])}t.updateRenderState(n),this.updateRenderState(i,t,e);let a=t.getVariant(e);a||(a=t.applyMissingVariant(e));let o=a.getShader(i._shaderDefs);if(!s.setShader(o))return o=a.applyMissingShader(i._shaderDefs),void s.setShader(o);if(S)for(let t=0;t<o.samplers.length;t++){const e=o.samplers[t].scopeId.name,i=C[e];!i||"_GrabTexture"!==e&&T[e]||(this.renderGrabPass(b,i),T[e]=!0)}if(window.spector){const e=a.keywords.getEnabledKeywords().join(" "),s=i.node._unityComponents,n=s&&s.canvasRenderer&&s.canvasRenderer[0]?s.canvasRenderer[0]._parentCanvas.entity.fullname:"";o._glProgram.__SPECTOR_Metadata={Material:"["+i.material.$id+"] "+i.material.name,Shader:"["+t.sourceShader.$id+"] "+t.sourceShader.name,RenderType:pc.RENDER_TYPE_NAMES[t.renderType],LightMode:pc.LIGHT_MODE_NAMES[t.lightMode],Keywords:0===a.keywords.cardinality?"<none>":e,RenderQueue:i.material.renderQueue,SortingLayerIndex:i.sortingLayerIndex,SortingOrder:i.sortingOrder,DrawOrder:i.drawOrder,ZDist:i.zdist,ParentCanvas:n}}this.drawInstance(s,i,r,0,!0)},setMaterial:function(t,e,i){this._material&&(i||this._material!==e)&&this.popUniforms(t,this._material.parameters),(this._material!==e||i)&&this.pushUniforms(t,e.parameters),this._material=e},pushUniforms:function(t,e){for(const i in e)if(e.hasOwnProperty(i)){const s=e[i];s.scopeId||(s.scopeId=t.scope.resolve(i)),s.scopeId.pushValue(s.data)}t.scope.resolve("_ClipRect").setValue([Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY])},popUniforms:function(t,e){for(const t in e)if(e.hasOwnProperty(t)){e[t].scopeId.popValue()}},setDrawCall:function(t,e){null!==e&&(u[3]=e._flipFaces?-1:1,this.unityIds.worldTransformParamsId.setValue(u))},setPass:function(t,e){e.updateRenderState(t);const i=this.device,s=e,n=pc.RenderingUtils.unityCullModeToPlaycanvas(0|s.culling.val);i.setCullMode(n);const r=pc.RenderingUtils.unityCompareFunctionToPlaycanvas(0|s.zTest.val),a=r>=0&&r<=7,o=s.zWrite.val>0;i.setBlending(!0),i.setDepthTest(a),i.setDepthWrite(o);const h=s.offsetUnits.val,c=s.offsetFactor.val;h||c?(i.setDepthBias(!0),i.setDepthBiasValues(h,c)):i.setDepthBias(!1),this.setBlendFunctionAndEquation(s),a&&i.setDepthFunc(r);const l=s.colorWriteMask.val,u=(8&l)>0,d=(4&l)>0,p=(2&l)>0,m=(1&l)>0;i.setColorWrite(u,d,p,m);const f=this.device;_.copy(this.keywords),_.merge(t.keywords);let g=e.getVariant(_);g||(g=e.applyMissingVariant(_));let y=g.getShader(0);if(!f.setShader(y))return y=g.applyMissingShader(0),void f.setShader(y);this.setMaterial(f,t,!0)},renderForward:function(t,e,i,s,n){const r=this.device,a=pc.time.now();r._enableAutoInstancing&&this.prepareAutoInstancing(e,i),T={},C={},S=!1;for(let n=0;n<i;n++){const i=e[n],r=i._lightProbe||this._ambientProbe;_.copy(this.keywords),i.isCanvas?i.render(_,r,t,i,s):this.renderMeshInstance(_,r,t,i,s)}r.updateEnd(),this._forwardTime+=pc.time.now()-a}}}}()),Object.assign(pc,function(){const t=[];for(let e=0;e<8;e++)t.push(new pc.Vec3);const e=new pc.Mat4,i=new pc.Mat4,s=new pc.Mat4,n=new pc.Mat4,r=new pc.Mat4,a=new pc.Mat4,o=new pc.Mat4,h=new pc.Mat4,c=new pc.Mat4,l=[0,0,0,0],u=new Float32Array(4),d=new pc.Mat4,_=new pc.Mat4,p=[0,0];let m,f;const g=new Float32Array(24),y=pc.Mat4.IDENTITY.clone(),E=[0,0,0,0],A=[0,0,0,0],T=["unity_SHAr","unity_SHAg","unity_SHAb","unity_SHBr","unity_SHBg","unity_SHBb","unity_SHC"],C=["unity_SpecCube0","unity_SpecCube0_BoxMin","unity_SpecCube0_BoxMax","unity_SpecCube0_ProbePosition","unity_SpecCube1","unity_SpecCube1_BoxMin","unity_SpecCube1_BoxMax","unity_SpecCube1_ProbePosition"],b={min0:[-1/0,-1/0,-1/0,0],max0:[1/0,1/0,1/0,1],position0:[0,0,0,0],min1:[-1/0,-1/0,-1/0,1],max1:[1/0,1/0,1/0,1],position1:[0,0,0,0]};let S=null,x=null;const D=new pc.SphericalHarmonicsL2(null),M=new pc.BoundingBox,R=function(t){return!(0===t.comp.val||8===t.comp.val&&0===t.pass.val&&0===t.fail.val&&0===t.zFail.val)},I=pc.RenderingUtils.unityCompareFunctionToPlaycanvas,O=pc.RenderingUtils.unityStencilOpToPlaycanvas,F=pc.RenderingUtils.unityBlendModeToPlaycanvas,P=pc.RenderingUtils.unityCullModeToPlaycanvas,v=pc.RenderingUtils.unityBlendOpToPlaycanvas;function w(t,e){return e?"hlslcc_mtx4x4"+t+"[0]":t}function L(t){this.device=t;const e=this.device;x=new pc.StencilParameters({}),S=new pc.StencilParameters({}),this._forwardTime=0,this._skinTime=0,this._morphTime=0,this._instancingTime=0,this.clearMaskStencil=new pc.StencilParameters({});const i=e.getProgramLibrary();this.library=i;const s=e.scope;this.viewProjId=s.resolve("matrix_viewProjection"),this.viewInvId=s.resolve("matrix_viewInverse"),this.modelMatrixId=s.resolve("matrix_model"),this.poseMatrixId=s.resolve("matrix_pose[0]"),this.boneTextureId=s.resolve("texture_poseMap"),this.boneTextureSizeId=s.resolve("texture_poseMapSize");const n=UnityEngine.UnityVersion.IsOrNewer("2018.3");this.needsMatrixVectorization=n,this.unityIds={modelViewProjId:s.resolve(w("unity_MatrixMVP",n)),modelViewId:s.resolve(w("unity_MatrixMV",n)),viewProjId:s.resolve(w("unity_MatrixVP",n)),viewId:s.resolve(w("unity_MatrixV",n)),invViewId:s.resolve(w("unity_MatrixInvV",n)),legacyProjId:s.resolve(w("glstate_matrix_projection",n)),transposeModelViewId:s.resolve(w("unity_MatrixTMV",n)),inverseTransposeModelViewId:s.resolve(w("unity_MatrixITMV",n)),modelMatrixId:s.resolve(w("unity_ObjectToWorld",n)),modelMatrixInvId:s.resolve(w("unity_WorldToObject",n)),cameraProjectionId:s.resolve(w("unity_CameraProjection",n)),cameraInvProjectionId:s.resolve(w("unity_CameraInvProjection",n)),worldSpaceCameraPos:s.resolve("_WorldSpaceCameraPos"),projectionParamsId:s.resolve("_ProjectionParams"),screenParamsId:s.resolve("_ScreenParams"),zbufferParams:s.resolve("_ZBufferParams"),cameraOrthoParamsId:s.resolve("unity_OrthoParams"),cameraWorldClipPlanesId:s.resolve("unity_CameraWorldClipPlanes[0]"),time:s.resolve("_Time"),sinTime:s.resolve("_SinTime"),cosTime:s.resolve("_CosTime"),deltaTime:s.resolve("unity_DeltaTime"),timeParameters:s.resolve("_TimeParameters"),ambientSky:s.resolve("unity_AmbientSky"),ambientEquator:s.resolve("unity_AmbientEquator"),ambientGround:s.resolve("unity_AmbientGround"),glstateLightModelAmbient:s.resolve("glstate_lightmodel_ambient"),fogParamsId:s.resolve("unity_FogParams"),fogColorId:s.resolve("unity_FogColor"),fogStart:s.resolve("unity_FogStart"),fogEnd:s.resolve("unity_FogEnd"),indirectSpecularId:s.resolve("unity_IndirectSpecColor"),lightProbeIds:new Array(T.length),reflectionProbeIds:new Array(C.length),worldTransformParamsId:s.resolve("unity_WorldTransformParams"),roughness:s.resolve("unity_NHxRoughness")},this.lightIds={color:s.resolve("_LightColor0"),position:s.resolve("_WorldSpaceLightPos0"),vertexX:s.resolve("unity_4LightPosX0"),vertexY:s.resolve("unity_4LightPosY0"),vertexZ:s.resolve("unity_4LightPosZ0"),vertexAttenuation:s.resolve("unity_4LightAtten0"),vertexLightColors:s.resolve("unity_LightColor[0]"),vertexLightPositions:s.resolve("unity_LightPosition[0]"),attenuationTexture:s.resolve("_LightTexture0"),fallOffTexture:s.resolve("_LightTextureB0"),matrix:s.resolve(w("unity_WorldToLight",n))};for(let t=0;t<T.length;t++)this.unityIds.lightProbeIds[t]=s.resolve(T[t]);for(let t=0;t<C.length;t++)this.unityIds.reflectionProbeIds[t]=s.resolve(C[t]);this.fogColor=new Float32Array(4),this.fogParams=new Float32Array(4),this.ambientSky=new Float32Array(4),this.lightmodel_ambient=new Float32Array(4),this.removeShadows=!1,this.keywords=new pc.KeywordSet,Object.assign(this,pc.BuiltInForwardRenderer)}return Object.assign(L.prototype,{updateRenderState:function(t,e,i){const s=this.device;let n=P(0|e.culling.val);t._flipFaces&&(n===pc.CULLFACE_BACK?n=pc.CULLFACE_FRONT:n===pc.CULLFACE_FRONT&&(n=pc.CULLFACE_BACK)),s.setCullMode(n);const r=I(0|e.zTest.val),a=r>=0&&r<=7,o=e.zWrite.val>0;s.setBlending(!0),s.setDepthTest(a),a&&s.setDepthFunc(r),s.setDepthWrite(o);const h=e.offsetUnits.val,c=e.offsetFactor.val;if(h||c?(s.setDepthBias(!0),s.setDepthBiasValues(h,c)):s.setDepthBias(!1),this.setBlendFunctionAndEquation(e),(t._shaderDefs&pc.SHADERDEF_REVERT_STENCIL)>0){const e=t.stencilFront.ref,i=1===e;this.clearMaskStencil.func=i?pc.FUNC_ALWAYS:pc.FUNC_EQUAL,this.clearMaskStencil.zpass=i?pc.STENCILOP_ZERO:pc.STENCILOP_REPLACE,this.clearMaskStencil.ref=e>>1,this.clearMaskStencil.readMask=i?255:e>>1,this.clearMaskStencil.writeMask=i?255:e,s.applyStencilState(this.clearMaskStencil,this.clearMaskStencil,!0)}else{const i=this.isUiStencil(t),n=(t._shaderDefs&pc.SHADERDEF_STENCIL_OVERRIDE)===pc.SHADERDEF_STENCIL_OVERRIDE,r=R(e.stencilOp),a=R(e.stencilOpFront)||R(e.stencilOpBack);(i||n)&&t.stencilFront&&t.stencilBack?(t.node.element&&i&&(this._materialToStencilState(t.material,t.stencilFront),this._materialToStencilState(t.material,t.stencilBack)),s.applyStencilState(t.stencilFront,t.stencilBack,!0)):r?(this._renderStateToStencilState(e,e.stencilOp,S),t.stencilFront&&(S=t.stencilFront),s.applyStencilState(S,S,!0)):a?(this._renderStateToStencilState(e,e.stencilOpFront,S),this._renderStateToStencilState(e,e.stencilOpBack,x),s.applyStencilState(S,x,!0)):s.applyStencilState(null,null,!0)}let l=t.parameters.hasOwnProperty("_ColorMask")?t.parameters._ColorMask.data:e.colorWriteMask.val;(t._shaderDefs&pc.SHADERDEF_REVERT_STENCIL)>0&&(l=0);const u=(8&l)>0,d=(4&l)>0,_=(2&l)>0,p=(1&l)>0;s.setColorWrite(u,d,_,p),t.parameters.hasOwnProperty("UNITY_UI_ALPHACLIP")&&0!==t.parameters.UNITY_UI_ALPHACLIP.data&&i.enableKeyword("UNITY_UI_ALPHACLIP")},setBlendFunctionAndEquation(t){const e=F(0|t.blending.src.val),i=F(0|t.blending.dst.val),s=v(0|t.blending.op.val),n=F(0|t.alphaBlending.src.val),r=F(0|t.alphaBlending.dst.val),a=v(0|t.alphaBlending.op.val);this.device.setBlendFunctionSeparate(e,i,n,r),this.device.setBlendEquationSeparate(s,a)},isUiStencil:function(t){return!!(t.material.parameters._Stencil&&t.material.parameters._StencilOp&&t.material.parameters._StencilComp&&t.material.parameters._StencilReadMask&&t.material.parameters._StencilWriteMask&&t.material.parameters._ColorMask)},_renderStateToStencilState:function(t,e,i){i.func=I(0|e.comp.val),i.ref=0|t.stencilRef.val,i.readMask=0|t.stencilReadMask.val,i.writeMask=0|t.stencilWriteMask.val,i.fail=O(0|e.fail.val),i.zfail=O(0|e.zFail.val),i.zpass=O(0|e.pass.val)},_materialToStencilState:function(t,e){e.func=I(0|t.parameters._StencilComp.data),e.ref=0|t.parameters._Stencil.data,e.readMask=0|t.parameters._StencilReadMask.data,e.writeMask=0|t.parameters._StencilWriteMask.data,e.fail=O(0|t.parameters._StencilZFail),e.zfail=O(0|t.parameters._StencilZPass),e.zpass=O(0|t.parameters._StencilOp.data)},setCamera:function(t,a,o,h){const c=UnityEngine.Object.FromHandle(UnityEngine.Camera,t._component);UnityEngine.Camera.TriggerOnPreRender(c),UnityEngine.Canvas.TriggerWillRenderCanvases(),i.copy(t.viewMat),e.copy(t.viewInvMat),n.copy(t.projMat),r.copy(t.projInvMat),s.copy(t.viewProjMat),this.viewInvId.setValue(e.data),this.unityIds.invViewId.setValue(e.data),this.unityIds.viewId.setValue(i.data),this.unityIds.viewProjId.setValue(s.data),this.unityIds.legacyProjId.setValue(n.data),this.unityIds.cameraProjectionId.setValue(n.data),this.unityIds.cameraInvProjectionId.setValue(r.data);const l=t.projection===pc.PROJECTION_ORTHOGRAPHIC?t.frustum.unityPlanesOrthographic:t.frustum.unityPlanesPerspective;for(let t=0,e=0;t<l.length;t++,e+=4)g[e]=l[t][0],g[e+1]=l[t][1],g[e+2]=l[t][2],g[e+3]=l[t][3];this.unityIds.cameraWorldClipPlanesId.setValue(g);const d=t._node.getPosition();u[0]=d.x,u[1]=d.y,u[2]=d.z,u[3]=0,t._screenParams[0]=t.renderTarget?t.renderTarget.width:this.device.width,t._screenParams[1]=t.renderTarget?t.renderTarget.height:this.device.height,t._screenParams[2]=1+1/t._screenParams[0],t._screenParams[3]=1+1/t._screenParams[1],this.unityIds.worldSpaceCameraPos.setValue(u),this.unityIds.projectionParamsId.setValue(t._projectionParams),this.unityIds.cameraOrthoParamsId.setValue(t._orthoParams),this.unityIds.screenParamsId.setValue(t._screenParams),this.unityIds.zbufferParams.setValue(t._zbufferParams);const _=this.device;_.setRenderTarget(a),_.updateBegin();let p=t.getRect();const m=a?a.width:_.width,f=a?a.height:_.height;let y=Math.floor(p.x*m),E=Math.floor(p.y*f),A=Math.floor(p.width*m),T=Math.floor(p.height*f);_.setViewport(y,E,A,T),_.setScissor(y,E,A,T),o&&_.clear(t._clearOptions),p=t._scissorRect,y=Math.floor(p.x*m),E=Math.floor(p.y*f),A=Math.floor(p.width*m),T=Math.floor(p.height*f),_.setScissor(y,E,A,T),h&&_.setScissor(1,1,m-2,f-2),this.viewProjId.setValue(s.data),UnityEngine.Camera.TriggerOnPostRender(c)},dispatchGlobalLights:function(t){if(this.ambientSky=UnityEngine.RenderSettings.ambientSkyColor.data,this.lightmodel_ambient[0]=this.ambientSky[0]/2,this.lightmodel_ambient[1]=this.ambientSky[1]/2,this.lightmodel_ambient[2]=this.ambientSky[2]/2,this.lightmodel_ambient[3]=this.ambientSky[3]/2,this.unityIds.glstateLightModelAmbient.setValue(this.lightmodel_ambient),this.unityIds.ambientSky.setValue(this.ambientSky),this.unityIds.ambientEquator.setValue(UnityEngine.RenderSettings._ambientEquatorColor.data),this.unityIds.ambientGround.setValue(UnityEngine.RenderSettings._ambientGroundColor.data),t.skyboxHelper){const e=t.skyboxHelper.indirectSpecular;this.unityIds.indirectSpecularId.setValue(e.data)}this._ambientProbe=UnityEngine.RenderSettings.ambientProbe||D;const e=UnityEngine.LightmapSettings.reflectionProbes,i=e&&e.environmentProbe?e.environmentProbe:null;null!=i?(this.unityIds.reflectionProbeIds[0].setValue(i.cubemap),this.unityIds.reflectionProbeIds[1].setValue(b.min0),this.unityIds.reflectionProbeIds[2].setValue(b.max0),this.unityIds.reflectionProbeIds[3].setValue(b.position0),this.unityIds.reflectionProbeIds[4].setValue(i.cubemap),this.unityIds.reflectionProbeIds[5].setValue(b.min1),this.unityIds.reflectionProbeIds[6].setValue(b.max1),this.unityIds.reflectionProbeIds[7].setValue(b.position1)):(this.unityIds.reflectionProbeIds[0].setValue(null),this.unityIds.reflectionProbeIds[1].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[2].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[3].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[4].setValue(null),this.unityIds.reflectionProbeIds[5].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[6].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[7].setValue(pc.Vec4.ZERO.data))},updateCpuSkinMatrices:function(t,e){if(0===e)return;const i=pc.time.now();let s,n,r;for(let i=0;i<e;i++)if(s=t[i],r=s.skinInstance,r){r._dirty=!1;for(let t=0;t<r.bones.length&&(n=r.bones[t],!n||(r._dirty=n._aabbVer!==r.bonesAabbVersions[t],!r._dirty));t++);if(r._dirty){for(let t=0;t<r.bones.length;t++)r.bonesAabbVersions[t]=r.bones[t];const t=r.skin.rootBone||s.node;r.updateMatrices(t)}}this._skinTime+=pc.time.now()-i},updateGpuSkinMatrices:function(t,e,i){const s=pc.time.now();let n,r,a,o,h,c=!1;for(n=0;n<e;n++)if(a=t[n],c=!1,o=a.skinInstance,o&&o._dirty){if(h=o.skin,h.updateWhenOffscreen)c=!0;else{const t=o.skin.rootBone?o.skin.rootBone:a.node;for(r=0;r<i.length;r++)M.center=t.transformPoint(h.localBounds.center,M.center),M.halfExtents.copy(t.getLossyScale()),M.halfExtents.mul(h.localBounds.halfExtents),c=c||!!pc.Culling.isAABBVisibleInFrustum(i[r].frustum,M)}c&&(o.updateMatrixPalette(),o._dirty=!1)}this._skinTime+=pc.time.now()-s},updateMorphedBounds:function(t,e){const i=pc.time.now();let s,n;for(s=0;s<e;s++)n=t[s].morphInstance,n&&n._dirty&&n.updateBounds(t[s].mesh);this._morphTime+=pc.time.now()-i},updateMorphing:function(t,e){const i=pc.time.now();let s,n;for(s=0;s<e;s++)t[s].visibleThisFrame&&(n=t[s].morphInstance,n&&n._dirty&&(n.update(t[s].mesh),n._dirty=!1));this._morphTime+=pc.time.now()-i},setSkinning:function(t,e){e.skinInstance&&(t.supportsBoneTextures?(m=e.skinInstance.boneTexture,this.boneTextureId.setValue(m),p[0]=m.width,p[1]=m.height,this.boneTextureSizeId.setValue(p)):this.poseMatrixId.setValue(e.skinInstance.matrixPalette))},setMatrix:function(t,e){this.device.scope.resolve(w(t,this.needsMatrixVectorization)).setValue(e)},drawInstance:function(t,e,s,r,l){const u=t.shader.uniformsUsage;let p=e.node.worldTransform,m=e.node.worldTransformInverse;return e.skinInstance&&e.skinInstance.skin&&e.skinInstance.skin.rootBone&&(p=e.skinInstance.skin.rootBone.worldTransform,m=e.skinInstance.skin.rootBone.worldTransformInverse),e.parameters.localToWorldMatrix&&(p=d.set(e.parameters.localToWorldMatrix.data),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_WorldToObject)&&(m=e.parameters.worldToLocalMatrix?_.set(e.parameters.worldToLocalMatrix.data):_.copy(p).invert())),this.modelMatrixId.setValue(p.data),this.unityIds.modelMatrixId.setValue(p.data),this.unityIds.modelMatrixInvId.setValue(m.data),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixMVP)&&(a.copy(n),a.mul2(a,i),a.mul2(a,p),this.unityIds.modelViewProjId.setValue(a.data)),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixMV)&&(o.copy(i),o.mul2(o,p),this.unityIds.modelViewId.setValue(o.data)),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixTMV)&&(h.copy(o),h.transpose(),this.unityIds.transposeModelViewId.setValue(h.data)),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixITMV)&&(0==(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixTMV)&&(h.copy(o),h.transpose()),c.copy(h),c.invert(),this.unityIds.inverseTransposeModelViewId.setValue(c.data)),f=e.instancingData,f?(this._instancedDrawCalls++,this._removedByInstancing+=f.count,t.setVertexBuffer(f._buffer,1,f.offset),t.draw(s.primitive[r],f.count,e.material._shader.defaultParameters,e.constAttributes),f._buffer===pc._autoInstanceBuffer?(e.instancingData=null,f.count-1):0):(t.draw(s.primitive[r],null,e.material._shader.defaultParameters,e.constAttributes,e),0)},prepareAutoInstancing:function(t,e){const i=pc.time.now();pc._autoInstanceBuffer||this.setupInstancing(this.device);let s=0,n=0;const r=pc._autoInstanceBufferData;for(let i=0;i<e;i++){const a=i,o=t[i],h=o.material,c=o.mesh;if(!h||!c||!h.enableAutoInstancing)continue;if(null!==o.instancingData)continue;let l=0;for(l=i+1;l<e;l++){const e=t[l],i=e.material,s=e.mesh;if(i!==h||s!==c)break}if(l-a>1){for(o.instancingData={count:l-a,offset:4*s,_buffer:pc._autoInstanceBuffer},o._shaderDefs|=pc.SHADERDEF_INSTANCING,n=a;n<l;n++){const e=t[n].node.getWorldTransform().data;r.set(e,s),s+=16}i=l-1}else i=a,o._shaderDefs&=~pc.SHADERDEF_INSTANCING,o.instancingData=null}this._instancingTime+=(pc.time.now()-i)/1e3,pc._autoInstanceBuffer.unlock()},switchRenderingToScreenSpace:function(t){if(t!==this.renderingAsScreenSpace)if(this.renderingAsScreenSpace=t,t){const t=pc.Mat4.IDENTITY.data,e=this.device;y.setOrtho(0,e._width,0,e._height,-1e3,1e3),this.unityIds.viewId.pushValue(t),this.unityIds.legacyProjId.pushValue(y.data),this.viewProjId.pushValue(y.data),this.unityIds.viewProjId.pushValue(y.data)}else this.unityIds.viewId.popValue(),this.unityIds.legacyProjId.popValue(),this.viewProjId.popValue(),this.unityIds.viewProjId.popValue()},setupInstancing:function(t){if(!pc._instanceVertexFormat){const e=[{semantic:pc.SEMANTIC_TEXCOORD2,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD3,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD4,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD5,components:4,type:pc.TYPE_FLOAT32}];pc._instanceVertexFormat=new pc.VertexFormat(t,e)}pc._autoInstanceBuffer||(pc._autoInstanceBuffer=new pc.VertexBuffer(t,pc._instanceVertexFormat,t.autoInstancingMaxObjects,pc.BUFFER_DYNAMIC),pc._autoInstanceBufferData=new Float32Array(pc._autoInstanceBuffer.lock()))},clearTarget:function(t,e){window.spector&&window.spector.setMarker("Clear RT");const i=this.device,s=i.renderTarget;i.setRenderTarget(t),i.updateBegin(),i.setColorWrite(!0,!0,!0,!0),i.setDepthWrite(!0),this.setupViewport({x:0,y:0,width:1,height:1},t.width,t.height),this.device.clear(e),i.setRenderTarget(s)},clearView:function(t,e){window.spector&&window.spector.setMarker("Clear");const i=t.camera,s=i.renderTarget,n=this.device;n.setRenderTarget(s),n.updateBegin(),n.setColorWrite(!0,!0,!0,!0),n.setDepthWrite(!0);const r=i.getRect(),a=s?s.width:n.width,o=s?s.height:n.height;this.setupViewport(r,a,o),n.clear(e||i._clearOptions)},setupViewport:function(t,e,i){const s=this.device,n=Math.floor(t.x*e),r=Math.floor(t.y*i),a=Math.floor(t.width*e),o=Math.floor(t.height*i);s.setViewport(n,r,a,o),s.setScissor(n,r,a,o)},setSceneConstants:function(){const t=this.device,e=this.scene;this.keywords.copy(pc.UnityShader.globalKeywords),this.dispatchGlobalLights(e);const i=UnityEngine.RenderSettings;i.fog&&(l[2]=0,l[3]=0,i.fogMode===UnityEngine.FogMode.Exponential?this.keywords.enableKeywordId(pc.Keywords.FOG_EXP):i.fogMode===UnityEngine.FogMode.ExponentialSquared?this.keywords.enableKeywordId(pc.Keywords.FOG_EXP2):(this.keywords.enableKeywordId(pc.Keywords.FOG_LINEAR),l[2]=-1/(i.fogEndDistance-i.fogStartDistance),l[3]=i.fogEndDistance/(i.fogEndDistance-i.fogStartDistance)),l[0]=i.fogDensity/Math.sqrt(Math.log(2)),l[1]=i.fogDensity/Math.log(2),this.unityIds.fogParamsId.setValue(l)),this.unityIds.fogColorId.setValue(i.fogColor.data),E[0]=i.fogStartDistance,E[1]=i.fogStartDistance,E[2]=i.fogStartDistance,E[3]=i.fogStartDistance,A[0]=i.fogEndDistance,A[1]=i.fogEndDistance,A[2]=i.fogEndDistance,A[3]=i.fogEndDistance,this.unityIds.fogStart.setValue(E),this.unityIds.fogEnd.setValue(A);const s=UnityEngine.Time.time,n=UnityEngine.Time.deltaTime,r=UnityEngine.Time.smoothDeltaTime;this.unityIds.time.setValue([s/20,s,2*s,3*s]),this.unityIds.sinTime.setValue([Math.sin(s/8),Math.sin(s/4),Math.sin(s/2),Math.sin(s)]),this.unityIds.cosTime.setValue([Math.cos(s/8),Math.cos(s/4),Math.cos(s/2),Math.cos(s)]),this.unityIds.deltaTime.setValue([n,1/n,r,1/r]),this.unityIds.timeParameters.setValue([s,Math.sin(s),Math.cos(s),0]),UnityEngine.Texture2D.nhxRoughnessTexture&&this.unityIds.roughness.setValue(UnityEngine.Texture2D.nhxRoughnessTexture.handle);for(const e in pc.UnityShader.globalUniforms){if(!pc.UnityShader.globalUniforms.hasOwnProperty(e))continue;const i=pc.UnityShader.globalUniforms[e];i.scopeId=i.scopeId||t.scope.resolve(e),i.scopeId.setValue(i.value)}},renderComposition:function(){window.spector&&window.spector.clearMarker();const t=this.device,e=this.scene.getMeshInstances(),i=this.scene.meshInstancesCount;this.updateCpuSkinMatrices(e,i),this.updateMorphedBounds(e,i),this.setSceneConstants();const s=this.scene._cameras;s.sort(pc.SortUtils.cameraCompare),this.updateGpuSkinMatrices(e,i,s),this.updateMorphing(e,i);for(let t=0;t<s.length;t++)this.renderCamera(s[t]);const n=this.scene.overlayScreens;if(n.length>0){t.setRenderTarget(null),t.updateBegin();const e=[this.device.width,this.device.height,1+1/this.device.width,1+1/this.device.height];this.unityIds.screenParamsId.setValue(e),this.setupViewport({x:0,y:0,width:1,height:1},t.width,t.height),t.clear({flags:pc.CLEARFLAG_STENCIL}),this.switchRenderingToScreenSpace(!0);for(let t=0;t<n.length;t++){n[t].canvasMeshInstance.render(this.keywords,null,null,null,this.scene._lights)}this.switchRenderingToScreenSpace(!1)}},updateLights:function(t,e){const i=[];for(let s=0;s<e.length;s++){const n=e[s];n.update(t)&&i.push(n)}return i},setupWorldScreensVisibility:function(t,e){for(const i of t._worldScreens)i.screenType===pc.SCREEN_TYPE_CAMERA?i.canvasMeshInstance.visible=i.camera===e:i.canvasMeshInstance.visible=!0},renderCamera:function(t){const e=t.camera,i=t.camera.renderTarget,s=pc.Application.getApplication();t.frameBegin(i);const n=[];this.scene.skyboxHelper.updateSkyDrawCall(e),this.scene.skyboxHelper.setSkyboxEnabled((e._clearOptions.flags&pc.CLEARFLAG_USE_SKYBOX)>0),UnityEngine.Camera.TriggerOnPreCull(UnityEngine.Object.FromHandle(UnityEngine.Camera,e._component)),this.setupWorldScreensVisibility(this.scene,e);const r=this.scene.getMeshInstancesCached(),a=this.scene.meshInstancesCount;pc.Culling.cull(e,r,a,n),pc.SortUtils.calculateSortDistances(n,e._node.getPosition(),e._node.forward),n.sort(pc.SortUtils.genericSort);const o=this.updateLights(e,this.scene._lights);this.clearView(t),this.setCamera(e,e.renderTarget),s.counters.recordDrawCalls(n.length),this.renderForward(e,n,n.length,o),t.frameEnd()}}),{ForwardRenderer:L,reflectionProbeUniforms:C}}()),Object.assign(pc,function(){function t(){return!("undefined"==typeof AudioContext&&"undefined"==typeof webkitAudioContext)}const e=function(e){if(t()&&("undefined"!=typeof AudioContext?this.context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this.context=new webkitAudioContext),this.context)){const t=this.context;if(this.resumeContext=function(){this.context.resume(),window.removeEventListener("mousedown",this.resumeContext),window.removeEventListener("touchend",this.resumeContext)}.bind(this),window.addEventListener("mousedown",this.resumeContext),window.addEventListener("touchend",this.resumeContext),pc.platform.ios){const i=function(){const s=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=s,n.connect(t.destination),n.start(0),n.disconnect(),e.removeEventListener("touchstart",i)};e.addEventListener("touchstart",i)}}this._volume=1,this.suspended=!1,this.events=new pc.Events(this)};return e.hasAudio=function(){return"undefined"!=typeof Audio},e.hasAudioContext=t,Object.assign(e.prototype,{suspend:function(){this.suspended=!0,this.events.fire("suspend")},resume:function(){this.suspended=!1,this.events.fire("resume")}}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){t=pc.math.clamp(t,0,1),this._volume=t,this.events.fire("volumechange",t)}}),{SoundManager:e}}()),Object.assign(pc,function(){const t=function(t){t instanceof Audio?this.audio=t:this.buffer=t};return Object.defineProperty(t.prototype,"duration",{get:function(){let t=0;return this.buffer?t=this.buffer.duration:this.audio&&(t=this.audio.duration),t||0}}),{Sound:t}}()),Object.assign(pc,function(){let t;const e=function(t,e){return t%e||0};return pc.SoundManager.hasAudioContext()?(t=function(t,e){this.events=new pc.Events(this),this._volume=1,this._pitch=1,this._loop=!1,this._sound=e,this._state=2,this._suspended=!1,this._suspendEndEvent=!1,this._suspendInstanceEvents=!1,this._startTime=0,this._duration=0,this._startedAt=0,this._startOffset=null,this._currentTime=0,this._currentOffset=0,this._playWhenLoaded=!0,this._manager=t,this._inputNode=null,this._connectorNode=null,this._firstNode=null,this._lastNode=null,this._initializeNodes(),this._endedHandler=this._onEnded.bind(this),this.source=null},Object.assign(t.prototype,{_initializeNodes:function(){this.gain=this._manager.context.createGain(),this._inputNode=this.gain,this._connectorNode=this.gain,this._connectorNode.connect(this._manager.context.destination)},play:function(){"running"!==this._manager.context.state&&this._manager.context.resume(),2!==this._state&&this.stop(),this.source||this._createSource();let t=e(this._startOffset,this.duration);return t=e(this._startTime+t,this._sound.duration),this._startOffset=null,this._duration?this.source.start(0,t,this._duration):this.source.start(0,t),this._startedAt=this._manager.context.currentTime,this._currentTime=0,this._currentOffset=t,this._state=0,this._playWhenLoaded=!1,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._manager.events.on("volumechange",this._onManagerVolumeChange,this),this._manager.events.on("suspend",this._onManagerSuspend,this),this._manager.events.on("resume",this._onManagerResume,this),this._manager.suspended&&this._onManagerSuspend(),!0},pause:function(){return!(0!==this._state||!this.source)&&(this._updateCurrentTime(),this._state=1,this._suspendEndEvent=!0,this.source.stop(0),this.source=null,this._playWhenLoaded=!1,this._startOffset=null,!0)},resume:function(){if(1!==this._state)return!1;this.source||this._createSource();let t=this.currentTime;return null!==this._startOffset&&(t=e(this._startOffset,this.duration),t=e(this._startTime+t,this._sound.duration),this._startOffset=null),this._duration?this.source.start(0,t,this._duration):this.source.start(0,t),this._state=0,this._startedAt=this._manager.context.currentTime,this._currentOffset=t,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._playWhenLoaded=!1,!0},stop:function(){return!(2===this._state||!this.source)&&(this._manager.events.off("volumechange",this._onManagerVolumeChange),this._manager.events.off("suspend",this._onManagerSuspend),this._manager.events.off("resume",this._onManagerResume),this._startedAt=0,this._currentTime=0,this._currentOffset=0,this._startOffset=null,this._playWhenLoaded=!1,this._suspendEndEvent=!0,0===this._state&&this.source.stop(0),this.source.removeEventListener("ended",this._endedHandler),this.source=null,this._state=2,!0)},setExternalNodes:function(t,e){if(!t)return void console.error("The firstNode must be a valid Audio Node");e||(e=t);const i=this._manager.context.destination;this._firstNode!==t&&(this._firstNode?this._connectorNode.disconnect(this._firstNode):this._connectorNode.disconnect(i),this._firstNode=t,this._connectorNode.connect(t)),this._lastNode!==e&&(this._lastNode&&this._lastNode.disconnect(i),this._lastNode=e,this._lastNode.connect(i))},clearExternalNodes:function(){const t=this._manager.context.destination;this._firstNode&&(this._connectorNode.disconnect(this._firstNode),this._firstNode=null),this._lastNode&&(this._lastNode.disconnect(t),this._lastNode=null),this._connectorNode.connect(t)},getExternalNodes:function(){return[this._firstNode,this._lastNode]},_createSource:function(){if(!this._sound)return null;const t=this._manager.context;return this._sound.buffer&&(this.source=t.createBufferSource(),this.source.buffer=this._sound.buffer,this.source.connect(this._inputNode),this.source.onended=this._endedHandler,this.source.addEventListener("ended",this._endedHandler),this.source.loopStart=e(this._startTime,this.source.buffer.duration),this._duration&&(this.source.loopEnd=Math.max(this.source.loopStart,e(this._startTime+this._duration,this.source.buffer.duration)))),this.source},_updateCurrentTime:function(){this._currentTime=e((this._manager.context.currentTime-this._startedAt)*this._pitch+this._currentOffset,this.duration)}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){t=pc.math.clamp(t,0,1),this._volume=t,this.gain&&(this.gain.gain.value=t*this._manager.volume)}}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._currentOffset=this.currentTime,this._startedAt=this._manager.context.currentTime,this._pitch=Math.max(Number(t)||0,.01),this.source&&(this.source.playbackRate.value=this._pitch)}}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=!!t,this.source&&(this.source.loop=this._loop)}}),Object.defineProperty(t.prototype,"sound",{get:function(){return this._sound},set:function(t){this._sound=t,2!==this._state?this.stop():this._createSource()}}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return null!==this._startOffset?this._startOffset:1===this._state?this._currentTime:2!==this._state&&this.source?(this._updateCurrentTime(),this._currentTime):0},set:function(t){if(!(t<0))if(0===this._state){this.stop();const e=this._suspendInstanceEvents;this._suspendInstanceEvents=!0,this._startOffset=t,this.play(),this._suspendInstanceEvents=e}else this._startOffset=t,this._currentTime=t}})):pc.SoundManager.hasAudio()?(t=function(t,e,i){this.events=new pc.Events(this),i=i||{},this._volume=void 0!==i.volume?pc.math.clamp(Number(i.volume)||0,0,1):1,this._pitch=void 0!==i.pitch?Math.max(.01,Number(i.pitch)||0):1,this._loop=!(void 0===i.loop||!i.loop),this._sound=e,this._state=2,this._suspended=!1,this._suspendEndEvent=!1,this._suspendInstanceEvents=!1,this._playWhenLoaded=!0,this._startTime=Math.max(0,Number(i.startTime)||0),this._duration=Math.max(0,Number(i.duration)||0),this._startOffset=null,this._isReady=!1,this._manager=t,this._loadedMetadataHandler=this._onLoadedMetadata.bind(this),this._timeUpdateHandler=this._onTimeUpdate.bind(this),this._endedHandler=this._onEnded.bind(this),this._onPlayCallback=i.onPlay,this._onPauseCallback=i.onPause,this._onResumeCallback=i.onResume,this._onStopCallback=i.onStop,this._onEndCallback=i.onEnd,this.source=null,this._createSource()},Object.assign(t.prototype,{play:function(){return 2!==this._state&&this.stop(),!(!this.source&&!this._createSource())&&(this.volume=this._volume,this.pitch=this._pitch,this.loop=this._loop,this.source.play(),this._state=0,this._playWhenLoaded=!1,this._manager.events.on("volumechange",this._onManagerVolumeChange,this),this._manager.events.on("suspend",this._onManagerSuspend,this),this._manager.events.on("resume",this._onManagerResume,this),this._manager.suspended&&this._onManagerSuspend(),this._suspendInstanceEvents||this._onPlay(),!0)},pause:function(){return!(!this.source||0!==this._state)&&(this._suspendEndEvent=!0,this.source.pause(),this._playWhenLoaded=!1,this._state=1,this._startOffset=null,this._suspendInstanceEvents||this._onPause(),!0)},resume:function(){return!(!this.source||1!==this._state)&&(this._state=0,this._playWhenLoaded=!1,this.source.paused&&(this.source.play(),this._suspendInstanceEvents||this._onResume()),!0)},stop:function(){return!(!this.source||2===this._state)&&(this._manager.events.off("volumechange",this._onManagerVolumeChange),this._manager.events.off("suspend",this._onManagerSuspend),this._manager.events.off("resume",this._onManagerResume),this._suspendEndEvent=!0,this.source.pause(),this._playWhenLoaded=!1,this._state=2,this._startOffset=null,this._suspendInstanceEvents||this._onStop(),!0)},setExternalNodes:function(){},clearExternalNodes:function(){},getExternalNodes:function(){return[null,null]},_onLoadedMetadata:function(){this.source.removeEventListener("loadedmetadata",this._loadedMetadataHandler),this._isReady=!0;let t=e(this._startOffset,this.duration);t=e(this._startTime+t,this._sound.duration),this._startOffset=null,this.source.currentTime=t},_createSource:function(){return this._sound&&this._sound.audio&&(this._isReady=!1,this.source=this._sound.audio.cloneNode(!0),this.source.addEventListener("loadedmetadata",this._loadedMetadataHandler),this.source.addEventListener("timeupdate",this._timeUpdateHandler),this.source.onended=this._endedHandler),this.source},_onTimeUpdate:function(){this._duration&&this.source.currentTime>e(this._startTime+this._duration,this.source.duration)&&(this.loop?this.source.currentTime=e(this._startTime,this.source.duration):(this.source.removeEventListener("timeupdate",this._timeUpdateHandler),this.source.pause(),this._onEnded()))}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){t=pc.math.clamp(t,0,1),this._volume=t,this.source&&(this.source.volume=t*this._manager.volume)}}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch=Math.max(Number(t)||0,.01),this.source&&(this.source.playbackRate=this._pitch)}}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=!!t,this.source&&(this.source.loop=this._loop)}}),Object.defineProperty(t.prototype,"sound",{get:function(){return this._sound},set:function(t){this.stop(),this._sound=t}}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return null!==this._startOffset?this._startOffset:2!==this._state&&this.source?this.source.currentTime-this._startTime:0},set:function(t){t<0||(this._startOffset=t,this.source&&this._isReady&&(this.source.currentTime=e(this._startTime+e(t,this.duration),this._sound.duration),this._startOffset=null))}})):t=function(){},Object.assign(t.prototype,{_onPlay:function(){this._onPlayCallback&&this._onPlayCallback(this)},_onPause:function(){this._onPauseCallback&&this._onPauseCallback(this)},_onResume:function(){this.events.fire("resume"),this._onResumeCallback&&this._onResumeCallback(this)},_onStop:function(){this.events.fire("stop"),this._onStopCallback&&this._onStopCallback(this)},_onEnded:function(){pc.SoundInstance.doNotSuspendEndEvent||!this._suspendEndEvent?(this.events.fire("end"),this._onEndCallback&&this._onEndCallback(this),this.stop()):this._suspendEndEvent=!1},_onManagerVolumeChange:function(){this.volume=this._volume},_onManagerSuspend:function(){0!==this._state||this._suspended||(this._suspended=!0,this.pause())},_onManagerResume:function(){this._suspended&&(this._suspended=!1,this.resume())}}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(t){this._startTime=Math.max(0,Number(t)||0);const e=0===this._state;this.stop(),e&&this.play()}}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._sound?this._duration?e(this._duration,this._sound.duration):this._sound.duration:0},set:function(t){this._duration=Math.max(0,Number(t)||0);const e=0===this._state;this.stop(),e&&this.play()}}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return 0===this._state}}),Object.defineProperty(t.prototype,"isPaused",{get:function(){return 1===this._state}}),Object.defineProperty(t.prototype,"isStopped",{get:function(){return 2===this._state}}),Object.defineProperty(t.prototype,"isSuspended",{get:function(){return this._suspended}}),{SoundInstance:t}}()),Object.assign(pc,function(){const t=new pc.Vec4(0,0,1,1),e=new pc.Vec2;class i{constructor(){this.clearColor=new pc.Color(.722,.722,.722,1),this.clearColorBuffer=!0,this.clearDepthBuffer=!0,this.clearStencilBuffer=!0,this.clearSkybox=!0,this.nearClip=.1,this.farClip=1e3,this.fov=45,this.orthoHeight=100,this.projection=pc.PROJECTION_PERSPECTIVE,this.priority=0,this.rect=new pc.Vec4(0,0,1,1),this.enabled=!0,this.flipFaces=!1,this.camera=null,this.aspectRatio=16/9,this.aspectRatioMode=pc.ASPECT_AUTO,this.renderTarget=null,this.isRendering=!1,this.calculateTransform=null}}class s extends pc.Component{constructor(t,e){super(t,e),this.data=new i,this.events.on("set_aspectRatio",this.onSetAspectRatio,this),this.events.on("set_camera",this.onSetCamera,this),this.events.on("set_clearColor",this.onSetClearColor,this),this.events.on("set_fov",this.onSetFov,this),this.events.on("set_orthoHeight",this.onSetOrthoHeight,this),this.events.on("set_nearClip",this.onSetNearClip,this),this.events.on("set_farClip",this.onSetFarClip,this),this.events.on("set_projection",this.onSetProjection,this),this.events.on("set_clearColorBuffer",this.updateClearFlags,this),this.events.on("set_clearDepthBuffer",this.updateClearFlags,this),this.events.on("set_clearStencilBuffer",this.updateClearFlags,this),this.events.on("set_clearSkybox",this.updateClearFlags,this),this.events.on("set_renderTarget",this.onSetRenderTarget,this),this.events.on("set_rect",this.onSetRect,this),this.events.on("set_scissorRect",this.onSetScissorRect,this),this.events.on("set_horizontalFov",this.onSetHorizontalFov,this),this.events.on("set_calculateTransform",this.onSetCalculateTransform,this),this.events.on("set_cullingMask",this.onSetCullingMask,this),this.device=pc.Application.getApplication().graphicsDevice,this.layerCullDistancesActivated=!1,this.layerCullDistances=new Array(32).fill(0),this["__UnityEngine.Camera"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"CameraComponent")}screenToWorld(t,e,i,s){const n=this.system.app.graphicsDevice;return this.data.camera.screenToWorld(t,e,i,n.clientRect.width,n.clientRect.height,s)}worldToScreen(t,e){const i=this.system.app.graphicsDevice;return this.data.camera.worldToScreen(t,i.clientRect.width,i.clientRect.height,e)}onSetAspectRatio(t,e,i){this.data.camera.aspectRatio=i}onSetCamera(t,e,i){e&&(e._node=null),i._node=this.entity}onSetClearColor(t,e,i){const s=this.data.camera.clearColor;s[0]=i.r,s[1]=i.g,s[2]=i.b,s[3]=i.a}onSetFov(t,e,i){this.data.camera.fov=i}onSetCullingMask(t,e,i){this.data.camera.cullingMask=i}onSetOrthoHeight(t,e,i){this.data.camera.orthoHeight=i}onSetNearClip(t,e,i){this.data.camera.nearClip=i}onSetFarClip(t,e,i){this.data.camera.farClip=i}onSetHorizontalFov(t,e,i){this.data.camera.horizontalFov=i}onSetCalculateTransform(t,e,i){this.camera.calculateTransform=i,this.camera.overrideCalculateTransform=!!i}onSetProjection(t,e,i){this.data.camera.projection=i}addCameraToScene(){this.system.app.scene.addCamera(this)}removeCameraFromScene(){this.system.app.scene.removeCamera(this)}updateClearFlags(){let t=0;this.clearColorBuffer&&(t|=pc.CLEARFLAG_COLOR),this.clearDepthBuffer&&(t|=pc.CLEARFLAG_DEPTH),this.clearStencilBuffer&&(t|=pc.CLEARFLAG_STENCIL),this.clearSkybox&&(t|=pc.CLEARFLAG_USE_SKYBOX),this.data.camera.clearFlags=t}onSetRenderTarget(t,e,i){this.data.camera.renderTarget=i}onSetRect(t,e,i){this.data.camera.setRect(i.x,i.y,i.z,i.w)}onSetScissorRect(t,e,i){this.data.camera.setScissorRect(i.x,i.y,i.z,i.w)}onEnable(){this.system.addCamera(this),this.enabled&&this.entity.enabled&&this.addCameraToScene()}onDisable(){this.removeCameraFromScene(),this.system.removeCamera(this)}calculateAspectRatio(t){const e=t||this.system.app.graphicsDevice,i=this.rect;return e.width*i.z/(e.height*i.w)}frameBegin(t){this.aspectRatioMode===pc.ASPECT_AUTO&&(this.aspectRatio=this.calculateAspectRatio(t)),this.data.isRendering=!0}frameEnd(){this.data.isRendering=!1}resetProjectionMatrix(){this.camera.resetProjectionMatrix()}changeAspectRatio(t){this.aspectRatioMode=pc.ASPECT_MANUAL,this.aspectRatio=t}resetAspect(){this.aspectRatioMode=pc.ASPECT_AUTO}get clearColor(){return this.data.clearColor}set clearColor(t){const e=this.data.clearColor;this.data.clearColor=t,this.events.fire("set_clearColor","clearColor",e,t)}get clearDepthBuffer(){return this.data.clearDepthBuffer}set clearDepthBuffer(t){const e=this.data.clearDepthBuffer;this.data.clearDepthBuffer=t,this.events.fire("set_clearDepthBuffer","clearDepthBuffer",e,t)}get clearSkybox(){return this.data.clearSkybox}set clearSkybox(t){const e=this.data.clearSkybox;this.data.clearSkybox=t,this.events.fire("set_clearSkybox","clearSkybox",e,t)}get clearStencilBuffer(){return this.data.clearStencilBuffer}set clearStencilBuffer(t){const e=this.data.clearStencilBuffer;this.data.clearStencilBuffer=t,this.events.fire("set_clearStencilBuffer","clearStencilBuffer",e,t)}get projection(){return this.data.projection}set projection(t){const e=this.data.projection;this.data.projection=t,this.events.fire("set_projection","projection",e,t)}get fov(){return this.data.fov}set fov(t){const e=this.data.fov;this.data.fov=t,this.events.fire("set_fov","fov",e,t)}get orthoHeight(){return this.data.orthoHeight}set orthoHeight(t){const e=this.data.orthoHeight;this.data.orthoHeight=t,this.events.fire("set_orthoHeight","orthoHeight",e,t)}get nearClip(){return this.data.nearClip}set nearClip(t){const e=this.data.nearClip;this.data.nearClip=t,this.events.fire("set_nearClip","nearClip",e,t)}get farClip(){return this.data.farClip}set farClip(t){const e=this.data.farClip;this.data.farClip=t,this.events.fire("set_farClip","farClip",e,t)}get priority(){return this.data.priority}set priority(t){const e=this.data.priority;this.data.priority=t,this.events.fire("set_priority","priority",e,t)}get rect(){return this.data.rect}set rect(t){const e=this.data.rect;this.data.rect=t,this.events.fire("set_rect","rect",e,t)}get camera(){return this.data.camera}set camera(t){const e=this.data.camera;this.data.camera=t,this.events.fire("set_camera","camera",e,t)}get aspectRatio(){return this.data.aspectRatio}set aspectRatio(t){const e=this.data.aspectRatio;this.data.aspectRatio=t,this.events.fire("set_aspectRatio","aspectRatio",e,t)}get aspectRatioMode(){return this.data.aspectRatioMode}set aspectRatioMode(t){this.data.aspectRatioMode=t}get horizontalFov(){return this.data.horizontalFov}set horizontalFov(t){const e=this.data.horizontalFov;this.data.horizontalFov=t,this.events.fire("set_horizontalFov","horizontalFov",e,t)}get model(){return this.data.model}set model(t){const e=this.data.model;this.data.model=t,this.events.fire("set_model","model",e,t)}get renderTarget(){return this.data.renderTarget}set renderTarget(t){const e=this.data.renderTarget;this.data.renderTarget=t,this.events.fire("set_renderTarget","renderTarget",e,t)}get calculateTransform(){return this.data.calculateTransform}set calculateTransform(t){const e=this.data.calculateTransform;this.data.calculateTransform=t,this.events.fire("set_calculateTransform","calculateTransform",e,t)}get flipFaces(){return this.data.flipFaces}set flipFaces(t){const e=this.data.flipFaces;this.data.flipFaces=t,this.events.fire("set_flipFaces","flipFaces",e,t)}get layers(){return this.data.layers}set layers(t){const e=this.data.layers;this.data.layers=t,this.events.fire("set_layers","layers",e,t)}get cullingMask(){return this.data.cullingMask}set cullingMask(t){const e=this.data.cullingMask;this.data.cullingMask=t,this.events.fire("set_cullingMask","cullingMask",e,t)}get clearColorBuffer(){return this.data.clearColorBuffer}set clearColorBuffer(t){const e=this.data.clearColorBuffer;this.data.clearColorBuffer=t,this.events.fire("set_clearColorBuffer","clearColorBuffer",e,t)}get enabled(){return this.data.enabled}set enabled(t){const e=this.data.enabled;this.data.enabled=t,this.events.fire("set_enabled","enabled",e,t)}get projectionMatrix(){return this.data.camera.getProjectionMatrix()}set projectionMatrix(t){this.data.camera.setProjectionMatrix(t)}get viewMatrix(){return this.data.camera._node.getWorldTransform().clone().invert()}get frustum(){return this.data.camera.frustum}get node(){return this.data.camera._node}get unityRect(){return this.rect}set unityRect(t){this.rect=t}get unityPixelRect(){const i=this.renderTarget;return i?(e.x=i.width,e.y=i.height):(e.x=this.device.width,e.y=this.device.height),t.copy(this.rect),t.x*=e.x,t.y*=e.y,t.z*=e.x,t.w*=e.y,t}set unityPixelRect(t){const i=this.renderTarget;i?(e.x=i.width,e.y=i.height):(e.x=this.device.width,e.y=this.device.height),this.rect=new pc.Vec4(t.x/e.x,t.y/e.y,t.z/e.x,t.w/e.y)}}return{CameraComponent:s}}()),Object.assign(pc,function(){class t extends pc.ComponentSystem{constructor(t){super(t),this.id="camera",this.description="Renders the scene from the location of the Entity.",this.ComponentType=pc.CameraComponent,this.cameras=[],this.events.on("beforeremove",this.onBeforeRemove,this),this.events.on("remove",this.onRemove,this),pc.ComponentSystem.events.on("update",this.onUpdate,this)}initializeComponentData(t,e,i){const s={};for(let t=0,n=(i=["postEffects","enabled","model","camera","aspectRatio","aspectRatioMode","horizontalFov","renderTarget","clearColor","fov","orthoHeight","nearClip","farClip","projection","priority","clearColorBuffer","clearDepthBuffer","clearStencilBuffer","clearSkybox","rect","calculateTransform","flipFaces","layers","cullingMask"]).length;t<n;t++){const n=i[t];s[n]=e[n]}if(s.clearColor&&Array.isArray(s.clearColor)){const t=s.clearColor;s.clearColor=new pc.Color(t[0],t[1],t[2],t[3])}if(s.rect&&Array.isArray(s.rect)){const t=s.rect;s.rect=new pc.Vec4(t[0],t[1],t[2],t[3])}s.activate&&(console.warn("WARNING: activate: Property is deprecated. Set enabled property instead."),s.enabled=s.activate),s.camera=new pc.Camera,s._node=t.entity,s.camera._component=t;const n=t;s.camera.calculateTransform=function(t,e){return n._calculateTransform?n._calculateTransform(t,e):null},pc.ComponentSystem.prototype.initializeComponentData.call(this,t,s,i)}onBeforeRemove(t,e){this.removeCamera(e)}onRemove(t,e){e.camera=null}onUpdate(t){}addCamera(t){this.cameras.push(t),this.sortCamerasByPriority()}removeCamera(t){const e=this.cameras.indexOf(t);e>=0&&(this.cameras.splice(e,1),this.sortCamerasByPriority())}sortCamerasByPriority(){this.cameras.sort(((t,e)=>t.priority-e.priority))}}return{CameraComponentSystem:t}}()),Object.assign(pc,function(){class t{constructor(){this.enabled=!0,this.light=null,this.type="directional",this.color=new pc.Color(1,1,1),this.intensity=1,this.castShadows=!1,this.range=10,this.outerConeAngle=45,this.shadowType=pc.SHADOW_PCF3,this.cookie=null,this.cookieScale=null,this.mask=1,this.cullingMask=1,this.affectDynamic=!0,this.affectLightmapped=!1,this.isStatic=!1,this.renderMode=0}}class e extends pc.Component{constructor(e,i){super(e,i),this.data=new t,this["__UnityEngine.Light"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"LightComponent")}addLightToScene(){this.system.app.scene.addLight(this.light)}removeLightFromScene(){this.system.app.scene.removeLight(this.light)}refreshProperties(){let t;for(let e=0;e<i.length;e++)t=i[e],this[t]=this[t];this.enabled&&this.entity.enabled&&this.onEnable()}onEnable(){this.light.enabled=!0,this.enabled&&this.entity.enabled&&this.addLightToScene()}onDisable(){this.light.enabled=!1,this.removeLightFromScene()}}const i=[],s=[],n=function(t,n,r,a){const o=e.prototype;i.push(t),s.push(n),Object.defineProperty(o,t,{get:function(){return this.data[t]},set:function(e){const i=this.data,s=i[t];(a||s!==e)&&(i[t]=e,r&&r.call(this,e,s))},configurable:!0})};return n("enabled",!0,(function(t,e){this.onSetEnabled(null,e,t)})),n("light",null),n("type","directional",(function(t,e){this.system.changeType(this,e,t),this.refreshProperties()})),n("color",new pc.Color(1,1,1),(function(t,e){this.light.setColor(t)}),!0),n("intensity",1,(function(t,e){this.light.intensity=t})),n("castShadows",!1,(function(t,e){this.light.castShadows=t})),n("range",10,(function(t,e){this.light.attenuationEnd=t})),n("outerConeAngle",45,(function(t,e){this.light.outerConeAngle=t})),n("shadowType",pc.SHADOW_PCF3,(function(t,e){this.light.shadowType=t})),n("cookie",null,(function(t,e){t&&(t.minFilter=pc.FILTER_LINEAR),this.light.cookie=t})),n("cookieScale",null,(function(t,e){this.light.cookieScale=t}),!0),n("mask",1,(function(t,e){this.light.mask=t})),n("cullingMask",1,(function(t,e){this.light.cullingMask=t})),n("affectDynamic",!0,(function(t,e){t?this.light.mask|=pc.MASK_DYNAMIC:this.light.mask&=~pc.MASK_DYNAMIC,this.light.mask=this.light._mask})),n("affectLightmapped",!1,(function(t,e){t?this.light.mask|=pc.MASK_BAKED:this.light.mask&=~pc.MASK_BAKED,this.light.mask=this.light._mask})),n("isStatic",!1,(function(t,e){this.light.isStatic=t})),n("renderMode",0,(function(t,e){this.light.renderMode=t})),{LightComponent:e,_lightProps:i,_lightPropsDefault:s}}()),Object.assign(pc,function(){const t={directional:pc.LIGHTTYPE_DIRECTIONAL,point:pc.LIGHTTYPE_POINT,spot:pc.LIGHTTYPE_SPOT};class e extends pc.ComponentSystem{constructor(t){super(t),this.id="light",this.description="Enables the Entity to emit light.",this.ComponentType=pc.LightComponent}initializeComponentData(e,i){const s=pc._lightProps,n={};for(let t=0,e=s.length;t<e;t++){const e=s[t];n[e]=i[e]}n.type||(n.type=e.data.type),e.data.type=n.type,n.color&&Array.isArray(n.color)&&(n.color=new pc.Color(n.color[0],n.color[1],n.color[2]));const r=new pc.Light;r.type=t[n.type],r._node=e.entity,e.data.light=r,r.renderMode=i.renderMode,r.range=i.range,pc.ComponentSystem.prototype.initializeComponentData.call(this,e,n,s)}removeComponent(t){t.light.data.light.destroy(),pc.ComponentSystem.prototype.removeComponent.call(this,t)}changeType(e,i,s){i!==s&&(e.light.type=t[s])}}return{LightComponentSystem:e}}()),pc.extend(pc,function(){class t{constructor(){this.enabled=!0}}class e extends pc.Component{constructor(e,i){super(e,i),this.data=new t,this._resolution=new pc.Vec2(this.system.app.graphicsDevice.width,this.system.app.graphicsDevice.height),this._referenceResolution=new pc.Vec2(640,320),this._offset=new pc.Vec2(0,0),this._scaleMode=pc.ScreenComponent.SCALEMODE_NONE,this.scale=1,this._scaleBlend=.5,this._scaleFactor=1,this._planeHeight=0,this._camera=null,this._referencePixelsPerUnit=100,this._sortingLayerIndex=0,this._sortingOrder=0,this._screenType=pc.SCREEN_TYPE_SCREEN,this._screenDistance=1,this.parentScreen=null,this._isFallbackOverlay=!1,this.canvasMeshInstance=new pc.CanvasMeshInstance(this),this.registered=!1,this._rootPointerEventReceiver=!1,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"ScreenComponent")}_updateScreenInChildren(){for(let t=0;t<this.entity._children.length;t++){const e=this.entity._children[t].element;e&&e._updateScreen(e._findScreen(),!0)}this.syncDrawOrder()}syncDrawOrder(){const t=pc.Application.getApplication().systems.screen;t&&(t._dirtyOrder=!0)}_calcProjectionMatrix(){const t=this._screenType,e=this.camera;t===pc.SCREEN_TYPE_CAMERA&&e&&(e.projection===pc.PROJECTION_PERSPECTIVE?this._planeHeight=Math.tan(e.fov/2*(Math.PI/180))*Math.abs(2*this._screenDistance):this._planeHeight=2*e.orthoHeight),this.entity.element.dirtifyScreen()}_findParentScreen(){return pc.UIUtils.findParentScreen(this.entity.parent)}onRemove(){this.reparentChildrenToNewCanvas()}reparentChildrenToNewCanvas(){const t=pc.UIUtils.findParentScreen(this.entity.parent),e=this.canvasMeshInstance.renderers;for(let i=0;i<e.length;i++){e[i].reparentCanvas(t)}}_updateScale(){this.scale=this._calcScale(this._resolution,this.referenceResolution)}_calcScale(t,i){if(this._scaleMode===e.SCALEMODE_NONE)return this.scaleFactor;if(this._scaleMode===e.SCALEMODE_EXPAND)return Math.min(t.x/i.x,t.y/i.y);if(this._scaleMode===e.SCALEMODE_SHRINK)return Math.max(t.x/i.x,t.y/i.y);{const e=Math.log2(t.x/i.x),s=Math.log2(t.y/i.y),n=pc.math.lerp(e,s,this.scaleBlend);return Math.pow(2,n)}}_onResize(t,e,i,s){const n=this.camera;let r=i,a=s;n&&n.renderTarget&&(r=n.renderTarget.width,a=n.renderTarget.height),this._screenType!==pc.SCREEN_TYPE_WORLD&&(this._resolution.set(r,a),this.resolution=this._resolution),this.entity.element&&this.entity.element.triggerOnElementDimesionsChange(!0,!0)}_updateStencilRecursive(t,e){const i=t.element,s=!!i,n=s&&(i._image&&i._image.masksChildren||i._text&&i._text.masksChildren);s&&(i._masked=e.maskingDepth>0,n&&(e.maskingDepth++,e.ref=(1<<e.maskingDepth)-1),i.stencilLayer=e.ref);for(let i=0;i<t._children.length;i++)this._updateStencilRecursive(t._children[i],e);s&&n&&(e.maskingDepth--,e.ref=(1<<e.maskingDepth)-1)}_updateStencilParameters(){if(!this.entity)return;this._updateStencilRecursive(this.entity,{ref:0,maskingDepth:0})}addScreenToScene(){this.screenType!==pc.SCREEN_TYPE_SCREEN&&this.system.app.scene.addRenderer(this),this.system.app.graphicsDevice.events.on("resizecanvas",this._onResize,this),this.system.app.scene.addScreen(this);const t=this.entity.children;for(let e=0;e<t.length;e++)t[e].screen&&t[e].screen.addScreenToScene()}removeScreenFromScene(){this.screenType!==pc.SCREEN_TYPE_SCREEN&&this.system.app.scene.removeRenderer(this),this.system.app.graphicsDevice.events.off("resizecanvas",this._onResize,this),this.system.app.scene.removeScreen(this);const t=this.entity.children;for(let e=0;e<t.length;e++)t[e].screen&&t[e].screen.removeScreenFromScene()}onEnable(){this.registered=!0;const t=pc.UIUtils.findParentScreen(this.entity.parent);this.setParentScreen(t,!0);const e=this.system.app.graphicsDevice;this._onResize(e.width,e.height,e._width,e._height),this.notifyChildrenCanvasRenderers(this.entity.children)}notifyChildrenCanvasRenderers(t){for(let e=0;e<t.length;e++){const i=t[e];for(let t=0;t<i._canvasElements.length;t++){const e=i._canvasElements[t].canvasRenderer;e&&e.handle.updateParentCanvas()}this.notifyChildrenCanvasRenderers(i.children)}}onDisable(){this.setParentScreen(null,!1),this.registered=!1}onDestroy(){this.reparentChildrenToNewCanvas()}getMeshInstancesForRender(){return this.meshInstances}setParentScreen(t,e){e=!!e,this.registered&&this.removeScreenFromScene(),this.parentScreen=t,this.registered&&e&&this.addScreenToScene()}get enabled(){return this.data.enabled}set enabled(t){const e=this.data.enabled;this.data.enabled=t,this.events.fire("set_enabled","enabled",e,t)}get resolution(){return this._resolution}set resolution(t){const e=this.camera;e&&e.renderTarget||(this._screenType!==pc.SCREEN_TYPE_SCREEN?0!==t.x&&0!==t.y&&this._resolution.set(t.x,t.y):e&&e.renderTarget||this._resolution.set(this.system.app.graphicsDevice._width,this.system.app.graphicsDevice._height),this._scaleMode===pc.ScreenComponent.SCALEMODE_NONE&&this.referenceResolution.copy(this._resolution),this._updateScale(),this._calcProjectionMatrix(),this.events.fire("set:resolution",this._resolution))}get offset(){return this._offset}set offset(t){this._offset.set(t.x,t.y),this._calcProjectionMatrix()}get referenceResolution(){return this._scaleMode===pc.ScreenComponent.SCALEMODE_NONE?this._resolution:this._referenceResolution}set referenceResolution(t){this._referenceResolution.set(t.x,t.y),this._updateScale(),this._calcProjectionMatrix(),this.events.fire("set:referenceresolution",this._resolution)}get screenType(){return this.parentScreen?this.parentScreen.screenType:this._screenType}set screenType(t){if(this._screenType===t)return;this.registered&&this.enabled&&this.removeScreenFromScene(),this._screenType=t;const e=this.screenType;if(this._isFallbackOverlay=!1,e===pc.SCREEN_TYPE_CAMERA)if(this._camera){const t=this._camera._node.getPosition();this.entity.element.anchoredPosition.set(t.x,t.y)}else this._isFallbackOverlay=!0,this._screenType=pc.SCREEN_TYPE_SCREEN;e===pc.SCREEN_TYPE_SCREEN&&(this.canvasMeshInstance.visible=!0),this._resolution.set(this.system.app.graphicsDevice._width,this.system.app.graphicsDevice._height),this.resolution=this._resolution,this.events.fire("set:screentype",e),this.registered&&this.enabled&&this.addScreenToScene()}get screenDistance(){return this._screenDistance}set screenDistance(t){this._screenDistance=t,this._calcProjectionMatrix()}get scaleMode(){return this._scaleMode}set scaleMode(t){t!==pc.ScreenComponent.SCALEMODE_NONE&&t!==pc.ScreenComponent.SCALEMODE_BLEND&&t!==pc.ScreenComponent.SCALEMODE_EXPAND&&t!==pc.ScreenComponent.SCALEMODE_SHRINK&&(t=pc.ScreenComponent.SCALEMODE_NONE),this._screenType===pc.SCREEN_TYPE_WORLD&&t!==pc.ScreenComponent.SCALEMODE_NONE&&(t=pc.ScreenComponent.SCALEMODE_NONE),this._scaleMode=t,this.resolution=this._resolution,this.events.fire("set:scalemode",this._scaleMode)}get scaleBlend(){return this._scaleBlend}set scaleBlend(t){this._scaleBlend=t,this._updateScale(),this._calcProjectionMatrix(),this.events.fire("set:scaleblend",this._scaleBlend)}get camera(){return this.rootScreen._camera}set camera(t){this._camera=t,this._camera||this.screenType!==pc.SCREEN_TYPE_CAMERA||(this.screenType=pc.SCREEN_TYPE_SCREEN,this._isFallbackOverlay=!0),this._camera&&this._isFallbackOverlay&&(this.screenType=pc.SCREEN_TYPE_CAMERA),t&&null!=t.renderTarget&&this._resolution.set(t.renderTarget.width,t.renderTarget.height),this._calcProjectionMatrix()}get meshInstances(){return[this.canvasMeshInstance]}get referencePixelsPerUnit(){return this._referencePixelsPerUnit}set referencePixelsPerUnit(t){this._referencePixelsPerUnit=t,this.resolution=this._resolution}get rootScreen(){let t=this,e=this.entity;for(;e;)t=e.screen||t,e=e.parent;return t}get scaleFactor(){return this._scaleFactor}set scaleFactor(t){this._scaleFactor=t,this._updateScale(),this._calcProjectionMatrix()}get overrideSorting(){return this["__UnityEngine.Canvas"].overrideSorting}set overrideSorting(t){this._sortingOrder=t}get sortingOrder(){return!this.isNested||this["__UnityEngine.Canvas"].overrideSorting?this._sortingOrder:this.parentScreen.sortingOrder}set sortingOrder(t){this._sortingOrder=t}get sortingLayerIndex(){return!this.isNested||this["__UnityEngine.Canvas"].overrideSorting?this._sortingLayerIndex:this.parentScreen.sortingLayerIndex}set sortingLayerIndex(t){this._sortingLayerIndex=t}get isNested(){return null!=this.parentScreen}get drawOrder(){return this.entity.element.drawOrder}get isFallbackOverlay(){return this._isFallbackOverlay}set isFallbackOverlay(t){this._isFallbackOverlay=t}}return e.SCALEMODE_NONE="none",e.SCALEMODE_BLEND="blend",e.SCALEMODE_EXPAND="expand",e.SCALEMODE_SHRINK="shrink",{ScreenComponent:e}}()),Object.assign(pc,function(){const t=function(e,i){const s=e.element;if(s){const t=e._unityComponents.canvasRenderer[0];t&&(t._absoluteDepth=i),s.drawOrder=i++}const n=e._children;for(let e=0;e<n.length;e++)i=t(n[e],i);return i};class e extends pc.ComponentSystem{constructor(t){super(t),this.id="screen",this.app=t,this.ComponentType=pc.ScreenComponent,pc.ComponentSystem.events.on("update",this._onUpdate,this),this.events.on("beforeremove",this.onRemoveComponent,this)}initializeComponentData(t,e,i){void 0!==e.priority&&(t.priority=e.priority),void 0!==e.screenSpace&&(t.screenSpace=e.screenSpace),t.cull=t.screenSpace,void 0!==e.screenType&&(t.screenType=e.screenType),void 0!==e.scaleMode&&(t.scaleMode=e.scaleMode),void 0!==e.scaleBlend&&(t.scaleBlend=e.scaleBlend),void 0!==e.screenDistance&&(t.screenDistance=e.screenDistance),void 0!==e.layer&&(t.layer=e.layer),void 0!==e.drawOrder&&(t.drawOrder=e.drawOrder),void 0!==e.resolution&&(e.resolution instanceof pc.Vec2?t._resolution.copy(e.resolution):t._resolution.set(e.resolution[0],e.resolution[1]),t.resolution=t._resolution),void 0!==e.referenceResolution&&(e.referenceResolution instanceof pc.Vec2?t._referenceResolution.copy(e.referenceResolution):t._referenceResolution.set(e.referenceResolution[0],e.referenceResolution[1]),t.referenceResolution=t._referenceResolution),t.syncDrawOrder(),pc.ComponentSystem.prototype.initializeComponentData.call(this,t,e,i),t._updateScreenInChildren()}destroy(){this.events.off(),this.app.graphicsDevice.events.off("resizecanvas",this._onResize)}_syncDrawOrder(){t(pc.Application.getApplication().root,0)}_onUpdate(t){const e=this.store;this._dirtyOrder&&(this._syncDrawOrder(),this._dirtyOrder=!1);for(const i in e)e[i].entity.screen.update&&e[i].entity.screen.update(t)}onRemoveComponent(t,e){e.onRemove()}onDestroy(t,e){e.onRemove()}}return{ScreenComponentSystem:e}}()),Object.assign(pc,{UIUtils:{findParentScreen:function(t){let e=t,i=null;for(;e;){if(e.screen){i=e.screen;break}e=e.parent}return i}}}),pc.extend(pc,function(){pc.ELEMENTTYPE_GROUP="group",pc.ELEMENTTYPE_IMAGE="image",pc.ELEMENTTYPE_TEXT="text";const t=new pc.Vec4;class e{constructor(){this.enabled=!0}}class i extends pc.Component{constructor(t,i){super(t,i),this.data=new e,this._width=0,this._height=0,this._stencilLayer=255,this._anchors=new pc.Vec4,this._pivot=new pc.Vec2(.5,.5),this._sizeDelta=new pc.Vec2(0,0);const s=i.getLocalPosition();this._anchoredPosition=new pc.Vec2(s.x,s.y),this.entity.events.on("insert",this._onInsert,this),this._lastSyncAABBVersion=-1,this._dirtyScreen=!1,this._dirtyRect=!1,this.screen=null,this._type=pc.ELEMENTTYPE_GROUP,this._pivotPoint=new pc.Vec3,this._drawOrder=-1,this._masked=!1,this._image=null,this._text=null,this._group=null,this._localPositionAnimated=new pc.Vec3,this._dirtyAnimatedLocalPosition=!1,this._anchoredPositionAnimated=new pc.Vec3,this._dirtyAnimatedAnchoredPosition=!1,this._canvasGroups=[],this.cachedRect=new UnityEngine.Rect,this["__UnityEngine.UI.CanvasScaler"]=null,this["UnityEngine.UI.Graphic"]=null,this["UnityEngine.UI.Button"]=null,this["UnityEngine.UI.RawImage"]=null,this["UnityEngine.UI.Slider"]=null,this["UnityEngine.UI.Text"]=null,this["UnityEngine.UI.Image"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"ElementComponent")}dirtifyScreen(){if(!this._dirtyScreen){this.entity._app.scene.addDirty(this.entity),this._dirtyScreen=!0;for(const t of this.entity.children)t.element&&t.element.dirtifyRect()}}dirtifyRect(){if(!this._dirtyRect){this.entity._app.scene.addDirty(this.entity),this._dirtyRect=!0;for(const t of this.entity.children)t.element&&t.element.dirtifyRect()}}_getStencilParameters(){const t=this._masked?pc.FUNC_EQUAL:pc.FUNC_ALWAYS,e=this._image&&this._image.masksChildren||this._text&&this._text.masksChildren;return new pc.StencilParameters({func:t,ref:this._stencilLayer,writeMask:e?this._stencilLayer:0,readMask:e?this._stencilLayer>>1:this._stencilLayer,zfail:pc.STENCILOP_KEEP,zpass:pc.STENCILOP_REPLACE,fail:this._masked?pc.STENCILOP_KEEP:pc.STENCILOP_REPLACE})}_patch(){this.entity.flags|=pc.GraphNode.Flags.HijackedByElementComponent,this._lastSyncAABBVersion=-1,this.dirtifyRect()}_unpatch(){this.entity.flags&=~pc.GraphNode.Flags.HijackedByElementComponent}getRect(){const t=this._findParentElement();return t&&t.element.getRect(),this._dirtyRect&&this.entity._sync(),this.cachedRect.m_XMin=-this._pivotPoint.x,this.cachedRect.m_YMin=-this._pivotPoint.y,this.cachedRect.m_Width=this._width,this.cachedRect.m_Height=this._height,this.cachedRect.m_XMax=this.cachedRect.m_XMin+this._width,this.cachedRect.m_YMax=this.cachedRect.m_YMin+this._height,this.cachedRect}setVerticesDirty(){this._image&&this._image.setVerticesDirty(),this._text&&this._text.setVerticesDirty()}_onInsert(t){const e=this._findScreen();this._updateScreen(e),e&&!this.entity.isPrefab&&this.entity.getScene()&&this.triggerOnElementDimesionsChange(!0,!0)}_updateScreen(t,e){this.screen=this._findScreen(),this._patch(),this.events.fire("set:screen",this.screen),this.dirtifyRect(),this.dirtifyScreen(),this._updateScreenForNonElement(this.entity,t,e),this.screen&&!e&&this.screen.screen.syncDrawOrder()}_updateScreenForNonElement(t,e,i){const s=t.getChildren();for(let t=0,n=s.length;t<n;t++)s[t].element?s[t].element._updateScreen(e,i):this._updateScreenForNonElement(s[t],e,i)}_findScreen(){let t=this.entity,e=this.screen;for(this._nearestScreen=null;t;)this._nearestScreen=this._nearestScreen||t.screen,e=t.screen||e,t=t._parent;return e?e.entity:null}_findParentElement(){let t=this.entity._parent;for(;t&&!t.element;)t=t._parent;return t}_onScreenResize(t){this.dirtifyScreen(),this.events.fire("screen:set:resolution",t)}_onScreenTypeChange(){this.dirtifyScreen(),this.events.fire("screen:set:screentype",this.screen.screen.screenType)}addCanvasGroup(t,e){null==e?e=0:this.entity._canvasGroups.length>0&&e++,this._canvasGroups.splice(e,0,t);const i=this.entity.children;for(let s=0;s<i.length;s++){const n=i[s].element;n&&n.addCanvasGroup(t,e)}}removeCanvasGroup(t){const e=this._canvasGroups.indexOf(t);e>-1&&this._canvasGroups.splice(e,1);const i=this.entity.children;for(let e=0;e<i.length;e++){const s=i[e].element;s&&s.removeCanvasGroup(t)}}onRemove(){this.entity.events.off("insert",this._onInsert),this._unpatch(),this._image&&this._image.destroy(),this._text&&this._text.destroy()}triggerOnElementDimesionsChange(t,e){this.entity._elementDimesionsChange();const i=this.entity.children;for(let s=0;s<i.length;s++){if(!i[s]._activeSelf)continue;const n=i[s].element;if(n){const i=t&&n._anchors.x!==n._anchors.z,s=e&&n._anchors.y!==n._anchors.w;(i||s)&&n.triggerOnElementDimesionsChange(i,s)}}}setupParametersFromImage(t,e,i,s,n,r,a,o,h,c,l,u){const d=this._image;if(!d)return;const _=d._updateMesh;d._updateMesh=function(){},this["UnityEngine.UI.Image"]=t,d.sprite=e,d.spriteType=i,d.fillMethod=s,d.fillOrigin=n,d.fillAmount=r,d.fillCenter=a,d.pixelsPerUnitMultiplier=o,d.preserveAspect=h,d.ignoreMask=c,d.enabled=l,d.color=t.m_Color,d._updateMesh=_,d._updateMesh(),this.material=u}get enabled(){return this.data.enabled}set enabled(t){const e=this.data.enabled;this.data.enabled=t,this.events.fire("set_enabled","enabled",e,t)}get type(){return this._type}set type(t){t!==this._type&&(this._type=t,this._image&&(this._image.destroy(),this._image=null),this._text&&(this._text.destroy(),this._text=null),t===pc.ELEMENTTYPE_IMAGE?this._image=new pc.ImageElement(this):t===pc.ELEMENTTYPE_TEXT&&(this._text=new pc.TextElement(this)))}get drawOrder(){return this._drawOrder}set drawOrder(t){this._drawOrder!==t&&(this._drawOrder=t,this.events.fire("set:draworder",this._drawOrder))}get width(){return this._width}get height(){return this._height}get pivot(){return this._pivot}set pivot(t){t instanceof pc.Vec2?this._pivot.set(t.x,t.y):this._pivot.set(t[0],t[1]),this.dirtifyRect()}get anchor(){return this._anchors}set anchor(e){let i=e;if(i instanceof pc.Vec4||(i=t,i.set(i[0],i[1],i[2],i[3])),i.equals(this._anchors))return;const s=this._anchors.z-this._anchors.x!=i.z-i.x,n=this._anchors.w-this._anchors.y!=i.w-i.y;this._anchors.copy(i),this.dirtifyRect(),(s||n)&&this.triggerOnElementDimesionsChange(s,n)}get anchoredPosition(){return this._anchoredPosition}set anchoredPosition(t){this._anchoredPosition.copy(t),this.dirtifyRect()}get sizeDelta(){return this._sizeDelta}set sizeDelta(t){const e=this._sizeDelta.x!==t.x,i=this._sizeDelta.y!==t.y;(e||i)&&(this._sizeDelta.copy(t),this.dirtifyRect(),this.triggerOnElementDimesionsChange(e,i))}get rect(){return this.getRect()}get stencilLayer(){return this._stencilLayer}set stencilLayer(t){this._stencilLayer!==t&&(this._stencilLayer=t,this.events.fire("set:stencillayer",t))}}const s=function(t){Object.defineProperty(i.prototype,t,{get:function(){return this._text?this._text[t]:this._image?this._image[t]:null},set:function(e){this._text?this._text[t]=e:this._image&&(this._image[t]=e)}})};return s("fontSize"),s("color"),s("font"),s("fontAsset"),s("spacing"),s("lineHeight"),s("align"),s("verticalAlign"),s("text"),s("texture"),s("textureAsset"),s("material"),s("materialAsset"),s("opacity"),s("masksChildren"),s("showMaskGraphics"),s("alphaTest"),s("border"),{ElementComponent:i}}()),Object.assign(pc,function(){class t extends pc.ComponentSystem{constructor(t){super(t),this.id="element",this.app=t,this.ComponentType=pc.ElementComponent,this.events.on("beforeremove",this.onRemoveComponent,this)}destroy(){this._defaultTexture.destroy()}initializeComponentData(t,e,i){t._beingInitialized=!0,void 0!==e.anchor&&(e.anchor instanceof pc.Vec4?t._anchors.copy(e.anchor):t._anchors.set(e.anchor[0],e.anchor[1],e.anchor[2],e.anchor[3])),void 0!==e.pivot&&(e.pivot instanceof pc.Vec2?t._pivot.copy(e.pivot):t._pivot.set(e.pivot[0],e.pivot[1])),void 0!==e.sizeDelta&&(e.sizeDelta instanceof pc.Vec2?t._sizeDelta.copy(e.sizeDelta):t._sizeDelta.set(e.sizeDelta[0],e.sizeDelta[1])),void 0!==e.anchoredPosition&&(e.anchoredPosition instanceof pc.Vec2?t._anchoredPosition.copy(e.anchoredPosition):t._anchoredPosition.set(e.anchoredPosition[0],e.anchoredPosition[1]));const s=t._findScreen();s&&s.screen&&t._updateScreen(s.screen),pc.ComponentSystem.prototype.initializeComponentData.call(this,t,e,i),t._beingInitialized=!1,t.type===pc.ELEMENTTYPE_IMAGE&&t._image._meshDirty&&t._image._updateMesh(t._image.mesh)}onRemoveComponent(t,e){e.onRemove()}_onUpdate(t){const e=this.store;for(const i in e)e[i].entity.element.update&&e[i].entity.element.update(t)}}return{ElementComponentSystem:t}}()),pc.extend(pc,function(){let t=null,e=null,i=null,s=0;const n=new pc.Color,r=16,a=[0,1,2,0,2,3,0,3,4,0,4,5,0,5,6],o=[0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,4,5,9,9,8,4,5,6,10,10,9,5,6,7,11,11,10,6,8,9,13,13,12,8,9,10,14,14,13,9,10,11,15,15,14,10],h=[0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,4,5,9,9,8,4,6,7,11,11,10,6,8,9,13,13,12,8,9,10,14,14,13,9,10,11,15,15,14,10],c=[0,0,0,0];pc.extend(pc,{SPRITE_TYPE_SIMPLE:0,SPRITE_TYPE_SLICED:1,SPRITE_TYPE_TILED:2,SPRITE_TYPE_FILLED:3,FILL_METHOD_HORIZONTAL:0,FILL_METHOD_VERTICAL:1,FILL_METHOD_RADIAL90:2,FILL_METHOD_RADIAL180:3,FILL_METHOD_RADIAL360:4,FILL_ORIGIN_BOTTOM_LEFT:0,FILL_ORIGIN_TOP_RIGHT:1,FILL_ORIGIN_RADIAL_BOTTOM:0,FILL_ORIGIN_RADIAL_RIGHT:1,FILL_ORIGIN_RADIAL_TOP:2,FILL_ORIGIN_RADIAL_LEFT:3});const l=function(t){if(this._element=t,this._entity=t.entity,this._system=t.system,this._textureAsset=null,this._texture=null,this._materialAsset=null,this._material=null,this._masksChildren=!1,this._alphaTest=.01,this._ignoreMask=!1,this._showMaskGraphics=!0,this._enabled=!0,this._rect=new pc.Vec4(0,0,1,1),this._border=new pc.Vec4(0,0,0,0),this._color=new pc.Color(1,1,1,1),this._pivotPoint=new pc.Vec2,this._material=UnityEngine.Canvas.DefaultCanvasMaterial.handle,this._maskMaterial=UnityEngine.Canvas.DefaultCanvasMaterial.handle,this._positions=[],this._normals=[],this._uvs=[],this._indices=[],this._colors=[],this._canvasRenderer=this._entity._unityComponents.canvasRenderer[0],!this._canvasRenderer){const t=new pc.CanvasRendererComponent;this._entity.addUnityComponentFromDeserialization("canvasRenderer",t),this._canvasRenderer=this._entity._unityComponents.canvasRenderer[0]}this._mesh=this._createMesh(),this._model=this._canvasRenderer.model,this._model.setParameter("_TextureSampleAdd",c),this._canvasRenderer.setMesh(this._mesh),this._canvasRenderer.setMaterial(this._material,0),this._drawOrder=0,this._fillCenter=!0,this._fillMethod=0,this._spriteType=0,this._element.events.on("resize",this._onParentResize,this)};return pc.extend(l.prototype,{destroy:function(){this._canvasRenderer.setMesh(null),this._element.events.off("resize",this._onParentResizes),this._mesh&&(this._mesh.destroy(),this._mesh=null)},_onParentResize:function(){if(this._mesh){if(this._pivotPoint.equals(this._element._pivotPoint)&&this._width===this._element.width&&this._height===this._element.height)return;this._updateMesh(this._mesh),this._width=this._element.width,this._height=this._element.height,this._pivotPoint.copy(this._element._pivotPoint)}},setVerticesDirty:function(){this._mesh&&this._updateMesh(this._mesh)},_updateMaterial:function(){const t=this._material||UnityEngine.Canvas.DefaultCanvasMaterial.handle;this._canvasRenderer.setMaterial(t,0)},_imageIndexBuffer:function(){if(t)return t;t=new pc.IndexBuffer(this._system.app.graphicsDevice,pc.INDEXFORMAT_UINT16,o.length);return new Uint16Array(t.lock()).set(o),t.unlock(),t.preventDestroy=!0,t},_emptyCenterImageIndexBuffer:function(){if(e)return e;e=new pc.IndexBuffer(this._system.app.graphicsDevice,pc.INDEXFORMAT_UINT16,h.length);return new Uint16Array(e.lock()).set(h),e.unlock(),e.preventDestroy=!0,e},_imageRadialIndexBuffer:function(){if(i)return i;i=new pc.IndexBuffer(this._system.app.graphicsDevice,pc.INDEXFORMAT_UINT16,a.length);return new Uint16Array(i.lock()).set(a),i.unlock(),i.preventDestroy=!0,i},_createMesh:function(){if(this._entity.isPrefab)return null;const t=new pc.VertexFormat(this._system.app.graphicsDevice,[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_FLOAT32}],r);s=9,this._fillEdges=new pc.Vec4(0,0,1,1),this._buffer=new Float32Array(r*s);const e=new pc.VertexBuffer(this._system.app.graphicsDevice,t,r,pc.BUFFER_STATIC,this._buffer.buffer),i=new pc.Mesh(!0);return i.vertexBuffer=e,i.indexBuffer[0]=this._imageIndexBuffer(),i.primitive[0].type=pc.PRIMITIVE_TRIANGLES,i.primitive[0].base=0,i.primitive[0].count=o.length,i.primitive[0].indexed=!0,i.subMeshes=[i],i},_updateMesh:function(){null==this._texture&&(this._spriteType=pc.SPRITE_TYPE_SIMPLE),this._mesh?(this._spriteType===pc.SPRITE_TYPE_FILLED&&this._fillMethod===pc.FILL_METHOD_RADIAL360?(this._updateMeshRadial(),this._mesh.indexBuffer[0]=this._imageRadialIndexBuffer(),this._mesh.primitive[0].count=a.length):(this._updateMeshSquare(),this._fillCenter?(this._mesh.indexBuffer[0]=this._imageIndexBuffer(),this._mesh.primitive[0].count=o.length):(this._mesh.indexBuffer[0]=this._emptyCenterImageIndexBuffer(),this._mesh.primitive[0].count=h.length)),this._mesh.alphaCorrected=!1,this._canvasRenderer.setMesh(this._mesh)):this._canvasRenderer.setMesh(null)},_updateMeshSquare:function(){const t=this._element.width||0,e=this._element.height||0,i=new pc.Vec4(0,0,0,0),n=new pc.Vec2(0,0);this._calculatePaddings(t,e,i,n),this._spriteType===pc.SPRITE_TYPE_FILLED?(this._fillMethod===pc.FILL_METHOD_HORIZONTAL&&this._fillEdges.set(this._fillOrigin===pc.FILL_ORIGIN_BOTTOM_LEFT?0:1-this._fillAmount,0,this._fillOrigin===pc.FILL_ORIGIN_BOTTOM_LEFT?this._fillAmount:1,1),this._fillMethod===pc.FILL_METHOD_VERTICAL&&this._fillEdges.set(0,this._fillOrigin===pc.FILL_ORIGIN_BOTTOM_LEFT?0:1-this._fillAmount,1,this._fillOrigin===pc.FILL_ORIGIN_BOTTOM_LEFT?this._fillAmount:1)):this._fillEdges.set(0,0,1,1);let r=this._spriteType===pc.SPRITE_TYPE_SLICED||this._spriteType===pc.SPRITE_TYPE_TILED?1:0;this._sprite&&this._element.screen&&(r=r*this._element.screen.screen.referencePixelsPerUnit/this.multipliedPixelsPerUnit);const a=[i.x+t*this._fillEdges.x,i.x+t*this._fillEdges.x+Math.min(this._border.x*r,.5*t),i.x+(t-i.x-i.z)*this._fillEdges.z-Math.min(this._border.z*r,.5*t),i.x+(t-i.x-i.z)*this._fillEdges.z],o=[i.y+(e-i.y-i.w)*this._fillEdges.w,i.y+(e-i.y-i.w)*this._fillEdges.w-Math.min(this._border.w*r,.5*e),i.y+e*this._fillEdges.y+Math.min(this._border.y*r,.5*e),i.y+e*this._fillEdges.y],h=[pc.math.lerp(this._rect.x,this._rect.x+this._rect.z,this._fillEdges.x),pc.math.lerp(this._rect.x,this._rect.x+this._rect.z,this._fillEdges.x),pc.math.lerp(this._rect.x,this._rect.x+this._rect.z,this._fillEdges.z),pc.math.lerp(this._rect.x,this._rect.x+this._rect.z,this._fillEdges.z)],c=[pc.math.lerp(this._rect.y,this._rect.y+this._rect.w,this._fillEdges.w),pc.math.lerp(this._rect.y,this._rect.y+this._rect.w,this._fillEdges.w),pc.math.lerp(this._rect.y,this._rect.y+this._rect.w,this._fillEdges.y),pc.math.lerp(this._rect.y,this._rect.y+this._rect.w,this._fillEdges.y)];if(this._spriteType!==pc.SPRITE_TYPE_SLICED&&this._spriteType!==pc.SPRITE_TYPE_TILED||!this._texture)this._spriteType,pc.SPRITE_TYPE_TILED;else{if(h[1]+=this._border.x/this._texture.width,h[2]-=this._border.z/this._texture.width,a[1]>a[2]){const t=a[1];a[1]=a[2],a[2]=t}if(c[1]-=this._border.w/this._texture.height,c[2]+=this._border.y/this._texture.height,o[2]>o[1]){const t=o[1];o[1]=o[2],o[2]=t}}const l=this._mesh.vertexBuffer,u=this.color,d=new Float32Array(l.storage);for(let t=0;t<4;t++)for(let e=0;e<4;e++){let i=(4*t+e)*s;d[i++]=-this._element._pivotPoint.x+a[e],d[i++]=-this._element._pivotPoint.y+o[t],d[i++]=0,d[i++]=h[e],d[i++]=c[t],d[i++]=u.r,d[i++]=u.g,d[i++]=u.b,d[i++]=u.a}l.unlock()},_calculatePaddings:function(t,e,i,s){let n=t,r=e,a=1,o=1;if(this._texture&&(n=this._texture.width,r=this._texture.height),this._sprite){i.copy(this._sprite.transparency);const t=this._sprite.getTextureRect();n=t.z-t.x+i.x+i.z,r=t.w-t.y+i.y+i.w}if(t===n&&e===r||(a=t/n,o=e/r),s.x=t,s.y=e,this._preserveAspect&&this._spriteType!==pc.SPRITE_TYPE_SLICED&&this._spriteType!==pc.SPRITE_TYPE_TILED){const t=Math.min(a,o);s.x=t*n,s.y=t*r,i.scale(t)}else 1===a&&1===o||(i.x*=a,i.y*=o,i.z*=a,i.w*=o);return s.x===t&&s.y===e||i.add(new pc.Vec4((t-s.x)*this._element.pivot.x,(e-s.y)*this._element.pivot.y,(t-s.x)*(1-this._element.pivot.x),(e-s.y)*(1-this._element.pivot.y))),i},_updateMeshRadial:function(){const t=this._element.width||0,e=this._element.height||0,i=new pc.Vec4(0,0,0,0),n=new pc.Vec2(0,0);this._calculatePaddings(t,e,i,n);let a=360*this._fillAmount;const o=n.x/2,h=i.x+o,c=n.y/2,l=i.y+c,u=this._rect.z/2,d=this._rect.w/2,_=this._rect.x+u,p=this._rect.y+d,m=[h],f=[l],g=[_],y=[p];let E=0,A=0,T=!1;switch(this._fillOrigin){case pc.FILL_ORIGIN_RADIAL_BOTTOM:A=270;break;case pc.FILL_ORIGIN_RADIAL_RIGHT:A=0;break;case pc.FILL_ORIGIN_RADIAL_TOP:A=90;break;case pc.FILL_ORIGIN_RADIAL_LEFT:A=180}const C=this._element["UnityEngine.UI.Image"].m_FillClockwise?-1:1;let b=0,S=0;for(;a>0;){const t=Math.min(a,E);A+=C*t,A=(A+360)%360,A<=45||A>315?(m.push(h+o),g.push(_+u),S=Math.tan(A*pc.math.DEG_TO_RAD),f.push(l+c*S),y.push(p+d*S)):A<=135?(b=1/Math.tan(A*pc.math.DEG_TO_RAD),m.push(h+o*b),g.push(_+u*b),f.push(l+c),y.push(p+d)):A<=225?(m.push(h-o),g.push(_-u),S=-Math.tan(A*pc.math.DEG_TO_RAD),f.push(l+c*S),y.push(p+d*S)):A<=315&&(b=-1/Math.tan(A*pc.math.DEG_TO_RAD),m.push(h+o*b),g.push(_+u*b),f.push(l-c),y.push(p-d)),a-=t,T?E=90:(E=45,T=!0)}for(;m.length<r;)m.push(h);for(;f.length<r;)f.push(l);for(;g.length<r;)g.push(_);for(;y.length<r;)y.push(p);const x=this._mesh.vertexBuffer,D=this.color,M=new Float32Array(x.storage);for(let t=0;t<r;t++)M[t*s+0]=-this._element._pivotPoint.x+m[t],M[t*s+1]=-this._element._pivotPoint.y+f[t],M[t*s+2]=0,M[t*s+3]=g[t],M[t*s+4]=y[t],M[t*s+5]=D.r,M[t*s+6]=D.g,M[t*s+7]=D.b,M[t*s+8]=D.a;x.unlock()},synchornizeProperties:function(t,e){const i=t.m_OverrideSprite||t.m_Sprite,s=i?i.handle:null,r=e&&t.m_Texture?t.m_Texture.handle:null,a=e?this._texture!==r:this._sprite!==s,o=e&&(t.m_UVRect.m_XMin!==this._rect.x||t.m_UVRect.m_YMin!==this._rect.y||t.m_UVRect.m_Width!==this._rect.z||t.m_UVRect.m_Height!==this._rect.w);(this._fillCenter!==t.m_FillCenter||this._fillAmount!==t.m_FillAmount||this._fillMethod!==t.m_FillMethod||this._fillOrigin!==t.m_FillOrigin||a||o)&&(e&&this._texture!==r?this.texture=r:e||this._sprite===s||(this.sprite=s),o&&this._rect.set(t.m_UVRect.m_XMin,t.m_UVRect.m_YMin,t.m_UVRect.m_Width,t.m_UVRect.m_Height),e||(this._fillCenter=t.m_FillCenter,this._fillAmount=t.m_FillAmount,this._pixelsPerUnitMultiplier=t.m_PixelsPerUnitMultiplier,this._fillMethod=t.m_FillMethod,this._fillOrigin=t.m_FillOrigin),this._updateMesh()),n.copy(t.m_Color)}}),Object.defineProperty(l.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)}}),Object.defineProperty(l.prototype,"masksChildren",{get:function(){return this._masksChildren},set:function(t){this._masksChildren=t,this._canvasRenderer.model.masksChildren=t,this._element&&this._element.screen&&(this._element.screen.screen.canvasMeshInstance.renderersDirty=!0)}}),Object.defineProperty(l.prototype,"alphaTest",{get:function(){return this._alphaTest},set:function(t){this._alphaTest=t,this._updateMaterial()}}),Object.defineProperty(l.prototype,"opacity",{get:function(){return this._color.data[3]},set:function(t){this._color.a=t,this.color=this._color}}),Object.defineProperty(l.prototype,"rect",{get:function(){return this._rect},set:function(t){t instanceof pc.Vec4?this._rect.set(t.x,t.y,t.z,t.w):this._rect.set(t[0],t[1],t[2],t[3]),this._mesh&&this._updateMesh(this._mesh)}}),Object.defineProperty(l.prototype,"border",{get:function(){return this._border},set:function(t){t instanceof pc.Vec4?this._border.set(t.x,t.y,t.z,t.w):this._border.set(t[0],t[1],t[2],t[3]),this._mesh&&this._updateMesh(this._mesh)}}),Object.defineProperty(l.prototype,"material",{get:function(){return this._material},set:function(t){this._material=t,this._updateMaterial()}}),Object.defineProperty(l.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._canvasRenderer.setTexture(this._texture),this._mesh&&this._updateMesh(this._mesh)}}),Object.defineProperty(l.prototype,"ignoreMask",{get:function(){return this._ignoreMask},set:function(t){this._ignoreMask=t,t&&(this.alphaTest=0),this._updateMaterial()}}),Object.defineProperty(l.prototype,"showMaskGraphics",{get:function(){return this._showMaskGraphics},set:function(t){this._showMaskGraphics=t,this._canvasRenderer.showMaskGraphics=t,this._updateMaterial()}}),Object.defineProperty(l.prototype,"enabled",{get:function(){return this._enabled},set:function(t){if(this._enabled===t)return;this._enabled=t,this._canvasRenderer.enabled=t;const e=this._enabled?this._canvasRenderer.findParentCanvas():null;this._canvasRenderer.reparentCanvas(e)}}),Object.defineProperty(l.prototype,"sprite",{set:function(t){if(this._sprite=t,t){this._texture=t.texture,this._canvasRenderer.setTexture(this._texture);const e=t.uvRect;e instanceof pc.Vec4?this._rect.set(e.x,e.y,e.z,e.w):this._rect.set(e[0],e[1],e[2],e[3]);const i=this.spriteType===pc.SPRITE_TYPE_SIMPLE?pc.Vec4.ZERO:t.border;i instanceof pc.Vec4?this._border.set(i.x,i.y,i.z,i.w):this._border.set(i[0],i[1],i[2],i[3])}else this._texture=null,this._canvasRenderer.setTexture(this._texture);this._updateMesh()},get:function(){return this._sprite}}),Object.defineProperty(l.prototype,"spriteType",{set:function(t){this._spriteType=t,this.sprite=this._sprite},get:function(){return this._spriteType||pc.SPRITE_TYPE_SLICED}}),Object.defineProperty(l.prototype,"preserveAspect",{set:function(t){this._preserveAspect=t,this._updateMesh()},get:function(){return this._preserveAspect}}),Object.defineProperty(l.prototype,"fillMethod",{set:function(t){this._fillMethod=t,this._updateMesh()},get:function(){return this._fillMethod}}),Object.defineProperty(l.prototype,"fillCenter",{set:function(t){this._fillCenter=t,this._updateMesh()},get:function(){return this._fillCenter}}),Object.defineProperty(l.prototype,"fillOrigin",{set:function(t){this._fillOrigin=t,this._updateMesh()},get:function(){return this._fillOrigin}}),Object.defineProperty(l.prototype,"fillAmount",{set:function(t){this._fillAmount=t,this._updateMesh()},get:function(){return this._fillAmount}}),Object.defineProperty(l.prototype,"pixelsPerUnitMultiplier",{set:function(t){this._pixelsPerUnitMultiplier=t,this._updateMesh()},get:function(){return this._pixelsPerUnitMultiplier}}),Object.defineProperty(l.prototype,"multipliedPixelsPerUnit",{get:function(){return this._sprite.pixelsPerUnit*this._pixelsPerUnitMultiplier}}),{ImageElement:l}}()),pc.extend(pc,function(){const t=[1,1,1,0],e=new pc.Color,i=new pc.Vec3,s=function(e){if(this._element=e,this._system=e.system,this._entity=e.entity,this._text="",this._enabled=!0,this._horizontalWrap=!1,this._verticalOverflow=!1,this._align=pc.TEXT_ALIGN_CENTER,this._veticalAlign=pc.TEXT_VERTICAL_ALIGN_MIDDLE,this._fontAsset=null,this._font=null,this._color=new pc.Color(1,1,1,1),this._spacing=1,this._fontSize=32,this._lineHeight=1,this._bestFit=!1,this._minFontSize=0,this._maxFontSize=1e3,this.width=0,this.height=0,this._material=null,this._canvasRenderer=this._entity._unityComponents.canvasRenderer?this._entity._unityComponents.canvasRenderer[0]:null,!this._canvasRenderer){const t=new pc.CanvasRendererComponent;this._entity.addUnityComponentFromDeserialization("canvasRenderer",t),this._canvasRenderer=this._entity._unityComponents.canvasRenderer[0]}this._mesh=this._createMesh(""),this._model=this._canvasRenderer.model,this._model.setParameter("_TextureSampleAdd",t),this._canvasRenderer.setMesh(this._mesh),this._canvasRenderer.setMaterial(this._material,0),this._positions=[],this._normals=[],this._uvs=[],this._indices=[],this._spacings=new pc.Vec4(0,0,0,0),this._noResize=!1,this._masksChildren=!1};return pc.extend(s.prototype,{destroy:function(){this._canvasRenderer.setMesh(null),this._element.events.off("resize",this._onParentResize),this._mesh&&(this._mesh.destroy(),this._mesh=null)},_updateMaterial:function(){const t=this._material||UnityEngine.Canvas.DefaultCanvasMaterial.handle;this._canvasRenderer.setMaterial(t,0)},_createMesh:function(){if(this._entity.isPrefab)return null;this.bounds=new pc.Vec2,this._textOffsets=new pc.Vec3,this._textGenerator=new pc.TextGenerator(this.canvasRenderer),this._computedAlpha=1;const t=pc.TextGenerator.createEmptyMesh();return t.subMeshes=[t],t},_updateAligns:function(t){void 0!==this._element.width&&void 0!==this._element.height&&(t||(this.bounds.set(this._element.width,this._element.height),this._textGenerator.populate(this.text,this)),i.set(-this._element._pivotPoint.x,-this._element._pivotPoint.y,0).add(this._textGenerator.offset),this._textGenerator.updateMesh(this._mesh,this,i))},_updateMesh:function(t,e){if(this._entity.isPrefab)return;if(this._element._dirtyRect&&this._entity._sync(),!(0===this._element.width||0===this._element.height||this._element&&this._element.width&&this._element.height))return;this.bounds.set(this._element.width,this._element.height),this._textGenerator.populate(e,this);0!==this._textGenerator.vertexCount?(this._dirtyVertices&&this._textGenerator.updateMesh(this._mesh,this),this._dirtyOffset&&this._updateAligns(!0),(this._dirtyVertices||this._dirtyOffset)&&this._element.dirtifyRect(),t.alphaCorrected=!1,this._canvasRenderer.getMesh()||this._canvasRenderer.setMesh(t)):this._canvasRenderer.setMesh(null)},setVerticesDirty:function(){this._updateText(this._text)},_updateText:function(t){this._font&&(void 0===t&&(t=this._text),this._mesh||(this._updateMaterial(),this._mesh.alphaCorrected=!1,this._mesh=this._createMesh(t),this._canvasRenderer.setMesh(this._mesh)),this._updateMesh(this._mesh,t),this._canvasRenderer.setTexture(this._font.texture))},synchornizeProperties:function(t){e.copy(t.m_Color)}}),Object.defineProperty(s.prototype,"text",{get:function(){return this._text},set:function(t){const e=(t||"").toString();this._text!==e&&(this._font&&this._updateText(e),this._text=e)}}),Object.defineProperty(s.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)}}),Object.defineProperty(s.prototype,"opacity",{get:function(){return this._color.data[3]},set:function(t){this._color.a=t,this.color=this._color}}),Object.defineProperty(s.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight=t}}),Object.defineProperty(s.prototype,"lineSpacing",{get:function(){return this._spacing},set:function(t){this._spacing=t}}),Object.defineProperty(s.prototype,"align",{get:function(){return this._align},set:function(t){this._align=t}}),Object.defineProperty(s.prototype,"verticalAlign",{get:function(){return this._veticalAlign},set:function(t){this._veticalAlign=t}}),Object.defineProperty(s.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=t}}),Object.defineProperty(s.prototype,"horizontalWrap",{get:function(){return this._horizontalWrap},set:function(t){this._horizontalWrap=t}}),Object.defineProperty(s.prototype,"verticalOverflow",{get:function(){return this._verticalOverflow},set:function(t){this._verticalOverflow=t}}),Object.defineProperty(s.prototype,"font",{get:function(){return this._font},set:function(t){this._font=t}}),Object.defineProperty(s.prototype,"bestFit",{get:function(){return this._bestFit},set:function(t){this._bestFit=t}}),Object.defineProperty(s.prototype,"minFontSize",{get:function(){return this._minFontSize},set:function(t){this._minFontSize=t}}),Object.defineProperty(s.prototype,"maxFontSize",{get:function(){return this._maxFontSize},set:function(t){this._maxFontSize=t}}),Object.defineProperty(s.prototype,"enabled",{get:function(){return this._enabled},set:function(t){if(this._enabled===t)return;this._enabled=t,this._canvasRenderer.enabled=t,!this._enabled&&this._textGenerator&&this._textGenerator._reset();const e=this._enabled?this._canvasRenderer.findParentCanvas():null;this._canvasRenderer.reparentCanvas(e)}}),Object.defineProperty(s.prototype,"material",{get:function(){return this._material},set:function(t){this._material=t,this._updateMaterial()}}),Object.defineProperty(s.prototype,"masksChildren",{get:function(){return this._masksChildren},set:function(t){this._masksChildren=t;const e=this._canvasRenderer.model.meshInstances;for(let i=0;i<e.length;i++){const s=e[i];t?s._shaderDefs|=pc.SHADERDEF_UI_MASK:s._shaderDefs&=~pc.SHADERDEF_UI_MASK}this._element&&this._element.screen&&(this._element.screen.screen.canvasMeshInstance.renderersDirty=!0)}}),Object.defineProperty(s.prototype,"tintTexture",{set:function(t){this._tintTexture=t,this._updateText(this._text)},get:function(){return this._tintTexture}}),{TextElement:s,TEXT_ALIGN_LEFT:"left",TEXT_ALIGN_RIGHT:"right",TEXT_ALIGN_CENTER:"center",TEXT_VERTICAL_ALIGN_TOP:"top",TEXT_VERTICAL_ALIGN_MIDDLE:"middle",TEXT_VERTICAL_ALIGN_BOTTOM:"bottom"}}()),Object.assign(pc,function(){pc.FONT_MSDF="msdf",pc.FONT_BITMAP="bitmap";const t=function(t,e){this.type=t&&t.type||pc.FONT_MSDF,this.em=1,this.intensity=0,this._data=null,this.data=t,this._name=e.name||"",this._ascent=t.info.ascent||0,this._lineHeight=e.originalLineHeight||0,this._fontSize=t.info.fontSize||null,this._originalFontSize=e.originalFontSize||64,this._characterInfo=e.characterInfo||null,this._textures=e.texture||null};return Object.defineProperty(t.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(t.prototype,"ascent",{get:function(){return this._ascent}}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight}}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize}}),Object.defineProperty(t.prototype,"characterInfo",{get:function(){return this._characterInfo}}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._textures}}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){if(this._data=t,t&&(void 0!==this._data.intensity&&(this.intensity=this._data.intensity),this._data.info||(this._data.info={}),(!this._data.version||this._data.version<2)&&(this._data.info.maps=[{width:this._data.info.width,height:this._data.info.height}],this._data.chars)))for(const t in this._data.chars)this._data.chars.hasOwnProperty(t)&&(this._data.chars[t].map=0)}}),{FONT_MSDF:pc.FONT_MSDF,Font:t}}()),pc.extend(pc,function(){const t=new Set,e=0,i=1,s=2,n=3,r=function(t,i){this.id=t.keyId,this.curve=t,this.value=null,this._value=null,this.target=i,this.idx=null,this.interoplateType=e};r.prototype={set:function(t){this.dirty=this.dirty||t!==this._value||this.curve.targetsLocalEulerAnglesRaw,this._value=t,this.value=t}};const a=function(){this.keys={},this.keyArray=[],this.eventsMemo={},this.events=[],this.aQuat=new pc.Quat,this.bQuat=new pc.Quat,this.resultQuat=new pc.Quat,this.copiedFrom={},this.id=pc.guid.create()};return a.prototype={putKey:function(t){this.keys[t.id]=t,this.keyArray.push(t)},pushEvent:function(t){t.id=t.id||pc.guid.create(),this.eventsMemo[t.id]||(this.eventsMemo[t.id]=!0,this.events.push(t))},popEvents:function(){const t=this.events;return this.events=[],t},recycleEvents:function(){let t=-1;for(let e=0;e<this.events.length;e++)t=Math.max(t,this.events.time);return this.events=[],this.eventsMemo={},t},copyKeysFromSampler:function(t){for(let e=0;e<t.keyArray.length;e++){const i=t.keyArray[e];this.keys[i.id]||this.putKey(new r(i.curve,i.target))}this.copiedFrom[t.id]=!0,this.targetObjectsSet=!1},blendSamplers:function(t,r,a,o){this.copiedFrom[t.id]||this.copyKeysFromSampler(t),this.copiedFrom[a.id]||this.copyKeysFromSampler(a);const h=o/(r+o);if(!Number.isNaN(h))for(let r=0;r<this.keyArray.length;r++){const o=this.keyArray[r];if(t.keys[o.id])if(a.keys[o.id])switch(o.interoplateType===e&&(o.interoplateType=this.figureInterpolateType(o.curve,o)),o.interoplateType){case i:{const e=this.keyArray[r+0],i=this.keyArray[r+1],s=this.keyArray[r+2],n=this.keyArray[r+3];null==this.aQuat?this.resultQuat=this.bQuat:null==this.bQuat?this.resultQuat=this.aQuat:(this.aQuat.x=t.keys[e.id].value,this.aQuat.y=t.keys[i.id].value,this.aQuat.z=t.keys[s.id].value,this.aQuat.w=t.keys[n.id].value,this.bQuat.x=a.keys[e.id].value,this.bQuat.y=a.keys[i.id].value,this.bQuat.z=a.keys[s.id].value,this.bQuat.w=a.keys[n.id].value,this.resultQuat=this.resultQuat.slerp(this.aQuat,this.bQuat,h)),e.set(this.resultQuat.x),i.set(this.resultQuat.y),s.set(this.resultQuat.z),n.set(this.resultQuat.w),r+=3}break;case n:o.set(t.keys[o.id].value);break;case s:{let e=(1-h)*t.keys[o.id].value+h*a.keys[o.id].value;Object.is(e,-0)&&(e=0),o.set(e)}break;case e:console.log("Undefined")}else o.set(t.keys[o.id].value);else o.set(a.keys[o.id].value)}},figureInterpolateType:function(t,e){const r=e.curve.targetObject;return e.target&&null!=e.target[r]&&e.target[r].constructor===pc.Quat||"m_LocalRotation"===r?i:t.objectCurve?n:s},ensureTargetObjects:function(t){t.__defaults__=t.__defaults__||{};for(let e=0;e<this.keyArray.length;e++){const i=this.keyArray[e];if(i.target||(i.target=this.findTargetObject(t.handle,i.curve),i.interoplateType=this.figureInterpolateType(i.curve,i)),i.target&&!t.__defaults__.hasOwnProperty(i.id)){const e=new r(i.curve,i.target);if(i.curve.targetObject){if(!i.target[i.curve.targetObject])continue;i.curve.isMaterialPropertyCurve?this.setMaterialProperty(e,i):this.setObjectProperty(e,i)}else e.value=i.target[i.curve.targetProperty];t.__defaults__[e.id]=e}}this.targetObjectsSet=!0},findTargetObject:function(t,e){const i=e.path.split("/");for(let e=0;e<i.length&&null!=t;e++)i[e].length>0&&(t=t.findByNameImmediate(i[e]));if(null==t)return null;if("UnityEngine.GameObject"===e.componentType)return UnityEngine.Object.FromHandle(UnityEngine.GameObject,t);const s=Bridge._getTypeByName(e.componentType);return UnityEngine.Object.FromHandle(UnityEngine.GameObject,t).GetComponent(s)},setMaterialProperty:function(t,e){const i=e.target[e.curve.targetObject],s=e.curve.targetProperty,n=i.handle.parameters[s].data;e.curve.isVectorProperty?t.value=n[e.curve.vectorPropertyIndex]:t.value=n},setObjectProperty:function(t,e){t.value=e.target[e.curve.targetObject][e.curve.targetProperty]},applyKey:function(t){if(!t.target)return;let e=t.target[t.curve.targetObject];if(!e)return void(t.target[t.curve.targetProperty]=t.value);const i=t.curve.targetProperty;t.curve.isMaterialPropertyCurve?(e=t.target[t.curve.targetObject].handle.parameters,t.curve.isVectorProperty?(e[i].data[t.curve.vectorPropertyIndex]=t.value,e[i].scopeId&&e[i].scopeId.versionObject.increment()):e[i].data=t.value):e[t.curve.targetProperty]=t.value},getOrCreateKey(t,e){let i=this.keys[e];return i||(i=new r(t,void 0),this.putKey(i)),i},writeDefaults:function(t){if(t.__defaults__)for(const e in t.__defaults__){const i=t.__defaults__[e];this.applyKey(i);const s=i.target;s.OnDidApplyAnimationProperties&&s.OnDidApplyAnimationProperties(),s.entity&&s.entity.releaseHijackedProperties()}},apply:function(e){this.targetObjectsSet||this.ensureTargetObjects(e),t.clear();for(let e=0;e<this.keyArray.length;e++){const i=this.keyArray[e];i.dirty&&(i.dirty=!1,i.target&&i.curve.targetObject&&!i.target[i.curve.targetObject]?(console.warn(`AnimationKey issue: Target: ${i.target.name}, TargetObj: ${i&&i.target?i.target.$$fullname:"null"}, TargetField: ${i&&i.curve?i.curve.targetObject:"null"}`),this.keyArray.splice(e,1),e--):(i.target&&(i.target.OnDidApplyAnimationProperties||i.target.entity)&&t.add(i.target),this.applyKey(i)))}for(const e of t)e.OnDidApplyAnimationProperties&&e.OnDidApplyAnimationProperties(),e.entity&&e.entity.releaseHijackedProperties()}},{CurveSampler:a}}()),Bridge.assembly("LunaUnity",((t,e)=>{const i={};Bridge.define("LunaUnity.Objects.Bundle",{statics:{configure:function(t,e){this.objectSpace=t.objectSpace,this.network=t.network,this.bundles=e,this.handlers={game_object:new LunaUnity.Objects.Handlers.GameObject(t),audio_mixer:new LunaUnity.Objects.Handlers.AudioMixer(t),audio_mixer_snapshot:new LunaUnity.Objects.Handlers.AudioMixerSnapshot(t),project_settings:new LunaUnity.Objects.Handlers.ProjectSettings(t),material:new LunaUnity.Objects.Handlers.Material(t),physic_material:new LunaUnity.Objects.Handlers.PhysicMaterial(t),physics_material_2d:new LunaUnity.Objects.Handlers.PhysicsMaterial2D(t),mesh:new LunaUnity.Objects.Handlers.Mesh(t),scene:new LunaUnity.Objects.Handlers.Scene(t),shader:new LunaUnity.Objects.Handlers.Shader(t),video:new LunaUnity.Objects.Handlers.Video(t),sound:new LunaUnity.Objects.Handlers.Sound(t),sprite:new LunaUnity.Objects.Handlers.Sprite(t),texture:new LunaUnity.Objects.Handlers.Texture(t),cubemap:new LunaUnity.Objects.Handlers.Cubemap(t),animation_clip:new LunaUnity.Objects.Handlers.AnimationClip(t),blend_tree:new LunaUnity.Objects.Handlers.BlendTree(t),animator_controller:new LunaUnity.Objects.Handlers.AnimatorController(t),font:new LunaUnity.Objects.Handlers.Font(t),resources:new LunaUnity.Objects.Handlers.Resources(t),scriptable_object:new LunaUnity.Objects.Handlers.ScriptableObject(t),text_asset:new LunaUnity.Objects.Handlers.TextAsset(t),prefab_component:new LunaUnity.Objects.Handlers.PrefabComponent(t)}},tickResource:function(){this._resources=this._resources||0,this._resources++},loadAsync:function(t){return this.new(t)._loadAsync()},checkIsObjectAlreadyLoadedFromResources:function(t){return!t.isPrefabProxy},loadObject:function(t){const e=new LunaUnity.Objects.Request;return LunaUnity.Objects.Bundle.handlers.game_object.loadAsync(e,t.prefab,[],!0).result},loadByNameAsync:function(t){const e=Object.keys(this.bundles);for(let i=0;i<e.length;i++){if(this.bundles[e[i]].name===t)return this.loadAsync(e[i])}throw new System.FileNotFoundException},releaseByNameAsync:function(t){const e=Object.keys(this.bundles);for(let i=0;i<e.length;i++){const s=this.bundles[e[i]];if(s.name===t){const t=this._bundles[s.id];return t&&t._releaseBundleAndDependencies(),!0}}return!1},new:function(t){const e=this.bundles[t];return this._bundles=this._bundles||{},this._bundles[t]=this._bundles[t]||new LunaUnity.Objects.Bundle({manifest:e,objectSpace:this.objectSpace,network:this.network}),this._bundles[t]}},ctor:function(t){this.$initialize(),this.objectSpace=t.objectSpace,this.manifest=t.manifest,this.network=t.network,this.namesToId=i,this.refCount=0},_collectDependencies:function(t,e){let i=[];if(!t[e]){t[e]=!0,i.push(e);const s=LunaUnity.Objects.Bundle.bundles[e].dependencies;for(let e=0;e<s.length;e++)i=i.concat(this._collectDependencies(t,s[e]))}return i},_retain:function(){this.refCount++},_release:function(){if(this.refCount--,this.refCount>0)return;LunaUnity.Objects.Bundle._bundles[this.manifest.id]=null,console.log("Bundle "+this.manifest.name+" got refcount reduced to 0 and is about to free resources");const t=[{handler:"project_settings",json:"project-settings"},{handler:"texture",json:"textures"},{handler:"shader",json:"shaders"},{handler:"mesh",json:"meshes"},{handler:"video",json:"videos"},{handler:"sound",json:"sounds"},{handler:"animation_clip",json:"animation-clips"},{handler:"blend_tree",json:"blend-trees"},{handler:"text_asset",json:"text-assets"},{handler:"audio_mixer",json:"audio-mixers"},{handler:"physic_material",json:"physic-materials"},{handler:"physics_material_2d",json:"physics-materials-2d"},{handler:"audio_mixer_snapshot",json:"audio-mixer-snapshots"},{handler:"cubemap",json:"cubemaps"},{handler:"material",json:"materials"},{handler:"sprite",json:"sprites"},{handler:"font",json:"fonts"},{handler:"animator_controller",json:"animator-controllers"},{handler:"resources",json:"resources"},{handler:"scene",json:"scenes"},{handler:"scriptable_object",json:"scriptable-objects"},{handler:"game_object",json:"prefabs"}],e=this.json["scriptable-objects"];if(e)for(let t=0;t<e.length;t++){const i=this.objectSpace.registry.Get(e[t].id);i.CallOnDisable(),i.CallOnDestroy()}for(let e=0;e<t.length;e++){const i=LunaUnity.Objects.Bundle.handlers[t[e].handler],s=this.json[t[e].json];if(s)for(let t=0;t<s.length;t++)i.unloadAsync(s[t])}this.json=null},_retainBundleAndDependencies:function(){const t=this._collectDependencies({},this.manifest.id);for(let e=0;e<t.length;e++){LunaUnity.Objects.Bundle.new(t[e])._retain()}},_releaseBundleAndDependencies:function(){const t=this._collectDependencies({},this.manifest.id);for(let e=0;e<t.length;e++){LunaUnity.Objects.Bundle.new(t[e])._release()}},_loadAsync:function(){if(this._retainBundleAndDependencies(),this.loadCompletionSource)return this.loadCompletionSource.task;this.loadCompletionSource=new System.Threading.Tasks.TaskCompletionSource,this.loadCompletionSource.task.setSynchronous(!0);const t=this._collectDependencies({},this.manifest.id),e=[],i=[],s=new LunaUnity.Objects.Request;for(let s=0;s<t.length;s++){const n=LunaUnity.Objects.Bundle.new(t[s]);i.push(n),e.push(n._downloadBundleDataAsync(),n._downloadBlobDataAsync())}return System.Threading.Tasks.Task.whenAll(e).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cBundle chain loaded successfully","background-color: black; color: white; padding: 1em;"),this._loadSimpleAssetsAsync(s,i).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cSimple assets loaded successfully","background-color: black; color: white; padding: 1em;"),this._loadComplexAssetsAsync(s,i).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cComplex assets loaded successfully","background-color: black; color: white; padding: 1em;"),s.resolveReferences(this.objectSpace.registry),this._loadPrefabsAsync(s,i).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cPrefabs loaded successfully","background-color: black; color: white; padding: 1em;"),s.resolveReferences(this.objectSpace.registry),this._loadScenesAsync(s,i).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cScenes loaded successfully","background-color: black; color: white; padding: 1em;"),s.resolveReferences(this.objectSpace.registry),this.loadCompletionSource.setResult(this)})))})))})))})))}))),this.loadCompletionSource.task},_downloadBlobDataAsync:function(){return this.downloadBlobCompletionSource||(this.downloadBlobCompletionSource=new System.Threading.Tasks.TaskCompletionSource,this.network.GetBlobAsync("assets/bundles/"+this.manifest.id+"/data.blob").continueWith(Bridge.fn.bind(this,(function(t){this.blob=t.result,this.downloadBlobCompletionSource.setResult(this),LunaUnity.Objects.Bundle.tickResource()})))),this.downloadBlobCompletionSource.task},_downloadBundleDataAsync:function(t){return this.downloadCompletionSource||(this.downloadCompletionSource=new System.Threading.Tasks.TaskCompletionSource,this.network.GetJsonAsync("assets/bundles/"+this.manifest.id+"/bundle.json").continueWith(Bridge.fn.bind(this,(function(t){this.json=t.result,this.downloadCompletionSource.setResult(this),LunaUnity.Objects.Bundle.tickResource()})))),this.downloadCompletionSource.task},_loadSimpleAssetsAsync:function(t,e){return this._loadAssetsFromBundlesAsync(t,e,[{handler:"project_settings",json:"project-settings"},{handler:"texture",json:"textures"},{handler:"shader",json:"shaders"},{handler:"mesh",json:"meshes"},{handler:"video",json:"videos"},{handler:"sound",json:"sounds"},{handler:"animation_clip",json:"animation-clips"},{handler:"blend_tree",json:"blend-trees"},{handler:"text_asset",json:"text-assets"},{handler:"audio_mixer",json:"audio-mixers"},{handler:"physic_material",json:"physic-materials"},{handler:"physics_material_2d",json:"physics-materials-2d"},{handler:"audio_mixer_snapshot",json:"audio-mixer-snapshots"}])},_loadComplexAssetsAsync:function(t,e){return this._loadAssetsFromBundlesAsync(t,e,[{handler:"cubemap",json:"cubemaps"},{handler:"material",json:"materials"},{handler:"sprite",json:"sprites"},{handler:"font",json:"fonts"},{handler:"animator_controller",json:"animator-controllers"}])},_loadPrefabsAsync:function(t,e){let i=[],s=[];const n={};for(let t=0;t<e.length;t++){const r=e[t];n[r.manifest.id]=r,r._guardAssetType("prefabs",(()=>{i=i.concat(r.json.prefabs||[])})),r._guardAssetType("scriptable-objects",(()=>{s=s.concat(r.json["scriptable-objects"]||[])}))}const r=LunaUnity.Objects.Bundle.handlers.game_object,a=LunaUnity.Objects.Bundle.handlers.scriptable_object,o=LunaUnity.Objects.Bundle.handlers.project_settings,h=LunaUnity.Application.Instance.app.systems.list;for(let t=0;t<h.length;t++){h[t].creatingPrefabs=!0}for(let s=0;s<i.length;s++)r.loadAsync(t,i[s],e,o.autoInstantiatePrefabs).result;for(let t=0;t<h.length;t++){h[t].creatingPrefabs=!1}const c=[];for(let e=0;e<s.length;e++){const i=a.loadAsync(t,s[e]).result;c.push(i)}for(let t=0;t<c.length;t++){const e=c[t];e.CallAwake&&e.CallAwake(),e.CallOnEnable&&e.CallOnEnable()}return System.Threading.Tasks.Task.fromResult(!0)},_loadScenesAsync:function(t,e){return this._loadAssetsFromBundlesAsync(t,e,[{handler:"resources",json:"resources"},{handler:"scene",json:"scenes"}],!0)},_loadAssetsFromBundlesAsync:function(t,e,i,s){const n=[],r={};for(let s=0;s<i.length;s++){const a=i[s].handler,o=i[s].json,h=LunaUnity.Objects.Bundle.handlers[a];let c=[];for(let t=0;t<e.length;t++){const i=e[t];r[i.manifest.id]=i,i._guardAssetType(o,(()=>{c=c.concat(i.json[o]||[])}))}for(let i=0;i<c.length;i++){let s=c[i];window.playgroundBundlesOverrides&&(s=window.playgroundBundlesOverrides[s.id]||s);const o=h.loadAsync(t,s,e);"texture"!==a&&"sound"!==a&&"video"!==a||(n.push(o),o.continueWith((()=>{LunaUnity.Objects.Bundle.tickResource()}))),r[s.assetBundleId].namesToId[(s.name||"").toLowerCase()]=c[i].id||s.$id}}return System.Threading.Tasks.Task.whenAll(n)},_remove:function(){console.warn("Requested removal of asset bundle id = "+this.manifest.id+" - this is no-op for now")},_guardAssetType:function(t,e){this._guardAssetTypes=this._guardAssetTypes||{},this._guardAssetTypes[t]||e(),this._guardAssetTypes[t]=!0}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Scene",{ctor:function(){this.$initialize(),this.isLoaded=!1,this.index=-1,this.name=null,this.template=null,this.root=null,this.lightmapsOffset=-1},initializeAsTemplate:function(t){return this.rootJsons=t.rootJsons,this.renderSettings=t.renderSettings,this.name=t.name,this.index=t.index,this.lightmaps=t.lightmaps,this},_createRoot:function(){this.root=new pc.Entity,this.root.scene=this,this.root.name="SceneRoot: "+this.name,this.application.app.root.addChild(this.root)},initializeAsDontDestroyOnLoad:function(){this.name="DontDestroyOnLoad",this.application=window.$application,this.isLoaded=!0,this._createRoot()},isValid:function(){return!0},_load:function(t){return this.application=t,this.isLoaded=!0,this._createRoot(),UnityEngine.LightmapSettings.reflectionProbes||(UnityEngine.LightmapSettings.reflectionProbes=new UnityEngine.ReflectionProbes),this._installLightProbes(),this._installLightmaps(),1===UnityEngine.SceneManagement.SceneManager.sceneCount&&(window.$scene=this,this._applyRenderSettings(),this._updateEnvironmentLighting()),this.disableCallbacks(),this._loadObjects(),this.invokeCallbacks(this.root),this.root.syncHierarchy(),System.Threading.Tasks.Task.fromResult(!0)},loadAsync:function(){return this._load(window.$application)},unload:function(){this._unload()},_unload:function(){const t=this.root.children.slice();for(let e=0;e<t.length;e++)new pc.DestroyEntityTask(t[e],0).execute();this.root.destroy(),this.root=null,this.isLoaded=!1,this._uninstallLightProbes()},findChild:function(t,e){if(e.id===t)return e;{let i=null;for(let s=0;s<e.children.length&&(i=this.findChild(t,e.children[s]),!i);s++);return i}},_instantiate:function(t,e,i,s,n,r){const a=LunaUnity.Objects.Bundle.handlers.game_object.fork(),o=new LunaUnity.Objects.Request;let h;o.root=n||this.root;let c=!0;if(t.handle&&!t.handle.isPrefab){const i=t.gameObject.handle.$id;e.handle.$id===i?h=e.handle.objectJson:(e=e.handle.objectJson,h=this.findChild(i,e)),e=t.handle}else if(e.isPrefabProxy)h=e.prefab||a.registry.Get(e.prefabId).prefab;else if(h=(e=e.handle).objectJson,c=e.activeSelf,!h)throw new Error("Unable to instantiate a non-prefab object");this.disableCallbacks();const l=a.loadAsync(o,h).result;if(l.isPrefab=!1,l.name=(e.name||l.name)+"(Clone)",l.enabled=c,o.resolveReferences(a.registry),i&&s)l.muteTransformModificationCallback(),l.setRotation(s),l.setPosition(i),l.unmuteTransformModificationCallback();else if(r){l.muteTransformModificationCallback();const t=l.getLocalRotationAndScale();l.setRotation(l.getLocalRotation().clone()),l.setPosition(l.getLocalPosition().clone()),l.setWorldRotationAndScale(t),l.unmuteTransformModificationCallback()}this.invokeCallbacks(l);const u=a.registry.Get(e.isPrefabProxy?e.componentId||h.id:t.handle.$id);if(u.code)return u.code;if(e.isPrefabProxy)return UnityEngine.Object.FromHandle(t,u);if(Bridge.Reflection.isAssignableFrom(UnityEngine.Transform,Bridge.getType(t)))return UnityEngine.Object.FromHandle(UnityEngine.GameObject,u).gettransform();if("GameObject"===Bridge.Reflection.getTypeName(Bridge.getType(t)))return UnityEngine.Object.FromHandle(UnityEngine.GameObject,u);throw new Error("Don't know what should be instantiated")},_locatePrefabAsync:function(t,e){const i=LunaUnity.Objects.Bundle.loadByNameAsync(t),s=new System.Threading.Tasks.TaskCompletionSource;return i.continueWith(Bridge.fn.bind(this,(t=>{const i=t.result.json.prefabs.find((t=>t.data[0]===e)).id,n=LunaUnity.Objects.Bundle.handlers.game_object.objectSpace.registry,r=UnityEngine.Object.FromHandle(UnityEngine.GameObject,n.Get(i));s.setResult(r)}))),s.task},_releaseBundleAsync:function(t){LunaUnity.Objects.Bundle.releaseByNameAsync(t)},_applyRenderSettings:function(){const t=this.application.app,e=this.application.objectSpace.getRegistry(),i=UnityEngine.RenderSettings,s=this.renderSettings;t.scene.ambientLight=(new pc.Color).copy(s.ambientLight),i._ambientMode=s.ambientMode,i._pixelLightCount=s.pixelLightCount,i._ambientLight=s.ambientLight.clone(),i._ambientSkyColor=s.ambientSkyColor.clone(),i._ambientEquatorColor=s.ambientEquatorColor.clone(),i._ambientGroundColor=s.ambientGroundColor.clone(),i._ambientIntensity=s.ambientIntensity,i._reflectionIntensity=s.reflectionIntensity,i._defaultReflectionMode=s.defaultReflectionMode,i._defaultReflectionResolution=s.defaultReflectionResolution,i._sun=UnityEngine.Object.FromHandle(UnityEngine.Light,e.TryGet(s.sunLightObjectId)),i._skybox=s.skybox,i.fogDensity=s.fogDensity,i.fogColor=s.fogColor.clone(),i.fogStartDistance=s.fogStartDistance,i.fogEndDistance=s.fogEndDistance,i.fogMode=s.fogMode,i.fog=s.fog,i.hasLightDataAsset=s.hasLightDataAsset,i.hasManualGenerate=s.hasManualGenerate,i.ambientProbe.clear(),this._installSkybox(),i._customReflection=s.customReflection},_updateEnvironmentLighting:function(){const t=UnityEngine.RenderSettings,e=this.application.app;e.scene.skyboxHelper.update(),e.scene.skyboxHelper.environmentCubemap||t.defaultReflectionMode!==UnityEngine.Rendering.DefaultReflectionMode.Skybox&&t.defaultReflectionMode!==UnityEngine.Rendering.DefaultReflectionMode.Custom?(e.scene.skyboxHelper.computeIndirectSpecular(),e.scene.skyboxHelper.updateReflectionIntensity()):UnityEngine.DynamicGI.BakeReflectionsCubemap();const i=1!==t._ambientIntensity||t._ambientMode!==UnityEngine.Rendering.AmbientMode.Skybox||!t.skybox;t._ambientMode===UnityEngine.Rendering.AmbientMode.Skybox&&!t.hasLightDataAsset&&t.hasManualGenerate||(i?(UnityEngine.DynamicGI.BakeLightingCubemap(),UnityEngine.DynamicGI.UpdateEnvironmentLighting()):(UnityEngine.DynamicGI.UpdateEnvironmentLighting(!1),t.ambientProbe.copy(this.renderSettings.ambientProbe)))},_installSkybox:function(){const t=this.application.app;t.scene.skyboxHelper||(t.scene.skyboxHelper=new pc.Skybox(t),t.scene.skyboxHelper.install(t.scene),t.scene.skyboxHelper.environmentCubemap=this.renderSettings.defaultReflection?this.renderSettings.defaultReflection.handle:null)},_installLightmaps:function(){this.renderSettings.lightmaps&&0!==this.renderSettings.lightmaps.length&&(UnityEngine.LightmapSettings.lightmapsMode=this.renderSettings.lightmapsMode,UnityEngine.LightmapSettings.environmentLightingMode=this.renderSettings.environmentLightingMode,UnityEngine.LightmapSettings.manager.loadSceneLightmaps(this.index,this.renderSettings.lightmaps))},_installLightProbes:function(){if(UnityEngine.LightmapSettings.lightProbes||(UnityEngine.LightmapSettings.lightProbes=this.renderSettings.lightProbes),!this.renderSettings.lightProbes||!this.renderSettings.lightProbes.HasProbes)return;const t=UnityEngine.SceneManagement.SceneManager.currentLightProbeProvider;t&&t.index===this.index||(UnityEngine.LightmapSettings.lightProbes&&UnityEngine.LightmapSettings.lightProbes.HasProbes&&console.warn("Another scene with light probes was loaded. Previous light probes were unloaded."),UnityEngine.LightmapSettings.lightProbes=this.renderSettings.lightProbes),UnityEngine.SceneManagement.SceneManager.currentLightProbeProvider=this},_uninstallLightProbes:function(){if(UnityEngine.SceneManagement.SceneManager.currentLightProbeProvider!==this)return;const t=this.getClosestLoadedSceneMatch((t=>t._containsLightProbes()));t&&t._installLightProbes()},getClosestLoadedSceneMatch:function(t){const e=UnityEngine.SceneManagement.SceneManager,i=e.GetSceneIndex(this);if(i<0)return null;const s=e.loadedScenes._items,n=e.loadedScenes.Count;for(let e=i-1;e>=0;e--){const i=s[e];if(i&&i.isLoaded&&(!t||t(i)))return i}for(let e=i+1;e<n;e++){const i=s[e];if(i&&i.isLoaded&&(!t||t(i)))return i}return null},_containsLightProbes:function(){return this.renderSettings.lightProbes&&this.renderSettings.lightProbes.HasProbes},_loadObjects:function(){const t=LunaUnity.Objects.Bundle.handlers.game_object.fork(),e=new LunaUnity.Objects.Request;e.root=this.root;for(let i=0;i<this.rootJsons.length;i++)t.loadAsync(e,this.rootJsons[i]).result;e.resolveReferences(t.registry)},invokeCallbacks:function(t){this.application.app.systems.unitymanager.invokeCallbacks(t)},disableCallbacks:function(t){this.application.app.systems.unitymanager.disableCallbacks()},getRootGameObjects:function(){if(!this.root)return System.Array.init([],UnityEngine.GameObject);const t=this.root.children,e=t.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=UnityEngine.Object.FromHandle(UnityEngine.GameObject,t[s]);return System.Array.init(i,UnityEngine.GameObject)},createInstance:function(){const t=new LunaUnity.Objects.Scene;return t.template=this,t.index=this.index,t.name=this.name,t.rootJsons=this.rootJsons,t.renderSettings=this.renderSettings,t.lightmaps=this.lightmaps,t},setActive:function(t){t&&(this._applyRenderSettings(),this._updateEnvironmentLighting(),window.$scene=this)},addGameObjectToRoot:function(t){const e=t.handle;let i=null;if(null!=e.parent&&(i=e.parent.scene),i&&i===this)return;const s=e.getWorldTransform().clone();e.reparent(this.root,-1),e.setLocalTransform(s)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.LightmapManager",{ctor:function(t){this.$initialize(),this.lightmaps=[]},getLightmap:function(t,e){const i=this.lightmaps[t];return i?i.lightmaps[e]:null},loadSceneLightmaps:function(t,e){this.lightmaps[t]=this.lightmaps[t]||{},this.lightmaps[t].lightmaps=e,this.lightmaps[t].custom=!1},setManagedLightmaps:function(t){const e=UnityEngine.SceneManagement.SceneManager.loadedScenes._items;let i=0;const s=UnityEngine.SceneManagement.SceneManager.loadedScenes.Count;for(let n=0;n<s;n++){const r=e[n],a=this.lightmaps[r.index];if(a){const r=[];let o=a.lightmaps.length,h=!0;for(let t=n+1;t<s;t++)if(this.lightmaps[e[t]]){h=!1;break}h&&(o=t.length-i);for(let e=0;e<o;e++)r.push(new UnityEngine.LightmapData.$ctor1(t[i])),i++;a.custom=!0,a.lightmaps=r}}},getManagedLightmaps:function(){if(0===this.lightmaps.length)return System.Array.init([],UnityEngine.LightmapData);const t=[],e=UnityEngine.SceneManagement.SceneManager.loadedScenes._items,i=UnityEngine.SceneManagement.SceneManager.loadedScenes.Count;for(let s=0;s<i;s++){const i=e[s],n=this.lightmaps[i.index];if(n){const e=n.lightmaps;for(let i=0;i<e.length;i++)t.push(new UnityEngine.LightmapData.$ctor1(e[i]))}}return System.Array.init(t,UnityEngine.LightmapData)}})})),pc.extend(pc,function(){const t={size:"fontSize",color:"color",fontStyle:"fontStyle"},e={aqua:"#00ffffff",black:"#000000ff",blue:"#0000ffff",brown:"#a52a2aff",cyan:"#00ffffff",fuchsia:"#ff00ffff",green:"#008000ff",grey:"#808080ff",lightblue:"#add8e6ff",lime:"#00ff00ff",magenta:"#ff00ffff",maroon:"#800000ff",navy:"#000080ff",olive:"#808000ff",orange:"#ffa500ff",purple:"#800080ff",red:"#ff0000ff",silver:"#c0c0c0ff",teal:"#008080ff",white:"#ffffffff",yellow:"#ffff00ff"},i=function(t,e){this.startIndex=t,this.foundTag=e,this.isClosing=!1;const i=(e=e.substr(1,e.length-2)).split("=");let s=i[0];s=s.toLowerCase(),s.startsWith("/")&&(s=s.substr(1),this.isClosing=!0),this.tag=s;let n=i[1]?i[1]:null;if(n&&n.startsWith('"')&&n.endsWith('"')&&(n=n.substr(1,n.length-2)),n&&(n=n.toLowerCase()),this.value=n,this.isClosing)return this;if(this.colorValue=new pc.Color,this.intValue=0,!this.isClosing)switch(this.tag){case"color":this.colorValue=this.parseColor(this.value,this.colorValue);break;case"size":this.intValue=Number.parseInt(this.value,10)}return this};return pc.extend(i.prototype,{apply:function(e,i,s){const n=t[this.tag];if(this.isClosing)switch(this.tag){case"color":e.color.copy(i.color);break;case"size":e.fontSize=i.fontSize,e.fontScale=i.fontScale;break;default:e[n]=i[n]}else switch(this.tag){case"color":e.color.copy(this.colorValue);break;case"size":e.fontSize=this.intValue,e.fontScale=e.fontSize/s;break;default:e[n]=this.intValue}},parseColor:function(t,i){return i=i||new pc.Color,t.startsWith("#")||(t=e[t]),i.fromString(t),i}}),pc.extend(i,{tagRegex:/<.[^>]*>/gm,supportedSingleTags:{br:!0,quad:!0},unityColorsMap:e,removeTags:function(t){return t.replace(this.tagRegex,"")},extractTags:function(t,e){const i=e._tags;i.length=0;let s=0,n=null;for(;null!=(n=this.tagRegex.exec(t));){const t=n[0],e=new pc.TextTag(n.index-s,t);s+=t.length,i.push(e)}const r=this.removeTags(t),a=this.validateTags(i,r);return e.areTagsValid=a,t=a?r:t},validateTags:function(t,e){if(0===t.length)return!0;const i=[];for(let s=0;s<t.length;s++){const n=t[s];if(!pc.TextTag.supportedSingleTags[n.tag])if(n.isClosing){const t=i.pop();if(t.tag!==n.tag)return!1;n.content=e.substr(t.startIndex,n.startIndex-t.startIndex),t.content=e.substr(t.startIndex,n.startIndex-t.startIndex)}else i.push(n)}return 0===i.length}}),{TextTag:i}}()),pc.extend(pc,function(){const t=function(t,e,i,s,n){this.font=t,this.fontSize=e,this.fontScale=i,this.color=s.clone(),this.fontStyle=n};pc.extend(t.prototype,{init:function(t,e,i,s,n){this.font=t,this.fontSize=e,this.fontScale=i,this.color.copy(s),this.fontStyle=n},copy:function(t){this.font=t.font,this.fontSize=t.fontSize,this.fontScale=t.fontScale,this.color.copy(t.color),this.fontStyle=t.fontStyle}});const e=function(){return this.breakable={},this.breakable[" "]=10,this.breakable[","]=20,this.breakable[";"]=30,this.breakable["."]=40,this.breakable["\n"]=500,this};pc.extend(e.prototype,{cleanse:function(t){return t.replace(/\r\n/gm,"\n").replace(/\n\r/gm,"\n")},performWrap:function(t,e,i){let s="";t=this.cleanse(t);const n=Math.round(Math.sqrt(e*t.length/i)),r=Math.round(t.length/n);let a=r,o=0,h=0;for(let e=0;e<n-1;e++)h=o,o=this.bestBreak(t,a,2*r),s+=t.substring(h,o).trim()+"\n",a=o+r;return s+=t.substring(o),s},bestBreak:function(t,e,i){let s=e,n=0,r=0;for(let a=e-(i=Math.min(Math.min(e+i,t.length-1)-e,e-Math.max(e-i,0)));a<=e+i;a++){const i=this.breakable[t[a]];i&&(r=i/Math.abs(1*(e-a)),r>n&&(s=a,n=r))}return Math.min(s+1,t.length-1)}});return{EditableSettings:t,StringWrap:e,MeasuredLine:function(t,e,i){this.text=t,this.width=e,this.fontScale=i},UICharInfo:function(t,e){this.cursorPos=t||new pc.Vec3,this.charWidth=e||0},UILineInfo:function(t,e,i,s){this.startCharIdx=t||0,this.height=e||0,this.topY=i||0,this.leading=s||0}}}()),pc.extend(pc,function(){const t=11,e=[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD1,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_FLOAT32}],i=new pc.Vec4,s=new pc.Vec4,n=new pc.Vec4,r=function(t){return this._offset=new pc.Vec3,this._bakedOffset=new pc.Vec3,this._bounds=new pc.Vec2,this._metrics=new pc.Vec4,this.canvasRenderer=t,this._vertexCount=0,this._bufferSize=0,this._buffer=null,this._resizeBuffers(16),this._fontScale=0,this._bestFit=!1,this._font=null,this._maxFontSize=0,this._minFontSize=0,this._minFontSizeOriginal=0,this._maxFontSizeOriginal=0,this._horizontalWrap=!1,this._verticalOverflow=!1,this._lineHeight=0,this._lineSpacing=0,this._fontSize=0,this._textHeight=0,this._align=pc.TEXT_ALIGN_CENTER,this._color=new pc.Color(1,1,1,1),this._verticalAlign="top",this._text="",this._dirtyVertices=!1,this._dirtyOffset=!1,this._lineCount=0,this._characters=[],this._lines=[],this._tags=[],this.areTagsValid=!0,this._defaultSettings=new pc.EditableSettings(null,0,0,new pc.Color,0),this._currentSettings=new pc.EditableSettings(null,0,0,new pc.Color,0),this._measureSettings=new pc.EditableSettings(null,0,0,new pc.Color,0),this._recursiveCounter=0,this._measures=null,this._originalMeasures=null,this._recursiveLimit=10,this.graphicsDevice=pc.Application.getApplication().graphicsDevice,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"TextGenerator"),this};r.fontRatio=3.75;let a=null;return r.createEmptyMesh=function(){const t=pc.Application.getApplication().graphicsDevice,i=new pc.VertexFormat(t,e),s=new pc.VertexBuffer(t,i,0),n=new pc.Mesh(!0);return n.vertexBuffer=s,n.indexBuffer=[new pc.IndexBuffer(t,pc.INDEXFORMAT_UINT16,0)],n.primitive[0].type=pc.PRIMITIVE_TRIANGLES,n.primitive[0].base=0,n.primitive[0].count=0,n.primitive[0].indexed=!0,n},pc.extend(r.prototype,{_reset:function(){this._bufferSize=0,this._buffer=new Float32Array(0)},_textIndexBuffer:function(){if(a)return a;a=new pc.IndexBuffer(this.graphicsDevice,pc.INDEXFORMAT_UINT16,32768);const t=new Uint16Array(a.lock());let e=0;for(let i=0;i<32762;i+=6)t[i+0]=e+3,t[i+1]=e+0,t[i+2]=e+1,t[i+3]=e+1,t[i+4]=e+3,t[i+5]=e+2,e+=4;return a.unlock(),a.preventDestroy=!0,a},populate:function(t,e){e._font?(this._updateSettings(e),this._updateText(t),e._dirtyOffset=this._dirtyOffset,e._dirtyVertices=this._dirtyVertices,e._metrics=this._metrics,this._dirtyVertices&&this._fillMesh(),this._dirtyOffset&&this._updateAligns()):this.vertexCount=0},updateMesh:function(t,e,i){i=i||pc.Vec3.ZERO;const s=this._vertexCount,n=t.vertexBuffer;for(let t=0;t<s;t++)this._buffer[11*t+0]+=i.x-this._bakedOffset.x,this._buffer[11*t+1]+=i.y-this._bakedOffset.y,this._buffer[11*t+2]+=i.z-this._bakedOffset.z;for(let t=0;t<this._lines.length;t++){this._lines[t].topY+=i.y-this._bakedOffset.y}for(let t=0;t<this._characters.length;t++){this._characters[t].cursorPos.sub(this._bakedOffset).add(i)}n.numVertices=s,n.storage=this._buffer.buffer,n.unlock(),t.primitive[0].type=pc.PRIMITIVE_TRIANGLES,t.primitive[0].base=0,t.primitive[0].count=s/4*6,t.primitive[0].indexed=!0,t.indexBuffer[0]=this._textIndexBuffer(),this._bakedOffset.copy(i)},_updateAligns:function(t){t=t||this._measureText(this._text,void 0,!1);const e=this._font.data,i=this._lineHeight*this._fontScale,s=i+i/this._font.lineHeight*.5,n=Math.round(this._bounds.y/s),r=(this._verticalOverflow?t.length:Math.min(t.length,n>0?n:1))*s;let a=this._fontSize/e.info.fontSize;this._bestFit&&(a=this._minFontSize/e.info.fontSize);let o=-1;for(let e=0;e<t.length;e++)o=Math.max(t[e].width,o);this._metrics.set(Math.ceil(o/this._fontScale*a),Math.ceil(r/this._fontScale*a),Math.ceil(this._metrics.z),Math.ceil(this._metrics.w)),0===this._fontScale&&(this._metrics.x=0,this._metrics.y=0);const h=this._bounds.y;let c=0;switch(this._verticalAlign){case pc.TEXT_VERTICAL_ALIGN_BOTTOM:c=h-r;break;case pc.TEXT_VERTICAL_ALIGN_MIDDLE:c=.5*(h-r);break;case pc.TEXT_VERTICAL_ALIGN_TOP:c=0}const l=h-c-s;this._offset.set(0,l,0),this._dirtyOffset=!1},applyTags:function(t,e,i,s){if(this.areTagsValid)for(let n=0;n<this._tags.length;n++){const r=this._tags[n];t===r.startIndex&&r.apply(e,i,s)}},_fillMesh:function(){this._characters.length=0,this._lines.length=0;const t=this._font.data;let e=this._text;e=e.replace(/\r\n/gm,"\n").replace(/\n\r/gm,"\n"),e=e.replace(/\t/gm,"    "),e=pc.TextTag.extractTags(e,this),this._bakedOffset.set(0,0,0);const i=this._font.fontSize,s=this._fontSize,n=this._font._originalFontSize;this._lineHeight=this._lineSpacing*this._font.lineHeight*(i/n),this._fontScale=s/i,0===this._recursiveCounter&&(this._measures=this._measureText(e,1e15,!1));let r=-1,a=0;for(let t=0;t<this._measures.length;t++)r=Math.max(r,this._measures[t].width),a+=this._lineHeight*this._measures[t].fontScale;let o=Math.min(this._bounds.x/r,this._bounds.y/a),h=Math.min(this._maxFontSize,i*o);this._metrics.set(0,0,r,a);const c=this._bestFit&&!this._verticalOverflow;if(c&&this._bounds.x>0){this._metrics.set(0,0,r/this._fontSize*this._maxFontSize,a/this._fontSize*this._maxFontSize);const i=e.split("\n").length;if(0===this._recursiveCounter){o=this._bounds.y/(i*this._lineHeight),h=t.info.fontSize*o;const e=Math.max(Math.min(this._maxFontSize,h),this._minFontSize);this._fontScale=e/t.info.fontSize}}if(this._horizontalWrap){if(this._recursiveCounter>=this._recursiveLimit)return;if(this._measures=this._measureText(e,this._bounds.x,!0),this.measureAlignment(),this._recursiveCounter+=1,c){this._maxFontSize-this._minFontSize>.051&&this._fontSize<this._maxFontSize&&(this._recursiveCounter-1==0?this._fontSize=this._minFontSize:this._minFontSize=this._fontSize,this._fontSize+=Math.max((this._maxFontSize-this._fontSize)/2,.05),this._fontSize=Math.floor(20*Math.min(this._fontSize,this._maxFontSize)+.5)/20,this._fillMesh())}}else this._measureText(e,1e15,!0),this.measureAlignment()},measureAlignment(){let t=0,e=0;let r=0;this._defaultSettings.init(this._font,this._fontSize,this._fontScale,this._color,0),this._currentSettings.init(this._font,this._fontSize,this._fontScale,this._color,0);const a=this._font.data;let o=0,h=0,c=0;if(null!==this._measures){for(let l=0;l<this._measures.length;l++){const u=this._measures[l];switch(o=h,this._align){case pc.TEXT_ALIGN_LEFT:t=0;break;case pc.TEXT_ALIGN_CENTER:t=.5*(this._bounds.x-u.width);break;case pc.TEXT_ALIGN_RIGHT:t=this._bounds.x-u.width}const d=this._lineHeight*this._currentSettings.fontScale,_=d/this._font.lineHeight*.5;let p=-(e-d);l>0&&!this._bestFit&&(p-=_);let m=0!==this._bounds.y?this._bounds.y:0;if(p===d&&0!==m&&1===this._measures.length&&(m+=1),!this._verticalOverflow&&0!==this._bounds.y&&p>m){if(this._bestFit&&this._fontSize>this._minFontSizeOriginal&&(this._recursiveCounter>0||this._fontSize===this._maxFontSize)){if(this._maxFontSize=this._fontSize,this._fontSize-=Math.max((this._fontSize-this._minFontSize)/2,.05),this._fontSize=Math.floor(20*Math.max(this._fontSize,this._minFontSize)+.5)/20,this._recursiveCounter>=this._recursiveLimit)return;return void this._fillMesh()}0===l&&console.warn("[Rendering] Text will be hidden, as there are not enough space even for 1 line!\nSet BestFit or enable vertical overflow");continue}const f=d+_;e-=f-(this._lineHeight*this._measures[Math.max(l-1,0)].fontScale+_);for(let o=0;o<u.text.length;o++){this.applyTags(c,this._currentSettings,this._defaultSettings,a.info.fontSize);const l=u.text.charCodeAt(o);let d=0,_=0,p=0;const m=a.chars[l];if(!m)continue;d=m.xoffset*this._currentSettings.fontScale,_=m.yoffset*this._currentSettings.fontScale,p=m.xadvance*this._currentSettings.fontScale;const g=m.width*this._currentSettings.fontScale,y=m.height*this._currentSettings.fontScale,E=e+f,A=f;i.set(t+d,E-_-y,0),s.set(t+d+g,E-_,0),n.set(0,1-(_+y)/A,1,1-_/A),this.addCharToBuffer(r,i,s,m,n,this._currentSettings.color),this._characters.push(new pc.UICharInfo(new pc.Vec3(t+d,E-_-y,0).add(this._bakedOffset),g)),t+=p,r++,h++,c++}this._lines.push(new pc.UILineInfo(o,f,e+this._bakedOffset.y+f,0)),e-=f,this.applyTags(c,this._currentSettings,this._defaultSettings,a.info.fontSize),c++}this._vertexCount=4*r,this._dirtyVertices=!1,this._updateAligns(this._measures),this._lineCount=this._measures.length,this.canvasRenderer&&this.canvasRenderer.cacheColors(this.mesh)}},addCharToBuffer(e,i,s,n,r,a){const o=4*e,h=(o+0)*t,c=(o+1)*t,l=(o+2)*t,u=(o+3)*t;this._buffer[h]=i.x,this._buffer[h+1]=i.y,this._buffer[h+2]=i.z,this._buffer[h+3]=n.uvBottomLeft[0],this._buffer[h+4]=n.uvBottomLeft[1],this._buffer[h+5]=r.x,this._buffer[h+6]=r.y,this._buffer[h+7]=a.r,this._buffer[h+8]=a.g,this._buffer[h+9]=a.b,this._buffer[h+10]=a.a,this._buffer[c]=i.x,this._buffer[c+1]=s.y,this._buffer[c+2]=i.z,this._buffer[c+3]=n.uvTopLeft[0],this._buffer[c+4]=n.uvTopLeft[1],this._buffer[c+5]=r.x,this._buffer[c+6]=r.w,this._buffer[c+7]=a.r,this._buffer[c+8]=a.g,this._buffer[c+9]=a.b,this._buffer[c+10]=a.a,this._buffer[l]=s.x,this._buffer[l+1]=s.y,this._buffer[l+2]=i.z,this._buffer[l+3]=n.uvTopRight[0],this._buffer[l+4]=n.uvTopRight[1],this._buffer[l+5]=r.z,this._buffer[l+6]=r.w,this._buffer[l+7]=a.r,this._buffer[l+8]=a.g,this._buffer[l+9]=a.b,this._buffer[l+10]=a.a,this._buffer[u]=s.x,this._buffer[u+1]=i.y,this._buffer[u+2]=i.z,this._buffer[u+3]=n.uvBottomRight[0],this._buffer[u+4]=n.uvBottomRight[1],this._buffer[u+5]=r.z,this._buffer[u+6]=r.y,this._buffer[u+7]=a.r,this._buffer[u+8]=a.g,this._buffer[u+9]=a.b,this._buffer[u+10]=a.a},measureText:function(t,e,i){if(t=t||"",this._updateSettings(i),!this._font)return pc.Vec2.ZERO;const s=this._font.data;this._fontScale=this._fontSize/s.info.fontSize,t=pc.TextTag.removeTags(t);const n=this._measureText(t,e,!1);let r=-1;for(let t=0;t<n.length;t++)r=Math.max(r,n[t].width);const a=n.length*this._lineHeight*this._fontScale;return new pc.Vec2(r,a)},_measureText:function(t,e,i){const s=this._font.data,n=[],r=t.replace("\n\r","\n").replace("\r\n","\n").split(/\n/);let a="";const o=s.chars[" ".charCodeAt(0)];let h=o?o.xadvance*this._fontScale:0;this._defaultSettings.init(this._font,this._fontSize,this._fontScale,this._color,0),this._currentSettings.init(this._font,this._fontSize,this._fontScale,this._color,0),this._measureSettings.init(this._font,this._fontSize,this._fontScale,this._color,0);let c=0,l=0;const u={maxFontScale:0};this._measureSettings.copy(this._currentSettings);for(let t=0;t<r.length;t++){let d=r[t].split(" ");this._measureSettings.copy(this._currentSettings),d=this._checkBigWords(d,s,this._fontScale,e,c,this._measureSettings,this._defaultSettings,s.info.fontSize,i);let _=0;for(let t=0;t<d.length;t++){const i=d[t],r=this._calculateWidth(i,s,this._fontScale,c,this._currentSettings,this._defaultSettings,s.info.fontSize,u);_>0&&_+r>e&&(h=o?o.xadvance*this._currentSettings.fontScale:0,a=a.substring(0,a.length-1),_-=h,n.push(new pc.MeasuredLine(a,_,l)),l=0,a="",_=0,c++),l=Math.max(l,u.maxFontScale),c+=i.length,a+=i+" ",h=o?o.xadvance*this._currentSettings.fontScale:0,_+=r+h,this.applyTags(c,this._currentSettings,this._defaultSettings,s.info.fontSize),c++}a=a.substring(0,a.length-1),_-=h,n.push(new pc.MeasuredLine(a,_,l)),l=0,a="",_=0}return n},getMeasuredText:function(t){return t.map((t=>t.text)).join("\n")},_calculateWidth:function(t,e,i,s,n,r,a,o){let h=0;for(let i=0;i<t.length;i++){this.applyTags(s,n,r,a),o&&(o.maxFontScale=Math.max(o.maxFontScale,n.fontScale));const c=t.charCodeAt(i),l=e.chars[c];l&&(h+=l.xadvance*n.fontScale),s++}return 0===t.length&&o&&(o.maxFontScale=i),h},_splitWord:function(t,e,i,s){const n=[];let r=0,a=0;for(;a<t.length;){const o=t.charCodeAt(a),h=e.chars[o],c=(h?h.xadvance:0)*i;if(h){if(r>0&&r+c>=s){const e=t.substring(0,a);t=t.substring(a),r=c,a=1,n.push(e);continue}r+=c}a++}return n.push(t),n},_checkBigWords:function(t,e,i,s,n,r,a,o,h){const c=[];for(let l=0;l<t.length;l++){const u=t[l];if(this._calculateWidth(u,e,i,n,r,a,o)>s){const t=this._splitWord(u,e,i,s);for(let e=0;e<t.length;e++)c.push(t[e]),n+=t[e].length,h&&e!==t.length-1&&this.applyTagsOffsets(n,1)}else c.push(u)}return c},applyTagsOffsets(t,e){for(let i=0;i<this._tags.length;i++){const s=this._tags[i];s.startIndex<t||(s.startIndex+=e)}},_updateText:function(t){this._text!==t&&(this._dirtyVertices=!0,this._dirtyOffset=!0),this._text=t,this._resizeBuffers(t.length)},_updateSettings:function(t){this._verticalAlign!==t.verticalAlign&&(this._dirtyOffset=!0),this._fontSize===t.fontSize&&this._bestFit===t.bestFit&&this._font===t.font&&this._maxFontSize===t.maxFontSize&&this._minFontSize===t.minFontSize&&this._horizontalWrap===t.horizontalWrap&&this._verticalOverflow===t.verticalOverflow&&this._lineSpacing===t.lineSpacing&&this._fontSize===t.fontSize&&this._align===t.align&&this._color.equals(t.color)||(this._dirtyVertices=!0,this._dirtyOffset=!0),this._bounds&&this._bounds.x===t.bounds.x&&this._bounds.y===t.bounds.y||(this._dirtyOffset=!0,(this._horizontalWrap||this._bestFit||this._align!==pc.TEXT_ALIGN_LEFT)&&(this._dirtyVertices=!0)),this._verticalAlign=t.verticalAlign,this._fontSize=t.fontSize,this._bestFit=t.bestFit,this._font=t.font,this._align=t.align,this._maxFontSize=t.maxFontSize,this._minFontSize=t.minFontSize,this._minFontSizeOriginal=t.minFontSize,this._maxFontSizeOriginal=t.maxFontSize,this._horizontalWrap=t.horizontalWrap,this._verticalOverflow=t.verticalOverflow,this._recursiveCounter=0,this._measures=null,this._originalMeasures=null,this._recursiveLimit=10,this._bounds.copy(t.bounds),this._lineSpacing=t.lineSpacing,this._color.copy(t.color)},_resizeBuffers:function(t){this._bufferSize=t,this._buffer=new Float32Array(44*t)},populateWithErrors:function(t,e,i){e.bestFit=e.resizeTextForBestFit,e.font=e.font.handle,e.maxFontSize=e.resizeTextMaxSize,e.minFontSize=e.resizeTextMinSize,e.lineHeight=e.lineSpacing,e.horizontalWrap=!(0===e.horizontalOverflow),e.bounds=e.generationExtents,e.verticalAlign="top",e.align=pc.TEXT_ALIGN_LEFT,e._bestFit=e.resizeTextForBestFit,e._fontSize=e.fontSize,e._font=e.font,e._maxFontSize=e.resizeTextMaxSize,e._minFontSize=e.resizeTextMinSize,e._lineHeight=e.lineSpacing,e._verticalOverflow=e.verticalOverflow,e._horizontalWrap=!(0===e.horizontalOverflow),e._bounds=e.generationExtents,e._verticalAlign="top",e._align=pc.TEXT_ALIGN_LEFT,this.populate(t,e)}}),Object.defineProperty(r.prototype,"offset",{get:function(){return this._offset}}),Object.defineProperty(r.prototype,"vertexCount",{get:function(){return this._vertexCount}}),Object.defineProperty(r.prototype,"lineCount",{get:function(){return this._lineCount}}),Object.defineProperty(r.prototype,"characterCount",{get:function(){return this._characters.length}}),Object.defineProperty(r.prototype,"lines",{get:function(){return this._lines}}),Object.defineProperty(r.prototype,"characters",{get:function(){return this._characters}}),{TextGenerator:r}}()),window.Bridge.property=function(t,e,i,s,n,r){const a={enumerable:!r,configurable:!0};if(i&&i.get&&(a.get=i.get),i&&i.set&&(a.set=i.set),!i||!i.get&&!i.set){const t=Bridge.getTypeAlias(n)+"$"+e;n.$init=n.$init||{},s&&(n.$init[t]=i),function(t,e,i,s){t.get=function(){const t=this.$init[i];return void 0===t?s:t},t.set=function(t){this.$init[i]=t}}(a,0,t,i)}const o=[e],h=n.$descriptors||[];for(let t=0;t<h.length;t++){const i=h[t];if(i.name===e)for(let t=0;t<h.length;t++){const e=h[t];e.get===i.get&&e.set===i.set&&(-1===o.indexOf(e.name)&&o.push(e.name))}}for(const e of o)Object.defineProperty(t,e,a),t["get"+e]=t["get"+e]||a.get,t["set"+e]=t["set"+e]||a.set;return a},function(){const t=new RegExp(/[A-Za-z\u0061-\u007A\u00B5\u00DF-\u00F6\u00F8-\u00FF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0561-\u0587\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5E\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7FA\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A\u0041-\u005A\u00C0-\u00D6\u00D8-\u00DE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA\uFF21-\uFF3A\u01C5\u01C8\u01CB\u01F2\u1F88-\u1F8F\u1F98-\u1F9F\u1FA8-\u1FAF\u1FBC\u1FCC\u1FFC\u02B0-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0374\u037A\u0559\u0640\u06E5\u06E6\u07F4\u07F5\u07FA\u081A\u0824\u0828\u0971\u0E46\u0EC6\u10FC\u17D7\u1843\u1AA7\u1C78-\u1C7D\u1D2C-\u1D6A\u1D78\u1D9B-\u1DBF\u2071\u207F\u2090-\u209C\u2C7C\u2C7D\u2D6F\u2E2F\u3005\u3031-\u3035\u303B\u309D\u309E\u30FC-\u30FE\uA015\uA4F8-\uA4FD\uA60C\uA67F\uA717-\uA71F\uA770\uA788\uA7F8\uA7F9\uA9CF\uAA70\uAADD\uAAF3\uAAF4\uFF70\uFF9E\uFF9F\u00AA\u00BA\u01BB\u01C0-\u01C3\u0294\u05D0-\u05EA\u05F0-\u05F2\u0620-\u063F\u0641-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u0800-\u0815\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0972-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E45\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10D0-\u10FA\u10FD-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17DC\u1820-\u1842\u1844-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C77\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u2135-\u2138\u2D30-\u2D67\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3006\u303C\u3041-\u3096\u309F\u30A1-\u30FA\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA014\uA016-\uA48C\uA4D0-\uA4F7\uA500-\uA60B\uA610-\uA61F\uA62A\uA62B\uA66E\uA6A0-\uA6E5\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA6F\uAA71-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB\uAADC\uAAE0-\uAAEA\uAAF2\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF66-\uFF6F\uFF71-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/),e=new RegExp(/[0-9\u0030-\u0039\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]/),i=new RegExp(/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65\u002D\u058A\u05BE\u1400\u1806\u2010-\u2015\u2E17\u2E1A\u2E3A\u2E3B\u301C\u3030\u30A0\uFE31\uFE32\uFE58\uFE63\uFF0D\u0028\u005B\u007B\u0F3A\u0F3C\u169B\u201A\u201E\u2045\u207D\u208D\u2329\u2768\u276A\u276C\u276E\u2770\u2772\u2774\u27C5\u27E6\u27E8\u27EA\u27EC\u27EE\u2983\u2985\u2987\u2989\u298B\u298D\u298F\u2991\u2993\u2995\u2997\u29D8\u29DA\u29FC\u2E22\u2E24\u2E26\u2E28\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\u301A\u301D\uFD3E\uFE17\uFE35\uFE37\uFE39\uFE3B\uFE3D\uFE3F\uFE41\uFE43\uFE47\uFE59\uFE5B\uFE5D\uFF08\uFF3B\uFF5B\uFF5F\uFF62\u0029\u005D\u007D\u0F3B\u0F3D\u169C\u2046\u207E\u208E\u232A\u2769\u276B\u276D\u276F\u2771\u2773\u2775\u27C6\u27E7\u27E9\u27EB\u27ED\u27EF\u2984\u2986\u2988\u298A\u298C\u298E\u2990\u2992\u2994\u2996\u2998\u29D9\u29DB\u29FD\u2E23\u2E25\u2E27\u2E29\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\u301B\u301E\u301F\uFD3F\uFE18\uFE36\uFE38\uFE3A\uFE3C\uFE3E\uFE40\uFE42\uFE44\uFE48\uFE5A\uFE5C\uFE5E\uFF09\uFF3D\uFF5D\uFF60\uFF63\u00AB\u2018\u201B\u201C\u201F\u2039\u2E02\u2E04\u2E09\u2E0C\u2E1C\u2E20\u00BB\u2019\u201D\u203A\u2E03\u2E05\u2E0A\u2E0D\u2E1D\u2E21\u005F\u203F\u2040\u2054\uFE33\uFE34\uFE4D-\uFE4F\uFF3F\u0021-\u0023\u0025-\u0027\u002A\u002C\u002E\u002F\u003A\u003B\u003F\u0040\u005C\u00A1\u00A7\u00B6\u00B7\u00BF\u037E\u0387\u055A-\u055F\u0589\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u166D\u166E\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u1805\u1807-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2016\u2017\u2020-\u2027\u2030-\u2038\u203B-\u203E\u2041-\u2043\u2047-\u2051\u2053\u2055-\u205E\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00\u2E01\u2E06-\u2E08\u2E0B\u2E0E-\u2E16\u2E18\u2E19\u2E1B\u2E1E\u2E1F\u2E2A-\u2E2E\u2E30-\u2E39\u3001-\u3003\u303D\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFE10-\uFE16\uFE19\uFE30\uFE45\uFE46\uFE49-\uFE4C\uFE50-\uFE52\uFE54-\uFE57\uFE5F-\uFE61\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF07\uFF0A\uFF0C\uFF0E\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3C\uFF61\uFF64\uFF65]/),s=new RegExp(/[\u2028\u2029\u0020\u00A0\u1680\u180E\u2000-\u200A\u202F\u205F\u3000]/),n=[33,34,35,37,38,39,40,41,42,44,45,46,47,58,59,63,64,91,92,93,95,123,125,161,171,173,183,187,191];System.Array.resize=function(t,e,i){if(e<0)throw new System.ArgumentOutOfRangeException.$ctor3("newSize",e,"newSize cannot be less than 0.");let s=0;const n=Bridge.isFunction(i);let r=!1,a=t.v;if(a){const t=a;s=t.length,a=new Array(e);const i=Math.min(s,e);if(i>0){const e=t[0];r=e&&"struct"===e.__proto__.$kind,a[0]=r?e.$clone():e}for(let e=1;e<i;e++)a[e]=r?t[e].$clone():t[e]}else a=new Array(e);if(e>s){const t=n?i():i;r=t&&"struct"===t.__proto__.$kind,a[s]=r?t.$clone():t}for(let t=s+1;t<e;t++){let e=n?i():i;r&&(e=e.$clone()),a[t]=e}t.v=a};const r=function(t,e){this.o=t,this.n=e};if(Object.defineProperty(r.prototype,"v",{get:function(){return null==this.n?this.o:this.o[this.n]},set:function(t){null==this.n&&(t&&t.$clone?t.$clone(this.o):this.o=t),this.o[this.n]=t}}),Bridge.ref=function(t,e){return Bridge.isArray(e)&&(e=System.Array.toIndex(t,e)),new r(t,e)},System.Char.isWhiteSpace=function(t){return" "===t||"\t"===t||"\n"===t||"\v"===t||"\f"===t||"\r"===t||""===t||""===t},System.Char.isLetter=function(e){return e<256?e>=65&&e<=90||e>=97&&e<=122:t.test(String.fromCharCode(e))},System.Char.isDigit=function(t){return t<256?t>=48&&t<=57:e.test(String.fromCharCode(t))},System.Char.isPunctuation=function(t){return t<256?-1!==n.indexOf(t):i.test(String.fromCharCode(t))},System.Char.isHighSurrogate=function(t){return t>=55296&&t<=56319},System.Char.isLowSurrogate=function(t){return t>=56320&&t<=57343},System.Char.isSurrogate=function(t){return t>=55296&&t<=57343},System.Char.isSeparator=function(t){return t<256?32===t||160===t:s.test(String.fromCharCode(t))},DEVELOP){const t=System.SystemException.$ctor1;System.SystemException.$ctor1=function(e){pc.Debugger.Console.exception({message:e},{},3),t.call(this,e)}}}(),Object.assign(pc,function(){class t extends pc.Texture{constructor(t,e){super(t,e),this._videoWidth=0,this._videoHeight=0,this._frameCount=0,this._frameRate=24,void 0!==e&&(this._videoWidth=void 0!==e.width?e.width:this._videoWidth,this._videoHeight=void 0!==e.height?e.height:this._videoHeight,this._frameRate=void 0!==e.frameRate?e.frameRate:this._frameRate,this._frameCount=void 0!==e.frameCount?e.frameCount:this._frameCount)}get frameRate(){return this._frameRate}get frameCount(){return this._frameCount}get videoWidth(){return this._videoWidth}get videoHeight(){return this._videoHeight}}return{VideoTexture:t}}()),Object.assign(pc,function(){const t=function(t,e){this.object=t,this.time=e,this.updatedAt=UnityEngine.Time.time,this.instant=!e||e<=0,this.secondPassProcess=!1,this.enabled=!0,this.instant&&this.prepare()};(t.prototype=Object.create(Object.prototype)).constructor=t,Object.assign(t.prototype,{prepare:function(){this.isValid&&(this.object.enabled=!1)},update:function(){if(!this.isValid||this.instant||this.time<=0)return;const t=UnityEngine.Time.time,e=t-this.updatedAt;this.updatedAt=t,this.time-=e,this.time<=0&&(this.prepare(),this.secondPassProcess=!0)},execute:function(){this.isValid&&(this.object.onDestroy&&this.object.onDestroy(),this.object.destroy(),this.object=null)}}),Object.defineProperty(t.prototype,"isValid",{get:function(){return null!==this.object&&!this.object._destroyed}}),Object.defineProperty(t.prototype,"isReady",{get:function(){return this.enabled&&(this.instant||this.time<=0)||!this.isValid}});const e=function(e,i){t.prototype.constructor.call(this,e,i)};(e.prototype=Object.create(t.prototype)).constructor=e,Object.assign(e.prototype,{prepare:function(){if(!this.isValid)return;const t=this.object.collectAllUnityComponents();for(let e=0;e<t.length;e++){t[e].enabled=!1}},execute:function(){if(!this.isValid)return;this.object._beingDestroyed=!0,this.object.enabled=!1;const t=this.object.collectAllUnityComponents();for(let e=0;e<t.length;e++){const i=t[e];i.onDestroy&&i.onDestroy()}this.object.destroy(),this.object=null}}),Object.defineProperty(e.prototype,"isValid",{get:function(){return null!==this.object&&!this.object._destroyed&&!this.object._beingDestroyed}});const i=function(e,i){t.prototype.constructor.call(this,e,i)};return(i.prototype=Object.create(t.prototype)).constructor=i,Object.assign(i.prototype,{prepare:function(){},execute:function(){this.isValid&&(this.object.CallOnDisable(),this.object.CallOnDestroy(),this.object._destroyed=!0)}}),Object.defineProperty(i.prototype,"isValid",{get:function(){return!this.object._destroyed}}),{DestroyTask:t,DestroyEntityTask:e,DestroyScriptableObjectTask:i}}()),Object.assign(pc,function(){class t extends pc.ComponentSystem{constructor(t){super(t),this.id="unitymanager",this.description="Supports Unity-like components.",this.callbacksDisabled=!1,this.fixedTimeStep=.02,this.maximumAllowedTimeStep=.1,this.timeScale=1,this.maximumParticleTimestep=.15,this._fixedAccumulator=0,this.app.events.on("update",this.onUpdate,this),this.app.events.on("frameend",this.onFrameEnd,this),this.app.events.on("focus",this.onApplicationFocus,this),this.app.events.on("blur",this.onApplicationBlur,this),this.systems=[],this.destroyQueue=new Array(64),this.destroyQueueTmp=new Array(64),this.destroyQueueLength=0,this.destroyQueueProcessing=!1}registerSystem(t){this.systems.push(t)}onUpdate(t){if(this._invokeQueueOnSystems("onStart"),this._invokeQueueOnSystems("onBeforeUpdates",t),Math.abs(UnityEngine.Time.timeScale)>Number.EPSILON){for(this._fixedAccumulator=Math.min(this.maximumAllowedTimeStep,this._fixedAccumulator+t*UnityEngine.Time.timeScale),UnityEngine.Time.SetActiveFixedTime(!0);this._fixedAccumulator>=this.fixedTimeStep;)this._invokeQueueOnSystems("onFixedUpdate",this.fixedTimeStep),this._fixedAccumulator-=this.fixedTimeStep;UnityEngine.Time.SetActiveFixedTime(!1)}this._invokeDestroyQueue(!1),this._invokeQueueOnSystems("onUpdate",t),this._invokeDestroyQueue(!0),this._invokeQueueOnSystems("onPostUpdate",t),this._invokeDestroyQueue(!1),this._invokeQueueOnSystems("onBeforeRender",t)}onFrameEnd(){this._invokeQueueOnSystems("onAfterRender",null)}onApplicationFocus(){this._invokeQueueOnSystems("onApplicationFocus",!0)}onApplicationBlur(){this._invokeQueueOnSystems("onApplicationFocus",!1)}_invokeQueueOnSystems(t,e){for(let i=0;i<this.systems.length;i++){const s=this.systems[i];this._triggerPerformanceSample(s,!0),s[t].call(s,e),this._triggerPerformanceSample(s,!1)}}_triggerPerformanceSample(t,e){const i=t.performanceSamplerSection;i&&(e?this.app.counters.startSection(i):this.app.counters.endSection(i))}disableCallbacks(){this.callbacksDisabled=!0}enableCallbacks(){this.callbacksDisabled=!1}invokeCallbacks(t){if(t.isPrefab&&null==t.parent)return;this.callbacksDisabled=!1;const e=new pc.ComponentQueue;this._collectComponents(t,e),this._invokeQueue(e)}_collectComponents(t,e){const i=t.collectAllUnityComponents();for(let t=0;t<i.length;t++){const s=i[t];(s.onAwake||s.onEnable||s.onDisable)&&e.push(s)}}_invokeQueue(t,e){if(0===t.length)return;const i=t.getComponents(!0);for(let t=0;t<i.length;t++){const s=i[t];s.entity._enabledInHierarchy&&(s.onInit&&s.onInit.call(s,e),s.onEnable&&s.enabled&&s.onEnable.call(s,e),s.onDisable&&!s.enabled&&s.onDisable.call(s,e))}}enqueueDestroy(t){t.isValid&&(this.destroyQueueProcessing&&(t.enabled=!1),this.destroyQueue[this.destroyQueueLength]=t,this.destroyQueueLength++)}_invokeDestroyQueue(t){if(0===this.destroyQueueLength)return;let e=0;if(this.destroyQueueProcessing=!0,t)for(let t=0;t<this.destroyQueueLength;t++)this.destroyQueue[t].update();for(let t=0;t<this.destroyQueueLength;t++){const i=this.destroyQueue[t];i.isReady?i.secondPassProcess||i.execute():(this.destroyQueueTmp[e]=i,e++)}for(let t=0;t<this.destroyQueueLength;t++){const e=this.destroyQueue[t];e.isReady&&e.secondPassProcess&&e.execute()}for(let t=0;t<this.destroyQueueLength;t++)this.destroyQueue[t].enabled=!0;const i=this.destroyQueue;this.destroyQueue=this.destroyQueueTmp,this.destroyQueueTmp=i,this.destroyQueueLength=e,this.destroyQueueProcessing=!1}}return{UnityComponentSystemManagerSystem:t}}()),Object.assign(pc,function(){const t=["OnMouseDown","OnMouseDrag","OnMouseEnter","OnMouseExit","OnMouseOver","OnMouseUp","OnMouseUpAsButton","OnTriggerEnter","OnTriggerStay","OnTriggerExit","OnCollisionEnter","OnCollisionStay","OnCollisionExit","OnTriggerEnter2D","OnTriggerStay2D","OnTriggerExit2D","OnCollisionEnter2D","OnCollisionStay2D","OnCollisionExit2D","UnityEngine$UI$IMaterialModifier$GetModifiedMaterial","UnityEngine$UI$IMeshModifier$ModifyMesh","UnityEngine$UI$IMeshModifier$ModifyMesh$1","OnPopulateMesh","UnityEngine$ICanvasRaycastFilter$IsRaycastLocationValid"],e=new Map;class i extends pc.UnityComponent{constructor(i,s,n){super();const r=Bridge._getTypeByName(s);this.code=new r(this),this.scriptsExecutionOrder=0,this.internalExecutionOrder=100,this["__"+s]=this.code,this.code.handle=this,this.unityClass=r,this._enabled=void 0===n||!!n,this._events=[],function(i){const s=i.code.constructor;if(e.has(s))return;const n=[];for(let e=0;e<t.length;e++)s.prototype[t[e]]!==UnityEngine.UI.Graphic.prototype.OnPopulateMesh&&s.prototype[t[e]]&&n.push(t[e]);e.set(s,n)}(this),this._addEventListeners()}storeMagicMethods(t){if(t.isPrefab)return;const i=Bridge.as(this.code,UnityEngine.EventSystems.IEventSystemHandler);t._eventHanders||(t._eventHanders=[]),i&&t._eventHanders.push(i);const s=e.get(this.code.constructor);if(0!==s.length){null===t._magicMethods&&(t._magicMethods={});for(let e=0;e<s.length;e++){const i=t._magicMethods[s[e]]||[];i.push(this),t._magicMethods[s[e]]=i}}}removeMagicMethods(t){const i=e.get(this.code.constructor);if(0!==i.length&&null!==t._magicMethods)for(let e=0;e<i.length;e++){const s=t._magicMethods[i[e]];if(s){const t=s.indexOf(this);t>=0&&(s[t]=s[s.length-1],s.length-=1)}}}configureForEntity(t){this.code.ConfigureForEntity&&this.code.ConfigureForEntity(t)}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._invokeOverload("OnEnable"),!0)}onDisable(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._invokeOverload("OnDisable"),!0)}onDestroy(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.stopAllCoroutines(),this._invokeOverload("DestroyInternal"),this._invokeOverload("OnDestroy"),!0)}onAwake(){this._invokeOverload("Awake")}onStart(){this._invokeOverload("Start")}onUpdate(){this._invokeOverload("Update")}onFixedUpdate(){this._invokeOverload("FixedUpdate")}onPostUpdate(){this.code.LateUpdate()}onBeforeRender(){this.code.OnPreRender()}onAfterRender(){this.code.OnPostRender()}onApplicationFocus(t){this.code.OnApplicationFocus(t)}onPointerEnter(t){(this.code.OnPointerEnter||this.code.UnityEngine$EventSystems$IPointerEnterHandler$OnPointerEnter).call(this.code,t)}onPointerExit(t){(this.code.OnPointerExit||this.code.UnityEngine$EventSystems$IPointerExitHandler$OnPointerExit).call(this.code,t)}onPointerDown(t){(this.code.OnPointerDown||this.code.UnityEngine$EventSystems$IPointerDownHandler$OnPointerDown).call(this.code,t)}onPointerUp(t){(this.code.OnPointerUp||this.code.UnityEngine$EventSystems$IPointerUpHandler$OnPointerUp).call(this.code,t)}onPointerClick(t){(this.code.OnPointerClick||this.code.UnityEngine$EventSystems$IPointerClickHandler$OnPointerClick).call(this.code,t)}onBeginDrag(t){(this.code.onBeginDrag||this.code.UnityEngine$EventSystems$IBeginDragHandler$OnBeginDrag).call(this.code,t)}onDrag(t){(this.code.OnDrag||this.code.UnityEngine$EventSystems$IDragHandler$OnDrag).call(this.code,t)}onEndDrag(t){(this.code.OnEndDrag||this.code.UnityEngine$EventSystems$IEndDragHandler$OnEndDrag).call(this.code,t)}addCoroutine(t){this._system.addCoroutine(t,this)}addFixedUpdateCoroutine(t){this._system.addFixedUpdateCoroutine(t,this)}addEndOfFrameCoroutine(t){this._system.addEndOfFrameCoroutine(t,this)}stopAllCoroutines(){this._system.stopAllCoroutines(this)}stopCoroutine(t){this._system.stopCoroutine(t,this)}_addEventListeners(){this.code.Update&&this._events.push("onUpdate"),this.code.FixedUpdate&&this._events.push("onFixedUpdate"),this.code.LateUpdate&&this._events.push("onPostUpdate"),this.code.OnPostRender&&this._events.push("onAfterRender"),this.code.OnApplicationFocus&&this._events.push("onApplicationFocus")}_queuesToSubscribe(){return this._events}_invokeOverload(t){try{const e=this.code.overloads[t+"()"]||t,i=this.code[e];if(void 0!==i){const t=i.call(this.code);t&&"Bridge.GeneratorEnumerator"===t.$$fullname&&new UnityEngine.Coroutine(t,this)}}catch(t){t=t.hasOwnProperty("errorStack")?t.errorStack:t,console.error(t),"undefined"!=typeof Sentry&&Sentry.captureException(t)}}onCanvasGroupChanged(){this._invokeOverload("OnCanvasGroupChanged")}onBeforeTransformParentChanged(){this._invokeOverload("OnBeforeTransformParentChanged")}onTransformParentChanged(){this._invokeOverload("OnTransformParentChanged")}onTransformChildrenChanged(){this._invokeOverload("OnTransformChildrenChanged")}}return i.create=t=>{const e=Bridge._getTypeByName(t.type);return Bridge.isFunction(e)?new i(t.entity,t.type,t.enabled):null},{MonoBehaviourComponent:i}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="monoBehaviour",this.performanceSamplerSection=pc.Counters.SCRIPTS,this.scriptsExecutionOrder=[],this._coroutines={onUpdate:{},onFixedUpdate:{},onAfterRender:{}}}addComponent(t,e){pc.UnityComponentSystem.prototype.addComponent.call(this,t,e),e.scriptsExecutionOrder=this.scriptsExecutionOrder[e.code.$$fullname]||0,e.storeMagicMethods(t)}removeComponent(t,e){pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e),e.removeMagicMethods(t)}onBeforeUpdates(){UnityEngine.Input.OnMouseUpdate()}onUpdate(t){pc.UnityComponentSystem.prototype.onUpdate.call(this,t);const e=this._coroutines.onUpdate;for(const i in e){const s=e[i],n=s.length>0?s[0][1]:null;if(!n||!n._entity._activeSelf){delete e[i];continue}let r=0,a=-1;for(let e=s.length-1;e>=0;--e){const i=s[e][0];i.Update(t),i.isDone?(r++,a<0&&(a=e)):a>=0&&(s[a--]=s[e])}r===s.length?delete e[i]:r>0&&s.splice(0,r)}}onFixedUpdate(t){pc.UnityComponentSystem.prototype.onFixedUpdate.call(this,t),this._updateCoroutines(this._coroutines.onFixedUpdate,this._handleFixedUpdate)}onAfterRender(t){pc.UnityComponentSystem.prototype.onAfterRender.call(this,t),this._updateCoroutines(this._coroutines.onAfterRender,this._handleEndOfFrame)}_updateCoroutines(t,e){for(const i in t){const s=t[i],n=s.length>0?s[0][1]:null;if(!n||!n._entity._activeSelf){delete t[i];continue}const r=s.length;for(let t=r-1;t>=0;--t)e(s[t][0]);s.length===r?delete t[i]:s.splice(0,r)}}_handleFixedUpdate(t){t.HandleFixedUpdate()}_handleEndOfFrame(t){t.HandleEndOfFrame()}stopAllCoroutines(t){const e=this._coroutines.onUpdate[t._id];if(e)for(let t=0;t<e.length;++t){e[t][0].Cancel()}}stopCoroutine(t,e){const i=this._coroutines.onUpdate[e._id];if(i)for(let e=0;e<i.length;++e){const s=i[e][0];s.enumerator===t&&s.Cancel()}}addCoroutine(t,e){this._addCoroutineToQueue(t,e,this._coroutines.onUpdate)}addFixedUpdateCoroutine(t,e){this._addCoroutineToQueue(t,e,this._coroutines.onFixedUpdate)}addEndOfFrameCoroutine(t,e){this._addCoroutineToQueue(t,e,this._coroutines.onAfterRender)}_addCoroutineToQueue(t,e,i){i[e._id]||(i[e._id]=[]),i[e._id].push([t,e])}}return{MonoBehaviourSystem:t}}()),Object.assign(pc,function(){class t extends pc.MonoBehaviourComponent{get sortingOrderInQueue(){return this._sortingOrderInQueue}}return t.create=function(e){const i=Bridge._getTypeByName(e.type);return Bridge.isFunction(i)?new t(e.entity,e.type,e.enabled):null},{UIBehaviourComponent:t}}()),Object.assign(pc,function(){class t extends pc.MonoBehaviourSystem{constructor(t){super(t),this.id="uiBehaviour"}}return{UIBehaviourSystem:t}}()),Object.assign(pc,function(){const t="_MainTex";let e=0;class i extends pc.UnityComponent{constructor(){super(),this.id=e++,this.model=new pc.Model,this._color=new pc.Color(1,1,1,1),this._groupAlpha=1,this.code=new UnityEngine.CanvasRenderer(this),this._parentCanvas=null,this._colorParameter={const:[1,1,1,1]},this._showMaskGraphics=!0,this._absoluteDepth=0,this._hasPopInstruction=!1,this._popMaterialCount=0,this._popMaterials=[],this.mesh=null,this.isCanvas=!1,this._cullTransparentMesh=!1,this.cull=!1,this.culledByTransparency=!1,this.vertexColors=[],this["__UnityEngine.CanvasRenderer"]=this.code,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"CanvasRendererComponent")}get cullTransparentMesh(){return this._cullTransparentMesh}set cullTransparentMesh(t){this._cullTransparentMesh=t}get showMaskGraphics(){return this._showMaskGraphics}set showMaskGraphics(t){this._showMaskGraphics=t,this.model.setParameter("_ColorMask",t?15:0)}get absoluteDepth(){return this._absoluteDepth}set absoluteDepth(t){this._absoluteDepth=t}get hasPopInstruction(){return this._hasPopInstruction}set hasPopInstruction(t){this._hasPopInstruction=t}get popMaterialCount(){return this._popMaterialCount}set popMaterialCount(t){this._popMaterialCount=t}updateParentCanvas(){const t=this.findParentCanvas();this.reparentCanvas(t)}onEnable(){this.updateParentCanvas(),pc.UnityComponent.prototype.onEnable.call(this)}onDisable(){this.reparentCanvas(null),pc.UnityComponent.prototype.onDisable.call(this)}onScreenChanged(t){this.reparentCanvas(t)}onCanvasGroupChanged(){this.setGroupAlpha(UnityEngine.CanvasGroup.ExtractAlpha(this.entity.element._canvasGroups))}onAttached(){const t=this._entity;t.element||t.addComponent("element",{pivot:new pc.Vec2(.5,.5),anchor:new pc.Vec4(0,0,1,1),sizeDelta:new pc.Vec2(0,0),anchoredPosition:new pc.Vec2(0,0)});const e=t.element;e.events.on("set:stencillayer",this._onStencilLayerChange,this),e.events.on("set:draworder",this._onDrawOrderChange,this),this.model.element=e,this.model.entity=t}_onStencilLayerChange(t){if(this._ignoreMask)this.model.stencil=null;else{const t=this.entity.element;this.model.stencil=t._getStencilParameters(),this.model.masksChildren&&this.model.setParameter("UNITY_UI_ALPHACLIP",1)}}_onDrawOrderChange(t){const e=this._entity.element,i=e._nearestScreen;this.model.nearestScreen=i,this.model.element=e,this.model.drawOrder=t,i&&(this.model.sortingLayerIndex=i.sortingLayerIndex,this.model.sortingOrder=i.sortingOrder)}setTexture(e){e?this.model.setParameter(t,e):this.model.deleteParameter(t)}getTexture(){return this.model.getParameter(t)}setColor(t){this._color.equals(t)||(this._color.copy(t),this.applyColor())}getColor(){return this._color}setMaterial(t,e){const i=this.model.materials;i[e]=t,this.model.materials=i}getMaterial(t){return this.model.materials?this.model.materials[t]:null}setMaterialCount(t){const e=this.model.materials||[];e.length=t,this.model.materials=e}getMaterialCount(){return this.model.materials?this.model.materials.length:0}setMesh(t){this.model.mesh=t,this.cacheColors(t),this.applyColor()}cacheColors(t){if(t&&t.vertexBuffer.format.hasColor){const t=UnityEngine.Object.FromHandle(UnityEngine.Mesh,this.model._mesh);this.vertexColors=t.colors}}getMesh(){return this.model.mesh}findParentCanvas(){return pc.UIUtils.findParentScreen(this._entity)}addToParentCanvas(){this._parentCanvas&&!this._entity.isPrefab&&this._parentCanvas.canvasMeshInstance.addRenderer(this)}removeFromParentCanvas(){this._parentCanvas&&this._parentCanvas.canvasMeshInstance.removeRenderer(this)}reparentCanvas(t){if(!this.entity.enabled)return this.removeFromParentCanvas(),void(this._parentCanvas=null);if(t!==this._parentCanvas){this.removeFromParentCanvas();const e=this._parentCanvas?this._parentCanvas["__UnityEngine.Canvas"]:null;this._parentCanvas=t;const i=t?t["__UnityEngine.Canvas"]:null;this.enabled&&this.addToParentCanvas();const s=this.entity.element?this.entity.element["UnityEngine.UI.Graphic"]:null;this.entity.element._nearestScreen=t,s&&(s.m_canvas=i,s.OnCanvasChanged(e,i))}}setGroupAlpha(t){this._groupAlpha=t,this.applyColor()}applyColor(){const t=this.model.mesh;if(null!=t&&t.vertexBuffer.format.hasColor){this.model.deleteConstant("COLOR");const e=UnityEngine.Object.FromHandle(UnityEngine.Mesh,this.model._mesh),i=e.colors;if(0===i.length)return;let s=!0;if(!t.alphaCorrected){for(let t=0;t<this.vertexColors.length;t++)i[t].r=this.vertexColors[t].r*this._color.r,i[t].g=this.vertexColors[t].g*this._color.g,i[t].b=this.vertexColors[t].b*this._color.b,i[t].a=this.vertexColors[t].a*this._color.a*this._groupAlpha,i[t].a>=Number.EPSILON&&(s=!1);t.alphaCorrected=!0}e.colors=i,this.cullTransparentMesh&&(this.culledByTransparency=s)}else{const t=new pc.Color;t.copy(this._color),t.a*=this._groupAlpha,this._colorParameter=t.data,this.model.setConstant("COLOR",this._colorParameter)}}setPopMaterial(t,e){this._popMaterials[e]||this._popMaterialCount++,this._popMaterials[e]=t}}return{CanvasRendererComponent:i}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="canvasRenderer"}}return{CanvasRendererSystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="reflectionprobe"}scheduleProbeUpdate(){this.needsProbeUpdate=!0}onBeforeRender(t){this.needsProbeUpdate&&this.refreshReflectionProbes(),this.needsProbeUpdate=!1,pc.UnityComponentSystem.prototype.onBeforeRender.call(this,t)}refreshReflectionProbes(){const t=this.app.systems.renderer._components;for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];i.enabled&&(i.code&&i.code.UpdateReflectionProbes())}}}return{ReflectionProbeSystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponent{constructor(){super(),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"ReflectionProbeComponent")}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)}onDisable(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this.code.OnDisable(),!0)}onTransformChanged(){this.code.OnReflectionProbeChanged()}onBeforeRender(t){this.code.OnBeforeRender()}_queuesToSubscribe(){return["onBeforeRender"]}refreshReflectionProbes(){this.system.scheduleProbeUpdate()}}return{ReflectionProbeComponent:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="meshFilter"}}return{MeshFilterComponentSystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponent{constructor(t){super(),this.id="",this._mesh=null,this["__UnityEngine.MeshFilter"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"MeshFilterComponent")}get mesh(){return this._mesh}set mesh(t){this._mesh=t}}return{MeshFilterComponent:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="renderer",this.defaultMaterial=t.scene.defaultMaterial}}return{RendererComponentSystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponent{constructor(t){super(),this.id="",this.model=new pc.Model,this._castShadows=!0,this._receiveShadows=!0,this.system=pc.Application.getApplication().systems.renderer,this._material=this.system.defaultMaterial,this.__renderer="",this.code=null,this._aabb=null,this._lastAABBVersion=-1}get aabb(){return this._aabb||(this._aabb=new pc.BoundingBox),this.model&&this.model.mesh?this._aabb.setFromTransformedAabb(this.model.mesh.aabb,this.entity.worldTransform):this._aabb.setMinMax(pc.Vec3.ZERO,pc.Vec3.ZERO),this._aabb}get meshInstances(){return this.model?this.model.meshInstances:null}set meshInstances(t){this.model&&(this.model.meshInstances=t)}get castShadows(){return this._castShadows}set castShadows(t){this._castShadows!==t&&(this._castShadows=t)}get receiveShadows(){return this._receiveShadows}set receiveShadows(t){this._receiveShadows!==t&&(this._receiveShadows=t)}onAttached(){pc.UnityComponent.prototype.onAttached.call(this),this.model&&(this.model.entity=this.entity)}onDestroy(){return!!pc.UnityComponent.prototype.onDestroy.call(this)}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(pc.Application.getApplication().scene.addRenderer(this),!0)}onDisable(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(pc.Application.getApplication().scene.removeRenderer(this),!0)}synchronizeWithEntity(){if(!this.entity||!this.code)return;const t=this.model.skin&&this.model.skin.rootBone,e=t?t.aabbVersion:this.entity.aabbVersion;this._destroyed||this._lastAABBVersion===e||(this._lastAABBVersion=e,this.code._lightProbeUsage&&this.code.UpdateProbes(),this.model.flipFaces=t?t._isOddlyScaled():this.entity._isOddlyScaled())}getMeshInstancesForRender(){return this.synchronizeWithEntity(),this.code.OnBeforeRender&&this.code.OnBeforeRender(),this.model.update(),this.model.meshInstances}getPropertyBlock(t,e){this.model.update();const i=this.model.meshInstances[e];i?t.handle.copyFromMeshInstance(i):console.warn("MaterialPropertyBlock index "+e+" is out of range")}setPropertyBlock(t,e){this.model.update();const i=this.model.meshInstances[e];i?t.handle.applyToMeshInstance(i):console.warn("MaterialPropertyBlock index "+e+" is out of range")}setMesh(t){this.model.setMeshDirectlyToMeshInstance(t)}}return{RendererComponent:t}}()),Object.assign(pc,function(){const t=new pc.StencilParameters({func:pc.FUNC_LESSEQUAL,ref:1,writeMask:255,readMask:255,zfail:pc.STENCILOP_KEEP,zpass:pc.STENCILOP_KEEP,fail:pc.STENCILOP_KEEP}),e=new pc.StencilParameters({func:pc.FUNC_GREATER,ref:1,writeMask:255,readMask:255,zfail:pc.STENCILOP_KEEP,zpass:pc.STENCILOP_KEEP,fail:pc.STENCILOP_KEEP});class i extends pc.RendererComponent{constructor(t){super(),this.code=new UnityEngine.SpriteRenderer(this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"SpriteRendererComponent")}onEnable(){if(!pc.RendererComponent.prototype.onEnable.call(this))return!1;if(this.code.maskInteraction===UnityEngine.SpriteMaskInteraction.None)this.model._stencil=null;else{const i=this.code.maskInteraction===UnityEngine.SpriteMaskInteraction.VisibleInsideMask;this.model._stencil=i?t:e}return!0}}return{SpriteRendererComponent:i}}()),Object.assign(pc,function(){const t=new pc.StencilParameters({func:pc.FUNC_ALWAYS,ref:0,writeMask:255,readMask:255,zfail:pc.STENCILOP_KEEP,zpass:pc.STENCILOP_INCREMENT,fail:pc.STENCILOP_KEEP}),e=new pc.StencilParameters({func:pc.FUNC_ALWAYS,ref:0,writeMask:255,readMask:255,zfail:pc.STENCILOP_KEEP,zpass:pc.STENCILOP_DECREMENT,fail:pc.STENCILOP_KEEP});class i extends pc.RendererComponent{constructor(){super(),this.code=new UnityEngine.SpriteMask(this),this._sprite=null,this._alphaCutoff=.2,this._isCustomRangeActive=!1,this._frontSortingLayerID=0,this._frontSortingOrder=0,this._backSortingLayerID=-1e6,this._backSortingOrder=-1e3,this._spriteSortPoint=0,this._dirty=!0,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"SpriteMaskComponent")}get isCustomRangeActive(){return this._isCustomRangeActive}set isCustomRangeActive(t){this._isCustomRangeActive!==t&&(this._isCustomRangeActive=t,this._dirty=!0)}get alphaCutoff(){return this._alphaCutoff}set alphaCutoff(t){this._alphaCutoff!==t&&(this._alphaCutoff=t,this.model.setParameter("_Cutoff",this._alphaCutoff))}get frontSortingLayerID(){return this._frontSortingLayerID}set frontSortingLayerID(t){this._isCustomRangeActive&&this._frontSortingLayerID!==t&&(this._frontSortingLayerID=t,this._dirty=!0)}get frontSortingOrder(){return this._frontSortingOrder}set frontSortingOrder(t){this._isCustomRangeActive&&this._frontSortingOrder!==t&&(this._frontSortingOrder=t,this._dirty=!0)}get backSortingLayerID(){return this._backSortingLayerID}set backSortingLayerID(t){this._isCustomRangeActive&&this._backSortingLayerID!==t&&(this._backSortingLayerID=t,this._dirty=!0)}get backSortingOrder(){return this._backSortingOrder}set backSortingOrder(t){this._isCustomRangeActive&&this._backSortingOrder!==t&&(this._backSortingOrder=t,this._dirty=!0)}get sprite(){return this._sprite}set sprite(t){this._sprite!==t&&(this._sprite=t,this.model.setParameter("_MainTex",this._sprite.texture),this.model.mesh=this._sprite.getMesh())}onEnable(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.model._stencil=t,this.model.setParameter("_Cutoff",this.alphaCutoff),!0)}updateMaskRange(){this._dirty&&(this.isCustomRangeActive?(this.model.meshInstances[0].sortingOrder=this.backSortingOrder,this.model.meshInstances[0].sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(this.backSortingLayerID),this.model.meshInstances[1].sortingOrder=this.frontSortingOrder,this.model.meshInstances[1].sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(this.frontSortingLayerID)):(this.model.meshInstances[0].sortingOrder=0,this.model.meshInstances[0].sortingLayerIndex=-1,this.model.meshInstances[1].sortingOrder=0,this.model.meshInstances[1].sortingLayerIndex=Number.MAX_SAFE_INTEGER),this._dirty=!1)}changeStencilToAdditionalDrawCall(){const t=this.model.meshInstances.length;return!(!this._dirty||0===t)&&(this.model.meshInstances[1].stencilFront=e,this.model.meshInstances[1].stencilBack=e,this.updateMaskRange(),!0)}getMeshInstancesForRender(){return null!=this.model._mesh&&(this.model._mesh.subMeshes.length=2,this.model._mesh.subMeshes[1]=this.model._mesh.subMeshes[0],this.changeStencilToAdditionalDrawCall()),this.code.OnBeforeRender&&this.code.OnBeforeRender(),this.model.update(),this.model.meshInstances}}return{SpriteMaskComponent:i}}()),Object.assign(pc,function(){class t extends pc.RendererComponent{constructor(t){super(),this.meshFilter=null,this.code=new UnityEngine.MeshRenderer(this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"MeshRendererComponent")}onEnable(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.updateMesh(),!0)}getMeshInstancesForRender(){return this.synchronizeWithEntity(),this.updateMesh(),this.model.update(),this.model.meshInstances}updateMesh(){this.meshFilter&&!this.meshFilter._destroyed||(this.meshFilter=this.entity.getUnityComponent("meshFilter"));const t=null!=this.meshFilter?this.meshFilter.mesh:null;this.model.mesh!==t&&(this.model.mesh=t)}}return{MeshRendererComponent:t}}()),Object.assign(pc,function(){class t extends pc.RendererComponent{constructor(t){super(),this.code=new UnityEngine.SkinnedMeshRenderer(this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"SkinnedMeshRendererComponent")}}return{SkinnedMeshRendererComponent:t}}()),Object.assign(pc,function(){class t extends pc.RendererComponent{constructor(t){super(),this.code=new UnityEngine.LineRenderer(this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"LineRendererComponent")}onEnable(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)}}return{LineRendererComponent:t}}()),Object.assign(pc,function(){class t extends pc.RendererComponent{constructor(t){super(),this.code=new UnityEngine.TrailRenderer(this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"TrailRendererComponent")}_queuesToSubscribe(){return["onUpdate"]}onEnable(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)}onUpdate(t){this.code.Update()}}return{TrailRendererComponent:t}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Vec3;class i extends pc.BasePhysicsAdapter{constructor(t){super(t),this._effectors2d=new Map}setup(){this._world=this.options.world,this._newContacts={},this._contacts={},this._oldContacts={},this._disabledContacts={},this._world.on("begin-contact",Bridge.fn.bind(this,this._onBeginContact)),this._world.on("end-contact",Bridge.fn.bind(this,this._onEndContact)),this._world.on("pre-solve",Bridge.fn.bind(this,this._onPresolve))}addRigidbody(t){t.setActive(!0),this.preSimulationSynchronization(t._component||t,pc.BasePhysicsAdapter.PreSyncStages.TransformToPhysics)}removeRigidbody(t){for(let e=t.getFixtureList();e;e=e.getNext())e._component&&this._exitContacts(e._component);t.setActive(!1)}_exitContacts(t){const e=t._getContacts();if(e)for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];i._childContactsCount=0,this._onEndContact(i)}}destroyRigidbody(t){this._world.destroyBody(t)}addCollider(t,e){e.addFixture(t),e.enable(),this.preSimulationSynchronizationForCollider(e)}removeCollider(t,e){this._exitContacts(e),e.disable(),this._clearDisabledContacts(e)}_clearDisabledContacts(t){const e=t._disabledContacts;if(e){for(let t=0,i=e.length;t<i;++t)delete this._disabledContacts[e[t]];e.length=0}}addConstraint(t){t.createJoint(),t.enable()}removeConstraint(t){t.disable()}onSimulationStep(t){this._world.step(t)}getAttachedColliders(t){return t._unityComponents.collider2D}getAttachedRigidbody(t){const e=t._unityComponents.rigidbody2D[0];return e&&e.enabled&&e.getSimulated()&&!e.destroyed?e._body:null}attachFauxRigidbody(t){const e=this.createWorldBody();return e._body=e,e._entity=t,this.addRigidbody(e),e}getRelTransformAndAccumScale(i,s,n,r){const a=i._component?i._component._entity:s._entity,o=s._entity.getWorldTransform(),h=a.getWorldTransform();a===s._entity?n.setTranslation(pc.Vec3.ZERO):(o.getTranslation(e),h.getTranslation(t),e.sub(t),n.setTranslation(e)),o.getScale(r).abs()}synchronizeBodyWithEntity(t){const e=t._entity,i=t._body;i.setLayer(e.cullingLayer),i.setLayerMask(e.layerMask);const s=e.getPosition(),n=e.getEulerAngles();pc.Rigidbody2DComponent.setBodyTransform(i,s,n.z)}synchronizeEntityWithBody(t){pc.Rigidbody2DComponent.setEntityTransform(t._body,t._entity)}updateConstraint(t){t.update()}preSimulationSynchronization(t,e){if(e!==pc.BasePhysicsAdapter.PreSyncStages.TransformToPhysics)return;const i=t._entity;if(t._worldTransformVersion===i.aabbVersion)return;this.synchronizeBodyWithEntity(t),t._worldTransformVersion=i.aabbVersion;t._body._isEntityTransformed=!0}postSimulationSynchronization(t){t._body._isEntityTransformed=!1;const e=t._entity,i=t._worldTransformVersion!==e.aabbVersion;if(t.getIsKinematic()){if(i)return void this.synchronizeBodyWithEntity(t)}else if(t.getIsStatic()&&!i)return;this.synchronizeEntityWithBody(t)}onAfterSimulation(t){pc.BasePhysicsAdapter.prototype.onAfterSimulation.call(this,t)}_onBeginContact(t){const e=this._getContactUid(t),i=this._contacts[e]||this._newContacts[e];i?i._childContactsCount++:(t._childContactsCount=1,this._newContacts[e]=t)}_onEndContact(t){const e=this._getContactUid(t),i=this._contacts[e];i&&--i._childContactsCount<=0&&(this._oldContacts[e]=i)}_onPresolve(t){const e=t.getFixtureA()._component,i=t.getFixtureB()._component;if(e._usedByEffector){const i=this._effectors2d.get(e._entity._guid);i&&i.onBeforeCollision2D(t)}else if(i._usedByEffector){const e=this._effectors2d.get(i._entity._guid);e&&e.onBeforeCollision2D(t)}}_getContactUid(t){return this._getCollidersUid(t.getFixtureA()._component,t.getFixtureB()._component)}_getCollidersUid(t,e){const i=t._id,s=e._id;return i>s?i+":"+s:s+":"+i}handleContacts(){this._triggerNewContacts(),this._triggerPersistentContacts(),this._removeNewContacts(),this._triggerOldContacts()}_triggerNewContacts(){for(const t in this._newContacts)this._contacts[t]||this._triggerContactCallback("Enter",this._newContacts[t],t,!0)}_triggerPersistentContacts(){for(const t in this._contacts)this._triggerContactCallback("Stay",this._contacts[t],t)}_removeNewContacts(){for(const t in this._newContacts)this._contacts[t]=this._newContacts[t],delete this._newContacts[t]}_triggerOldContacts(){for(const t in this._oldContacts){const e=this._oldContacts[t];e.getFixtureA()._component.removeContact(t),e.getFixtureB()._component.removeContact(t),this._triggerContactCallback("Exit",e,t),delete this._oldContacts[t],delete this._contacts[t]}}_triggerContactCallback(t,e,i,s){if(this._disabledContacts[i])return;const n=e.getFixtureA(),r=n.getBody();if(!r)return;const a=e.getFixtureB(),o=a.getBody();if(!o)return;const h=n._component,c=a._component;if(h._isTrigger||c._isTrigger){const e="OnTrigger"+t+"2D";this.dispatchContact(h._entity,e,c.code);let i=r._component;i&&h._entity!==i._entity&&this.dispatchContact(i._entity,e,c.code),this.dispatchContact(c._entity,e,h.code),i=o._component,i&&c._entity!==i._entity&&this.dispatchContact(i._entity,e,h.code)}else{s&&(h.addContact(e,i),c.addContact(e,i));const n="OnCollision"+t+"2D";this.dispatchContact(h._entity,n,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(0));let a=r._component;a&&h._entity!==a._entity&&this.dispatchContact(a._entity,n,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(0)),this.dispatchContact(c._entity,n,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(1)),a=o._component,a&&c._entity!==a._entity&&this.dispatchContact(a._entity,n,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(1))}}ignoreCollision(t,e,i){if(!t.entity._enabledInHierarchy||!e.entity._enabledInHierarchy)return;const s=this._getCollidersUid(t,e);this._disabledContacts[s]=i,i&&(t._disabledContacts=t._disabledContacts||[],e._disabledContacts=e._disabledContacts||[],t._disabledContacts.push(s),e._disabledContacts.push(s))}getWorldBody(){return this._worldBody||(this._worldBody=this.createWorldBody()),this._worldBody}createWorldBody(){const t=this._world.createBody({type:planck.Body.STATIC,userData:{isWorldBody:!0}});return t.equals=function(e){return e===t||e&&(e=e.getUserData())&&e.isWorldBody},t}enableEffector(t){this._effectors2d.set(t._entity._guid,t)}disableEffector(t){this._effectors2d.delete(t._entity._guid)}get world(){return this._world}}return{Physics2DAdapter:i}}()),Object.assign(pc,(()=>{let t,e,i,s;const n=new planck.Vec2,r=new planck.Vec2;let a,o,h,c,l,u;class d extends pc.UnityComponentSystem{constructor(t){super(t),this.id="physics2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this.initializePhysicsEngine()}initializePhysicsEngine(){this._defaultMaterial=new UnityEngine.PhysicsMaterial2D,this._defaultMaterial.friction=.4,this._defaultMaterial.bounciness=0,this._gravity=new pc.Vec2(0,-9.81),d._world=this._world=planck.World({gravity:new planck.Vec2(this._gravity.x,this._gravity.y)}),d._adapter=this._adapter=new pc.Physics2DAdapter({world:this._world})}onFixedUpdate(t){this._adapter.onFixedUpdate(t)}setIgnoreCollisionBetweenLayers(t,e,i){this._adapter.setIgnoreCollisionBetweenLayers(t,e,i)}syncHierarchy(t){this._adapter.syncHierarchy(t)}syncTransforms(t){this._autoSyncTransforms&&this._adapter.syncTransforms(t)}get adapter(){return this._adapter}get gravity(){return this._gravity}set gravity(t){this._gravity=t;const e=this._world.getGravity();e.x=t.x,e.y=t.y,this._world.setGravity(e)}get defaultMaterial(){return this._defaultMaterial}set defaultMaterial(t){t&&(this._defaultMaterial=t)}get autoSyncTransforms(){return this._autoSyncTransforms}set autoSyncTransforms(t){this._autoSyncTransforms=t}get velocityIterations(){return this._world.getVelocityIterations()}set velocityIterations(t){this._world.setVelocityIterations(t>0?t:1)}get positionIterations(){return this._world.getPositionIterations()}set positionIterations(t){this._world.setPositionIterations(t>0?t:1)}}function _(t,n,r,a){return a>=e||p(t)?e:(e=a,c.collider=t._component.code,c.fraction=(c.distance=a*i)/s,c.m_Normal.set(r.x,r.y),c.m_Point.set(n.x,n.y),c.m_Centroid.set(n.x,n.y),a)}function p(e){if(e._isFaux)return!0;const i=e._component._entity;if(!(i.layerMask&t))return!0;const s=i.getPosition().z;return s<l||u<s}function m(t){return t===Number.POSITIVE_INFINITY?3402823e32:t===Number.NEGATIVE_INFINITY?-3402823e32:t}function f(t,e,n,r){if(p(t))return 1;let a=h.length;for(h.push(new UnityEngine.RaycastHit2D),y(a,t,e,n,e,(r*=i)/s,r);a>0&&!(h[a].fraction>=h[a-1].fraction);--a)E(a,a-1);return 1}function g(t,e,n,r){if(p(t))return 1;const o=r*i;let c;if(r=o/s,a<h.length)c=a++;else if(r>=h[c=h.length-1].fraction)return 1;for(y(c,t,e,n,e,r,o);c>0&&!(r>=h[c-1].fraction);--c)E(c,c-1);return 1}function y(t,e,i,s,n,r,a){const o=h[t];o.collider=e._component.code,o.fraction=r,o.distance=a,o.m_Normal.set(s.x,s.y),o.m_Point.set(i.x,i.y),o.m_Centroid.set(n.x,n.y)}function E(t,e){const i=h[t];h[t]=h[e],h[e]=i}function A(t){if(p(t))return 1;const e=t._component;return(null==c||e._entity.getPosition().z<c.handle._entity.getPosition().z)&&(c=e.code),1}function T(t){if(p(t))return 1;let e=h.length;const i=t._component,s=i._entity.getPosition().z;for(h.push(i.code);e>0&&!(s>=h[e-1].handle._entity.getPosition().z);--e)E(e,e-1);return 1}function C(t){if(p(t))return 1;let e;const i=t._component,s=i._entity.getPosition().z;if(a<h.length)e=a++;else if(s>=h[e=h.length-1].handle._entity.getPosition().z)return 1;for(h[e]=i.code;e>0&&!(s>=h[e-1].handle._entity.getPosition().z);--e)E(e,e-1);return 1}function b(t){const e=t.fixture;if(p(e))return 1;const i=e._component._id;let s=o[i];if(s>=0){if(t.fraction>=h[s].fraction)return 1}else s=h.length,h.push(new UnityEngine.RaycastHit2D);for(y(s,e,t.point,t.normal,t.centroid,t.fraction,t.distance);s>0&&!(h[s].fraction>=h[s-1].fraction);--s)E(s,s-1),o[h[s].collider.handle._id]=s;return o[i]=s,1}function S(t,e){const i=.5*t.x;let s=.5*t.y;const n=new planck.Vec2,r=new planck.Vec2;e===UnityEngine.CapsuleDirection2D.Vertical?(n.set(0,-s),r.set(0,s)):(n.set(-s,0),r.set(s,0)),s<=0&&(s=i);const a=Math.max(planck.Math.EPSILON,1-i/s);return n.mul(a),r.mul(a),{vertex1:n,vertex2:r,radius:i}}function x(t,i){if(i>e)return e;const s=t.fixture;if(p(s))return e;e=i,c.collider=s._component.code,c.fraction=t.fraction,c.distance=t.distance;const n=t.normal;c.m_Normal.set(n.x,n.y);const r=t.point;c.m_Point.set(r.x,r.y);const a=t.centroid;return c.m_Centroid.set(a.x,a.y),e}function D(t){const e=t.fixture;if(p(e))return 1;const i=e._component._id;let s=o[i];if(s>=0){if(t.fraction>=h[s].fraction)return 1}else if(a<h.length)s=a++;else{if(s=h.length-1,t.fraction>=h[s].fraction)return 1;o[h[s].collider.handle._id]=-1}for(y(s,e,t.point,t.normal,t.centroid,t.fraction,t.distance);s>0&&!(t.fraction>=h[s-1].fraction);--s)E(s,s-1),o[h[s].collider.handle._id]=s;return o[i]=s,1}return d.raycast=(a,o,h,p,f,g)=>{h=m(h),n.set(a.x,a.y),o=r.set(o.x,o.y),s=o.normalize(),0===s&&(s=1),r.mul(h),r.add(n),i=h,t=p,l=f,u=g,e=1/0;const y=c=new UnityEngine.RaycastHit2D;return d._world.rayCast(n,r,_),c=null,y},d.linecast=(a,o,h,p,m)=>{n.set(a.x,a.y),r.set(o.x,o.y),i=planck.Vec2.distance(n,r),s=i,0===s&&(s=1),t=h,l=p,u=m,e=1;const f=c=new UnityEngine.RaycastHit2D;return d._world.rayCast(n,r,_),c=null,f},d.raycastAll=(e,a,o,c,_,p)=>{o=m(o),n.set(e.x,e.y),a=r.set(a.x,a.y),s=a.normalize(),0===s&&(s=1),r.mul(o),r.add(n),i=o,t=c,l=_,u=p;const g=h=[];return d._world.rayCast(n,r,f),h=null,g},d.raycastNonAlloc=(e,o,c,_,p,f,y)=>null==c||0===c.length?0:(_=m(_),n.set(e.x,e.y),r.set(o.x,o.y),s=r.normalize(),0===s&&(s=1),r.mul(_),r.add(n),i=_,t=p,l=f,u=y,a=0,h=c,d._world.rayCast(n,r,g),h=null,a),d.overlapCircle=(e,i,s,r,a)=>{n.set(e.x,e.y),t=s,l=r,u=a,c=null,d._world.queryCircle(n,i,A);const o=c;return c=null,o},d.overlapCircleAll=(e,i,s,r,a)=>{n.set(e.x,e.y),t=s,l=r,u=a;const o=h=[];return d._world.queryCircle(n,i,T),h=null,o},d.overlapCircleNonAlloc=(e,i,s,r,o,c)=>null==s||0===s.length?0:(n.set(e.x,e.y),t=r,l=o,u=c,a=0,h=s,d._world.queryCircle(n,i,C),h=null,a),d.overlapPoint=(e,i,s,a)=>{r.set(n.set(e.x,e.y)),t=i,l=s,u=a,c=null,d._world.rayCast(n,r,A);const o=c;return c=null,o},d.overlapPointAll=(e,i,s,a)=>{r.set(n.set(e.x,e.y)),t=i,l=s,u=a;const o=h=[];return d._world.rayCast(n,r,T),h=null,o},d.overlapPointNonAlloc=(e,i,s,o,c)=>null==i||0===i.length?0:(r.set(n.set(e.x,e.y)),t=s,l=o,u=c,a=0,h=i,d._world.rayCast(n,r,C),h=null,a),d.ignoreCollision=(t,e,i)=>{d._adapter.ignoreCollision(t,e,i)},d.circleCastAll=(e,i,s,a,c,_,p)=>{a=m(a),n.set(e.x,e.y),s=r.set(s.x,s.y),t=c,l=_,u=p;const f=h=[];return o={},d._world.circleCast(n,i,s,a,b),h=o=null,f},d.boxCastAll=(e,i,s,a,c,_,p,f)=>{c=m(c),n.set(e.x,e.y),a=r.set(a.x,a.y),s*=pc.math.DEG_TO_RAD,t=_,l=p,u=f;const g=h=[];return o={},d._world.boxCast(n,.5*i.x,.5*i.y,s,a,c,b),h=o=null,g},d.capsuleCastAll=(e,i,s,a,c,_,p,f,g)=>{_=m(_),n.set(e.x,e.y),c=r.set(c.x,c.y),a*=pc.math.DEG_TO_RAD,t=p,l=f,u=g;const y=S(i,s),E=h=[];return o={},d._world.capsuleCast(n,y.vertex1,y.vertex2,y.radius,a,c,_,b),h=o=null,E},d.circleCast=(i,s,a,o,h,_,p)=>{o=m(o),n.set(i.x,i.y),a=r.set(a.x,a.y),t=h,l=_,u=p,e=1;const f=c=new UnityEngine.RaycastHit2D;return d._world.circleCast(n,s,a,o,x),c=null,f},d.boxCast=(i,s,a,o,h,_,p,f)=>{h=m(h),n.set(i.x,i.y),o=r.set(o.x,o.y),a*=pc.math.DEG_TO_RAD,t=_,l=p,u=f,e=1;const g=c=new UnityEngine.RaycastHit2D;return d._world.boxCast(n,.5*s.x,.5*s.y,a,o,h,x),g},d.capsuleCast=(i,s,a,o,h,_,p,f,g)=>{_=m(_),n.set(i.x,i.y),h=r.set(h.x,h.y),o*=pc.math.DEG_TO_RAD,t=p,l=f,u=g;const y=S(s,a);e=1;const E=c=new UnityEngine.RaycastHit2D;return d._world.capsuleCast(n,y.vertex1,y.vertex2,y.radius,o,h,_,x),E},d.circleCastNonAlloc=(e,i,s,c,_,p,f,g)=>null==c||0===c.length?0:(_=m(_),n.set(e.x,e.y),s=r.set(s.x,s.y),t=p,l=f,u=g,a=0,h=c,o={},d._world.circleCast(n,i,s,_,D),h=o=null,a),d.boxCastNonAlloc=(e,i,s,c,_,p,f,g,y)=>null==_||0===_.length?0:(p=m(p),n.set(e.x,e.y),c=r.set(c.x,c.y),s*=pc.math.DEG_TO_RAD,t=f,l=g,u=y,a=0,h=_,o={},d._world.boxCast(n,.5*i.x,.5*i.y,s,c,p,D),h=o=null,a),d.capsuleCastNonAlloc=(e,i,s,c,_,p,f,g,y,E)=>{if(null==p||0===p.length)return 0;f=m(f),n.set(e.x,e.y),_=r.set(_.x,_.y),c*=pc.math.DEG_TO_RAD,t=g,l=y,u=E;const A=S(i,s);return a=0,h=p,o={},d._world.capsuleCast(n,A.vertex1,A.vertex2,A.radius,c,_,f,D),h=o=null,a},d.getRayIntersectionAll=(t,e,i,s)=>{if(0===e.z)return[];i=m(i);const n=d.raycastAll(t,e,i,s,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);for(let i=0;i<n.length;i++){const s=n[i],r=s.transform.position;if(Math.sign(r.z-t.z)!==Math.sign(e.z)){n.splice(i,1),i--;continue}const a=Math.abs((t.z-r.z)/e.z),o=new pc.Vec2(t.x+e.x*a,t.y+e.y*a);s.collider.OverlapPoint(o)?(s.point=o,s.distance=pc.Vec3.distance(t,o),s.fraction=s.distance,n[i]=s):(n.splice(i,1),i--)}return e.z>0?n.sort(((t,e)=>t.transform.position.z-e.transform.position.z)):n.sort(((t,e)=>e.transform.position.z-t.transform.position.z))},d.getRayIntersectionNonAlloc=(t,e,i,s,n)=>{if(null==i||0===i.length||0===e.z)return 0;s=m(s);const r=d.raycastAll(t,e,s,n,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);let a=0;for(let s=0;s<r.length&&a<i.length;s++){const n=r[s],o=n.transform.position;if(Math.sign(o.z-t.z)!==Math.sign(e.z))continue;const h=Math.abs((t.z-o.z)/e.z),c=new pc.Vec2(t.x+e.x*h,t.y+e.y*h);n.collider.OverlapPoint(c)&&(n.point=c,n.distance=pc.Vec3.distance(t,c),n.fraction=n.distance,i[a]=n,a++)}return e.z>0?i.sort(((t,e)=>t.transform===e.transform?0:null===t.transform?1:null===e.transform?-1:t.transform.position.z-e.transform.position.z)):i.sort(((t,e)=>t.transform===e.transform?0:null===t.transform?1:null===e.transform?-1:e.transform.position.z-t.transform.position.z)),a},d.isTouching=(t,e)=>{const i=t.handle,s=e.handle.$id;if(!i._contacts||i.$id===s)return!1;for(const t in i._contacts){if(!i._contacts.hasOwnProperty(t))continue;const e=i._contacts[t],n=e.getFixtureA(),r=e.getFixtureB(),a=n._component,o=r._component;if(a.$id===s||o.$id===s)return!0}return!1},{Physics2DSystem:d}})()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="rigidbody2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this._physics2DSystem=pc.Application.getApplication().systems.physics2D}removeComponent(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}get adapter(){return this._physics2DSystem.adapter}}return{Rigidbody2DSystem:t}}()),Object.assign(pc,function(){const t=planck.Math.EPSILON,e=.001,i=Math.PI*e*e,s=planck.Body,n=new planck.Vec2,r=new planck.Vec2,a=new pc.Quat,o=new pc.Vec3;class h extends pc.UnityComponent{constructor(t){super(),t=t||{enabled:!0,simulated:!0,type:UnityEngine.RigidbodyType2D.Dynamic,collisionDetectionMode:UnityEngine.CollisionDetectionMode2D.Discrete,mass:1},this._system=pc.Application.getApplication().systems.rigidbody2D,this._enabled=t.enabled,this._simulated=t.simulated,this._collisionDetectionMode=t.collisionDetectionMode,this._constraints=t.constraints||0,this._freezeRotation=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezeRotation),this._freezeX=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezePositionX),this._freezeY=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezePositionY),this._useCollidersDensity=!!t.useAutoMass,this._adapter=this._system.adapter,this._world=this._adapter.world,this._body=this._world.createBody({type:t.type===UnityEngine.RigidbodyType2D.Dynamic?s.DYNAMIC:t.type===UnityEngine.RigidbodyType2D.Kinematic?s.KINEMATIC:s.STATIC,bullet:this._collisionDetectionMode===UnityEngine.CollisionDetectionMode2D.Continuous,gravityScale:Number.isFinite(t.gravityScale)?t.gravityScale:1,angularDamping:t.angularDrag>=0?t.angularDrag:.05,linearDamping:t.drag>0?t.drag:0,fixedRotation:this._freezeRotation,defaultMass:t.mass,fixedX:this._freezeX,fixedY:this._freezeY,active:!1}),this._body._component=this,this._body._entity=t.entity,this._body._material=t.material,this._worldTransformVersion=-1,this.createFauxFixture(),this["__UnityEngine.Rigidbody2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Rigidbody2DComponent")}get body(){return this._body}get destroyed(){return this._destroyed}get useCollidersDensity(){return this._useCollidersDensity}createFauxFixture(){const t=this._body._density=this._body.getDefaultMass()/i;this._body.createFixture(new planck.Circle(e),{density:t,filterMaskBits:0})._isFaux=!0}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._simulated&&this._adapter.enableRigidbody(this),!0)}onDisable(){if(!pc.UnityComponent.prototype.onDisable.call(this))return!1;if(this._simulated&&this._enabled&&this._adapter.disableRigidbody(this),this._entity._enabled)return!0;let t=this._body.getJointList();for(;t;){const e=t.joint;t=t.next,e.getBodyB()===this._body&&this._world.destroyJoint(e)}return!0}onDestroy(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this._destroyed=!0,this.onDisable(),this._world.destroyBody(this._body),!0)}addForce(t){this._body.applyForceToCenter(n.set(t.x,t.y),!0)}addImpulse(t){this._body.applyLinearImpulseToCenter(n.set(t.x,t.y),!0)}addForceAtPosition(t,e){this._body.applyForce(n.set(t.x,t.y),r.set(e.x,e.y),!0)}addImpulseAtPosition(t,e){this._body.applyLinearImpulse(n.set(t.x,t.y),r.set(e.x,e.y),!0)}addRelativeForce(t){this._body.applyForceToCenter(n.set(t.x,t.y).rot(this._body.getTransform().q),!0)}addRelativeImpulse(t){this._body.applyLinearImpulseToCenter(n.set(t.x,t.y).rot(this._body.getTransform().q),!0)}addTorque(t){this._body.applyTorque(t,!0)}addTorqueImpulse(t){this._body.applyAngularImpulse(t,!0)}getVelocity(){const t=this._body.getLinearVelocity();return this._velocity=(this._velocity||new pc.Vec2).set(t.x,t.y),this._velocity}setVelocity(t){this._freezeX&&this._freezeY||(this._freezeX||this._freezeY?(n.set(this._body.getLinearVelocity()),this._freezeX?n.y=t.y:n.x=t.x,this._body.setLinearVelocity(n)):this._body.setLinearVelocity(n.set(t.x,t.y)))}getAngularVelocity(){return this._body.getAngularVelocity()*pc.math.RAD_TO_DEG}setAngularVelocity(t){this._freezeRotation||this._body.setAngularVelocity(t*pc.math.DEG_TO_RAD)}getMass(){return this._body.getMass()}setMass(t){if(this._useCollidersDensity)return void UnityEngine.Debug.LogWarningFormat("Mass cannot be set on the rigid-body when it is using auto-mass.");const e=this._body;e.getMass()!==t&&(e.setDefaultMass(t),h.setDensity(e,e.getDefaultMass()/e.getMass()*e._density),e.setAwake(!0))}getUseAutoMass(){return this._useCollidersDensity}setUseAutoMass(t){this._useCollidersDensity!==t&&(this._useCollidersDensity=!!t,this._resetMassData())}_resetMassData(){const t=this._body;if(!this._useCollidersDensity){const e=t.getDefaultMass();return h.setDensity(t,1),void this.setMass(e)}let e=t.getFixtureList();if(!e._isFaux){for(;e;e=e.getNext()){const t=e._component.getDensity();e.setDensity(t)}t.resetMassData(),t.setAwake(!0)}}getInertia(){return this._body.getInertia()}setInertia(t){this._body.setInertia(Math.max(t,1e-4))}getDrag(){return this._body.getLinearDamping()}setDrag(t){this._body.setLinearDamping(t)}getAngularDrag(){return this._body.getAngularDamping()}setAngularDrag(t){this._body.setAngularDamping(t)}getPosition(){const t=this._body.getPosition();return new pc.Vec2(t.x,t.y)}setPosition(t){this._body.setPosition(r.set(t.x,t.y))}getRotation(){return this._body.getAngle()*pc.math.RAD_TO_DEG}setRotation(t){this._body.setAngle(t*pc.math.DEG_TO_RAD)}getGravityScale(){return this._body.getGravityScale()}setGravityScale(t){this._body.setGravityScale(t)}getCollisionDetectionMode(){return this._collisionDetectionMode}setCollisionDetectionMode(t){this._collisionDetectionMode!==t&&(this._collisionDetectionMode=t,this._body.setBullet(t===UnityEngine.CollisionDetectionMode2D.Continuous))}getSimulated(){return this._simulated}setSimulated(t){t!==this._simulated&&(this._simulated=t,this._enabled&&(t?this._adapter.enableRigidbody(this):this._adapter.disableRigidbody(this)))}getBodyType(){switch(this._body.getType()){case s.DYNAMIC:return UnityEngine.RigidbodyType2D.Dynamic;case s.KINEMATIC:return UnityEngine.RigidbodyType2D.Kinematic;case s.STATIC:return UnityEngine.RigidbodyType2D.Static;default:return NaN}}setBodyType(t){if(this.getBodyType()!==t)switch(t){case UnityEngine.RigidbodyType2D.Dynamic:this._body.setType(s.DYNAMIC),this._resetMassData();break;case UnityEngine.RigidbodyType2D.Kinematic:this._body.setType(s.KINEMATIC);break;case UnityEngine.RigidbodyType2D.Static:this._body.setType(s.STATIC)}}getIsKinematic(){return this._body.getType()===s.KINEMATIC}setIsKinematic(t){this._body.setType(t?s.KINEMATIC:s.DYNAMIC)}getIsStatic(){return this._body.getType()===s.STATIC}getFreezeRotation(){return this._freezeRotation}setFreezeRotation(t){t!==this._freezeRotation&&(this._body.setFixedRotation(this._freezeRotation=!!t),this._freezeRotation?this._constraints|=UnityEngine.RigidbodyConstraints2D.FreezeRotation:this._constraints&=~UnityEngine.RigidbodyConstraints2D.FreezeRotation)}getConstraints(){return this._constraints}setConstraints(t){t!==this._constraints&&(this._constraints=t,this._freezeRotation!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezeRotation)&&this._body.setFixedRotation(this._freezeRotation=!this._freezeRotation),this._freezeX!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezePositionX)&&this._body.setFixedX(this._freezeX=!this._freezeX),this._freezeY!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezePositionY)&&this._body.setFixedY(this._freezeY=!this._freezeY))}getCenterOfMass(){const t=this._body.getLocalCenter();return new pc.Vec2(t.x,t.y)}setCenterOfMass(t){r.set(t.x,t.y),this._body.setLocalCenter(r)}moveRotation(t){this._freezeRotation||(t*=pc.math.DEG_TO_RAD,this._body.setAngularVelocity((t-this._body.getAngle())/this._world.getLastTimeStep()))}movePosition(t){this._body.setPosition(t)}wakeUp(){this._body.setAwake(!0)}getAttachedColliderCount(){let t=this.body.getFixtureList(),e=0;for(;t;)e++,t=t.getNext();return e}getAttachedColliders(t){let e=this.body.getFixtureList(),i=0;for(;i<t.length&&e;)t[i]=e,i++,e=e.getNext();return i}}return h.setBodyTransform=(e,i,s)=>{if(r.set(i.x,i.y),s*=pc.math.DEG_TO_RAD,e.getPosition().closeTo(r)){const i=(s-e.getAngle())/(2*Math.PI);if(Math.abs(Math.round(i)-i)<=t)return}e.setTransform(r,s),e.dirtifyTransform(!1)},h.setEntityTransform=(e,i)=>{if(!e.isDirtyTransform())return;const s=e.getTransform(),n=i.getPosition();r.set(n.x,n.y),i.getRotation().getEulerAngles(o);const h=s.q.getAngle()*pc.math.RAD_TO_DEG;Math.abs(h-o.z)>t&&(a.setFromEulerAngles(o.x,o.y,h),i.setRotation(a)),r.closeTo(s.p)||i.setPosition(s.p.x,s.p.y,n.z),e.dirtifyTransform(!1)},h.setDensity=(t,e)=>{t._density=e;for(let i=t.getFixtureList();i;i=i.getNext())i.setDensity(e);t.resetMassData()},{Rigidbody2DComponent:h}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="collider2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this._physics2DSystem=pc.Application.getApplication().systems.physics2D}removeComponent(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}get defaultMaterial(){return this._physics2DSystem.defaultMaterial}set defaultMaterial(t){this._physics2DSystem.defaultMaterial=t}}return{Collider2DSystem:t}}()),Object.assign(pc,function(){const t=.005,e=planck.Math.EPSILON,i=new planck.Vec2,s=new pc.Vec3;let n,r;const a=new pc.Vec3,o=new pc.Vec3;let h;class c extends pc.UnityComponent{constructor(t){super(),t=t||{enabled:!0},this._enabled=void 0===t.enabled||t.enabled,this._fixtureDef=t.fixture||{active:!1},this._shape=t.shape,this._isTrigger=t.isTrigger,this._usedByEffector=t.usedByEffector,this._density=t.density>=0?t.density:1,this._offset=this._offset||t.offset,this._type=t.type||"collider2D",this._relativePosition=new pc.Vec3(0,0,0),this._accumulatedScale=new pc.Vec3(1,1,1),this._adapter=pc.Application.getApplication().systems.physics2D.adapter,this._material=t.material,this._material&&(this._fixtureDef.friction=this._material.friction,this._fixtureDef.restitution=this._material.bounciness),this._fixtureDef.isSensor=this._isTrigger,this._contacts={},this["__UnityEngine.Collider2D"]=null}get code(){return this._code||this._initializeCode(),this._code}get shape(){return this._shape}get type(){return this._type}_initializeCode(){this._code&&(this["__UnityEngine.Collider2D"]=this._code,this._code.handle=this)}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableCollider(this),!0)}onDisable(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableCollider(this),!0)}onDestroy(){if(!pc.UnityComponent.prototype.onDestroy.call(this))return!1;if(this.onDisable(),this._fixture){const t=this._fixture.getBody();t.destroyFixture(this._fixture),t._component&&!t.getFixtureList()&&t._component.createFauxFixture(),this._fixture=null}return!0}addFixture(t){if(this._fixture){const e=this._fixture.getBody();if(e===t)return;e.destroyFixture(this._fixture),this._fixture=null}else{const e=t.getFixtureList();e&&e._isFaux&&t.destroyFixture(e)}const e=t._component&&t._component.useCollidersDensity;if(this._fixtureDef.density=e?this._density:t._density,!this._material){const e=t._material||this._system.defaultMaterial;this._fixtureDef.friction=e.friction,this._fixtureDef.restitution=e.bounciness}this._fixture=t.createFixture(this._shape,this._fixtureDef),this._fixture._component=this,this._body=t}updateShape(t,e,i){t.getTranslation(this._relativePosition),this._accumulatedScale.copy(e),i&&i!==this._body||this._updateShapeSizeAndPosition()}_updateShapeSizeAndPosition(t){const e=this._fixture;e&&(e.createProxies(),this._resetMassData())}_resetMassData(){this._resetBodyMassData(this._fixture.getBody())}_resetBodyMassData(t){if(t.resetMassData(),t.fixturesAreBlank()||t.isStatic()||t.isKinematic()||t._component&&t._component.useCollidersDensity)return t.setDefaultMass(t.getMass()),void t.setAwake(!0);const e=this._fixtureDef.density=t.getDefaultMass()/t.getMass()*t._density;pc.Rigidbody2DComponent.setDensity(t,e),t.setAwake(!0)}_transformVertices(){const t=this._entity.getWorldTransform(),e=this._vertices,n=this._vertices2D;let r=!1;const a=this._getAngle2D(),o=Math.cos(a),h=Math.sin(a),c=this._relativePosition;let l;for(let a=e.length,u=0;u<a;++u)s.copy(e[u]),t.transformVector(s,s).add(c),l=n[u],i.set(s).rotate(o,h).closeTo(l)||(l.set(i),r=!0);return r}_getAngle2D(){return-(this._body._entity||this._body._component._entity).getEulerAngles().z*pc.math.DEG_TO_RAD}enable(){this._fixtureDef.active=!0,this._fixture&&(this._fixture.setActive(!0),this._resetMassData())}disable(){this._fixtureDef.active=!1,this._fixture&&(this._fixture.setActive(!1),this._resetMassData())}addContact(t,e){this._contacts[e]=t}removeContact(t){this._contacts&&delete this._contacts[t]}_getContacts(){return this._contacts}overlapPoint(t){return!!this._fixture&&this._fixture.testPoint(i.set(t.x,t.y))}getContactedColliders(t){if(!(t&&t.length>0&&this._contacts))return 0;let e=0;for(const i in this._contacts){if(!this._contacts.hasOwnProperty(i))continue;const s=this._contacts[i],n=s.getFixtureA(),r=s.getFixtureB();if(!n.getBody()||!r.getBody())continue;const a=n._component,o=r._component;if(!a._isTrigger&&!o._isTrigger&&(n===this._fixture?t[e++]=o.code:r===this._fixture&&(t[e++]=a.code),e>=t.length))break}return e}getIsTrigger(){return this._isTrigger}setIsTrigger(t){t=!!t,this._isTrigger!==t&&(this._fixtureDef.isSensor=this._isTrigger=t,this._fixture&&this._fixture.setSensor(t))}getIsUsedByEffector(){return this._usedByEffector}setIsUsedByEffector(t){this._usedByEffector=!!t}getOffset(){return this._offset.clone()}setOffset(t){throw new Error("Not Implemented")}getShapeCount(){return 1}overlapCollider(t,e){return null!=e&&0!==e.length&&this._fixture?(n=0,r=e,this._fixture.queryOverlaps(this._reportOverlap),r=null,n):0}_reportOverlap(t){return!!t._isFaux||(r[n++]=t._component.code,n<r.length)}getDistance(t){const e=new UnityEngine.ColliderDistance2D;if(null==t||null==t._fixture||null==this._fixture)return e;const i=this._adapter.world.getDistance(this._fixture,t._fixture);if(null==i)return e;let s=i.pointA,n=i.pointB;return s=e.pointA.set(s.x,s.y),n=e.pointB.set(n.x,n.y),e.distance=i.distance,e.normal.copy(s).sub(n).normalize(),e.isValid=!0,e}getBounds(){const t=new UnityEngine.Bounds;if(!this._fixture||!this._fixtureDef.active)return t;const e=this._fixture.getProxyCount();if(e<1)return t;h=h||new planck.AABB,h.set(this._fixture.getAABB(0));for(let t=1;t<e;++t)h.combine(h,this._fixture.getAABB(t));const i=this._entity.getPosition().z;return a.set(h.lowerBound.x,h.lowerBound.y,i),o.set(h.upperBound.x,h.upperBound.y,i),t.SetMinMax(a,o),t}getDensity(){return this._density}setDensity(t){if(this._density===t)return;const e=this._body;if(e&&e._component&&!e._component.useCollidersDensity)return void UnityEngine.Debug.LogWarningFormat("Density cannot be set on the collider unless it is attached to a dynamic rigid-body that is using auto-mass.");this._fixtureDef.density=this._density=t=t>=0?t:0;const i=this._fixture;i&&(i.setDensity(t),this._resetBodyMassData(i.getBody()))}getSharedMaterial(){return this._material}setSharedMaterial(t){this._material=t,t||(this._body&&(t=this._body._material),t=t||this._system.defaultMaterial);const e=this._fixtureDef;e.friction=t.friction,e.restitution=t.bounciness;const i=this._fixture;i&&(i.setFriction(t.friction),i.setRestitution(t.bounciness))}}return{Collider2DComponent:c,BoxCollider2DComponent:class extends c{constructor(e){(e=e||{}).type="boxCollider2D";const s=(new pc.Vec2).copy(e.size||pc.Vec2.ZERO).setFromMax(t,t),n=(new pc.Vec2).copy(e.center||pc.Vec2.ZERO),r=new planck.Box(.5*s.x,.5*s.y,i.set(n.x,n.y));r.setRadius(e.radius),e.shape=r,super(e),this._offset=n,this._size=s;const a=this._vertices2D=r.m_vertices,o=this._vertices=new Array(a.length);for(let t=o.length,e=0;e<t;++e)o[e]=new pc.Vec3(a[e].x,a[e].y,0);this["__UnityEngine.BoxCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"BoxCollider2DComponents")}_initializeCode(){this._code=new UnityEngine.BoxCollider2D(this),this["__UnityEngine.BoxCollider2D"]=this._code,c.prototype._initializeCode.call(this)}_updateShapeSizeAndPosition(t){(this._fixture||t)&&(this._transformVertices()||t)&&(this._shape._set(this._vertices2D),c.prototype._updateShapeSizeAndPosition.call(this))}getSize(){return this._size.clone()}setSize(e){let i=(e=e||pc.Vec2.ZERO).x,s=e.y;i<t&&(i=t),s<t&&(s=t),(e=this._size).x===i&&e.y===s||(this._size.set(i,s),this._rebuild())}_rebuild(){this._shape._setAsBox(.5*this._size.x,.5*this._size.y,i.set(this._offset.x,this._offset.y));const t=this._vertices;let e;const s=this._vertices2D;for(let i=t.length,n=0;n<i;++n)e=s[n],t[n].set(e.x,e.y,0);this._updateShapeSizeAndPosition()}setOffset(t){this._offset.equals(t=t||pc.Vec2.ZERO)||(this._offset.copy(t),this._rebuild())}getShapeCount(){return this._size.x<=t||this._size.y<=t?0:1}},CircleCollider2DComponent:class extends c{constructor(e){(e=e||{}).type="circleCollider2D";const s=(new pc.Vec2).copy(e.center||pc.Vec2.ZERO);i.set(s.x,s.y);const n=e.radius=e.radius>0?e.radius:t,r=e.shape=new planck.Circle(i,n);super(e),this._center=new pc.Vec3(i.x,i.y,0),this._vertices=[this._center],this._vertices2D=[r.m_p],this._radius=n,this._offset=s,this["__UnityEngine.CircleCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"CircleCollider2DComponent")}_initializeCode(){this._code=new UnityEngine.CircleCollider2D(this),this["__UnityEngine.CircleCollider2D"]=this._code,c.prototype._initializeCode.call(this)}_updateShapeSizeAndPosition(t){if(this._fixture||t){const e=this._transformVertices(),i=this._scaleRadius();(e||i||t)&&this._rebuild()}}_rebuild(){c.prototype._updateShapeSizeAndPosition.call(this),this._shape.m_vertices=null}_scaleRadius(){const t=this._radius*Math.max(this._accumulatedScale.x,this._accumulatedScale.y),i=t-this._shape.getRadius();return!(-e<=i&&i<=e)&&(this._shape.setRadius(t),!0)}getRadius(){return this._radius}setRadius(t){this._radius!==t&&(this._radius=t,this._fixture&&this._scaleRadius()&&this._rebuild())}setOffset(t){this._offset.equals(t=t||pc.Vec2.ZERO)||(this._offset.copy(t),this._center.set(t.x,t.y,0),this._fixture&&this._transformVertices()&&this._rebuild())}},CapsuleCollider2DComponent:class extends c{constructor(e){(e=e||{}).type="capsuleCollider2D",super(e),this._offset=(new pc.Vec2).copy(e.center||pc.Vec2.ZERO),this._size=(new pc.Vec2).copy(e.size||pc.Vec2.ZERO).setFromMax(t,t),this._direction=e.direction||UnityEngine.CapsuleDirection2D.Vertical,this._vertices2D=[new planck.Vec2,new planck.Vec2,new planck.Vec2],this._vertices=[new pc.Vec3,new pc.Vec3,new pc.Vec3],this._vertex1=new planck.Vec2,this._vertex2=new planck.Vec2,this._radius=0,this._calculateVertices(),this._calculateShape(),this._shape=new planck.Capsule(this._vertex1,this._vertex2,this._radius),this["__UnityEngine.CapsuleCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"CapsuleCollider2DComponent")}_calculateVertices(){const t=this._offset.x,e=this._offset.y,i=.5*this._size.x,s=.5*this._size.y,n=this._vertices2D,r=this._vertices;this._direction===UnityEngine.CapsuleDirection2D.Vertical?(n[0].set(t,e-s),n[1].set(t,e+s),n[2].set(t+i,e)):(n[0].set(t-s,e),n[1].set(t+s,e),n[2].set(t,e+i));for(let t=0,e=n.length;t<e;++t){const e=n[t];r[t].set(e.x,e.y,0)}}_calculateShape(){const t=this._vertices2D[0],i=this._vertices2D[1],s=this._vertices2D[2],n=t.x,r=t.y,a=i.x,o=i.y,h=.5*(n+a),c=.5*(r+o),l=s.x-h,u=s.y-c,d=Math.sqrt(l*l+u*u);this._radius=d;let _=n-h,p=r-c,m=Math.sqrt(_*_+p*p);m<=0&&(m=d);const f=Math.max(e,1-d/m);this._vertex1.x=h+f*_,this._vertex1.y=c+f*p,_=a-h,p=o-c,this._vertex2.x=h+f*_,this._vertex2.y=c+f*p}_initializeCode(){this._code=new UnityEngine.CapsuleCollider2D(this),this["__UnityEngine.CapsuleCollider2D"]=this._code,c.prototype._initializeCode.call(this)}_updateShapeSizeAndPosition(t){(this._fixture||t)&&(this._transformVertices()||t)&&(this._calculateShape(),this._shape.setRadius(this._radius),this._shape.setVertex1(this._vertex1),this._shape.setVertex2(this._vertex2),c.prototype._updateShapeSizeAndPosition.call(this))}getSize(){return this._size.clone()}setSize(t){this._size.equals(t)||(this._size=t,this._calculateVertices(),this._updateShapeSizeAndPosition())}getDirection(){return this._direction}},EdgeCollider2DComponent:class extends c{constructor(t){(t=t||{}).type="edgeCollider2D",super(t),this._init(t),this._shape=new planck.Chain(this._vertices2D,!1,t.radius),this["__UnityEngine.EdgeCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"EdgeCollider2DComponent")}get edgeRadius(){return this._shape.getRadius()}set edgeRadius(t){this._shape.setRadius(t)}_initializeCode(){this._code=new UnityEngine.EdgeCollider2D(this),this["__UnityEngine.EdgeCollider2D"]=this._code,c.prototype._initializeCode.call(this)}_updateShapeSizeAndPosition(t){(this._fixture||t)&&(!this._body||this._transformVertices()||t)&&(this._shape._createChain(this._vertices2D),c.prototype._updateShapeSizeAndPosition.call(this))}_init(t){this._offset=(new pc.Vec2).copy(t.offset||pc.Vec2.ZERO);const e=t.points||[],i=e.length,s=i/2,n=this._points=new Array(s),r=this._vertices=new Array(s),a=this._vertices2D=new Array(s),o=this._offset.x,h=this._offset.y;for(let t,s,c,l,u=0,d=0;u<i;u+=2,++d)t=e[u],s=e[u+1],c=o+t,l=h+s,n[d]=new pc.Vec2(t,s),a[d]=new planck.Vec2(c,l),r[d]=new pc.Vec3(c,l,0)}setOffset(t){if(this._offset.equals(t=t||pc.Vec2.ZERO))return;this._offset.copy(t);const e=this._points,i=this._vertices,s=t.x,n=t.y;for(let t,r=0,a=e.length;r<a;++r)t=e[r],i[r].set(s+t.x,n+t.y,0);this._updateShapeSizeAndPosition()}getPoints(){let t;const e=this._points,i=e.length,s=new Array(i);for(let n=0;n<i;++n)t=e[n],s[n]=new pc.Vec2(t.x,t.y);return s}setPoints(t){let e,i,s,n,r,a=0;const o=(t=t||[]).length,h=this._offset.x,c=this._offset.y,l=this._vertices,u=this._vertices2D,d=this._points;for(let e=Math.min(o,l.length);a<e;++a)s=t[a],n=s.x,r=s.y,l[a].set(h+n,c+r,0),d[a].set(n,r);for(l.length=u.length=d.length=o;a<o;++a)s=t[a],n=s.x,r=s.y,e=h+n,i=c+r,u[a]=new planck.Vec2(e,i),l[a]=new pc.Vec3(e,i,0),d[a]=new pc.Vec2(n,r);this._updateShapeSizeAndPosition(!0)}getPointCount(){return this._vertices.length}},PolygonCollider2DComponent:class extends c{constructor(t){(t=t||{}).type="polygonCollider2D",super(t),this._init(t),this._shape=new planck.CompositePolygon(this._contours),this["__UnityEngine.PolygonCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"PolygonCollider2DComponent")}_initializeCode(){this._code=new UnityEngine.PolygonCollider2D(this),this["__UnityEngine.PolygonCollider2D"]=this._code,c.prototype._initializeCode.call(this)}_updateShapeSizeAndPosition(t){(this._fixture||t)&&(!this._body||this._transformVertices()||t)&&(this._shape._set(this._contours),c.prototype._updateShapeSizeAndPosition.call(this))}_init(t){this._offset=(new pc.Vec2).copy(t.offset||pc.Vec2.ZERO);const e=this._offset.x,i=this._offset.y,s=this._points=t.points||[],n=s.length,r=this._vertices=new Array(n),a=this._contours=new Array(n);for(let t=0;t<n;++t){const n=s[t]||[],o=n.length,h=o>>1,c=r[t]=new Array(h),l=a[t]=new Array(o);for(let t,s,r=0,a=0;r<o;r+=2,++a)t=l[r]=n[r]+e,s=l[r+1]=n[r+1]+i,c[a]=new pc.Vec3(t,s,0)}}_transformVertices(){let t=!1;const e=this._entity.getWorldTransform(),i=this._getAngle2D(),s=Math.cos(i),n=Math.sin(i),r=this._relativePosition,a=this._vertices,o=this._contours;for(let i=a.length,h=0;h<i;++h){const i=o[h],c=a[h];t=this._setContour(i,c,e,s,n,r)||t}return t}_transformContour(t){const e=this._entity.getWorldTransform(),i=this._getAngle2D(),s=Math.cos(i),n=Math.sin(i),r=this._relativePosition,a=this._contours[t],o=this._vertices[t];return this._setContour(a,o,e,s,n,r)}_setContour(t,e,n,r,a,o){let h=!1;for(let c=t.length,l=0,u=0;l<c;l+=2,++u)s.copy(e[u]),n.transformVector(s,s).add(o),i.set(s).rotate(r,a).closeToValues(t[l],t[l+1])||(t[l]=i.x,t[l+1]=i.y,h=!0);return h}setOffset(t){if(this._offset.equals(t=t||pc.Vec2.ZERO))return;this._offset.copy(t);const e=t.x,i=t.y,s=this._points,n=this._vertices;for(let t=0,r=s.length;t<r;++t){const r=s[t],a=n[t];for(let t=0,n=0,o=s.length;t<o;t+=2,++n)a[n].set(e+r[t],i+r[t+1],0)}this._updateShapeSizeAndPosition()}getPoints(){return 0===this._points.length?[]:this.getPath(0)}getPath(t){if(t>=this._points.length||t<0)throw new System.ArgumentOutOfRangeException.ctor;const e=this._points[t],i=e.length,s=new Array(i>>1);for(let t=0,n=0;t<i;t+=2,++n)s[n]=new pc.Vec2(e[t],e[t+1]);return s}setPoints(t){null!=t&&0!==t.length&&this.setPath(0,t)}setPath(t,e){if(null==e)throw new System.ArgumentNullException;const i=this._points,s=i.length;if(t>0&&t>=s||t<0)throw new System.ArgumentOutOfRangeException.ctor;const n=this._contours,r=this._vertices;let a,o;0===s&&(i[0]=[],n[0]=[],r[0]=[]);let h=0,l=0;const u=e.length;let d,_,p;const m=this._offset.x,f=this._offset.y,g=i[t],y=n[t],E=r[t],A=E.length!==u;for(let t=Math.min(u,E.length);h<t;++h,l+=2)d=e[h],_=d.x,p=d.y,E[h].set(m+_,f+p,0),g[l]=_,g[l+1]=p;for(E.length=u,y.length=g.length=2*u;h<u;++h,l+=2)d=e[h],_=d.x,p=d.y,a=m+_,o=f+p,E[h]=new pc.Vec3(a,o,0),y[l]=a,y[l+1]=o,g[l]=_,g[l+1]=p;(!this._body||this._transformContour(t)||A)&&(this._shape._set(this._contours),c.prototype._updateShapeSizeAndPosition.call(this))}getPathCount(){return this._points.length}setPathCount(t){const e=this._points,i=e.length;if(i===t)return;t<0&&(t=0);const s=this._contours,n=this._vertices;if(e.length=t,s.length=t,n.length=t,t<i)return this._shape._set(this._contours),void c.prototype._updateShapeSizeAndPosition.call(this);for(let r=i;r<t;++r)e[r]=[],s[r]=[],n[r]=[]}getTotalPointCount(){let t=0;const e=this._vertices;for(let i=0,s=e.length;i<s;++i)t+=e[i].length;return t}}}}()),pc.extend(planck.Contact.prototype,{getContactPoint:function(t,e){const i=new UnityEngine.ContactPoint2D;i.collider=e.collider,i.otherCollider=e.otherCollider,i.rigidbody=e.rigidbody,i.otherRigidbody=e.otherRigidbody;const s=this.v_points[t];return i.point.set(s.worldPoint.x,s.worldPoint.y),i.normal.set(this.v_normal.x,this.v_normal.y),i.normalImpulse=s.normalImpulse,i.tangentImpulse=s.tangentImpulse,i.separation=s.separation,i}}),Object.assign(pc,function(){class t extends pc.UnityComponent{constructor(t){super(),t&&(this._enabled=!!t.enabled,this._useColliderMask=!!t.useColliderMask,this._colliderMask=t.colliderMask),this._adapter=pc.Application.getApplication().systems.physics2D.adapter}get useColliderMask(){return this._useColliderMask}set useColliderMask(t){this._useColliderMask=t}_initializeCode(){this._code&&(this["__UnityEngine.Effector2D"]=this._code,this._code.handle=this)}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableEffector(this),!0)}onBeforeCollision2D(t){const e=t.getFixtureA(),i=t.getFixtureB(),s=e._component._body.getLinearVelocity(),n=i._component._body.getLinearVelocity();s.y+n.y>0&&t.setEnabled(!1)}onDisable(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableEffector(this),!0)}onDestroy(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.onDisable(),!0)}}return{Effector2DComponent:t,PlatformEffector2DComponent:class extends t{_initializeCode(){this._code=new UnityEngine.PlatformEffector2D(this),this["__UnityEngine.PlatformEffector2D"]=this._code,t.prototype._initializeCode.call(this)}}}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="effector2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D}removeComponent(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}return{Effector2DSystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="joint2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D}removeComponent(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}return{Joint2DSystem:t}}()),Object.assign(pc,function(){const t=["onFixedUpdate"],e=pc.math.DEG_TO_RAD,i=pc.math.RAD_TO_DEG,s=new planck.Vec2;class n extends pc.UnityComponent{constructor(t){if(super(),this.constraint=this._jointDef={active:!1},t){this._enabled=!!t.enabled,this._enableCollision=!!t.enableCollision;const e=t.breakForce,i=t.breakTorque;this._breakForce=Number.isFinite(e)&&e>=0?e:1/0,this._breakTorque=Number.isFinite(i)&&i>=0?i:1/0}else this._enabled=!0,this._enableCollision=!1,this._breakForce=1/0,this._breakTorque=1/0;this._breakForceSq=this._breakForce*this._breakForce,this._adapter=pc.Application.getApplication().systems.physics2D.adapter,this._world=this._adapter.world,this._dt=0}get sortingOrderInQueue(){return this._sortingOrderInQueue}get code(){return this._code||this._initializeCode(),this._code}get joint(){return this._joint}get type(){return this._type}_initializeCode(){this._code&&(this["__UnityEngine.Joint2D"]=this._code,this._code.handle=this)}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableConstraint(this),!0)}onDisable(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableConstraint(this),!0)}onDestroy(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.onDisable(),this._joint&&(this._world.destroyJoint(this._joint),this._joint=null),!0)}_queuesToSubscribe(){return t}onFixedUpdate(t){if(null!=this._joint){if(this._dt=t,this._breakTorque<1/0){if(this._joint.getReactionTorque(1/t)>this._breakTorque)return void this.onDestroy()}if(this._breakForce<1/0){this._joint.getReactionForce(1/t,s).lengthSquared()>this._breakForceSq&&this.onDestroy()}}}createJoint(){if(this._joint)return;this._connectedBody=this.code.connectedBody;let t=this._connectedBody&&this._connectedBody.handle.body;const e=this.getAttachedRigidbody().handle.body;t||(t=this._adapter.getWorldBody()),this._joint=this._createJoint(e,t),this._joint._component=this}_createJoint(t,e){const i=this._jointDef;return i.bodyA=t,i.bodyB=e,i.active=this.enabled,i.collideConnected=this._enableCollision,i}update(){}enable(){this._jointDef.active=!0,this._joint&&this._joint.setActive(!0)}disable(){this._jointDef.active=!1,this._joint&&this._joint.setActive(!1)}getEnableCollision(){return this._enableCollision}setEnableCollision(t){this._enableCollision=!!t,this._joint&&this._joint.setCollideConnected(t)}getAttachedRigidbody(){if(this._attachedRigidbody)return this._attachedRigidbody;const t=this._entity._unityComponents.rigidbody2D[0];return this._attachedRigidbody=UnityEngine.Object.FromHandle(UnityEngine.Rigidbody2D,t),this._attachedRigidbody}getConnectedBody(){return this._connectedBody}setConnectedBody(t){this._connectedBody!==t&&(this._connectedBody=t,this._joint&&this._joint.setBodyB(t?this._connectedBody.handle.body:this._adapter.getWorldBody()))}getBreakForce(){return this._breakForce}setBreakForce(t){t<0&&(t=0),this._breakForce=t,this._breakForceSq=t*t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t<0?0:t}getReactionForce(t){return t>0&&this._joint?(new pc.Vec2).copy(this._joint.getReactionForce(1/t,s)):new pc.Vec2}getFrameReactionForce(){return this._dt>0&&this._joint?(new pc.Vec2).copy(this._joint.getReactionForce(1/this._dt,s)):new pc.Vec2}getReactionTorque(t){return t>0&&this._joint?this._joint.getReactionTorque(1/t):0}getFrameReactionTorque(){return this._dt>0&&this._joint?this._joint.getReactionTorque(1/this._dt):0}}class r extends n{constructor(t){super(t),t?(this._autoConfigureConnectedAnchor=!!t.autoConfigureConnectedAnchor,this._connectedAnchor=t.connectedAnchor,this._anchor=t.anchor):(this._autoConfigureConnectedAnchor=!0,this._connectedAnchor=new pc.Vec2,this._anchor=pc.Vec2.ZERO)}_initializeCode(){this._code&&(this["__UnityEngine.AnchoredJoint2D"]=this._code),n.prototype._initializeCode.call(this)}_createJoint(t,e){const i=n.prototype._createJoint.call(this,t,e);i.localAnchorA=new planck.Vec2(this._anchor);const s=new planck.Vec2(this._connectedAnchor);return this._autoConfigureConnectedAnchor?(i.localAnchorB=this._getConnectedAnchor(t,e,i.localAnchorA,s),this._connectedAnchor.set(s.x,s.y)):i.localAnchorB=s,i}_getConnectedAnchor(t,e,i,s){return e.getLocalPoint(t.getWorldPoint(i,s),s)}getAutoConfigureConnectedAnchor(){return this._autoConfigureConnectedAnchor}setAutoConfigureConnectedAnchor(t){this._autoConfigureConnectedAnchor=!!t}getAnchor(){return this._anchor.clone()}setAnchor(t){this._anchor.equals(t)||(this._anchor=t,this._joint&&this._joint.setLocalAnchorA(this._joint.getLocalAnchorA().set(t.x,t.y)))}getConnectedAnchor(){return this._connectedAnchor.clone()}setConnectedAnchor(t){this._autoConfigureConnectedAnchor||this._connectedAnchor.equals(t)||(this._connectedAnchor=t,this._joint&&this._joint.setLocalAnchorB(this._joint.getLocalAnchorB().set(t.x,t.y)))}update(){if(!this._autoConfigureConnectedAnchor)return;const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&this._resetConnectedAnchor(t,e,i)}_updateConnectedAnchor(){if(!this._autoConfigureConnectedAnchor)return;const t=this._joint;t&&this._resetConnectedAnchor(t,t.getBodyA(),t.getBodyB())}_resetConnectedAnchor(t,e,i){const s=t.getLocalAnchorB();t.setLocalAnchorB(this._getConnectedAnchor(e,i,t.getLocalAnchorA(),s)),this._connectedAnchor.set(s.x,s.y)}setConnectedBody(t){this._connectedBody!==t&&(n.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateConnectedAnchor())}enable(){n.prototype.enable.call(this),this._updateConnectedAnchor()}}return{Joint2DComponent:n,AnchoredJoint2DComponent:r,SpringJoint2DComponent:class extends r{constructor(t){super(t),this._type="springJoint2D",t?(this._frequency=t.frequency,this._dampingRatio=t.dampingRatio,this._distance=t.distance):(this._autoConfigureConnectedAnchor=!1,this._frequency=1,this._dampingRatio=0,this._distance=0),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"SpringJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.SpringJoint2D(this),this["__UnityEngine.SpringJoint2D"]=this._code,r.prototype._initializeCode.call(this)}_createJoint(t,e){const i=r.prototype._createJoint.call(this,t,e);return i.frequencyHz=this._frequency,i.dampingRatio=this._dampingRatio,i.length=this._distance,this._world.createJoint(new planck.DistanceJoint(i))}getDistance(){return this._distance}setDistance(t){this._distance=t,this._joint&&this._joint.setLength(t)}getFrequency(){return this._frequency}setFrequency(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}getDampingRatio(){return this._dampingRatio}setDampingRatio(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}},DistanceJoint2DComponent:class extends r{constructor(t){super(t),this._type="distanceJoint2D",t?(this._maxDistanceOnly=!!t.maxDistanceOnly,this._distance=t.distance,this._autoConfigureDistance=!!t.autoConfigureDistance):(this._autoConfigureConnectedAnchor=!1,this._maxDistanceOnly=!1,this._distance=.005,this._autoConfigureDistance=!0),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"DistanceJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.DistanceJoint2D(this),this["__UnityEngine.DistanceJoint2D"]=this._code,r.prototype._initializeCode.call(this)}_createJoint(t,e){const i=r.prototype._createJoint.call(this,t,e);return this.autoConfigureDistance&&(this._distance=this._getDistance(t,e)),this._maxDistanceOnly?(i.maxLength=this._distance,this._world.createJoint(new planck.RopeJoint(i,t,e))):(i.frequencyHz=0,i.dampingRatio=1,i.length=this._distance,this._world.createJoint(new planck.DistanceJoint(i)))}update(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(r.prototype.update.call(this),this._autoConfigureDistance&&this._resetDistance(e,i))}_updateDistance(){if(!this._autoConfigureDistance)return;const t=this._joint;t&&this._resetDistance(t.getBodyA(),t.getBodyB())}_resetDistance(t,e){const i=this._distance=this._getDistance(t,e);this._joint.setLength(i),this._joint2&&this._joint2.setLength(i)}_getDistance(t,e){return Math.max(planck.Vec2.distance(t.getWorldPoint(this._anchor),e.getWorldPoint(this._connectedAnchor)),.005)}getDistance(){return this._distance}setDistance(t){this._autoConfigureDistance||(this._distance=t,this._joint&&(this._joint.setLength(t),this._joint2&&this._joint2.setLength(t)))}onDestroy(){return!!pc.AnchoredJoint2DComponent.prototype.onDestroy.call(this)&&(this._joint2&&(this._world.destroyJoint(this._joint2),this._joint2=null),!0)}getMaxDistanceOnly(){return this._maxDistanceOnly}setMaxDistanceOnly(t){if(t=!!t,this._maxDistanceOnly===t)return;if(this._maxDistanceOnly=t,!this._joint)return;if(this._joint.setActive(!1),!this._joint2)return this._joint2=this._joint,void(this._joint=this._createJoint(this._joint.getBodyA(),this._joint.getBodyB()));const e=this._joint2;this._joint2=this._joint,this._joint=e,this._joint.setActive(this.enabled)}getAutoConfigureDistance(){return this._autoConfigureDistance}setAutoConfigureDistance(t){if(t=!!t,this._autoConfigureDistance===t)return;if(this._autoConfigureDistance=t,!t)return;const e=this._joint;e&&this._resetDistance(e,e.getBodyA(),e.getBodyB())}setConnectedBody(t){this._connectedBody!==t&&(r.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateDistance())}enable(){this._updateDistance(),r.prototype.enable.call(this)}},FixedJoint2DComponent:class extends r{constructor(t){super(t),this._type="fixedJoint2D",t?(this._frequency=t.frequency,this._dampingRatio=t.dampingRatio):(this._frequency=0,this._dampingRatio=0),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"FixedJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.FixedJoint2D(this),this["__UnityEngine.FixedJoint2D"]=this._code,r.prototype._initializeCode.call(this)}_createJoint(t,e){const i=r.prototype._createJoint.call(this,t,e);return i.frequencyHz=this._frequency,i.dampingRatio=this._dampingRatio,this._world.createJoint(new planck.WeldJoint(i))}update(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(r.prototype.update.call(this),this._resetReferenceAngle(t,e,i))}_updateReferenceAngle(){const t=this._joint;t&&this._resetReferenceAngle(t,t.getBodyA(),t.getBodyB())}_resetReferenceAngle(t,e,i){t.setReferenceAngle(i.getAngle()-e.getAngle())}setConnectedBody(t){this._connectedBody!==t&&(r.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateReferenceAngle())}enable(){this._updateReferenceAngle(),r.prototype.enable.call(this)}getFrequency(){return this._frequency}setFrequency(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}getDampingRatio(){return this._dampingRatio}setDampingRatio(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}getReferenceAngle(){return this._joint?this._joint.getReferenceAngle()*i:0}},HingeJoint2DComponent:class extends r{constructor(t){super(t),this._type="hingeJoint2D",t?(this._limits=t.limits,this._useLimits=!!t.useLimits,this._motor=t.motor,this._useMotor=!!t.useMotor):(this._useLimits=!1,this._useMotor=!1),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"HingeJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.HingeJoint2D(this),this["__UnityEngine.HingeJoint2D"]=this._code,r.prototype._initializeCode.call(this)}_createJoint(t,i){const s=r.prototype._createJoint.call(this,t,i);return s.enableLimit=this._useLimits,this._limits&&(s.lowerAngle=this._limits.min*e,s.upperAngle=this._limits.max*e),s.enableMotor=this._useMotor,this._motor&&(s.motorSpeed=this._motor.motorSpeed*e,s.maxMotorTorque=this._motor.maxMotorTorque),this._world.createJoint(new planck.RevoluteJoint(s))}getUseLimits(){return this._useLimits}setUseLimits(t){t=!!t,this._useLimits!==t&&(this._useLimits=t,this._joint&&this._joint.enableLimit(t))}getLimits(){if(this._limits)return this._limits.$clone();const t=new UnityEngine.JointAngleLimits2D;return t.max=359,t}setLimits(t){this._limits&&this._limits.min===t.min&&this._limits.max===t.max||(this._limits=t,this._joint&&this._joint.setLimits(t.min*e,t.max*e))}getUseMotor(){return this._useMotor}setUseMotor(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))}getMotor(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t}setMotor(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const i=this._joint;i&&(i.setMotorSpeed(t.motorSpeed*e),i.setMaxMotorTorque(t.maxMotorTorque))}getJointAngle(){return this._joint?this._joint.getJointAngle()*i:0}},WheelJoint2DComponent:class extends r{constructor(t){super(t),this._type="wheelJoint2D",this._autoConfigureConnectedAnchorMock=this._autoConfigureConnectedAnchor,this._autoConfigureConnectedAnchor=!1,t?(this._suspension=t.suspension,this._motor=t.motor,this._useMotor=!!t.useMotor):this._useMotor=!1,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"WheelJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.WheelJoint2D(this),this["__UnityEngine.WheelJoint2D"]=this._code,r.prototype._initializeCode.call(this)}_createJoint(t,i){const s=r.prototype._createJoint.call(this,t,i);return this._suspension&&(s.dampingRatio=this._suspension.dampingRatio,s.frequencyHz=this._suspension.frequency,s.localAxisA=this._getAxis(this._suspension.angle)),s.enableMotor=this._useMotor,this._motor&&(s.motorSpeed=this._motor.motorSpeed*e,s.maxMotorTorque=this._motor.maxMotorTorque),s.active=!!this._connectedBody,this._world.createJoint(new planck.WheelJoint(s))}_getAxis(t,i){return t*=e,(i=i||new planck.Vec2).set(Math.cos(t),Math.sin(t))}getAutoConfigureConnectedAnchor(){return this._autoConfigureConnectedAnchorMock}setConnectedBody(t){r.prototype.setConnectedBody.call(this,t),this._joint&&this._connectedBody&&this.enabled&&this._joint.setActive(!0)}enable(){r.prototype.enable.call(this),this._joint&&this._joint.setActive(!!this._connectedBody)}setAutoConfigureConnectedAnchor(t){this._autoConfigureConnectedAnchorMock=!!t}getSuspension(){if(this._suspension)return this._suspension.$clone();const t=new UnityEngine.JointSuspension2D;return t.dampingRatio=.7,t.frequency=2,t.angle=90,t}setSuspension(t){if(this._suspension&&this._suspension.dampingRatio===t.dampingRatio&&this._suspension.frequency===t.frequency&&this._suspension.angle===t.angle)return;this._suspension=t;const e=this._joint;e&&(e.setSpringDampingRatio(t.dampingRatio),e.setSpringFrequencyHz(t.frequency),e.setLocalAxisA(this._getAxis(t.angle,s)))}getUseMotor(){return this._useMotor}setUseMotor(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))}getMotor(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t}setMotor(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const i=this._joint;i&&(i.setMotorSpeed(t.motorSpeed*e),i.setMaxMotorTorque(t.maxMotorTorque))}getMotorTorque(t){return this._joint&&t>0?this._joint.getMotorTorque(1/t):0}getJointAngle(){return this._joint?this._joint.getJointAngle()*i:0}getJointSpeed(){return this._joint?this._joint.getJointAngularSpeed()*i:0}getJointTranslation(){return this._joint?this._joint.getJointTranslation():0}getJointLinearSpeed(){return this._joint?this._joint.getJointLinearSpeed():0}},FrictionJoint2DComponent:class extends r{constructor(t){super(t),this._type="frictionJoint2D",t?(this._maxForce=t.maxForce,this._maxTorque=t.maxTorque):(this._maxForce=1,this._maxTorque=1),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"FrictionJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.FrictionJoint2D(this),this["__UnityEngine.FrictionJoint2D"]=this._code,r.prototype._initializeCode.call(this)}_createJoint(t,e){const i=r.prototype._createJoint.call(this,t,e);return i.maxForce=this._maxForce,i.maxTorque=this._maxTorque,this._world.createJoint(new planck.FrictionJoint(i))}getMaxForce(){return this._maxForce}setMaxForce(t){this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce)}getMaxTorque(){return this._maxTorque}setMaxTorque(t){this._maxTorque=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxTorque(this._maxTorque)}},RelativeJoint2DComponent:class extends n{constructor(t){super(t),this._type="relativeJoint2D",t?(this._autoConfigureOffset=!!t.autoConfigureOffset,this._linearOffset=t.linearOffset,this._angularOffset=t.angularOffset*e,this._maxForce=t.maxForce,this._maxTorque=t.maxTorque,this._correctionScale=t.correctionScale):(this._autoConfigureOffset=!0,this._linearOffset=new pc.Vec2,this._angularOffset=0,this._maxForce=1e4,this._maxTorque=1e4,this._correctionScale=.3),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"RelativeJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.RelativeJoint2D(this),this["__UnityEngine.RelativeJoint2D"]=this._code,n.prototype._initializeCode.call(this)}_createJoint(t,e){const i=n.prototype._createJoint.call(this,t,e);i.maxForce=this._maxForce,i.maxTorque=this._maxTorque,i.correctionFactor=this._correctionScale;const s=new planck.Vec2(this._linearOffset);return this._autoConfigureOffset?(i.linearOffset=this._getLinearOffset(t,e,s),this._linearOffset.set(s.x,s.y),i.angularOffset=this._angularOffset=this._getAngularOffset(t,e)):(i.linearOffset=s,i.angularOffset=this._angularOffset),this._world.createJoint(new planck.MotorJoint(i))}_getLinearOffset(t,e,i){return t.getLocalPoint(e.getPosition(),i)}_getAngularOffset(t,e){return e.getAngle()-t.getAngle()}update(){if(!this._autoConfigureOffset)return;const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&this._resetOffsets(t,e,i)}_updateOffsets(){if(!this._autoConfigureOffset)return;const t=this._joint;t&&this._resetOffsets(t,t.getBodyA(),t.getBodyB())}_resetOffsets(t,e,i){const s=t.getLinearOffset();t.setLinearOffset(this._getLinearOffset(e,i,s)),this._linearOffset.set(s.x,s.y),t.setAngularOffset(this._angularOffset=this._getAngularOffset(e,i))}setConnectedBody(t){this._connectedBody!==t&&(n.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateOffsets())}enable(){n.prototype.enable.call(this),this._updateOffsets()}getAngularOffset(){return this._angularOffset*i}setAngularOffset(t){t*=e,this._angularOffset!==t&&(this._angularOffset=t,this._joint&&this._joint.setAngularOffset(t))}getLinearOffset(){return this._linearOffset.clone()}setLinearOffset(t){this._linearOffset.equals(t)||(this._linearOffset=t,this._joint&&this._joint.setLinearOffset(this._joint.getLinearOffset().set(t.x,t.y)))}getAutoConfigureOffset(){return this._autoConfigureOffset}setAutoConfigureOffset(t){this._autoConfigureOffset=!!t}getCorrectionScale(){return this._correctionScale}setCorrectionScale(t){this._correctionScale!==t&&(this._correctionScale=t<0?0:t>1?1:t,this._joint&&this._joint.setCorrectionFactor(this._correctionScale))}getMaxForce(){return this._maxForce}setMaxForce(t){this._maxForce!==t&&(this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce))}getMaxTorque(){return this._maxTorque}setMaxTorque(t){this._maxTorque!==t&&(this._maxTorque=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxTorque(this._maxTorque))}getTarget(){if(!this._joint)return pc.Vec2.ZERO.clone();const t=-this._angularOffset,e=this._joint.getBodyB();return s.set(e.getLocalCenter()).sub(this._linearOffset).rotate(Math.cos(t),Math.sin(t)),e.getWorldPoint(s,s),new pc.Vec2(s.x,s.y)}},SliderJoint2DComponent:class extends r{constructor(t){super(t),this._type="sliderJoint2D",t?(this._autoConfigureAngle=!!t.autoConfigureAngle,this._angle=t.angle*e,this._useMotor=!!t.useMotor,this._motor=t.motor,this._useLimits=!!t.useLimits,this._limits=t.limits):(this._autoConfigureConnectedAnchor=!1,this._autoConfigureAngle=!0,this._angle=0,this._useMotor=!1,this._useLimits=!1),this._newConnectedBody=!0,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"SliderJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.SliderJoint2D(this),this["__UnityEngine.SliderJoint2D"]=this._code,r.prototype._initializeCode.call(this)}_createJoint(t,e){const i=r.prototype._createJoint.call(this,t,e);return i.enableMotor=this._useMotor,this._motor&&(i.motorSpeed=this._motor.motorSpeed,i.maxMotorForce=this._motor.maxMotorTorque),i.enableLimit=this._useLimits,this._limits&&(i.lowerTranslation=this._limits.min,i.upperTranslation=this._limits.max),i.localAxisA=this._getAxis(this._angle),this._world.createJoint(new planck.PrismaticJoint(i))}_getAxis(t,e){return(e=e||new planck.Vec2).set(Math.cos(t),Math.sin(t))}update(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(r.prototype.update.call(this),this._resetAngle(t,e,i))}_updateAngle(){const t=this._joint;t&&this._resetAngle(t,t.getBodyA(),t.getBodyB())}_resetAngle(t,e,i){if(this._newConnectedBody&&(t.setReferenceAngle(i.getAngle()-e.getAngle()),this._newConnectedBody=!1),!this._autoConfigureAngle)return;const n=t.getLocalAxisA(),r=i.getWorldPoint(t.getLocalAnchorB(),n),a=e.getWorldPoint(t.getLocalAnchorA(),s),o=r.sub(a).normal();this._angle=Math.atan2(o.y,o.x),t.setLocalAxisA(o)}setConnectedBody(t){this._newConnectedBody=!0,this._connectedBody!==t&&(r.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateAngle())}enable(){this._updateAngle(),r.prototype.enable.call(this)}getAngle(){return this._angle*i}setAngle(t){if(this._autoConfigureAngle)return void this._updateAngle();if(t*=e,this._angle===t)return;this._angle=t;const i=this._joint;i&&i.setLocalAxisA(this._getAxis(t,i.getLocalAxisA()))}getReferenceAngle(){return this._joint?this._joint.getReferenceAngle()*i:0}getAutoConfigureAngle(){return this._autoConfigureAngle}setAutoConfigureAngle(t){this._autoConfigureAngle=!!t}getUseMotor(){return this._useMotor}setUseMotor(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))}getMotor(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t}setMotor(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const e=this._joint;e&&(e.setMotorSpeed(t.motorSpeed),e.setMaxMotorForce(t.maxMotorTorque))}getUseLimits(){return this._useLimits}setUseLimits(t){t=!!t,this._useLimits!==t&&(this._useLimits=t,this._joint&&this._joint.enableLimit(t))}getLimits(){return this._limits?this._limits.$clone():new UnityEngine.JointTranslationLimits2D}setLimits(t){this.setUseLimits(!0),this._limits&&this._limits.min===t.min&&this._limits.max===t.max||(this._limits=t,this._joint&&this._joint.setLimits(t.min,t.max))}getLimitState(){if(!this._joint)return UnityEngine.JointLimitState2D.Inactive;switch(this._joint.getLimitState()){case 0:return UnityEngine.JointLimitState2D.Inactive;case 1:return UnityEngine.JointLimitState2D.LowerLimit;case 2:return UnityEngine.JointLimitState2D.UpperLimit;case 3:return UnityEngine.JointLimitState2D.EqualLimits;default:return UnityEngine.JointLimitState2D.Inactive}}getJointTranslation(){return this._joint?this._joint.getJointTranslation():0}getJointSpeed(){return this._joint?this._joint.getJointSpeed()*i:0}getMotorForce(t){return this._joint&&t>0?this._joint.getMotorForce(1/t):0}},TargetJoint2DComponent:class extends n{constructor(t){super(t),this._type="targetJoint2D",t?(this._autoConfigureTarget=!!t.autoConfigureTarget,this._target=t.target,this._anchor=t.anchor,this._maxForce=t.maxForce,this._dampingRatio=t.dampingRatio,this._frequency=t.frequency):(this._autoConfigureTarget=!0,this._target=new pc.Vec2,this._anchor=new pc.Vec2,this._maxForce=1e4,this._dampingRatio=1,this._frequency=5),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"TargetJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.TargetJoint2D(this),this["__UnityEngine.TargetJoint2D"]=this._code,n.prototype._initializeCode.call(this)}_createJoint(t,e){const i=n.prototype._createJoint.call(this,e,t);i.maxForce=this._maxForce,i.dampingRatio=this._dampingRatio,i.frequencyHz=this._frequency,i.anchorB=new planck.Vec2(this._anchor);const s=new planck.Vec2(this._target);return this._autoConfigureTarget?(i.target=s.set(t.getPosition()),this._target.set(s.x,s.y)):i.target=s,this._world.createJoint(new planck.MouseJoint(i))}update(){if(!this._autoConfigureTarget)return;const t=this._joint;if(!t)return;const e=t.getBodyB();e._isEntityTransformed&&this._resetTarget(t,e)}_updateTarget(){if(!this._autoConfigureOffset)return;const t=this._joint;t&&this._resetTarget(t,t.getBodyB())}_resetTarget(t,e){const i=t.getTarget();t.setTarget(i.set(e.getPosition())),this._target.set(i.x,i.y)}setConnectedBody(t){UnityEngine.Debug.LogWarningFormat("The connected rigidbody for the 'TargetJoint2D' type cannot be set.")}enable(){n.prototype.enable.call(this),this._updateTarget()}getAutoConfigureTarget(){return this._autoConfigureTarget}setAutoConfigureTarget(t){this._autoConfigureTarget=!!t}getTarget(){return this._target.clone()}setTarget(t){this._target.set(t);const e=this._joint;e&&e.setTarget(e.getTarget().set(t.x,t.y))}getAnchor(){return this._anchor.clone()}setAnchor(t){if(this._anchor.equals(t))return;this._anchor=t;const e=this._joint;e&&e.setLocalAnchorB(e.getLocalAnchorB().set(t.x,t.y))}getMaxForce(){return this._maxForce}setMaxForce(t){this._maxForce!==t&&(this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce))}getFrequency(){return this._frequency}setFrequency(t){this._frequency!==t&&(this._frequency=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setFrequency(this._frequency))}getDampingRatio(){return this._dampingRatio}setDampingRatio(t){this._dampingRatio!==t&&(this._dampingRatio=t<0?0:t>1?1:t,this._joint&&this._joint.setDampingRatio(this._dampingRatio))}}}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="animator",this.performanceSamplerSection=pc.Counters.ANIMATORS}}return{AnimatorSystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponent{constructor(){super(),this.code=UnityEngine.Object.FromHandle(UnityEngine.Animator,this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"AnimatorComponent")}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)}onUpdate(t){this.code.AddTime(t)}_queuesToSubscribe(){return["onUpdate"]}}return{AnimatorComponent:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="animation",this.performanceSamplerSection=pc.Counters.ANIMATIONS}}return{AnimationSystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponent{constructor(){super(),this.code=UnityEngine.Object.FromHandle(UnityEngine.Animation,this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"AnimationComponent")}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)}onUpdate(t){this.code.AddTime(t)}_queuesToSubscribe(){return["onUpdate"]}}return{AnimationComponent:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="audiosourceunity"}}return{AudioSourceUnitySystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponent{constructor(t){super(),this._soundInstance=new pc.SoundInstance($application.app._audioManager),this._playOnAwake=t&&t.playOnAwake,this.loop=t&&t.loop,this.sound=t&&t.sound,this["__UnityEngine.AudioSource"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"AudioSourceUnityComponent")}get playOnAwake(){return this._playOnAwake}set playOnAwake(t){this._playOnAwake=t}get loop(){return this._soundInstance.loop}set loop(t){this._soundInstance.loop=t}get volume(){return this._soundInstance.volume}set volume(t){this._soundInstance.volume=t}get pitch(){return this._soundInstance.pitch}set pitch(t){this._soundInstance.pitch=t}get sound(){return this._soundInstance.sound}set sound(t){this._soundInstance.sound=t}get isPlaying(){return this._soundInstance.isPlaying}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._playOnAwake&&this.play(),!0)}onDisable(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._soundInstance.isPlaying&&this._soundInstance.stop(),!0)}play(){this._soundInstance.sound&&this._soundInstance.play()}pause(){this._soundInstance.sound&&this._soundInstance.pause()}resume(){this._soundInstance.sound&&this._soundInstance.resume()}stop(){this._soundInstance.sound&&this._soundInstance.stop()}}return{AudioSourceUnityComponent:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponentSystem{constructor(t){super(t),this.id="videoPlayer"}}return{VideoPlayerSystem:t}}()),Object.assign(pc,function(){class t extends pc.UnityComponent{constructor(t){super(),this._clip=t?t.clip:null,this.code=UnityEngine.Object.FromHandle(UnityEngine.Video.VideoPlayer,this),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"VideoPlayerComponent")}configureForEntity(t){this._entity=t}onEnable(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)}onDisable(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this.code.OnDisable&&this.code.OnDisable(),!0)}onDestroy(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.code.OnDestroy&&this.code.OnDestroy(),!0)}_queuesToSubscribe(){return[]}}return{VideoPlayerComponent:t}}()),Bridge.assembly("LunaUnity",((t,e)=>{const i=/\+/g;Bridge.define("LunaUnity.Objects.Request",{ctor:function(){this.$initialize(),this.immediateRegistry=null,this.referenceQueue=[],this.pendingQueue=[],this.root=null,LunaUnity.Objects.Request.typeCache=LunaUnity.Objects.Request.typeCache||{}},r:function(t,e,i,s,n){const r={type:null==t?null:"boolean"==typeof t?t:Deserializers.types[t],id:e,targetType:i,targetObject:s,targetProperty:n};this.immediateRegistry?this.resolveInstruction(this.immediateRegistry,r):this.referenceQueue.push(r)},resolveReferences:function(t){for(let e=0;e<this.referenceQueue.length;e++)this.resolveInstruction(t,this.referenceQueue[e]);this.referenceQueue=this.pendingQueue,this.pendingQueue=[]},resolveInstruction:function(t,e){if(null===e.type||null===e.id)return void this.applyObject(e,null);const i=t.TryGet(e.id);if(!i)return void this.pendingQueue.push(e);const s=!0===e.type?null:this._getTypeByName(e.type);let n=i;!s||n.$kind||n.isPrefabProxy||(n=UnityEngine.Object.FromHandle(s,i)),this.applyObject(e,n)},applyObject:function(t,e){0===t.targetType?t.targetObject[t.targetProperty]=e:1===t.targetType?t.targetObject.add(e):t.targetObject.push(e)},d:function(t,e,i){return null==e?null:Deserializers[t](this,e,i)},deserializeTo:function(t,e,i){return Deserializers[i||e.$$fullname](this,t,e)},c:function(t){const e=this._getTypeByName(t);if(!e||!e.$$fullname)return{};if(e.ctor&&0===e.ctor.length)return new e.ctor;{const t=Object.create(e.prototype);return t.$initialize&&t.$initialize(),t}},_getTypeByName:function(t){const e=LunaUnity.Objects.Request.typeCache;if(!e.hasOwnProperty(t)){let s=Bridge.ns(t.replace(i,"."));s.$$fullname||(console.warn("Unknown class found: "+t),s=null),e[t]=s}return e[t]}}),Bridge.define("LunaUnity.Objects.ImmediateRequest",{inherits:[LunaUnity.Objects.Request],ctor:function(t){LunaUnity.Objects.Request.ctor.call(this),this.registry=t},r:function(t,e,i,s,n){if(null===t||null===e)return;const r={type:"boolean"==typeof t?t:Deserializers.types[t],id:e,targetType:i,targetObject:s,targetProperty:n};this.resolveInstruction(this.registry,r)}})})),Bridge._getTypeByName=LunaUnity.Objects.Request.prototype._getTypeByName,Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.Base",{ctors:{ctor:function(t){this.$initialize(),this.application=t,this.network=t.network,this.objectSpace=t.objectSpace,this.app=t.app,this.graphicsDevice=this.app.graphicsDevice,this.registry=this.objectSpace.getRegistry()}},methods:{loadAsync:function(){throw new Error("Not implemented")}}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Scene.GameObject"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Transform"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Animator"],r=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Animation"],a=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Canvas"],o=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CanvasGroup"],h=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.RectTransform"],c=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Camera"],l=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.VideoPlayer"],u=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.AudioSource"],d=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Light"],_=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshFilter"],p=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshRenderer"],m=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SkinnedMeshRenderer"],f=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SpriteRenderer"],g=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SpriteMask"],y=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Rigidbody"],E=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.BoxCollider"],A=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SphereCollider"],T=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshCollider"],C=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CapsuleCollider"],b=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Rigidbody2D"],S=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.BoxCollider2D"],x=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CircleCollider2D"],D=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CapsuleCollider2D"],M=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.EdgeCollider2D"],R=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.PolygonCollider2D"],I=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SpringJoint2D"],O=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.DistanceJoint2D"],F=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.FixedJoint2D"],P=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.HingeJoint2D"],v=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.WheelJoint2D"],w=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.FrictionJoint2D"],L=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.RelativeJoint2D"],B=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SliderJoint2D"],U=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.TargetJoint2D"],N=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.LineRenderer"],k=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.TrailRenderer"],z=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.PlatformEffector2D"];Bridge.define("LunaUnity.Objects.Handlers.GameObject",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},fork:function(){const t=new LunaUnity.Objects.Handlers.GameObject(this.application);return t.registry=t.registry.Clone().AllowUpdate(),t},loadAsync:function(t,e,i,s){if(!this.app.systems.monoBehaviour.creatingPrefabs||s){const i=this._loadObject(t,t.root,e,this.registry);return i.isPrefab=!0,i.objectJson=e,{result:i}}const n={isPrefabProxy:!0,prefab:e};return this.registry.Put(e.id,n),{result:n}},_loadObject:function(t,e,s,n){if(n.Has(s.id)&&!n.updatesAllowed){const t=n.Get(s.id);if(!t.isPrefabProxy)return t;n.Release(s.id)}const r=s.data,a=new pc.Entity(r[i.name],this.app,this.app.systems.monoBehaviour.creatingPrefabs);a.enabled=!!r[i.enabled],a.cullingLayer=r[i.layer],a.static=!!r[i.isStatic],a.tag=r[i.tag],a.isPrefab&&(a.objectJson=s);const o=s.children;for(let e=0;e<o.length;e++)this._loadObject(t,a,o[e],this.registry);const h=s.components,c=Deserializers.typeNameToIdMap["UnityEngine.CanvasRenderer"];for(let t=0;t<h.length;t++)h[t].type===c&&t>1&&([h[1],h[t]]=[h[t],h[1]]);for(let e=0;e<h.length;e++)this._loadComponent(t,a,h[e],this.registry);return null!=e&&e.addChild(a),n.Put(s.id,a)},unloadAsync:function(t){for(let e=0;e<t.components.length;e++)this.registry.Release(t.components[e].id);for(let e=0;e<t.children.length;e++)this.unloadAsync(t.children[e])},_loadComponent:function(t,e,i,s){let n=null;switch(Deserializers.types[i.type]){case"UnityEngine.Transform":n=this._loadTransformComponent(t,e,i,s);break;case"UnityEngine.Animator":n=this._loadAnimatorComponent(t,e,i,s);break;case"UnityEngine.Animation":n=this._loadAnimationComponent(t,e,i,s);break;case"UnityEngine.Canvas":n=this._loadCanvasComponent(t,e,i,s);break;case"UnityEngine.CanvasGroup":n=this._loadCanvasGroupComponent(t,e,i,s);break;case"UnityEngine.EventSystems.UIBehaviour":n=this._loadUIBehaviourComponent(t,e,i,s);break;case"UnityEngine.TextMesh":n=this._loadTextMesh(t,e,i,s);break;case"UnityEngine.RectTransform":n=this._loadRectTransformComponent(t,e,i,s);break;case"UnityEngine.Camera":n=this._loadCameraComponent(t,e,i,s);break;case"UnityEngine.Video.VideoPlayer":n=this._loadVideoPlayerComponent(t,e,i,s);break;case"UnityEngine.AudioSource":n=this._loadAudioSourceComponent(t,e,i,s);break;case"UnityEngine.Light":n=this._loadLightComponent(t,e,i,s);break;case"UnityEngine.MeshFilter":n=this._loadMeshFilterComponent(t,e,i,s);break;case"UnityEngine.SkinnedMeshRenderer":n=this._loadSkinnedMeshRendererComponent(t,e,i,s);break;case"UnityEngine.MeshRenderer":n=this._loadMeshRendererComponent(t,e,i,s);break;case"UnityEngine.SpriteRenderer":n=this._loadSpriteRendererComponent(t,e,i,s);break;case"UnityEngine.SpriteMask":n=this._loadSpriteMaskComponent(t,e,i,s);break;case"UnityEngine.MonoBehaviour":n=this._loadMonoBehaviourComponent(t,e,i,s);break;case"UnityEngine.Rigidbody":n=this._loadRigidbodyComponent(t,e,i,s);break;case"UnityEngine.BoxCollider":n=this._loadBoxColliderComponent(t,e,i,s);break;case"UnityEngine.SphereCollider":n=this._loadSphereColliderComponent(t,e,i,s);break;case"UnityEngine.MeshCollider":n=this._loadMeshColliderComponent(t,e,i,s);break;case"UnityEngine.CapsuleCollider":n=this._loadCapsuleColliderComponent(t,e,i,s);break;case"UnityEngine.WheelCollider":n=this._loadWheelColliderComponent(t,e,i,s);break;case"UnityEngine.CharacterController":n=this._loadCharacterControllerComponent(t,e,i,s);break;case"UnityEngine.Rigidbody2D":n=this._loadRigidbody2DComponent(t,e,i,s);break;case"UnityEngine.BoxCollider2D":n=this._loadBoxCollider2DComponent(t,e,i,s);break;case"UnityEngine.CircleCollider2D":n=this._loadCircleCollider2DComponent(t,e,i,s);break;case"UnityEngine.CapsuleCollider2D":n=this._loadCapsuleCollider2DComponent(t,e,i,s);break;case"UnityEngine.EdgeCollider2D":n=this._loadEdgeCollider2DComponent(t,e,i,s);break;case"UnityEngine.PolygonCollider2D":n=this._loadPolygonCollider2DComponent(t,e,i,s);break;case"UnityEngine.SpringJoint2D":n=this._loadSpringJoint2DComponent(t,e,i,s);break;case"UnityEngine.DistanceJoint2D":n=this._loadDistanceJoint2DComponent(t,e,i,s);break;case"UnityEngine.FixedJoint2D":n=this._loadFixedJoint2DComponent(t,e,i,s);break;case"UnityEngine.HingeJoint2D":n=this._loadHingeJoint2DComponent(t,e,i,s);break;case"UnityEngine.WheelJoint2D":n=this._loadWheelJoint2DComponent(t,e,i,s);break;case"UnityEngine.FrictionJoint2D":n=this._loadFrictionJoint2DComponent(t,e,i,s);break;case"UnityEngine.RelativeJoint2D":n=this._loadRelativeJoint2DComponent(t,e,i,s);break;case"UnityEngine.SliderJoint2D":n=this._loadSliderJoint2DComponent(t,e,i,s);break;case"UnityEngine.TargetJoint2D":n=this._loadTargetJoint2DComponent(t,e,i,s);break;case"UnityEngine.PlatformEffector2D":n=this._loadPlatformEffector2DComponent(t,e,i,s);break;case"UnityEngine.ParticleSystem":n=this._loadParticleSystemComponent(t,e,i,s);break;case"UnityEngine.ParticleSystemRenderer":n=this._loadParticleSystemRendererComponent(t,e,i,s);break;case"UnityEngine.LineRenderer":n=this._loadLineRendererComponent(t,e,i,s);break;case"UnityEngine.CanvasRenderer":n=this._loadCanvasRendererComponent(t,e,i,s);break;case"UnityEngine.TrailRenderer":n=this._loadTrailRendererComponent(t,e,i,s);break;case"UnityEngine.ReflectionProbe":n=this._loadReflectionProbeComponent(t,e,i,s);break;case"UnityEngine.SpringJoint":case"UnityEngine.FixedJoint":case"UnityEngine.HingeJoint":case"UnityEngine.CharacterJoint":case"UnityEngine.ConfigurableJoint":n=this._loadJointComponent(t,e,i,s)}return n&&(s.Has(i.id)&&s.Release(i.id),s.Put(i.id,n)),n},_loadTransformComponent:function(t,e,i,n){const r=i.data;return e.setLocalPosition(r[s.position+0],r[s.position+1],r[s.position+2]),e.setLocalRotation(r[s.rotation+0],r[s.rotation+1],r[s.rotation+2],r[s.rotation+3]),e.setLocalScale(r[s.scale+0],r[s.scale+1],r[s.scale+2]),e["__UnityEngine.Transform"]=new UnityEngine.Transform(e),e},_loadAnimatorComponent:function(t,e,i,s){const r=i.data,a=new pc.AnimatorComponent;e.addUnityComponentFromDeserialization("animator",a),a._entity=e;const o=new UnityEngine.Animator(a);a._enabled=!!r[n.enabled],o.animatorController=s.TryGet(r[n.animatorController+1]),o.updateMode=r[n.updateMode],a.code=o;const h=r[n.humanBones],c=a.code.humanBones;for(let e=0;e<h.length;e+=2)t.r(h[e+0],h[e+1],2,c);return a},_loadAnimationComponent:function(t,e,i,s){const n=i.data,a=new(System.Collections.Generic.List$1(UnityEngine.AnimationClip).ctor),o=n[r.clips];for(let t=0;t<o.length;t+=2){const e=s.Get(o[t+1]);a.add(e)}const h=new pc.AnimationComponent;h._enabled=!!n[r.enabled],h._entity=e,e.addUnityComponentFromDeserialization("animation",h);const c=h["__UnityEngine.Animation"];return c.playAutomatically=n[r.playAutomatically],c.clip=s.TryGet(n[r.clip+1]),c.clips=a,h.code=c,h},_loadCanvasComponent:function(t,e,i,s){const n=pc.MonoBehaviourComponent.create({type:Deserializers.types[i.type],enabled:!!i.data[a.enabled],entity:e});return n.code.ConfigureForEntity(e),e.screen.$id=i.id,e.addUnityComponentFromDeserialization("monoBehaviour",n),e.screen.monoComponent=n,n.code.enabled=i.data[a.enabled],n.code.internalExecutionOrder=0,t.deserializeTo(i.data,n.code,"Luna.Unity.DTO.UnityEngine.Components.Canvas"),n},_loadCanvasGroupComponent:function(t,e,i,s){const n=pc.MonoBehaviourComponent.create({type:Deserializers.types[i.type],enabled:i.data[o.enabled],entity:e});return n.code.code=n.code,t.deserializeTo(i.data,n.code,"Luna.Unity.DTO.UnityEngine.Components.CanvasGroup"),e.addUnityComponentFromDeserialization("monoBehaviour",n),n},_loadUIBehaviourComponent:function(t,e,i,s){const n=Deserializers.types[i.class],r=pc.MonoBehaviourComponent.create({type:n,enabled:i.enabled,entity:e});return r?(r.code.ConfigureForEntity(e),t.deserializeTo(i.data,r.code),e.addUnityComponentFromDeserialization("monoBehaviour",r),r):null},_loadTextMesh:function(t,e,i,s){const n=pc.MonoBehaviourComponent.create({type:Deserializers.types[i.type],enabled:!0,entity:e});return n?(n.code.ConfigureForEntity(e),t.deserializeTo(i.data,n.code,"Luna.Unity.DTO.UnityEngine.Components.TextMesh"),e.addUnityComponentFromDeserialization("monoBehaviour",n),n):null},_loadRectTransformComponent:function(t,e,i,s){const n=i.data;e.addComponent("element",{pivot:new pc.Vec2(n[h.pivot+0],n[h.pivot+1]),anchor:new pc.Vec4(n[h.anchorMin+0],n[h.anchorMin+1],n[h.anchorMax+0],n[h.anchorMax+1]),sizeDelta:new pc.Vec2(n[h.sizeDelta+0],n[h.sizeDelta+1]),anchoredPosition:new pc.Vec2(n[h.anchoredPosition3D+0],n[h.anchoredPosition3D+1])}),e.element._width=e.element.sizeDelta.x,e.element._height=e.element.sizeDelta.y;const r=e.getLocalPosition();return e.setLocalPosition(r.x,r.y,n[h.anchoredPosition3D+2]),e.setLocalRotation(n[h.rotation+0],n[h.rotation+1],n[h.rotation+2],n[h.rotation+3]),e.setLocalScale(n[h.scale+0],n[h.scale+1],n[h.scale+2]),e["__UnityEngine.Transform"]=new UnityEngine.RectTransform(e),e["__UnityEngine.RectTransform"]=new UnityEngine.RectTransform(e),e},_loadCameraComponent:function(t,e,i,s){const n=i.data,r=n[c.rect];if(e.addComponent("camera",{enabled:!!n[c.enabled],clearColor:new pc.Color(n[c.backgroundColor+0],n[c.backgroundColor+1],n[c.backgroundColor+2],n[c.backgroundColor+3]),aspectRatio:this.graphicsDevice.width/this.graphicsDevice.height,fov:n[c.fieldOfView],nearClip:n[c.nearClipPlane],farClip:n[c.farClipPlane],clearColorBuffer:n[c.clearFlags]<=UnityEngine.CameraClearFlags.Color,clearDepthBuffer:n[c.clearFlags]<=UnityEngine.CameraClearFlags.Depth,clearStencilBuffer:n[c.clearFlags]<=UnityEngine.CameraClearFlags.Color,clearSkybox:n[c.clearFlags]===UnityEngine.CameraClearFlags.Skybox,projection:n[c.orthographic]?pc.PROJECTION_ORTHOGRAPHIC:pc.PROJECTION_PERSPECTIVE,orthoHeight:n[c.orthographicSize],priority:n[c.depth],cullingMask:n[c.cullingMask],rect:new pc.Vec4(r[0],r[1],r[2],r[3])}),n[c.targetTexture+1]){const t=UnityEngine.Object.FromHandle(UnityEngine.RenderTexture,this.registry.Get(n[c.targetTexture+1]));if(t){UnityEngine.Object.FromHandle(UnityEngine.Camera,e.camera).targetTexture=t,e.camera.aspectRatio=1*t.handle.width/t.handle.height}}return e.camera},_loadVideoPlayerComponent:function(t,e,i,s){const n=i.data,r=new pc.VideoPlayerComponent({enabled:!!n[l.enabled],entity:e}),a=new UnityEngine.Video.VideoPlayer(r);return a.ConfigureForEntity(e),r.code=a,t.deserializeTo(n,a,"Luna.Unity.DTO.UnityEngine.Components.VideoPlayer"),e.addUnityComponentFromDeserialization("videoPlayer",r),r},_loadAudioSourceComponent:function(t,e,i,s){const n=i.data,r=new pc.AudioSourceUnityComponent({id:i.id,loop:n[u.loop],sound:s.TryGet(n[u.clip+1]),playOnAwake:n[u.playOnAwake]});return e.addUnityComponentFromDeserialization("audiosourceunity",r),r.enabled=!!n[u.enabled],r},_loadLightComponent:function(t,e,i,s){const n=i.data;return e.addComponent("light",{type:["spot","directional","point",null][n[d.type]],color:new pc.Color(n[d.color+0],n[d.color+1],n[d.color+2],n[d.color+3]),intensity:n[d.intensity],outerConeAngle:n[d.spotAngle],range:n[d.range],cullingMask:n[d.cullingMask],castShadows:n[d.shadows]!==UnityEngine.LightShadows.None,shadowType:pc.SHADOW_VSM32,affectDynamic:n[d.lightmapBakeType]!==UnityEngine.LightmapBakeType.Baked,affectLightmapped:n[d.lightmapBakeType]<=UnityEngine.LightmapBakeType.Baked,enabled:!!n[d.enabled],renderMode:n[d.renderMode],cookie:s.TryGet(n[d.cookie+1]),cookieScale:new pc.Vec2(n[d.cookieSize],n[d.cookieSize])}),e.light},_loadMeshFilterComponent:function(t,e,i,s){const n=i.data,r=new pc.MeshFilterComponent;return e.addUnityComponentFromDeserialization("meshFilter",r),r.id=i.id,r.mesh=s.TryGet(n[_.sharedMesh+1]),r.mesh||console.warn(`GameObject ${e.name} is missing mesh. Check force excluded assets if it got excluded.`),r},_loadMeshRendererComponent:function(t,e,i,s){const n=i.data,r=this._loadRendererComponent(p,new pc.MeshRendererComponent,t,e,i,s),a=r.code;return a.lightProbeUsage=n[p.lightProbeUsage],a.reflectionProbeUsage=n[p.reflectionProbeUsage],r},_loadSkinnedMeshRendererComponent:function(t,e,i,s){const n=i.data,r=s.TryGet(n[m.sharedMesh+1]);if(null==r)return console.log(`Missing mesh on skinned mesh. GameObject : ${e.name}`),null;const a=this._loadRendererComponent(m,new pc.SkinnedMeshRendererComponent,t,e,i,s),o=a.model;o.mesh=r;const h=a.code;h.lightProbeUsage=n[m.lightProbeUsage],h.reflectionProbeUsage=n[m.reflectionProbeUsage];const c=n[m.bones];if(0!==c.length){const e=new Array(c.length/2),i=new Array(0);for(let s=0;s<c.length;s+=2)t.r(!0,c[s+1],2,i),e.push(c[s+1]);a.model.bones=i,a.model.skin=new pc.Skin(this.graphicsDevice,r.bindposes,e),a.__renderer="skinned-mesh";const s=n[m.localBounds];a.model.skin.localBounds=new pc.BoundingBox(new pc.Vec3(s[0],s[1],s[2]),new pc.Vec3(s[3],s[4],s[5])),a.model.skin.updateWhenOffscreen=!!n[m.updateWhenOffscreen],t.r(!0,n[m.rootBone+1],0,a.model.skin,"rootBone")}const l=n[m.blendShapesWeights];if(0!==l.length){const t=new pc.MorphInstance(r.morph);t._setBaseMesh(r);for(let e=0;e<l.length;e++)t.setWeight(e,l[e][0]);o.morphInstance=t}return a},_loadSpriteRendererComponent:function(t,e,i,s){const n=i.data,r=this._loadRendererComponent(f,new pc.SpriteRendererComponent,t,e,i,s),a=r.code,o=s.TryGet(n[f.sprite+1]);return a.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(n[f.sortingLayerID]),a.sortingOrder=n[f.sortingOrder],a.color=new pc.Color(n[f.color+0],n[f.color+1],n[f.color+2],n[f.color+3]),a.flipX=n[f.flipX],a.flipY=n[f.flipY],a.drawMode=n[f.drawMode],a.size=new pc.Vec2(n[f.size],n[f.size+1]),a.tileMode=n[f.tileMode],a.adaptiveModeThreshold=n[f.adaptiveModeThreshold],a.maskInteraction=n[f.maskInteraction],a.spriteSortPoint=n[f.spriteSortPoint],o&&(a.sprite=UnityEngine.Object.FromHandle(UnityEngine.Sprite,o)),r.__renderer="sprite",r},_loadSpriteMaskComponent:function(t,e,i,s){const n=i.data,r=new pc.SpriteMaskComponent,a=this._loadRendererComponent(g,r,t,e,i,s);a._frontSortingLayerID=n[g.frontSortingLayerID],a._frontSortingOrder=n[g.frontSortingOrder],a._backSortingLayerID=n[g.backSortingLayerID],a._backSortingOrder=n[g.backSortingOrder],a._alphaCutoff=n[g.alphaCutoff],a._isCustomRangeActive=n[g.isCustomRangeActive],a._spriteSortPoint=n[g.spriteSortPoint];const o=s.TryGet(n[g.sprite+1]);return o&&(a.sprite=o),a},_loadRigidbodyComponent:function(t,e,i,s){const n=i.data,r=new pc.RigidbodyComponent({enabled:!0,maxAngularVelocity:n[y.maxAngularVelocity],mass:n[y.mass],drag:n[y.drag],angularDrag:n[y.angularDrag],useGravity:!!n[y.useGravity],isKinematic:!!n[y.isKinematic],constraints:n[y.constraints],collisionDetectionMode:n[y.collisionDetectionMode],interpolation:n[y.interpolation]});return e.addUnityComponentFromDeserialization("rigidbody",r),r},_loadBoxColliderComponent:function(t,e,i,s){const n=i.data,r=new pc.BoxColliderComponent({enabled:!!n[E.enabled],size:new pc.Vec3(n[E.size+0],n[E.size+1],n[E.size+2]),material:s.TryGet(n[E.material+1]),center:new pc.Vec3(n[E.center+0],n[E.center+1],n[E.center+2]),isTrigger:!!n[E.isTrigger]});return e.addUnityComponentFromDeserialization("collider",r),r},_loadSphereColliderComponent:function(t,e,i,s){const n=i.data,r=new pc.SphereColliderComponent({enabled:!!n[A.enabled],radius:n[A.radius],material:s.TryGet(n[A.material+1]),center:new pc.Vec3(n[A.center+0],n[A.center+1],n[A.center+2]),isTrigger:!!n[A.isTrigger]});return e.addUnityComponentFromDeserialization("collider",r),r},_loadMeshColliderComponent:function(t,e,i,s){const n=i.data,r=new pc.MeshColliderComponent({enabled:!!n[T.enabled],mesh:s.TryGet(n[T.sharedMesh+1]),material:s.TryGet(n[T.material+1]),isTrigger:!!n[T.isTrigger],convex:!!n[T.convex]});return e.addUnityComponentFromDeserialization("collider",r),r},_loadCapsuleColliderComponent:function(t,e,i,s){const n=i.data,r=new pc.CapsuleColliderComponent({enabled:!!n[C.enabled],radius:n[C.radius],material:s.TryGet(n[C.material+1]),center:new pc.Vec3(n[C.center+0],n[C.center+1],n[C.center+2]),height:n[C.height],direction:n[C.direction],isTrigger:!!n[C.isTrigger]});return e.addUnityComponentFromDeserialization("collider",r),r},_loadWheelColliderComponent:function(t,e,i,s){const n=i.data,r=new pc.WheelColliderComponent,a=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[i.type]),r);return t.deserializeTo(n,a,"Luna.Unity.DTO.UnityEngine.Components.WheelCollider"),e.addUnityComponentFromDeserialization("collider",r),r},_loadCharacterControllerComponent:function(t,e,i,s){const n=new pc.CharacterControllerComponent,r=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[i.type]),n);return t.deserializeTo(i.data,r,"Luna.Unity.DTO.UnityEngine.Components.CharacterController"),e.addUnityComponentFromDeserialization("collider",n),n},_loadRigidbody2DComponent:function(t,e,i,s){const n=i.data,r=new pc.Rigidbody2DComponent({entity:e,enabled:!0,simulated:n[b.simulated],useAutoMass:n[b.useAutoMass],type:n[b.bodyType],mass:n[b.mass],drag:n[b.drag],angularDrag:n[b.angularDrag],gravityScale:n[b.gravityScale],collisionDetectionMode:n[b.collisionDetectionMode],constraints:n[b.constraints],material:s.TryGet(b.material+1)});return e.addUnityComponentFromDeserialization("rigidbody2D",r),r},_loadBoxCollider2DComponent:function(t,e,i,s){const n=i.data,r=new pc.BoxCollider2DComponent({enabled:!!n[S.enabled],isTrigger:n[S.isTrigger],usedByEffector:n[S.usedByEffector],density:n[S.density],size:new pc.Vec2(n[S.size+0],n[S.size+1]),center:new pc.Vec2(n[S.offset+0],n[S.offset+1]),radius:n[S.edgeRadius],material:s.TryGet(n[S.material+1])});return e.addUnityComponentFromDeserialization("collider2D",r),r},_loadCircleCollider2DComponent:function(t,e,i,s){const n=i.data,r=new pc.CircleCollider2DComponent({enabled:!!n[x.enabled],isTrigger:n[x.isTrigger],usedByEffector:n[x.usedByEffector],density:n[x.density],radius:n[x.radius],center:new pc.Vec2(n[x.offset+0],n[x.offset+1]),material:s.TryGet(n[x.material+1])});return e.addUnityComponentFromDeserialization("collider2D",r),r},_loadCapsuleCollider2DComponent:function(t,e,i,s){const n=i.data,r=new pc.CapsuleCollider2DComponent({enabled:!!n[D.enabled],isTrigger:n[D.isTrigger],usedByEffector:n[D.usedByEffector],density:n[D.density],center:new pc.Vec2(n[D.offset+0],n[D.offset+1]),material:s.TryGet(n[D.material+1]),direction:n[D.direction],size:new pc.Vec2(n[D.size+0],n[D.size+1])});return e.addUnityComponentFromDeserialization("collider2D",r),r},_loadEdgeCollider2DComponent:function(t,e,i,s){const n=i.data,r=new pc.EdgeCollider2DComponent({enabled:!!n[M.enabled],isTrigger:n[M.isTrigger],usedByEffector:n[M.usedByEffector],density:n[M.density],points:n[M.points],offset:new pc.Vec2(n[M.offset+0],n[M.offset+1]),radius:n[M.edgeRadius],material:s.TryGet(n[M.material+1])});return e.addUnityComponentFromDeserialization("collider2D",r),r},_loadPolygonCollider2DComponent:function(t,e,i,s){const n=i.data,r=new pc.PolygonCollider2DComponent({enabled:!!n[R.enabled],isTrigger:n[R.isTrigger],usedByEffector:n[R.usedByEffector],density:n[R.density],points:n[R.points],offset:new pc.Vec2(n[R.offset+0],n[R.offset+1]),material:s.TryGet(n[R.material+1])});return e.addUnityComponentFromDeserialization("collider2D",r),r},_loadSpringJoint2DComponent:function(t,e,i,s){const n=i.data;return this._loadJoint2DComponent(t,e,i,I,new pc.SpringJoint2DComponent({enabled:!!n[I.enabled],enableCollision:n[I.enableCollision],breakForce:n[I.breakForce],breakTorque:n[I.breakTorque],frequency:n[I.frequency],dampingRatio:n[I.dampingRatio],distance:n[I.distance],autoConfigureConnectedAnchor:n[I.autoConfigureConnectedAnchor],anchor:new pc.Vec2(n[I.anchor+0],n[I.anchor+1]),connectedAnchor:new pc.Vec2(n[I.connectedAnchor+0],n[I.connectedAnchor+1])}))},_loadDistanceJoint2DComponent:function(t,e,i,s){const n=i.data;return this._loadJoint2DComponent(t,e,i,O,new pc.DistanceJoint2DComponent({enabled:!!n[O.enabled],enableCollision:n[O.enableCollision],breakForce:n[O.breakForce],breakTorque:n[O.breakTorque],maxDistanceOnly:n[O.maxDistanceOnly],distance:n[O.distance],autoConfigureDistance:n[O.autoConfigureDistance],autoConfigureConnectedAnchor:n[O.autoConfigureConnectedAnchor],anchor:new pc.Vec2(n[O.anchor+0],n[O.anchor+1]),connectedAnchor:new pc.Vec2(n[O.connectedAnchor+0],n[O.connectedAnchor+1])}))},_loadFixedJoint2DComponent:function(t,e,i,s){const n=i.data;return this._loadJoint2DComponent(t,e,i,F,new pc.FixedJoint2DComponent({enabled:!!n[F.enabled],enableCollision:n[F.enableCollision],breakForce:n[F.breakForce],breakTorque:n[F.breakTorque],frequency:n[F.frequency],dampingRatio:n[F.dampingRatio],autoConfigureConnectedAnchor:n[F.autoConfigureConnectedAnchor],anchor:new pc.Vec2(n[F.anchor+0],n[F.anchor+1]),connectedAnchor:new pc.Vec2(n[F.connectedAnchor+0],n[F.connectedAnchor+1])}))},_loadHingeJoint2DComponent:function(t,e,i,s){const n=i.data,r=new UnityEngine.JointAngleLimits2D;t.deserializeTo(n[P.limits],r);const a=new UnityEngine.JointMotor2D;return t.deserializeTo(n[P.motor],a),this._loadJoint2DComponent(t,e,i,P,new pc.HingeJoint2DComponent({enabled:!!n[P.enabled],enableCollision:n[P.enableCollision],breakForce:n[P.breakForce],breakTorque:n[P.breakTorque],autoConfigureConnectedAnchor:n[P.autoConfigureConnectedAnchor],anchor:new pc.Vec2(n[P.anchor+0],n[P.anchor+1]),connectedAnchor:new pc.Vec2(n[P.connectedAnchor+0],n[P.connectedAnchor+1]),useLimits:n[P.useLimits],limits:r,useMotor:n[P.useMotor],motor:a}))},_loadWheelJoint2DComponent:function(t,e,i,s){const n=i.data,r=new UnityEngine.JointSuspension2D;t.deserializeTo(n[v.suspension],r);const a=new UnityEngine.JointMotor2D;return t.deserializeTo(n[v.motor],a),this._loadJoint2DComponent(t,e,i,v,new pc.WheelJoint2DComponent({enabled:!!n[v.enabled],enableCollision:n[v.enableCollision],breakForce:n[v.breakForce],breakTorque:n[v.breakTorque],autoConfigureConnectedAnchor:n[v.autoConfigureConnectedAnchor],anchor:new pc.Vec2(n[v.anchor+0],n[v.anchor+1]),connectedAnchor:new pc.Vec2(n[v.connectedAnchor+0],n[v.connectedAnchor+1]),suspension:r,useMotor:n[v.useMotor],motor:a}))},_loadFrictionJoint2DComponent:function(t,e,i,s){const n=i.data;return this._loadJoint2DComponent(t,e,i,w,new pc.FrictionJoint2DComponent({enabled:!!n[w.enabled],enableCollision:n[w.enableCollision],breakForce:n[w.breakForce],breakTorque:n[w.breakTorque],autoConfigureConnectedAnchor:n[w.autoConfigureConnectedAnchor],anchor:new pc.Vec2(n[w.anchor+0],n[w.anchor+1]),connectedAnchor:new pc.Vec2(n[w.connectedAnchor+0],n[w.connectedAnchor+1]),maxForce:n[w.maxForce],maxTorque:n[w.maxTorque]}))},_loadRelativeJoint2DComponent:function(t,e,i,s){const n=i.data;return this._loadJoint2DComponent(t,e,i,L,new pc.RelativeJoint2DComponent({enabled:!!n[L.enabled],enableCollision:n[L.enableCollision],breakForce:n[L.breakForce],breakTorque:n[L.breakTorque],autoConfigureOffset:n[L.autoConfigureOffset],linearOffset:new pc.Vec2(n[L.linearOffset+0],n[L.linearOffset+1]),angularOffset:n[L.angularOffset],maxForce:n[L.maxForce],maxTorque:n[L.maxTorque],correctionScale:n[L.correctionScale]}))},_loadSliderJoint2DComponent:function(t,e,i,s){const n=i.data,r=new UnityEngine.JointTranslationLimits2D;t.deserializeTo(n[B.limits],r);const a=new UnityEngine.JointMotor2D;return t.deserializeTo(n[B.motor],a),this._loadJoint2DComponent(t,e,i,B,new pc.SliderJoint2DComponent({enabled:!!n[B.enabled],enableCollision:n[B.enableCollision],breakForce:n[B.breakForce],breakTorque:n[B.breakTorque],autoConfigureConnectedAnchor:n[B.autoConfigureConnectedAnchor],anchor:new pc.Vec2(n[B.anchor+0],n[B.anchor+1]),connectedAnchor:new pc.Vec2(n[B.connectedAnchor+0],n[B.connectedAnchor+1]),autoConfigureAngle:n[B.autoConfigureAngle],angle:n[B.angle],useLimits:n[B.useLimits],limits:r,useMotor:n[B.useMotor],motor:a}))},_loadTargetJoint2DComponent:function(t,e,i,s){const n=i.data;return this._loadJoint2DComponent(t,e,i,U,new pc.TargetJoint2DComponent({enabled:!!n[U.enabled],enableCollision:n[U.enableCollision],breakForce:n[U.breakForce],breakTorque:n[U.breakTorque],autoConfigureTarget:n[U.autoConfigureTarget],target:new pc.Vec2(n[U.target+0],n[U.target+1]),anchor:new pc.Vec2(n[U.anchor+0],n[U.anchor+1]),maxForce:n[U.maxForce],dampingRatio:n[U.dampingRatio],frequency:n[U.frequency]}))},_loadPlatformEffector2DComponent:function(t,e,i,s){const n=i.data,r=new pc.PlatformEffector2DComponent({enabled:!!n[z.enabled]});return e.addUnityComponentFromDeserialization("effector2D",r),r},_loadJoint2DComponent:function(t,e,i,s,n){const r=i.data,a=Deserializers.types[i.type],o=UnityEngine.Object.FromHandle(Bridge._getTypeByName(a),n);return t.r(r[s.connectedBody+0],r[s.connectedBody+1],0,o,"connectedBody"),e.addUnityComponentFromDeserialization("joint2D",n),n},_loadParticleSystemComponent:function(t,e,i,s){const n=new pc.ParticleSystem,r=new pc.ParticleSystemComponent({particleSystem:n});return t.deserializeTo(i.data,n,"Luna.Unity.DTO.UnityEngine.Components.ParticleSystem"),e.addUnityComponentFromDeserialization("particlesystem",r),r},_loadParticleSystemRendererComponent:function(t,e,i,s){const n=new pc.ParticleSystemRenderer;t.deserializeTo(i.data,n,"Luna.Unity.DTO.UnityEngine.Components.ParticleSystemRenderer"),n.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(n.sortingLayerID),n.sortingOrder=n.sortingOrder;const r=new pc.ParticleSystemRendererComponent({particleSystemRenderer:n});return e.addUnityComponentFromDeserialization("particleSystemRenderer",r),r.enabled=n.enabled,r},_loadJointComponent:function(t,e,i,s){const n=i.data,r=new pc.JointComponent({type:Deserializers.types[i.type]}),a=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[i.type]),r);return t.deserializeTo(n,a,Deserializers.types[i.type].replace("UnityEngine.","Luna.Unity.DTO.UnityEngine.Components.")),e.addUnityComponentFromDeserialization("joint",r),r},_loadMonoBehaviourComponent:function(t,e,i,s){const n=Deserializers.types[i.class],r=pc.MonoBehaviourComponent.create({type:n,enabled:!!i.enabled,entity:e});return r?(t.deserializeTo(i.data,r.code),e.addUnityComponentFromDeserialization("monoBehaviour",r),r):null},_loadRendererComponent:function(t,e,i,s,n,r){const a=n.data,o=e;s.addUnityComponentFromDeserialization("renderer",o);const h=a[t.sharedMaterials],c=[];for(let t=0;t<h.length;t+=2){let e=r.TryGet(h[t+1]);e||(e=UnityEngine.Graphics.InternalErrorShaderMaterial.handle),c.push(e)}return o.model.materials=c,o.model.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(a[t.sortingLayerID]),o.model.sortingOrder=a[t.sortingOrder],o.model.cullingLayer=s.cullingLayer,o.enabled=!!a[t.enabled],o.castShadows=a[t.shadowCastingMode]>UnityEngine.Rendering.ShadowCastingMode.Off,o.receiveShadows=!!a[t.receiveShadows],o.id=n.id,o.model._lightmapSceneIndex=a[t.lightmapSceneIndex],o.model._lightmapIndex=a[t.lightmapIndex],o.model.lightmapScaleOffset=new pc.Vec4(a[t.lightmapScaleOffset+0],a[t.lightmapScaleOffset+1],a[t.lightmapScaleOffset+2],a[t.lightmapScaleOffset+3]),o},_loadLineRendererComponent:function(t,e,i,s){const n=this._loadRendererComponent(N,new pc.LineRendererComponent,t,e,i,s),r=n.code;return t.deserializeTo(i.data,r,"Luna.Unity.DTO.UnityEngine.Components.LineRenderer"),n},_loadCanvasRendererComponent:function(t,e,i,s){const n=new pc.CanvasRendererComponent;return t.deserializeTo(i.data,n.code,"Luna.Unity.DTO.UnityEngine.Components.CanvasRenderer"),e.addUnityComponentFromDeserialization("canvasRenderer",n),n},_loadTrailRendererComponent:function(t,e,i,s){const n=this._loadRendererComponent(k,new pc.TrailRendererComponent,t,e,i,s),r=n.code;return t.deserializeTo(i.data,r,"Luna.Unity.DTO.UnityEngine.Components.TrailRenderer"),n},_loadReflectionProbeComponent:function(t,e,i,s){const n=i.data,r=new pc.ReflectionProbeComponent,a=UnityEngine.Object.FromHandle(UnityEngine.ReflectionProbe,r);return t.deserializeTo(n,a,"Luna.Unity.DTO.UnityEngine.Components.ReflectionProbe"),e.addUnityComponentFromDeserialization("reflectionprobe",r),r}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.AudioMixer",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){const s=t.d("Luna.Unity.DTO.UnityEngine.Audio.AudioMixer",e.data),n=new UnityEditor.Audio.AudioMixerController(s);this.registry.Put(e.id,n);for(let t=0;t<n.groups.length;t++)this.registry.Put(n.groups[t].id,n.groups[t]);return{result:n}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.AudioMixerSnapshot",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){const s=t.d("Luna.Unity.DTO.UnityEngine.Audio.AudioMixerSnapshot",e.data),n=new UnityEngine.Audio.AudioMixerSnapshot(s);return this.registry.Put(e.id,n),{result:n}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+ScriptsExecutionOrder"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+SortingLayer"],r=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+CullingLayer"],a=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+TimeSettings"],o=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+PhysicsSettings"],h=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+PhysicsSettings+CollisionMask"],c=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+Physics2DSettings"];Bridge.define("LunaUnity.Objects.Handlers.ProjectSettings",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,l){const u=e.data,d=u[i.scriptsExecutionOrder],_=[];for(let t=0;t<d.length;t++){const e=d[t];_[e[s.name]]=e[s.value]}this.app.systems.monoBehaviour.scriptsExecutionOrder=_;const p=u[i.sortingLayers];pc.Application.getApplication().renderer.removeShadows=!!u[i.removeShadows],this.autoInstantiatePrefabs=!!u[i.autoInstantiatePrefabs];for(let t=0;t<p.length;t++){const e=new UnityEngine.SortingLayer,i=p[t];e.id=i[n.id],e.name=i[n.name],e.value=i[n.value],UnityEngine.SortingLayer.layers.push(e)}const m=u[i.cullingLayers];for(let t=0;t<m.length;t++){const e=new UnityEngine.LayerMask.CullingLayer,i=m[t];e.id=i[r.id],e.name=i[r.name],UnityEngine.LayerMask.layers.push(e)}const f=u[i.timeSettings];this.app.systems.unitymanager.fixedTimeStep=f[a.fixedDeltaTime],this.app.systems.unitymanager.maximumAllowedTimeStep=f[a.maximumDeltaTime],this.app.systems.unitymanager.timeScale=f[a.timeScale],this.app.systems.unitymanager.maximumParticleTimestep=f[a.maximumParticleTimestep];const g=u[i.physicsSettings];this.app.systems.physics.gravity=new pc.Vec3(g[o.gravity+0],g[o.gravity+1],g[o.gravity+2]);const y=g[o.collisionMatrix];for(let t=0;t<y.length;t++){const e=y[t];this.app.systems.physics.setIgnoreCollisionBetweenLayers(e[h.layerId],e[h.otherLayerId],e[h.enabled])}this.app.systems.physics.defaultSolverIterations=g[o.defaultSolverIterations],this.app.systems.physics.bounceThreshold=g[o.bounceThreshold],this.app.systems.physics.autoSyncTransforms=!!g[o.autoSyncTransforms],this.app.systems.physics.autoSimulation=!!g[o.autoSimulation];const E=this.app.systems.physics2D,A=u[i.physics2DSettings];E.gravity=new pc.Vec2(A[c.gravity+0],A[c.gravity+1]),E.autoSyncTransforms=A[c.autoSyncTransforms],E.positionIterations=A[c.positionIterations],E.velocityIterations=A[c.velocityIterations],t.r(!0,A[c.material+1],0,E,"defaultMaterial");const T=A[c.collisionMatrix];for(let t=0;t<T.length;t++){const e=T[t];E.setIgnoreCollisionBetweenLayers(e[h.layerId],e[h.otherLayerId],e[h.enabled])}return UnityEngine.Graphics.graphicsDevice.enableAutoInstancing=!!u[i.enableAutoInstancing],UnityEngine.LightmapSettings.lightmapEncodingQuality=u[i.lightmapEncodingQuality],UnityEngine.LightmapSettings.bakedColorSpace=u[i.desiredColorSpace],{}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Material"];Bridge.define("LunaUnity.Objects.Handlers.Material",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t),this.request=new LunaUnity.Objects.ImmediateRequest(null)},loadAsync:function(t,e,s){this.request.registry=this.registry;const n=this.request.d("Luna.Unity.DTO.UnityEngine.Assets.Material",e.data);return n.shader=this.registry.TryGet(e.data[i.shader+1]),n.setup(),"Default UI Material"===n.name&&(UnityEngine.Canvas.DefaultCanvasMaterial=UnityEngine.Object.FromHandle(UnityEngine.Material,n)),"Sprites-Default"===n.name&&(UnityEngine.Material.SpritesDefault=UnityEngine.Object.FromHandle(UnityEngine.Material,n)),"Sprites-Mask"===n.name&&(UnityEngine.Material.SpriteMasksDefault=UnityEngine.Object.FromHandle(UnityEngine.Material,n)),"Font Material"===n.name&&(UnityEngine.Material.FontDefault=UnityEngine.Object.FromHandle(UnityEngine.Material,n)),this.registry.Put(e.id,n),System.Threading.Tasks.Task.fromResult(n)},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.PhysicMaterial",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e){const i=t.d("Luna.Unity.DTO.UnityEngine.Assets.PhysicMaterial",e.data),s=new Goblin.PhysicMaterial(i);return this.registry.Put(e.id,s),{result:s}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.PhysicsMaterial2D",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e){const i=t.d("Luna.Unity.DTO.UnityEngine.Assets.PhysicsMaterial2D",e.data);return this.registry.Put(e.id,i),{result:i}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Mesh"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Mesh+SubMesh"],n=new Blob;Bridge.define("LunaUnity.Objects.Handlers.Mesh",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,r){const a=e.data,o=new pc.Mesh(!0),h=r.find((t=>t.manifest.id===e.assetBundleId)).blob||n;o.name=a[i.name];const c=a[i.vertices];let l=h.slice(c[0],c[0]+c[1]);const u=a[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):new Float32Array(l),d=o.defaultVertexBuffer(a[i.streams],a[i.vertexCount],u.buffer);a[i.vertices]=null,o.vertexBuffer=d,o.subMeshes=[];const _=a[i.subMeshes],p=a[i.aabb];for(let t=0;t<_.length;t++){const i=_[t][s.triangles],n=new Uint16Array(h.slice(i[0],i[0]+i[1])),r=new pc.Mesh;r.aabb=new pc.BoundingBox(new pc.Vec3(p[0],p[1],p[2]),new pc.Vec3(p[3],p[4],p[5])),r.$id=e.id;const a=o.defaultIndexBuffer(n.length,n.buffer);r.vertexBuffer=d,r.indexBuffer[0]=a,r.primitive[0].type=pc.PRIMITIVE_TRIANGLES,r.primitive[0].base=0,r.primitive[0].count=n.length,r.primitive[0].indexed=!0,o.subMeshes.push(r)}o.indexBuffer=o.subMeshes[0].indexBuffer,o.primitive[0].type=pc.PRIMITIVE_TRIANGLES,o.primitive[0].base=0,o.primitive[0].count=_[0].length,o.primitive[0].indexed=!0,o.aabb=new pc.BoundingBox(new pc.Vec3(p[0],p[1],p[2]),new pc.Vec3(p[3],p[4],p[5]));const m=a[i.bindposes];for(let t=0;t<m.length;t+=16)o.bindposes.push((new pc.Mat4).setData(m[t+0],m[t+1],m[t+2],m[t+3],m[t+4],m[t+5],m[t+6],m[t+7],m[t+8],m[t+9],m[t+10],m[t+11],m[t+12],m[t+13],m[t+14],m[t+15]));const f=a[i.blendShapes];if(0!==f.length){o.morph=new pc.Morph([]);for(let t=0;t<f.length;t++){const e=f[t],s=e[1],n={};n.name=e[0],n.frames=[];for(let t=0;t<s.length;t++){const s={};s.weight=e[1][t][0],l=h.slice(e[1][t][1][0],e[1][t][1][0]+e[1][t][1][1]),s.deltaPositions=a[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):e[1][t][1],l=h.slice(e[1][t][2][0],e[1][t][2][0]+e[1][t][2][1]),s.deltaNormals=a[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):e[1][t][2],l=h.slice(e[1][t][3][0],e[1][t][3][0]+e[1][t][3][1]),s.deltaTangents=a[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):e[1][t][3];const r=new pc.MorphTargetFrame(s);n.frames[t]=r}const r=new pc.MorphTarget(n);o.morph.addTarget(r),o.morph._setBaseMesh(o)}}return this.registry.Put(e.id,o),{result:o}},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Scene.Scene"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.RenderSettings"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.RenderSettings+LightProbes"];Bridge.define("LunaUnity.Objects.Handlers.Scene",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,n){const r=e.data,a=(new LunaUnity.Objects.Scene).initializeAsTemplate({renderSettings:t.d("Luna.Unity.DTO.UnityEngine.Assets.RenderSettings",e.render_settings.data),rootJsons:e.objects,name:r[i.name],index:r[i.index],lightmaps:r[i.lightmaps]}),o=n.find((t=>t.manifest.id===e.assetBundleId)).blob,h=e.render_settings.data[s.lightProbes];return this.parseLightProbeData(o,h,a.renderSettings.lightProbes),UnityEngine.SceneManagement.SceneManager.scenes.push(a),this.registry.Put("scenes/"+e.name,a),{result:a}},parseLightProbeData:function(t,e,i){let s=[],r=0,a=this.getTypedArrayFromBlobAndMarker(Float32Array,t,e[n.bakedProbes]);for(r=0;r<a.length;r+=27)s.push(pc.SphericalHarmonicsL2.fromArray(a.subarray(r,r+27)));for(i.bakedProbes=s,s=[],a=this.getTypedArrayFromBlobAndMarker(Float32Array,t,e[n.positions]),r=0;r<a.length;r+=3)s.push(new pc.Vec3(a[r+0],a[r+1],a[r+2]));for(i.positions=s,s=[],a=this.getTypedArrayFromBlobAndMarker(Float32Array,t,e[n.hullRays]),r=0;r<a.length;r+=3)s.push(new pc.Vec3(a[r+0],a[r+1],a[r+2]));for(i.hullRays=s,s=[],a=this.getTypedArrayFromBlobAndMarker(Float32Array,t,e[n.matrices]),r=0;r<a.length;r+=16)s.push(pc.Mat4.fromArray(a.subarray(r,r+16)));i.matrices=s,i.tetrahedra=this.getTypedArrayFromBlobAndMarker(Int16Array,t,e[n.tetrahedra]),i.neighbours=this.getTypedArrayFromBlobAndMarker(Int16Array,t,e[n.neighbours])},getTypedArrayFromBlobAndMarker:function(t,e,i){return new t(e?e.slice(i[0],i[0]+i[1]):0)},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Shader"];Bridge.define("LunaUnity.Objects.Handlers.Shader",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){const s=new pc.UnityShader(this.graphicsDevice);return t.d("Luna.Unity.DTO.UnityEngine.Assets.Shader",e.data,s),s.setup(),this.registry.Put(e.id,s),UnityEngine.Shader.shaderIndex[s.name]=s,System.Threading.Tasks.Task.fromResult(s)},_loadRenderState:function(t,e){const i=t.d("Luna.Unity.DTO.UnityEngine.Assets.Shader+Pass",e),s=[];return this._collectBoundParameters(i,s),i.boundParameters=s,i},_collectBoundParameters:function(t,e){for(const i in t){if(!t.hasOwnProperty(i))continue;const s=t[i];s&&s.$$fullname&&("Luna.Unity.DTO.UnityEngine.Assets.Shader.Pass+Value"===s.$$fullname&&s.name?e.push(s):this._collectBoundParameters(s,e))}},_getDefaultTextureNamed:function(t){const e=UnityEngine.Texture2D[t+"Texture"];return e?e.handle:null},_loadShaderForStandardMaterialAsync:function(t,e){return this.registry.Put(e.id,{name:e.data[i.name],renderState:this._loadRenderState(t,e.data[i.passes][0])}),System.Threading.Tasks.Task.fromResult(!0)},_loadCustomShaderAsync:function(t,e){const s=[];let n=pc.MultipassShader;const r=e.data,a=r[i.passes];let o=null;for(let h=0;h<a.length;h++){const a=r[i.vertexPrograms][h],c=r[i.fragmentPrograms][h];a&&c?o=new n(this.graphicsDevice,{attributes:{vertex_position:pc.SEMANTIC_POSITION,vertex_normal:pc.SEMANTIC_NORMAL,vertex_tangent:pc.SEMANTIC_TANGENT,vertex_texCoord0:pc.SEMANTIC_TEXCOORD0,vertex_texCoord1:pc.SEMANTIC_TEXCOORD1,vertex_color:pc.SEMANTIC_COLOR,instancing_translation:pc.SEMANTIC_TEXCOORD7,instancing_rotation:pc.SEMANTIC_BLENDWEIGHT,instancing_scale:pc.SEMANTIC_BLENDINDICES,instancing_color:pc.SEMANTIC_ATTR0,instancing_st:pc.SEMANTIC_ATTR1,_glesVertex:pc.SEMANTIC_POSITION,_glesNormal:pc.SEMANTIC_NORMAL,_glesTangent:pc.SEMANTIC_TANGENT,_glesMultiTexCoord0:pc.SEMANTIC_TEXCOORD0,_glesMultiTexCoord1:pc.SEMANTIC_TEXCOORD1,_glesMultiTexCoord2:pc.SEMANTIC_TEXCOORD2,_glesMultiTexCoord3:pc.SEMANTIC_TEXCOORD3,_glesColor:pc.SEMANTIC_COLOR,in_POSITION0:pc.SEMANTIC_POSITION,in_NORMAL0:pc.SEMANTIC_NORMAL,in_TANGENT0:pc.SEMANTIC_TANGENT,in_TEXCOORD0:pc.SEMANTIC_TEXCOORD0,in_TEXCOORD1:pc.SEMANTIC_TEXCOORD1,in_TEXCOORD2:pc.SEMANTIC_TEXCOORD2,in_TEXCOORD3:pc.SEMANTIC_TEXCOORD3,in_COLOR0:pc.SEMANTIC_COLOR,_patched_POSITION:pc.SEMANTIC_POSITION,_patched_COLOR:pc.SEMANTIC_COLOR,_patched_NORMAL:pc.SEMANTIC_NORMAL,_patched_TANGENT:pc.SEMANTIC_TANGENT,_patched_TEXCOORD0:pc.SEMANTIC_TEXCOORD0,vertex_boneWeights:pc.SEMANTIC_BLENDWEIGHT,vertex_boneIndices:pc.SEMANTIC_BLENDINDICES},vshader:a,fshader:c}):(o=pc._createMissingShader(e.data[i.name],e.id),o.name=e.data[i.name]),o._supportsKeywords=!0,o.renderState=this._loadRenderState(t,r[i.passes][h]),s.push(o),n=pc.Shader}return o=s[0],o.shaders=s,o.defaultParameters={},this.registry.Put(e.id,o),UnityEngine.Shader.shaderIndex[e.name]=o,System.Threading.Tasks.Task.fromResult(o)},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.VideoClip"];Bridge.define("LunaUnity.Objects.Handlers.Video",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,s){const n=new System.Threading.Tasks.TaskCompletionSource,r=e.data,a={name:r[i.name],width:r[i.width],height:r[i.height],frameRate:r[i.frameRate],frameCount:r[i.frameCount]},o=new pc.VideoTexture(this.app.graphicsDevice,a);return this.registry.Put(e.id,o),this.network.GetVideoAsync(this._getVideoUrl(e)).continueWith(Bridge.fn.bind(this,(t=>{if(t.status===System.Threading.Tasks.TaskStatus.ranToCompletion){const e=t.result;o.setSource(e),n.setResult(o)}else n.setCanceled()}))),n.task},_getVideoUrl:function(t){return"external"===this.network.resourceConfig.video&&t.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[t.id]:"assets/bundles/"+t.assetBundleId+"/"+t.id+(t.ext||".mp4")},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.AudioClip"];Bridge.define("LunaUnity.Objects.Handlers.Sound",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,s){const n=new System.Threading.Tasks.TaskCompletionSource,r=new pc.Sound;r.name=e.data[i.name];const a=this._getSoundUrl(e),o=function(t){r.buffer=t,n.setResult(r)},h=function(t){t=t||"Error loading audio url: "+a,console.error(t),n.setCancelled()},c=this.app._audioManager;return this.registry.Put(e.id,r),this.network.GetSoundAsync(this._getSoundUrl(e)).continueWith((t=>{t.status===System.Threading.Tasks.TaskStatus.ranToCompletion?c.context.decodeAudioData(t.result,o,h):h(t.error)})),n.task},_getSoundUrl:function(t){return"external"===this.network.resourceConfig.sound&&t.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[t.id]:"assets/bundles/"+t.assetBundleId+"/"+t.id+(t.ext||".mp3")},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&(e.buffer=null)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Sprite"];Bridge.define("LunaUnity.Objects.Handlers.Sprite",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,s){const n=e.data,r=this.registry.Get(n[i.texture+1]),a=new pc.Sprite({}),o=n[i.textureWidth]/r.width;return a.attributes.transparency=new pc.Vec4((n[i.packedRect+0]-n[i.textureRect+0])*r.width,(n[i.packedRect+1]-n[i.textureRect+1])*r.height,(n[i.textureRect+2]-n[i.packedRect+2])*r.width,(n[i.textureRect+3]-n[i.packedRect+3])*r.height),a.attributes.textureRect=new pc.Vec4(n[i.packedRect+0]*r.width,n[i.packedRect+1]*r.height,n[i.packedRect+2]*r.width,n[i.packedRect+3]*r.height),a.attributes.graphicsDevice=this.graphicsDevice,a.attributes.texture=r,a.attributes.border=new pc.Vec4(Math.max(0,n[i.border+0]*r.width-a.attributes.transparency.x),Math.max(0,n[i.border+1]*r.height-a.attributes.transparency.y),Math.max(0,n[i.border+2]*r.width-a.attributes.transparency.z),Math.max(0,n[i.border+3]*r.height-a.attributes.transparency.w)),a.attributes.bounds=n[i.bounds],a.attributes.pixelsPerUnit=n[i.pixelsPerUnit]/o,a.attributes.aabb=n[i.aabb],a.attributes.vertices=n[i.vertices],a.attributes.triangles=n[i.triangles],a.attributes.nativeSize=new pc.Vec2(n[i.nativeSize],n[i.nativeSize+1]),a.attributes.pivot=new pc.Vec2(n[i.pivot+0],n[i.pivot+1]),a.attributes.textureRectOffset=new pc.Vec2(n[i.textureRectOffset+0],n[i.textureRectOffset+1]),this.registry.Put(e.id,a),{result:a}},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.mesh&&e.mesh.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Texture2D"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.RenderTexture"],n=[pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_A8,pc.PIXELFORMAT_R4_G4_B4_A4,pc.PIXELFORMAT_R8_G8_B8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R5_G6_B5,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_RGBA32F,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_PVRTC_2BPP_RGBA_1,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8];Bridge.define("LunaUnity.Objects.Handlers.Texture",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){if(0===e.type)return this._loadTexture2dAsync(e);if(1===e.type)return this._loadTexture3dAsync(e);if(2===e.type)return System.Threading.Tasks.Task.fromResult(!0);if(3===e.type)return this._loadRenderTextureAsync(e);throw new Error("Unknown texture type: "+e.type)},_loadRenderTextureAsync:function(t){const e=new UnityEngine.RenderTexture.Create(t.data[s.width],t.data[s.height],16,0);return this.registry.Put(t.id,e.handle),System.Threading.Tasks.Task.fromResult(e.handle)},_loadTexture3dAsync:function(t){throw new Error("NotImplemented")},_getDummyTexture:function(){if(this._dummyTexture)return this._dummyTexture;this._dummyTexture=new pc.Texture(this.app.graphicsDevice,{width:16,height:16,format:pc.PIXELFORMAT_R8_G8_B8_A8});const t=this._dummyTexture.lock();for(let e=0;e<t.length;e+=3)t[e+0]=255,t[e+1]=0,t[e+2]=255,t[e+4]=127;return this._dummyTexture.unlock(),this._dummyTexture},_loadTexture2dAsync:function(t){const e=new System.Threading.Tasks.TaskCompletionSource,s=t.data,r=s[i.filterMode],a=s[i.mipmapCount]>1;let o=a?pc.FILTER_NEAREST_MIPMAP_NEAREST:pc.FILTER_NEAREST,h=pc.FILTER_NEAREST;r===UnityEngine.FilterMode.Bilinear?(o=a?pc.FILTER_LINEAR_MIPMAP_NEAREST:pc.FILTER_LINEAR,h=pc.FILTER_LINEAR):r===UnityEngine.FilterMode.Trilinear&&(o=a?pc.FILTER_LINEAR_MIPMAP_LINEAR:pc.FILTER_LINEAR,h=pc.FILTER_LINEAR);const c=s[i.wrapMode]===UnityEngine.TextureWrapMode.Repeat?pc.ADDRESS_REPEAT:pc.ADDRESS_CLAMP_TO_EDGE,l={name:s[i.name]||"",width:s[i.width],height:s[i.height],addressU:c,addressV:c,mipmaps:a,minFilter:o,magFilter:h,autoMipmap:a,rgbm:!!s[i.hdr],anisotropy:Math.min(this.graphicsDevice.maxAnisotropy,s[i.anisoLevel]),format:n[s[i.format]]};if(t.dummy){const e=this._getDummyTexture();return this.registry.Put(t.id,e),System.Threading.Tasks.Task.fromResult(e)}const u=new pc.Texture(this.app.graphicsDevice,l);return this.registry.Put(t.id,u),this.network.GetImageAsync(this._getTextureUrl(t)).continueWith(Bridge.fn.bind(this,(t=>{if(t.status===System.Threading.Tasks.TaskStatus.ranToCompletion){const i=t.result;u.setSource(i),i.remove(),u.mipmaps=l.mipmaps,u.minFilter=l.minFilter,u.magFilter=l.magFilter,u.anisotropy=l.anisotropy,e.setResult(u)}else e.setCanceled()}))),e.task},_getTextureUrl:function(t){return"external"===this.network.resourceConfig.image&&t.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[t.id]:"assets/bundles/"+t.assetBundleId+"/"+t.id+(t.ext||".png")},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Cubemap"];Bridge.define("LunaUnity.Objects.Handlers.Cubemap",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){return 2===e.type?this._loadCubemapAsync(e):System.Threading.Tasks.Task.fromResult(null)},_loadCubemapAsync:function(t){const e=t.data,s=e[i.size],n=e[i.filterMode],r=e[i.mipmapCount]>0;let a=r?pc.FILTER_NEAREST_MIPMAP_NEAREST:pc.FILTER_NEAREST,o=pc.FILTER_NEAREST;n===UnityEngine.FilterMode.Bilinear?(a=r?pc.FILTER_LINEAR_MIPMAP_NEAREST:pc.FILTER_LINEAR,o=pc.FILTER_LINEAR):n===UnityEngine.FilterMode.Trilinear&&(a=r?pc.FILTER_LINEAR_MIPMAP_LINEAR:pc.FILTER_LINEAR,o=pc.FILTER_LINEAR);const h=e[i.wrapMode]===UnityEngine.TextureWrapMode.Repeat?pc.ADDRESS_REPEAT:pc.ADDRESS_CLAMP_TO_EDGE,c=new pc.Texture(this.graphicsDevice,{width:s,height:s,minFilter:a,magFilter:o,addressU:h,addressV:h,anisotropy:Math.min(this.graphicsDevice.maxAnisotropy,e[i.anisoLevel]),cubemap:!0,mipmaps:r,rgbm:!!e[i.hdr],flipY:!0,atlas:this.registry.Get(e[i.atlasId]),rects:e[i.rects]});return c.upload(),this.registry.Put(t.id,c),System.Threading.Tasks.Task.fromResult(c)},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.Resources",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){t.deserializeTo(e.data,UnityEngine.Resources,"Luna.Unity.DTO.UnityEngine.Assets.Resources");const s=LunaUnity.Objects.Bundle.handlers.project_settings;return LunaUnity.Objects.Bundle.handlers.prefab_component.load(s.autoInstantiatePrefabs),{}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.TextAsset"];Bridge.define("LunaUnity.Objects.Handlers.TextAsset",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,s){const n=new UnityEngine.TextAsset;return n.data=e.data[i.data],n.name=e.data[i.name],n.bytes64=e.data[i.bytes64],this.registry.Put(e.id,n),{result:n}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.ScriptableObject",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){try{const i=Deserializers.types[e.class],s=t.d(i,e.data);return s.name=e.name,s?(this.registry.Put(e.id,s),{result:s}):(console.warn("Failed to instantiate ScriptableObject of type "+i),System.Threading.Tasks.Task.fromResult(!0))}catch(t){return console.warn("Cannot put scriptable object with id "+e.id+": "+t),null}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationClip"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationCurve"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationEvent"];Bridge.define("LunaUnity.Objects.Handlers.AnimationClip",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,r){const a=e.data,o=new UnityEngine.AnimationClip,h=r.find((t=>t.manifest.id===e.assetBundleId)).blob;o.name=a[i.name],o.length=a[i.length],o.wrapMode=a[i.wrapMode],o.isLooping=a[i.isLooping];const c=a[i.curves];o.curves=new Array(c.length);for(let e=0;e<c.length;e++){const n=c[e],r=n[s.keys],l=h.slice(r[0],r[0]+r[1]),u=a[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):new Float32Array(l)||[],d=n[s.objectReferenceKeys]||[],_=new Array(Math.floor(u.length/7)+d.length);for(let t=0;t<u.length;t+=7)_[t/7]=new pc.Keyframe(u[t],u[t+1],u[t+2],u[t+3],u[t+4],u[t+5],u[t+6]);for(let e=0;e<d.length;e++){const i=d[e];_[e+u.length/7]=t.deserializeTo(i,new pc.Keyframe,"Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationCurve+ObjectReferenceKey")}const p={path:n[s.path],componentType:n[s.componentType],property:n[s.property],keyframes:_};o.curves[e]=new pc.AnimationCurve(p),d.length>0&&(o.curves[e].objectCurve=!0)}const l=a[i.events];o.events=new Array(l.length);for(let e=0;e<l.length;e++){const i=l[e],s=new UnityEngine.AnimationEvent;s.functionName=i[n.functionName],s.floatParameter=i[n.floatParameter],s.intParameter=i[n.intParameter],s.stringParameter=i[n.stringParameter],s.time=i[n.time],t.r(i[n.objectReferenceParameter],i[n.objectReferenceParameter+1],0,s,"objectReferenceParameter"),o.events[e]=s}return this.registry.Put(e.id,o),{result:o}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animations.BlendTree"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animations.ChildMotion"];Bridge.define("LunaUnity.Objects.Handlers.BlendTree",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,n){const r=e.data,a=new UnityEditor.Animations.BlendTree;a.name=r[i.name],a.blendParameter=r[i.blendParameter],a.blendParameterY=r[i.blendParameterY],a.blendType=r[i.blendType],a.children=r[i.children],a.useAutomaticThresholds=r[i.useAutomaticThresholds],a.minThreshold=r[i.minThreshold],a.maxThreshold=r[i.maxThreshold];const o=r[i.children];a.children=new Array(o.length);for(let e=0;e<o.length;++e){const i=new UnityEditor.Animations.ChildMotion,n=o[e];t.r(!0,n[s.motion+1],0,i,"motion"),i.position=new pc.Vec2,i.position.x=n[s.position+0],i.position.y=n[s.position+1],i.threshold=n[s.threshold],i.timeScale=n[s.timeScale],i.cycleOffset=n[s.cycleOffset],i.directBlendParameter=n[s.directBlendParameter],i.mirror=n[s.mirror],a.children[e]=i}return this.registry.Put(e.id,a),{result:a}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.AnimatorController",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){const s=t.d("Luna.Unity.DTO.UnityEngine.Animation.Mecanim.AnimatorController",e.data),n=new UnityEditor.Animations.AnimatorController.$ctor1(s,this.registry);return this.registry.Put(e.id,n),{result:n}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Font"];Bridge.define("LunaUnity.Objects.Handlers.Font",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,s){const n=e.data,r={name:n[i.name],ascent:n[i.ascent],originalLineHeight:n[i.originalLineHeight],fontSize:n[i.fontSize],originalFontSize:n[i.originalFontSize],characterInfo:n[i.characterInfo],texture:this.registry.TryGet(e.data[i.texture+1])},a=new pc.Font(e.font,r);return this.registry.Put(e.id,a),pc.Font.fonts=pc.Font.fonts||{},pc.Font.fonts[e.data[i.name]]=a,pc.Font.fonts[e.data[i.name].replace("-Regular","")]=a,UnityEngine.Font.FontDefault&&"Arial"!==e.data[i.name]||(UnityEngine.Font.FontDefault=new UnityEngine.Font(a)),{result:a}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.PrefabComponent",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},load:function(t){if(t)return;const e=UnityEngine.Resources.componentToPrefabIds;for(let t=0;t<e.length;t+=2){const i=e[t].toString(),s=e[t+1].toString();this.registry.Put(i,{isPrefabProxy:!0,componentId:i,prefabId:s})}}})})),window.System$Collections$Generic$ICollection$1$Function$contains="contains",window.System$Collections$Generic$ICollection$1$Function$getItem="getItem",window.System$Collections$Generic$ICollection$1$Function$setItem="setItem",window.System$Collections$Generic$ICollection$1$Function$removeItem="removeItem",window.System$Collections$Generic$IDictionary$2$Function$Function$add="add",window.System$Collections$Generic$IDictionary$2$Function$Function$containsKey="containsKey",window.System$Collections$Generic$IDictionary$2$Function$Function$getItem="getItem",window.System$Collections$Generic$IDictionary$2$Function$Function$setItem="setItem",window.System$Collections$Generic$IDictionary$2$Function$Function$removeItem="removeItem",Bridge.ns=function(t,e){const i=t.split(".");let s=0;if(e||(e=Bridge.global),e===Bridge.global&&(window.$typeCache=window.$typeCache||{},window.$typeCache[t]))return window.$typeCache[t];for(s=0;s<i.length;s++)void 0===e[i[s]]&&(e[i[s]]={}),e=e[i[s]];return e===Bridge.global&&(window.$typeCache[t]=e),e},System.Threading.Tasks.Task.prototype.setSynchronous=function(t){this._synchrounous=t},System.Threading.Tasks.Task.prototype.continueWith=function(t,e){const i=new System.Threading.Tasks.TaskCompletionSource,s=this,n=e?function(){i.setResult(t(s))}:function(){try{i.setResult(t(s))}catch(t){i.setException(System.Exception.create(t))}};return this.isCompleted()?this._synchrounous?n():setTimeout(n,0):this.callbacks.push(n),i.task},window.utf8ArrayToStr=function(){const t=new Array(128),e=String.fromCodePoint||String.fromCharCode,i=[];return"undefined"!=typeof TextEncoder?function(t){return t?new TextDecoder("utf-8").decode(t):""}:function(s){let n,r;const a=s.length;i.length=0;for(let o=0;o<a;)r=s[o++],r<=127?n=r:r<=223?n=(31&r)<<6|63&s[o++]:r<=239?n=(15&r)<<12|(63&s[o++])<<6|63&s[o++]:String.fromCodePoint?n=(7&r)<<18|(63&s[o++])<<12|(63&s[o++])<<6|63&s[o++]:(n=63,o+=3),i.push(t[n]||(t[n]=e(n)));return i.join("")}}(),function(){if(!DEBUG)return;const t=function(){const t=this;if(!(t instanceof pc.Vec2&&!Number.isNaN(t.x)&&!Number.isNaN(t.y))){const t=new Error("NaN in Vec2");console.error(t.stack)}},e=function(){const t=this;if(!(t instanceof pc.Vec3&&!Number.isNaN(t.x)&&!Number.isNaN(t.y)&&!Number.isNaN(t.z))){const t=new Error("NaN in Vec3");console.error(t.stack)}},i=function(){const t=this;if(!(t instanceof pc.Vec4&&!Number.isNaN(t.x)&&!Number.isNaN(t.y)&&!Number.isNaN(t.z)&&!Number.isNaN(t.w))){const t=new Error("NaN in Vec4");console.error(t.stack)}},s=function(){const t=this;if(!(t instanceof pc.Quat&&!Number.isNaN(t.x)&&!Number.isNaN(t.y)&&!Number.isNaN(t.z)&&!Number.isNaN(t.w))){const t=new Error("NaN in Quat");console.error(t.stack)}},n=function(t,e,i){const s=t[e];t[e]=function(...t){const e=s.apply(this,t);return i.call(this),e}};n(pc.Vec2.prototype,"add",t),n(pc.Vec2.prototype,"add2",t),n(pc.Vec2.prototype,"sub",t),n(pc.Vec2.prototype,"sub2",t),n(pc.Vec2.prototype,"set",t),n(pc.Vec2.prototype,"copy",t),n(pc.Vec2.prototype,"lerp",t),n(pc.Vec2.prototype,"mul",t),n(pc.Vec2.prototype,"mul2",t),n(pc.Vec2.prototype,"normalize",t),n(pc.Vec2.prototype,"scale",t),n(pc.Vec3.prototype,"add",e),n(pc.Vec3.prototype,"add2",e),n(pc.Vec3.prototype,"sub",e),n(pc.Vec3.prototype,"sub2",e),n(pc.Vec3.prototype,"set",e),n(pc.Vec3.prototype,"copy",e),n(pc.Vec3.prototype,"cross",e),n(pc.Vec3.prototype,"lerp",e),n(pc.Vec3.prototype,"mul",e),n(pc.Vec3.prototype,"mul2",e),n(pc.Vec3.prototype,"normalize",e),n(pc.Vec3.prototype,"project",e),n(pc.Vec3.prototype,"scale",e),n(pc.Vec4.prototype,"add",i),n(pc.Vec4.prototype,"add2",i),n(pc.Vec4.prototype,"sub",i),n(pc.Vec4.prototype,"sub2",i),n(pc.Vec4.prototype,"set",i),n(pc.Vec4.prototype,"copy",i),n(pc.Vec4.prototype,"lerp",i),n(pc.Vec4.prototype,"mul",i),n(pc.Vec4.prototype,"mul2",i),n(pc.Vec4.prototype,"normalize",i),n(pc.Vec4.prototype,"scale",i),n(pc.Quat.prototype,"clone",s),n(pc.Quat.prototype,"copy",s),n(pc.Quat.prototype,"conjugate",s),n(pc.Quat.prototype,"negate",s),n(pc.Quat.prototype,"invert",s),n(pc.Quat.prototype,"mul",s),n(pc.Quat.prototype,"mul2",s),n(pc.Quat.prototype,"nearest",s),n(pc.Quat.prototype,"normalize",s),n(pc.Quat.prototype,"set",s),n(pc.Quat.prototype,"fromTo",s),n(pc.Quat.prototype,"setFromAxisAngle",s),n(pc.Quat.prototype,"setFromEulerAngles",s),n(pc.Quat.prototype,"setFromMat4",s),n(pc.Quat.prototype,"slerp",s),n(pc.Quat.prototype,"slerpUnclamped",s),n(pc.Quat.prototype,"setLookAt",s)}();